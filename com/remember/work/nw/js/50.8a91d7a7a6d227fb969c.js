webpackJsonp([50],{"+sNG":function(t,e){t.exports="https://snkoudai.oss-cn-hangzhou.aliyuncs.com/goverment/static/img/sensor2_on.39d0fe9.png"},"0e/S":function(t,e){t.exports="https://snkoudai.oss-cn-hangzhou.aliyuncs.com/goverment/static/img/weather_top.8afb8ae.gif"},"5y8e":function(t,e){t.exports="https://snkoudai.oss-cn-hangzhou.aliyuncs.com/goverment/static/img/weather2_lower.87e225d.png"},AJ8d:function(t,e){t.exports="https://snkoudai.oss-cn-hangzhou.aliyuncs.com/goverment/static/img/weatherbg_1.22fdf1b.png"},B4o8:function(t,e){t.exports="https://snkoudai.oss-cn-hangzhou.aliyuncs.com/goverment/static/img/poster.e8c2c6c.jpg"},FChz:function(t,e){t.exports="https://snkoudai.oss-cn-hangzhou.aliyuncs.com/goverment/static/img/sensor2.4975d50.png"},Ivz0:function(t,e){t.exports="https://snkoudai.oss-cn-hangzhou.aliyuncs.com/goverment/static/img/weather_on.9596a4d.png"},KUkP:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});i("PvbX"),i("wg9G");var a=i("wD5Q"),n=i.n(a),s=i("OZzv"),o=i.n(s),r=i("VCTt"),l={data:function(){return{iotMarkData:[]}},methods:{getAllDatefn:function(){var t=this;t.$ajax.post(this.$api.plotlist.urlGetIot,{areaId:this.areaId,areaType:this.areaLevel}).then(function(e){e.data&&0==e.data.respCode&&(t.iotMarkData=e.data.obj,t.initIotMark())})},initIotMark:function(){for(var t=0;t<this.iotMarkData.length;t++)1==this.iotMarkData[t].iotType?this.addmark({src:i("x/VB"),latlng:[this.iotMarkData[t].lat,this.iotMarkData[t].lng],type:"sensor",index:t,farmid:this.iotMarkData[t].farmId,configid:this.iotMarkData[t].id,layertit:this.iotMarkData[t].pointName}):2==this.iotMarkData[t].iotType?this.addmark({src:i("mrfU"),latlng:[this.iotMarkData[t].lat,this.iotMarkData[t].lng],type:"video",index:t,farmid:this.iotMarkData[t].farmId}):3==this.iotMarkData[t].iotType&&this.addmark({src:i("LCol"),latlng:[this.iotMarkData[t].lat,this.iotMarkData[t].lng],type:"weather",index:t,farmid:this.iotMarkData[t].farmId,configid:this.iotMarkData[t].id,layertit:this.iotMarkData[t].pointName});$(".leaflet-marker-pane").get(0).setAttribute("class","leaflet-pane leaflet-marker-pane "+this.zoommapclass[this.map.getZoom()])},addmark:function(t){var e=this,i=!!t.hasOwnProperty("configid")&&t.configid,a=t.hasOwnProperty("layertit")?t.layertit:"",n=L.icon({iconUrl:t.src,iconSize:[30,45],type:t.type,className:t.type+"_marker markitem",index:t.index,configid:i,layertit:a});L.marker({lat:t.latlng[0],lng:t.latlng[1]},{icon:n,farmid:t.farmid}).addTo(e.map).on("click",function(t){e.farmid=t.sourceTarget.options.farmid,e.closeDialog(),e.syncAreaSelectfn([],!0);var i=t.sourceTarget.options.icon.options.configid,a=t.sourceTarget.options.icon.options.layertit,n=t.sourceTarget.options.icon.options.type,s=t.sourceTarget.options.icon.options.index,o=2*$(t.target._icon).offset().left-$(window).width()+16,r=2*$(t.target._icon).offset().top-$(window).height()+16;$(".homeMap .homemap_content .anilayertemp").removeClass("hidden").find("span").css("margin",r+"px 0 0 "+o+"px").removeClass("weatheranimate"),"weather"==n&&$(".homeMap .homemap_content .anilayertemp span").addClass("weatheranimate"),e.layertit=a,e.initmarklayer(n,s,t.target._icon,t.latlng,i),setTimeout(function(){e.backmarkericon(n,t.target._icon)},400)})},markerEditWithZoom:function(t){$(".leaflet-marker-pane").get(0).setAttribute("class","leaflet-pane leaflet-marker-pane "+this.zoommapclass[t])},syncAreaSelectfn:function(t,e){if(!t||0==t.length)return window.layer.closeAll("page"),this.plotdialogVisible=!1,$(".plantlistcon ul li.active, .arealistcon ul li.active").removeClass("active"),!1;if(e)var i=null;else i=[];for(var a=0;a<t.length;a++)for(var n=0;n<this.allpolygon.length;n++)this.allpolygon[n].areaid==t[a]&&(e?(i=this.allpolygon[this.allpolygon[n].index],$(".homemap_maplayer .arealistcon ul li.active").removeClass("active"),s(t[a]),this.initAreaPlantLayer(t[a])):i.push(this.allpolygon[n].index));function s(t){$(".arealistcon ul li").each(function(){$(this).attr("areaid")==t&&$(this).addClass("active")})}this.selectedArea(i,e)},mapMovePos:function(t,e,i){var a=this;setTimeout(function(){var n=a.map.getPixelBounds(),s=n.max.y-n.min.y,o=a.map.getBounds(),r=o._northEast.lat-o._southWest.lat;if("area"==t)var l=r/4,c=i;else l=0,c=i;var d=c.lat+l+r*(e/s),p=c.lng;a.map.panTo({lat:d,lng:p})},600)},weather:function(t){var e=this;layer.open({type:1,id:"weatherPop",skin:"anilayer slidecontrol weatherlayer",resize:!1,content:'<div class="equiplayer sensormonitor"><div class="loader historyload" style="padding: 29% 0 0 50%;"><div class="loader-inner ball-spin-fade-loader"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div></div>',title:!1,area:["779px","519px"],shade:0,anim:-1,success:function(i,a){e.getWeatherInfo(t)},end:function(t,i){e.backmarkericon()}})},getWeatherInfo:function(t){var e=this;e.$ajax.post(this.$api.landSource.sensorlist,{configId:t,farmId:e.farmid}).then(function(t){t.data&&0==t.data.respCode?e.weatherLayout(t.data.obj.weatherStation):500==t.data.respCode&&e.$message({type:"warning",message:t.data.respDesc,center:!0})})},weatherLayout:function(t){var e="";if(t.isOnline&&t.slotList.length>0)t.slotList.forEach(function(t,i){if(2305==t.sensorTypeID){for(var a=[{label:"北",arr:[15,16,0]},{label:"东北",arr:[1,2]},{label:"东",arr:[3,4]},{label:"东南",arr:[5,6]},{label:"南",arr:[7,8]},{label:"西南",arr:[9,10]},{label:"西",arr:[11,12]},{label:"西北",arr:[13,14]}],n=Math.floor(t.data/22.5),s=0,o=0;o<8;o++)if(-1!=$.inArray(n,a[o].arr)){s=o;break}e+='<div class="weatheritem w1">\n\t\t\t\t\t\t\t\t\t\t\t<p>风向</p>\n\t\t\t\t\t\t\t\t\t\t\t<p class="value">'+a[s].label+"</p>\n\t\t\t\t\t\t\t\t\t\t</div>"}else 2049==t.sensorTypeID?e+='<div class="weatheritem w2">\n\t\t\t\t\t\t\t\t\t\t\t<p>风速</p>\n\t\t\t\t\t\t\t\t\t\t\t<p class="value">'+l(t.data,1)+t.unit+"</p>\n\t\t\t\t\t\t\t\t\t\t</div>":5377==t.sensorTypeID?e+='<div class="weatheritem w3">\n\t\t\t\t\t\t\t\t\t\t<p>光照度</p>\n\t\t\t\t\t\t\t\t\t\t<p class="value">'+parseInt(t.data)+t.unit+"</p>\n\t\t\t\t\t\t\t\t\t</div>":769==t.sensorTypeID?e+='<div class="weatheritem w4">\n\t\t\t\t\t\t\t\t\t\t<p>空气湿度</p>\n\t\t\t\t\t\t\t\t\t\t<p class="value">'+l(t.data,1)+t.unit+"</p>\n\t\t\t\t\t\t\t\t\t</div>":770==t.sensorTypeID?e+='<div class="weatheritem w5">\n\t\t\t\t\t\t\t\t\t\t<p>空气温度</p>\n\t\t\t\t\t\t\t\t\t\t<p class="value">'+l(t.data,1)+t.unit+"</p>\n\t\t\t\t\t\t\t\t\t</div>":12802==t.sensorTypeID?e+='<div class="weatheritem w6">\n\t\t\t\t\t\t\t\t\t<p>PM2.5</p>\n\t\t\t\t\t\t\t\t\t<p class="value">'+l(t.data,1)+t.unit+"</p>\n\t\t\t\t\t\t\t\t</div>":41217==t.sensorTypeID?e+='<div class="weatheritem w7">\n\t\t\t\t\t\t\t\t\t\t<p>大气压强</p>\n\t\t\t\t\t\t\t\t\t\t<p class="value">'+l(t.data,1)+t.unit+"</p>\n\t\t\t\t\t\t\t\t\t</div>":41473==t.sensorTypeID&&(e+='<div class="weatheritem w8">\n\t\t\t\t\t\t\t\t\t\t<p>降水量</p>\n\t\t\t\t\t\t\t\t\t\t<p class="value">'+l(t.data,1)+t.unit+"</p>\n\t\t\t\t\t\t\t\t\t</div>")});else{var a=t.hasOwnProperty("isOnline")&&!t.isOnline?"离线":"--",n=t.hasOwnProperty("isOnline")&&!t.isOnline?"":"ftcolor";[{label:"风向",classname:"w1"},{label:"风速",classname:"w2"},{label:"光照度",classname:"w3"},{label:"空气湿度",classname:"w4"},{label:"空气温度",classname:"w5"},{label:"PM2.5",classname:"w6"},{label:"大气压强",classname:"w7"},{label:"降水量",classname:"w8"}].forEach(function(t,i){e+='<div class="weatheritem '+t.classname+' gray">\n\t\t\t\t\t\t\t\t\t\t<p>'+t.label+'</p>\n\t\t\t\t\t\t\t\t\t\t<p class="value  '+n+'">'+a+"</p>\n\t\t\t\t\t\t\t\t\t</div>"})}var s=i("rO80"),o=i("AJ8d"),r='<div class="title"><p class="txt">'+this.layertit+'</p><span class="closebtn ivu-modal-close" onClick="window.layer.closeAll()"></span></div>\n\t\t\t\t\t\t\t\t<div class="weathercon">\n\t\t\t\t\t\t\t\t\t<div class="weather_bgimgs">\n\t\t\t\t\t\t\t\t\t\t<p><img src="'+s+'" alt="" /></p><p><img src="'+o+'" alt="" /></p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="weather_items">'+e+"</div>\n\t\t\t\t\t\t\t\t</div>";function l(t,e,i){return 0!=t?3==arguments.length&&i?(t*=100,parseInt(t*Math.pow(10,e)+.5,10)/Math.pow(10,e)+"%"):parseInt(t*Math.pow(10,e)+.5,10)/Math.pow(10,e):3==arguments.length&&i?"0%":0}$("#weatherPop .sensormonitor").html(r)},videomonitor:function(t){var e=this,i='<div class="equiplayer videomonitor"> <p class="title"><span class="pyc videotitle">'+e.iotMarkData[t].pointName+'</span><span class="closebtn" onClick="window.layer.closeAll()"></span></p> <div id="videomonitor"> <div class="loader videoload"> <div class="loader-inner ball-spin-fade-loader"> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> </div> </div> </div> </div>';layer.open({type:1,skin:"anilayer slidecontrol cameralayer",resize:!1,content:i,title:!1,area:["659px","399px"],shade:0,anim:-1,success:function(i,a){setTimeout(function(){e.initvideo($("#videomonitor"),e.iotMarkData[t].hlsUrl)},800)},end:function(t,i){e.playerobj&&e.playerobj.stopload(),e.playerobj=null,e.backmarkericon()}})},sensormonitor:function(t){var e=this;layer.open({type:1,skin:"anilayer slidecontrol sensormonitorlayer",resize:!1,content:'<div class="equiplayer sensormonitor"><div class="loader historyload" style="padding: 29% 0 0 50%;"><div class="loader-inner ball-spin-fade-loader"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div></div>',title:!1,area:["659px","399px"],shade:0,anim:-1,success:function(i,a){e.getsensorlist(t,function(i,a){$(".sensormonitorlayer .sensormonitor").html(i),$(".sensormonitor .sensorlist").niceScroll({cursorcolor:"rgba(0, 247, 255 ,0.4)",cursorwidth:"4px",cursorborder:"none",autohidemode:!0,railoffset:!0,railpadding:{top:0,right:5,left:0,bottom:0}}),$(".sensormonitor .sensorlist ul li").each(function(t,i){e.zanumber($(this).find(".sensoritem .sensornum"))}),a.length>1?$(".sensormonitor .sensorlist ul").on("click",".senhistory_btn",function(){var i=$(this).closest("li");if(i.hasClass("active")){$(this).closest("li").removeClass("active").siblings("li").removeClass("active").show(),i.find(".sensor_history").html('<div class="historycon"></div>');var n=$(this).closest(".sensorlist").data("scrollT");$(".sensormonitor .sensorlist").scrollTop(Math.abs(n))}else{n=$(this).closest(".sensormonitor .sensorlist").scrollTop();$(this).closest(".sensorlist").data("scrollT",n),$(".sensormonitor .sensorlist").getNiceScroll().hide(),i.addClass("active").siblings("li").removeClass("active").hide(),e.inithistory(i.find(".historycon"),a[i.index()],t)}}):1==a.length&&($(".sensormonitor .sensorlist").getNiceScroll().hide(),$(".sensormonitor .sensorlist ul li").addClass("active").siblings("li").removeClass("active").hide(),e.inithistory($(".sensormonitor .sensorlist ul li").find(".historycon"),a[0],t),$(".sensormonitor .sensorlist ul li span.splitline,.sensormonitor .sensorlist ul li .senhistory_btn").remove(),$(".sensormonitor .sensorlist ul li .sensoritem").css("width","499px"))})},end:function(t,i){e.backmarkericon()}})},getsensorlist:function(t,e){var i=this;this.$ajax.post(i.$api.landSource.sensorlist,{farmId:this.farmid,configId:t}).then(function(t){if(t.data&&0==t.data.respCode){var a=t.data.obj.sensorDeviceList,n='<div class="equiplayercon"> <div class="title"><p class="txt">'+i.layertit+'</p><span class="closebtn" onClick="window.layer.closeAll()"></span></div><div class="sensorlist"><ul class="clearfix">';a.forEach(function(t,e){n+='<li>\n\t\t\t\t\t\t\t\t<div class="sensorlicon clearfix">\n\t\t\t\t\t\t\t\t\t<div class="sensoricon"><img src="../../static/sensor_icon/'+t.sensorTypeID+'.png" alt="" /></div>\n\t\t\t\t\t\t\t\t\t<div class="sensoritem">\n\t\t\t\t\t\t\t\t\t\t<p>'+t.deviceName+"</p>\n\t\t\t\t\t\t\t\t\t\t<p>单位：<span>"+(t.unit||"无")+"</span></p>",t.data||0==t.data?n+='<div class="sensornum za_number" num="'+t.data+'"></div>':n+='<div class="sensornum za_number" style="font-size: 24px; color: #2f896d; line-height: 32px;">离线</div>',n+='</div> <span class="splitline"></span> <div class="senhistory_btn"></div> </div> <div class="sensor_history"> <div class="historycon"></div> </div> </li>'}),e(n+="</ul></div></div>",a)}else 500==t.data.respCode&&i.$message({type:"warning",message:t.data.respDesc,center:!0})})},backmarkericon:function(t,e){$(".layui-layer-setwin").remove(),$("#mapbox .leaflet-map-pane .leaflet-marker-pane img.sensor_marker").attr("src",i("x/VB")).removeClass("active"),$("#mapbox .leaflet-map-pane .leaflet-marker-pane img.video_marker").attr("src",i("mrfU")).removeClass("active"),$("#mapbox .leaflet-map-pane .leaflet-marker-pane img.weather_marker").attr("src",i("LCol")).removeClass("active"),2==arguments.length&&("sensor"==t?e.src=i("o9yN"):"video"==t?e.src=i("rBfV"):"weather"==t&&(e.src=i("Ivz0")),$(e).addClass("active"))},initmarklayer:function(t,e,i,a,n){5==arguments.length&&("sensor"==t?this.sensormonitor(n):"video"==t?this.videomonitor(e):"weather"==t&&this.weather(n),a&&this.markcenter(a)),a&&this.markcenter(a),setTimeout(function(){$(".homeMap .homemap_content .anilayertemp").addClass("hidden")},400)},inithistory:function(t,e,i){var a=this,n=t;n.html('<div class="loader historyload"><div class="loader-inner ball-spin-fade-loader"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>'),function(t){a.$ajax.post(a.$api.landSource.sensorhistory,{farmId:a.farmid,deviceId:e.deviceID,slotId:e.slotID,configId:t}).then(function(t){if(t.data&&0==t.data.respCode){for(var e=t.data.obj.dataList,i=[],s=[],o=0;o<e.length;o++)i.push(new Date(e[o].time).format("MM.dd hh:mm")),s.push(e[o].close);!function(t,e,i,n){if(!n)return!1;if(!e.length&&!i.length)return void(n.innerHTML='<div style="padding-top:100px;text-align:center;font-size:16px;">暂无数据<div>');var s=a.$echarts.init(n),o={title:{show:!1,text:"",subtext:""},tooltip:{show:!0,trigger:"axis",borderColor:"#308A6E",backgroundColor:"#64C3A4",padding:[5,10,2],textStyle:{color:"#fff"},formatter:function(t){return"<p style='text-align:center;line-height:16px;'>"+t[0].name+"<br/>数值："+t[0].value+"</p>"},axisPointer:{lineStyle:{color:"#6ffb70",width:1},crossStyle:{color:"#308A6E",width:3}}},legend:{data:[]},toolbox:{show:!1},calculable:!1,xAxis:[{type:"category",boundaryGap:!1,data:e,splitLine:{show:!1},axisLabel:{show:!0,textStyle:{color:"#73867A"},formatter:function(t){return t.split(" ")[0]+"\n"+t.split(" ")[1]}},axisLine:{lineStyle:{color:"#308A6E",width:1}}}],yAxis:[{type:"value",splitLine:{show:!0,lineStyle:{color:"rgba(48,138,110,0.2)"}},axisLabel:{show:!0,textStyle:{color:"#73867A"}},axisLine:{lineStyle:{color:"#308A6E",width:1}}}],grid:{x:50,y:20,x2:23,y2:40,borderWidth:0},series:[{name:"传感器历史数据",type:"line",smooth:!0,clickable:!1,itemStyle:{normal:{color:"#64C3A4",lineStyle:{color:"#64C3A4"},areaStyle:{color:"rgba(109, 250, 115, 0.1)"}},emphasis:{lineStyle:{color:"#fff"}}},data:i,symbol:"circle",symbolSize:0}]};s.setOption(o)}(t.data.obj.unit,i,s,n.get(0))}})}(i)},initvideo:function(t,e){var a=this;function n(e){var n=0,s=null,o=null;function r(t){o=setInterval(function(){window.TcPlayer&&(a.playerobj=function(t){if(!(t.idname&&t.src&&t.width&&t.height))return!1;var e={m3u8:t.src,width:t.width,height:t.height,autoplay:!0,coverpic:{style:"stretch",src:t.poster||""},live:!0,flash:!1,x5_player:!0,x5_type:!0,x5_fullscreen:!0,listener:function(t){var e=t.src.player.el.querySelector(".vcp-loading");if("error"==t.type?i.options.src&&(e.setAttribute("style","display:none;"),i.timer_errordoing=setTimeout(function(){!i.playing()&&i.errorreload_i<3?(console.log("重新loading"),i.load(i.options.src),i.errorreload_i++,e.setAttribute("style","display:block;")):e.setAttribute("style","display:none;"),clearTimeout(i.timer_errordoing)},3e3)):i.playing()&&(clearTimeout(i.timer_errordoing),e.setAttribute("style","display:none;")),!i.initreflashbtn){i.initreflashbtn=!0;var a=document.createElement("div");a.className="vcp-reflashbtn",a.addEventListener("click",function(){console.log("手动重新loading"),i&&i.video&&i.video.hls&&i.video.hls.stopLoad(),e.setAttribute("style","display:block;"),clearTimeout(i.timer_errordoing),i.load(i.options.src)}),setTimeout(function(){t.src.player.el.querySelector(".vcp-controls-panel").appendChild(a)},600)}}};t.setoptionfn&&(e=t.setoptionfn(e));var i=new TcPlayer(t.idname,e);return i.timer_errordoing=null,i.errorreload_i=0,i.initreflashbtn=!1,i.stopload=function(){i&&i.video&&i.video.hls&&i.video.hls.stopLoad(),i=null},i}({idname:"videoitem",src:t,width:"560",height:"315",poster:i("B4o8")}),clearInterval(o))},300)}t.html('<div id="videoitem" class="videobaseStyle"></div>'),r(e),s=setInterval(function(){if(""==$("#videoitem").html()){if(console.log("出错："+n),n>=3)return clearInterval(s),clearInterval(o),t.html('<p style="font-size: 20px; color: #71e8cf; text-align: center; line-height: 303px;">视频连接失败，请刷新浏览器重试</p>'),!1;r(e),n++}else clearInterval(s),clearInterval(o)},1e3)}a.playerobj&&a.playerobj.stopload(),window.TcPlayer?n(e):$.getScript("https://snkoudai.oss-cn-hangzhou.aliyuncs.com/common/common-js/snkoudai-web/js/TcPlayer-2.2.2.js",function(){$.getScript("https://snkoudai.oss-cn-hangzhou.aliyuncs.com/common/common-js/snkoudai-web/js/hls.min.0.8.9.js",function(){n(e)})})},markcenter:function(t){this.mapMovePos("area",120,t)},zanumber:function(t){var e=t.attr("num");if(!isNaN(e)&&(e=Number(e)+"").split("").length>0){for(var i=e.split(""),a="",n=0;n<i.length;n++)"."==i[n]?a+='<span class="number_pointer"></span>':isNaN(i[n])?a+='<span class="number_other">'+i[n]+"</span>":a+='<span class="number_'+i[n]+'"></span>';t.html(a),setTimeout(function(){t.find("span").not(".number_pointer").addClass("aninum")},0)}},pageback:function(){this.$router.push({path:"/home/landSource"})}}},c=i("Xtqa");function d(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function p(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,i){return function a(n,s){try{var o=e[n](s),r=o.value}catch(t){return void i(t)}if(!o.done)return Promise.resolve(r).then(function(t){a("next",t)},function(t){a("throw",t)});t(r)}("next")})}}var m=i("FChz"),u=i("mrfU"),v=i("LCol"),h=i("+sNG"),g=i("rBfV"),f=i("Ivz0"),y=i("B4o8"),b=/(http[s]?:\/\/)[a-zA-Z0-9\.\/\_\-\:]*(?=\?)/,w=/(layers=)([a-zA-Z0-9\%\_\-]*)(\&)/,x=["a1LbLHpaiF0","a1gtsBcBv8B","a1VcM7zpCpr"],k={data:function(){return{newVersionFlag:null,totalSensor:0,totalController:0,markProductPosition:[],oldImageLayers:null,oldGisLayers:null,whatLayerWasLast:null,gisTabs:[],selectedGisTabs:0,teamLegend:null,hisBsFlag:!1,sensorHsBs:null}},mounted:function(){},methods:{getDeviceDetail:function(t){return this.$ajax.post(this.$api.farmDetail.getDeviceDetailState,{deviceId:t,farmId:this.farmid}).then(function(t){var e=t.data;if(0===e.respCode)return e.obj})},getDeviceHistory:function(t,e){return this.$ajax.post(this.$api.farmDetail.getDeviceHistory,{farmId:this.farmid,deviceId:t,identifier:e}).then(function(t){var e=t.data;if(0===e.respCode)return e.obj})},getDevicesAllPosition:function(){return this.$ajax.post(this.$api.plotlist.getIotLocationAllFarm,{areaId:this.areaId,farmAreaType:this.areaLevel}).then(function(t){var e=t.data;if(0===e.respCode)return e.obj})},_initIot:function(){var t=this;return p(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getDevicesAllPosition();case 2:e.sent.forEach(function(e){t.processIot(e)}),t._initIotMark();case 5:case"end":return e.stop()}},e,t)}))()},processIot:function(t){var e=t.farmVO,i=t.locationDTO,a=i.cameraList?i.cameraList.map(function(t){return{lat:t.lat,lng:t.lng,id:t.id,pointName:t.displayName,iotType:2,hlsUrl:t.hlsUrl,hlsUrlHd:t.hlsUrlHd,updateTime:t.updateTime,farmId:e.farmId}}):[],n=i.gateDeviceList?i.gateDeviceList.map(function(t){return{lat:t.lat,lng:t.lng,id:t.id,pointName:t.clientDisplayName,iotType:"INTEGRATED"===t.productVO.productType?3:1,hlsUrl:null,updateTime:null,productKey:t.productVO.productKey,farmId:e.farmId}}):[];this.markProductPosition=[].concat(d(this.markProductPosition),d(a),d(n))},_initIotMark:function(){var t=this;this.markProductPosition.forEach(function(e,i){var a=[e.lat,e.lng];switch(e.iotType){case 1:t._addMark({src:m,latlng:a,type:"sensor",index:i,farmId:e.farmId,configid:e.id,layertit:e.pointName});break;case 2:t._addMark({src:u,latlng:a,type:"video",index:i,farmId:e.farmId});break;case 3:t._addMark({src:v,latlng:a,type:"weather",index:i,configid:e.id,layertit:e.pointName,farmId:e.farmId})}})},_addMark:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.src,a=e.latlng,n=e.type,s=e.index,o=e.configid,r=void 0!==o&&o,l=e.layertit,c=void 0===l?"":l,d=e.farmId,p=L.icon({iconUrl:i,iconSize:[30,45],type:n,className:n+"_marker markitem",index:s,configid:r,layertit:c,farmId:d});L.marker({lat:a[0],lng:a[1]},{icon:p}).addTo(this.map).on("click",function(e){var i=e.sourceTarget,a=e.target,n=e.latlng;t.closeDialog(),t.syncAreaSelectfn([],!0);var s=i.options.icon.options,o=s.configid,r=s.layertit,l=s.type,c=s.index;t.farmid=s.farmId,t.layertit=r,t._initMarkLayer({type:l,markIndex:c,icon:a._icon,latlng:n,configId:o}),setTimeout(function(){t.recoveryMarkerIcon(l,a._icon)},400)})},_initMarkLayer:function(t){var e=t.type,i=t.markIndex,a=(t.icon,t.latlng),n=t.configId;switch(e){case"video":this._initVideoLayer(i);break;case"sensor":case"weather":this._initGatewayLayer(i,n)}a&&this._mark2Center(a)},_initVideoLayer:function(t){this.plotdialogVisible=!1;var e=this,i='<div class="equiplayer videomonitor">\n        <p class="title">\n          <span class="pyc videotitle">'+this.markProductPosition[t].pointName+'</span>\n          <span class="closebtn" onClick="window.layer.closeAll()"></span>\n        </p>\n        <div id="videomonitor">\n          <div class="loader videoload">\n            <div class="loader-inner ball-spin-fade-loader"> \n              <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> \n            </div> \n          </div> \n        </div> \n      </div>';layer.open({type:1,anim:-1,skin:"anilayer slidecontrol cameralayer",resize:!1,content:i,title:!1,area:["659px","399px"],shade:0,success:function(){setTimeout(function(){e._initVideoPlayer($("#videomonitor"),e.markProductPosition[t])},300)},end:function(){e.playerobj&&e.playerobj.stopload(),e.playerobj=null,e.recoveryMarkerIcon()}})},_initGatewayLayer:function(t,e){var i=this,a=null,n=null;window.layer.open({type:1,skin:"anilayer slidecontrol sensormonitorlayer "+(this.isInterHasImage(t)?"hasImage":""),resize:!1,content:'\n\t\t\t\t<div id="newVersion" class="equiplayer sensormonitor">\n\t\t\t\t\t<div class="equiplayercon">\n\t\t\t\t\t\t<p class="title"><span class="closebtn" onclick="window.layer.closeAll()"></span></p>\n\t\t\t\t\t\t<div class="monitorlistcon">\n\t\t\t\t\t\t\t<div class="monitorlist sensorlist">\n\t\t\t\t\t\t\t\t<div class="loader historyload" style="padding:23% 0 0 50%;">\n\t\t\t\t\t\t\t\t\t<div class="loader-inner ball-spin-fade-loader"><div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div></div><div></div><div></div><div></div><div></div><div></div><div></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>',title:!1,area:["659px",this.isInterHasImage(t)?"514px":"399px"],shade:0,anim:-1,success:function(){var s=this;return p(regeneratorRuntime.mark(function o(){var l,c,d,p,m,u,v,h;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return l=".sensormonitor .monitorlist ul li",s.next=3,i.generateSubDeviceList(t,e);case 3:c=s.sent,d=c.generateDetail,p=c.listTpl,m=d.sensorList,u=d.controllerList,v=null,$(".sensormonitorlayer .sensormonitor").html(p),m.length>3&&(a=Object(r.a)($(".sensormonitor .sensorlist").get(0)),$(".sensormonitor .monitorlist>ul>li").css("overflow","hidden"),a.scrollTo(0,-1),a.scrollTo(0,0)),u.length>3&&(n=Object(r.a)($(".sensormonitor .controlerlist").get(0)),$(".sensormonitor .monitorlist>ul>li").css("overflow","hidden"),n.scrollTo(0,-1),n.scrollTo(0,0)),$(l).each(function(){i._zaNumber($(this).find(".sensoritem .sensornum"))}),(h=$(l).length)>1?(i.hisBsFlag=!1,i.sensorHsBs=null,$(".sensormonitor .sensorlist ul").on("click",".senhistory_btn",function(){var t=$(this).closest("li");t.hasClass("active")?(t.find(".sensor_history").html('<div class="historycon"></div>'),$(this).closest("li").removeClass("active").siblings("li").removeClass("active").show(),a&&(a.refresh(),a.scrollTo(0,v),setTimeout(function(){a.refresh()},300))):(a&&(v=a.y),t.addClass("active").siblings("li").removeClass("active").hide(),i._initHistory(t.find(".historycon"),t.data("index"),m),i.$nextTick(function(){a&&a.refresh()}))})):1===h&&(i.hisBsFlag=!0,$(".sensormonitor .sensorlist>ul>li").addClass("active").siblings("li").removeClass("active").hide(),i._initHistory($(".sensormonitor .sensorlist>ul>li").find(".historycon"),$(".sensormonitor .sensorlist>ul>li").data("index"),m),$(".sensormonitor .sensorlist>ul>li span.splitline,.sensormonitor .sensorlist>ul>li .senhistory_btn").remove(),$(".sensormonitor .sensorlist>ul>li .sensoritem").css("width","499px"),i.$nextTick(function(){a&&a.destroy()})),$(".equiplayer p.title span.layertname").on("click",function(){$(".equiplayer p.title span.layertname").length>1?$(this).addClass("active").siblings("span.layertname").removeClass("active"):$(this).addClass("blue"),$(".sensormonitor .equiplayercon .monitorlist").eq($(this).index()).show().siblings(".monitorlist").hide(),i.hisBsFlag&&setTimeout(function(){i.sensorHsBs&&i.sensorHsBs.refresh()},300)}),$(".equiplayer p.title span.layertname").first().trigger("click");case 17:case"end":return s.stop()}},o,s)}))()},end:function(){i.recoveryMarkerIcon()}})},generateSubDeviceList:function(t,e){var i=this;return p(regeneratorRuntime.mark(function a(){var n,s,o,r,l,c,d,p,m;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return n=i,a.next=3,i.getDeviceDetail(e);case 3:return s=a.sent,o=s.sensorList,r=s.controllerList,l=s.deviceVO,c=s.totalController,d=s.totalSensor,p=s.totalProperty,m='<div class="equiplayercon"><p class="title">',!!p+!!d+!!c===1||!!p+!!d+!!c===0?m+='<span class="layertname">'+n.markProductPosition[t].pointName+"</span>":(p>0&&(m+='<span class="layertname">气象监测</span>'),d>0&&(m+='<span class="layertname">环境监测</span>'),c>0&&(m+='<span class="layertname">远程控制</span>')),m+='<span class="closebtn" onClick="window.layer.closeAll()"></span></p><div class="monitorlistcon '+(i.isInterHasImage(t)?"weatherlayer":"")+'">',p>0&&(m+=i.generateWeatherTpl(l)),m=i.generateSensingTpl("controler",i.generateSensingTpl("sensor",m,o),r),0===d&&0===c&&0===p&&(m+='<div class="monitorlist nodata"><ul class="clearfix"><li class="nodata">暂未连接子设备</li></ul></div>'),m+="</div></div>",a.abrupt("return",{listTpl:m,generateDetail:s});case 18:case"end":return a.stop()}},a,i)}))()},generateWeatherTpl:function(t){var e="",a="",n="",s=t.devicePropertyDTOList,o=i("0e/S"),r=2===t.gateType?i("5y8e"):i("n0y3"),l={Direction:{name:"",value:"--"},Temp:{name:"",value:"--"},Speed:{name:"",value:"--"},Rain:{name:"",value:"--"},Humi:{name:"",value:"--"},Pressure:{name:"",value:"--"},Light:{name:"",value:"--"},PM25:{name:"",value:"--"}};return s.forEach(function(t){a=t.specsNumber?t.specsNumber.unit:"",l[t.identifier].name=t.name,n=t.propertyValue,"bool"!==t.dataType&&"enum"!==t.dataType||(n=JSON.parse(t.specs)[n]),n=(n||"--")+a,l[t.identifier].value=n}),e+='\n\t\t\t\t\t<div class="monitorlist weathercon '+(2===t.gateType?"lower":"")+'">\n\t\t\t\t\t\t<div class="weather_bgimgs">\n\t\t\t\t\t\t\t<p><img style="width:286px" src="'+o+'" alt="" /></p>\n\t\t\t\t\t\t\t<p><img style="width:286px" src="'+r+'" alt="" /></p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="weather_items"> <div class="weatheritem">\n\t\t\t\t\t\t\t<p>'+l.Direction.name+'</p>\n\t\t\t\t\t\t\t<p class="value '+("--"===l.Direction.value.substr(0,2)?"gray":"")+'">'+l.Direction.value+'</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="weatheritem">\n\t\t\t\t\t\t\t<p>'+l.Speed.name+'</p>\n\t\t\t\t\t\t\t<p class="value '+("--"===l.Speed.value.substr(0,2)?"gray":"")+'">'+l.Speed.value+'</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="weatheritem">\n\t\t\t\t\t\t\t<p>'+l.Light.name+'</p>\n\t\t\t\t\t\t\t<p class="value '+("--"===l.Light.value.substr(0,2)?"gray":"")+'">'+l.Light.value+'</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="weatheritem">\n\t\t\t\t\t\t\t<p>'+l.Humi.name+'</p>\n\t\t\t\t\t\t\t<p class="value '+("--"===l.Humi.value.substr(0,2)?"gray":"")+'">'+l.Humi.value+'</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="weatheritem">\n\t\t\t\t\t\t\t<p>'+l.Temp.name+'</p>\n\t\t\t\t\t\t\t<p class="value '+("--"===l.Temp.value.substr(0,2)?"gray":"")+'">'+l.Temp.value+'</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="weatheritem">\n\t\t\t\t\t\t\t<p>'+l.PM25.name+'</p>\n\t\t\t\t\t\t\t<p class="value '+("--"===l.PM25.value.substr(0,2)?"gray":"")+'">'+l.PM25.value+'</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="weatheritem">\n\t\t\t\t\t\t\t<p>'+l.Pressure.name+'</p>\n\t\t\t\t\t\t\t<p class="value '+("--"===l.Pressure.value.substr(0,2)?"gray":"")+'">'+l.Pressure.value+'</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="weatheritem">\n\t\t\t\t\t\t\t<p>'+l.Rain.name+'</p>\n\t\t\t\t\t\t\t<p class="value '+("--"===l.Rain.value.substr(0,2)?"gray":"")+'">'+l.Rain.value+"</p>\n\t\t\t\t\t</div></div></div>"},generateSensingTpl:function(t,e,i){return i.length>0&&(e+='<div class="monitorlist '+("sensor"===t?"sensorlist":"controlerlist")+'"><ul class="clearfix">',i.forEach(function(i,a){var n=i.devicePropertyDTOList;if("sensor"===t&&n.length>1&&n.forEach(function(t,n){var s=t.propertyValue,o="",r="无";"bool"!==t.dataType&&"enum"!==t.dataType||(o="discrete",s=JSON.parse(t.specs)[s]),e+='<li data-index="'+a+"-"+n+'" class="'+o+'">\n\t\t\t\t\t\t\t<div class="sensorlicon clearfix">\n\t\t\t\t\t\t\t<div class="sensoricon"><img src="'+(i.productVO.productLogo?i.productVO.productLogo:"https://zaiot.oss-cn-hangzhou.aliyuncs.com/wechat/img/icon_eq_default.png")+'" alt="" /></div>\n\t\t\t\t\t\t\t<div class="sensoritem">\n\t\t\t\t\t\t\t<p>'+i.clientDisplayName+"-"+t.name+"</p>",t.specsNumber&&t.specsNumber.unit&&(r=t.specsNumber.unit),e+="<p>单位：<span>"+r+"</span></p>",x.includes(i.productKey)&&(s=parseInt(s,10)>=100?"0.1":s),e+='<div class="sensornum za_number '+(s?"":"no-value")+'" num="'+(s||"--")+'"></div>',e+='</div> <span class="splitline"></span> <div class="senhistory_btn"></div> </div> <div class="sensor_history"> <div class="historycon"></div> </div> </li>'}),1===n.length){var s=n[0],o=s.propertyValue,r="",l="";if(l="controler"===t?" controler":l,"bool"!==s.dataType&&"enum"!==s.dataType||(r="discrete",o=JSON.parse(s.specs)[o]),e+="sensor"===t?'<li data-index="'+a+'-0" class="'+(r+l)+'">\n\t\t\t\t\t\t\t<div class="sensorlicon clearfix">\n\t\t\t\t\t\t\t<div class="sensoricon"><img src="'+(i.productVO.productLogo?i.productVO.productLogo:"https://zaiot.oss-cn-hangzhou.aliyuncs.com/wechat/img/icon_eq_default.png")+'" alt="" /></div>\n\t\t\t\t\t\t\t<div class="sensoritem">\n\t\t\t\t\t\t\t<p>'+i.clientDisplayName+"</p>":'<li data-index="'+a+'-0" class="'+(r+l)+'">\n\t\t\t\t\t\t\t<div class="sensorlicon clearfix">\n\t\t\t\t\t\t\t<div class="sensoricon"><img src="'+(i.controllerCategoryVO.categoryLogo?i.controllerCategoryVO.categoryLogo:"https://zaiot.oss-cn-hangzhou.aliyuncs.com/wechat/img/icon_eq_default.png")+'" alt="" /></div>\n\t\t\t\t\t\t\t<div class="sensoritem">\n\t\t\t\t\t\t\t<p>'+i.clientDisplayName+"</p>","sensor"===t){var c="无";s.specsNumber&&s.specsNumber.unit&&(c=s.specsNumber.unit),e+="<p>单位：<span>"+c+"</span></p>",x.includes(i.productKey)&&(o=parseInt(o,10)>=100?"0.1":o),e+='<div class="sensornum za_number '+(o?"":"no-value")+'" num="'+(o||"--")+'"></div>'}else"ONLINE"===i.deviceState?(x.includes(i.productKey)&&(o=parseInt(o,10)>=100?"0.1":o),e+='<div class="sensornum za_number '+(o?"":"no-value")+'" num="'+(o||"--")+'"></div>'):e+='<div class="sensornum za_number" style="font-size: 24px; color: #2F896D; line-height: 32px;">离线</div>';e+="sensor"===t?'</div> <span class="splitline"></span> <div class="senhistory_btn"></div> </div> <div class="sensor_history"> <div class="historycon"></div> </div> </li>':'</div></div> <div class="sensor_history"> <div class="historycon"></div> </div> </li>'}}),e+="</ul></div>"),e},_mark2Center:function(t){this.moveMapPosition("area","120",t)},moveMapPosition:function(t,e,i){var a=this;this.$nextTick(function(){var n=a.map.getPixelBounds(),s=n.max.y-n.min.y,o=a.map.getBounds(),r=o._northEast.lat-o._southWest.lat,l="area"===t?r/4:0;a.map.panTo({lat:i.lat+l+r*(e/s),lng:i.lng})})},_initVideoPlayer:function(t,e){var i=this;return p(regeneratorRuntime.mark(function a(){var n,s,o;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return n=i,s=function(){var a=0,n=null;t.html('<div id="videoitem" class="videobaseStyle"></div>'),i.playerobj=o({idName:"videoitem",src:e.hlsUrl||e.hlsUrlHd,width:"560",height:"315",poster:y}),n=setInterval(function(){if(""===$("#videoitem").html()){if(a>=3)return clearInterval(n),t.html('<p style="font-size: 20px; color: #71e8cf; text-align: center; line-height: 303px;">视频连接失败，请刷新浏览器重试</p>'),!1;a++}else clearInterval(n)},1e3)},o=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.idName,a=t.src,s=t.width,o=t.height,r=t.poster,l=t.autoplay,c=void 0===l||l,d=t.live,p=void 0===d||d,m=t.flash,u=void 0!==m&&m,v=t.x5_player,h=void 0===v||v,g=t.x5_type,f=void 0===g||g,y=t.x5_fullscreen,b=new TcPlayer(i,{m3u8:a,width:s,height:o,autoplay:c,coverpic:{style:"stretch",src:r||""},live:p,flash:u,x5_player:h,x5_type:f,x5_fullscreen:void 0===y||y,listener:function(t){if(!b)return!1;var i=t.src.player.el.querySelector(".vcp-loading");if("error"===t.type&&b.options.src&&(i.setAttribute("style","display:none;"),b.timer_errordoing=setTimeout(function(){if(!b.playing()&&b.errorreload_i<3){var t=e.hlsUrl?"流畅":"高清";document.querySelector(".switch-load-btn")&&(document.querySelector(".switch-load-btn").innerHTML=t),b.load(b.options.src),b.errorreload_i++,i.setAttribute("style","display:block;")}else i.setAttribute("style","display:none;");clearTimeout(b.timer_errordoing)},3e3)),"playing"===t.type&&(clearTimeout(b.timer_errordoing),i.setAttribute("style","display:none;")),!b.initreflashbtn){var a=document.createElement("div"),s=e.hlsUrl?"流畅":"高清";a.setAttribute("class","switch-load-btn"),a.innerText=s,a.addEventListener("click",function(){switch(s){case"流畅":if(!e.hlsUrlHd)return n.$message({type:"warning",message:"当前视频仅支持流畅播放",center:!0}),!1;b.load(e.hlsUrlHd),s="高清";break;case"高清":if(!e.hlsUrl)return n.$message({type:"warning",message:"当前视频仅支持高清播放",center:!0}),!1;b.load(e.hlsUrl),s="流畅"}n.$message({type:"success",message:"已切换至"+s+"播放",center:!0}),a.innerText=s}),e.hlsUrl!==e.hlsUrlHd&&t.src.player.el.querySelector(".vcp-controls-panel").appendChild(a),b.initreflashbtn=!0;var o=document.createElement("div");o.className="vcp-reflashbtn",o.addEventListener("click",function(){b&&b.video&&b.video.hls&&b.video.hls.stopLoad(),i.setAttribute("style","display:block;"),clearTimeout(b.timer_errordoing),b.load("高清"===s?e.hlsUrlHd:e.hlsUrl)}),setTimeout(function(){t.src.player.el.querySelector(".vcp-controls-panel").appendChild(o)},600)}}});return b.timer_errordoing=null,b.errorreload_i=0,b.initreflashbtn=!1,b.stopload=function(){b&&b.video&&b.video.hls&&b.video.hls.stopLoad(),b=null},b},i.playerobj&&i.playerobj.stopload(),a.next=6,i._initTcPlayer();case 6:s();case 7:case"end":return a.stop()}},a,i)}))()},_initTcPlayer:function(){return new Promise(function(t,e){window.TcPlayer?t():$.getScript("https://imgcache.qq.com/open/qcloud/video/vcplayer/TcPlayer-2.3.2.js",function(){t()})})},recoveryMarkerIcon:function(t,e){this.$nextTick(function(){var i=$("#mapbox .leaflet-map-pane .leaflet-marker-pane");switch($(".layui-layer-setwin").remove(),i.find("img.sensor_marker").attr("src",m).removeClass("active"),i.find("img.video_marker").attr("src",u).removeClass("active"),i.find("img.weather_marker").attr("src",v).removeClass("active"),t){case"sensor":e.src=h;break;case"video":e.src=g;break;case"weather":e.src=f}$(e).addClass("active")})},isInterHasImage:function(t){return 3===this.markProductPosition[t].iotType},_initHistory:function(t,e,i){var a=this;return p(regeneratorRuntime.mark(function n(){var s,o,l,d,p,m,u,v,h,g;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return s=function(t,e,i,a){if(!a)return!1;if(e.length||i.length){var n=echarts.init(a),s={title:{show:!1,text:"",subtext:""},tooltip:{show:!0,trigger:"axis",borderColor:"#64C3A4",backgroundColor:"rgba(100,195,164,1)",padding:[5,10,2],textStyle:{color:"#fff"},formatter:function(e){return"<p class='echartBox' style='text-align:left;line-height:24px;padding:3px;'>"+e[0].name+"<br/>数值："+(void 0===e[0].value?"--":e[0].value)+t.replace(/无/,"")+"</p>"},axisPointer:{lineStyle:{color:"#64C3A4",width:1},crossStyle:{color:"#00E5FF",width:3}}},legend:{data:[]},toolbox:{show:!1},calculable:!1,xAxis:[{type:"category",boundaryGap:!1,data:e,splitLine:{show:!1},axisLabel:{show:!0,textStyle:{color:"#73867A"},formatter:function(t){return t.split(" ")[0]+"\n"+t.split(" ")[1]}},axisLine:{lineStyle:{color:"rgba(255,255,255,0.1)",width:1}}}],yAxis:[{type:"value",splitLine:{show:!0,lineStyle:{color:"rgba(48,138,110,0.2)"}},axisLabel:{show:!0,textStyle:{color:"#73867A"}},axisLine:{lineStyle:{color:"rgba(255,255,255,0.1)",width:1}}}],grid:{left:48,right:23,top:20,bottom:43,borderWidth:0},series:[{name:"传感器历史数据",type:"line",smooth:!0,clickable:!1,itemStyle:{normal:{color:"#73867A",lineStyle:{color:"#308A6E"},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(109,250,115,0.4)"},{offset:1,color:"rgba(100,195,164,0)"}],global:!1}}},emphasis:{lineStyle:{color:"#fff"}}},data:i,symbol:"circle",symbolSize:1,showAllSymbol:!0}]},o=Math.max.apply(null,i);if(o.toString().length>4){var r=7*(o.toString().length-4)+50;s.grid.x=r}n.setOption(s)}else a.innerHTML='<div style="padding-top: 100px; text-align: center; font-size: 18px; color: #2CD2A9;">暂无历史数据<div>'},o=function(t,e,i,n){var s="";s+='<div class="control_timeline" ref="controltimeline"><ul class="clearfix">';for(var o=0;o<e.length;o++)s+='<li><span class="pointer"></span><p><span class="fl">'+e[o]+'</span><span class="fr">'+(JSON.parse(d.specs)[i[o]]||"")+"</span></p> </li>";if(s+="</ul></div>",0===e.length)return n.innerHTML='<div style="padding-top: 100px; text-align: center; font-size: 18px; color: #2CD2A9;">暂无历史数据<div>',!1;n.innerHTML=s,a.sensorHsBs=Object(r.a)(n.querySelectorAll(".control_timeline")[0])},l=e.split("-").map(function(t){return Number(t)}),d=i[l[0]].devicePropertyDTOList[l[1]],p="bool"===d.dataType||"enum"===d.dataType,t.html('<div class="loader historyload"><div class="loader-inner ball-spin-fade-loader"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>'),n.next=8,a.getDeviceHistory(i[l[0]].id,d.identifier);case 8:m=n.sent,u=m.historyList,v=[],h=[],g="无",u.forEach(function(t){var e=t.value;p?v.push(Object(c.a)(t.timestamp,"年月日")):v.push(new Date(t.timestamp).format("MM.dd hh:mm")),x.includes(m.deviceVO.productKey)&&(e=parseInt(e,10)>=100?"0.1":e),h.push(null===e?null:Object(c.b)(e,2))}),d.specsNumber&&(g=d.specsNumber.unit||g),p?o(g,v,h,t.get(0)):s(g,v,h,t.get(0));case 16:case"end":return n.stop()}},n,a)}))()},_zaNumber:function(t){var e=t.attr("num");if(isNaN(e)){var i=e;"停"===e?i="<i style='color:#FEBD4D;font-style:normal;'>停</i>":"开"===e?i="<i style='color:#30E034;font-style:normal;'>开</i>":"关"===e&&(i="<i style='color:#FD4F4F;font-style:normal;'>关</i>"),t.html(i)}else if((e=Number(e)+"").split("").length>0){for(var a=e.split(""),n="",s=0;s<a.length;s++)"."==a[s]?n+='<span class="number_pointer"></span>':isNaN(a[s])?n+='<span class="number_other">'+a[s]+"</span>":n+='<span class="number_'+a[s]+'"></span>';t.html(n),setTimeout(function(){t.find("span").not(".number_pointer").addClass("aninum")},0)}},getGisDetail:function(){return this.$ajax.post(this.$api.plotlist.gisDistributionGetDetail,{gisDistributionid:this.mapId}).then(function(t){var e=t.data;if(0===e.respCode)return e.obj})},deleteTheLastLayer:function(){return!!this.whatLayerWasLast&&("GIS"===this.whatLayerWasLast?(this.oldGisLayers.remove(),this.oldGisLayers=null,!0):"IMAGE"===this.whatLayerWasLast?(this.oldImageLayers.remove(),this.oldImageLayers=null,!0):void 0)},renderingGis:function(t){var e,i=void 0;e=L.tileLayer.wms(t.match(b)[0],{layers:decodeURIComponent(t.match(w)[2]),format:"image/png",transparent:!0,crs:L.CRS.EPSG4326,maxZoom:20,minZoom:5,zIndex:9}),i=L.layerGroup(),this.deleteTheLastLayer(),i.addLayer(e),this.whatLayerWasLast="GIS",this.oldGisLayers=e,i.addTo(this.map)},renderingImage:function(t){var e,i=void 0;e=this.gisTabs[this.selectedGisTabs].imgPath.split(",").map(Number),i=L.imageOverlay(t,[[e[3],e[2]],[e[1],e[0]]],{opacity:1,maxZoom:20,minZoom:5,zIndex:9}),this.deleteTheLastLayer(),this.whatLayerWasLast="IMAGE",this.oldImageLayers=i,i.addTo(this.map)},_initLayer:function(){var t=this;return p(regeneratorRuntime.mark(function e(){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getGisDetail();case 2:i=e.sent,t.teamLegend=i.gisDistributionVO.demoImgUrl,t.gisTabs=i.dataList.map(function(t){return{name:t.gisDataName,updateTime:t.gisDataUpdateTime,mapUrl:t.mapUrl,imgPath:t.imgPath}}),"0"!==t.mapType&&t.handleSelectedGis(0);case 6:case"end":return e.stop()}},e,t)}))()},handleSelectedGis:function(t){this.selectedGisTabs=t,"1"===this.mapType?this.renderingGis(this.gisTabs[t].mapUrl):"2"===this.mapType&&this.renderingImage(this.gisTabs[t].mapUrl)}}},T=Object(r.b)(),_={mixins:[l,k],data:function(){return{landId:"",plotdialogVisible:!1,plotTabIndex:1,layertit:"",map:null,layerSwitch:!1,wxMapLabelLayer:null,showSwitch:!1,areaId:T.farmAreaId,areaLevel:T.farmAreaType,center:[31.29979837641553,116.60591928254507],labellist:[{label:"粮田",color:"#E6AA4A"},{label:"菜田",color:"#BD4280"},{label:"花卉用地",color:"#A778F9"},{label:"经济果林",color:"#AFBE3D"},{label:"苗木用地",color:"#0FEF34"},{label:"生态林地",color:"#01B649"},{label:"禽畜养殖",color:"#32CEBB"},{label:"养殖水面",color:"#02B8FF"},{label:"其他耕地",color:"#7EE2E1"},{label:"其他农用地",color:"#85B5D5"}],feature_active:!1,map_active:!1,currPlot:null,playerobj:null,zoommapclass:["0","1","2","3","4","zoom110","zoom110","zoom110","zoom110","zoom110","zoom110","zoom1112","zoom1112","zoom13","zoom14","zoom1516 zoom15","zoom1516 zoom16","zoom17","zoom18","zoom192021 zoom19","zoom192021 zoom20","zoom192021 zoom21"],mapId:String(this.$route.query.mapId),mapType:String(this.$route.query.mapType),mapZoom:Number(this.$route.query.mapZoom),serverDate:(new Date).getTime()}},created:function(){this.center[0]=this.$route.query.lat,this.center[1]=this.$route.query.lng},mounted:function(){this.getPlot(this.center)},destroyed:function(){window.layer.closeAll(),this.playerobj&&this.playerobj.stopload()},methods:{mapInit:function(t,e){var i=this,a=L.icon({iconUrl:n.a,iconSize:[24,34],shadowUrl:o.a});L.Marker.prototype.options.icon=a;var s=L.tileLayer.chinaProvider("TianDiTu.Realm.Map",{id:"layer_line",detectRetina:!1,zIndex:5,maxZoom:21,minZoom:5}),r=L.tileLayer.chinaProvider("Google.Satellite.Map",{id:"layer_google",detectRetina:!1,zIndex:3,maxZoom:21,minZoom:5}),l=(L.tileLayer.chinaProvider("Google.Satellite.Annotion",{id:"layer_google",detectRetina:!1,zIndex:3,maxZoom:21,minZoom:5}),L.tileLayer.chinaProvider("TianDiTu.Satellite.Map",{id:"layer_tiandi",detectRetina:!1,zIndex:2,maxZoom:18,minZoom:5})),c=L.tileLayer.chinaProvider("GaoDe.Normal.Map",{id:"layer_gaodeLabel",detectRetina:!1,zIndex:1,maxZoom:18,minZoom:5}),d=L.map("mapbox",{center:t,zoom:this.mapZoom,zoomControl:!1,attributionControl:!1,dragging:!0,touchZoom:!1,scrollWheelZoom:!0,doubleClickZoom:!0,boxZoom:!1,tap:!1,keyboard:!0,maxZoom:21,minZoom:5}).on("click",function(t){var e=t.latlng;console.log("lat: ",e.lat,"lng: ",e.lng)}),p=L.layerGroup([s,r,l,c]);this.wxMapLabelLayer=L.tileLayer.chinaProvider("GaoDe.Normal.Annotion",{maxZoom:21,minZoom:5,zIndex:10}),p.addTo(d),this.map=d,d.on("zoomend",function(t){i.markerEditWithZoom(t.target._zoom)}),this.markerEditWithZoom(this.mapZoom),e&&e()},drawPolygon:function(t){var e=t.areaNode,i=t.map;L.geoJSON(e.getParentFeature(),{style:function(){return{color:"#000",fillColor:"#009cba",fillOpacity:0,fillRule:"evenodd",className:"polygonbox",lineJoin:"miter",weight:3}}}).addTo(i)},initPlots:function(t){var e=this,i=t.filter(function(t){return Boolean(t.path)}).map(function(t){return L.polygon(JSON.parse(t.path),{fillColor:t.fillColor,color:t.fillColor,stroke:!0,id:t.id,fillOpacity:.3,originstyle:{fillColor:t.fillColor,color:t.fillColor}})});if(i.length>0){var a=L.featureGroup(i);a.addTo(this.map),a.on("click",function(t){e.clearlight(),e.feature_active=!0,e.map_active=!1,e.currPlot=t.sourceTarget,e.changeAreaPos(e.currPlot),e.highlight(e.currPlot),e.landId=t.sourceTarget.options.id,e.plotdialogVisible=!1,window.layer.closeAll(),setTimeout(function(){e.plotdialogVisible=!0},200)})}this.map.on("click",function(){e.feature_active?e.feature_active=!1:(e.map_active=!0,e.feature_active=!1,e.map_active&&(e.map_active=!1,e.plotdialogVisible=!1))})},layerToggle:function(t){t?this.wxMapLabelLayer.addTo(this.map):this.map.removeLayer(this.wxMapLabelLayer),this.layerSwitch=t},getPlot:function(t){var e=this,i=this;this.$ajax.post(this.$api.plotlist.urlGetPlotList,{areaId:this.areaId,areaType:this.areaLevel}).then(function(a){i.mapInit(t,function(){"0"!==e.mapType?e.layerToggle(!0):(e.initPlots(a.data.obj),e._initIot()),"暂无遥感"!==e.mapId&&e._initLayer(),e.showSwitch=!0})}).catch(function(t){console.log("error:",t)})},changeAreaPos:function(t){var e=this;if(!t)return!1;var i=t.getBounds(),a=this.map.getBoundsZoom(i);e.map.setZoom(a-1),setTimeout(function(){var t=i.getCenter().lat,a=i.getCenter().lng,n=e.map.getBounds(),s=n._northEast.lat-n._southWest.lat,o=e.map.getPixelBounds(),r=t+s/3+s*(20/(o.max.y-o.min.y));e.map.panTo({lat:r,lng:a})},300)},highlight:function(t){t&&t._path&&t.setStyle({stroke:!0,color:"#fff",weight:4,fillOpacity:.6})},clearlight:function(){this.currPlot&&this.currPlot._path&&(this.currPlot.setStyle({stroke:!0,color:this.currPlot.options.originstyle.color,weight:3,fillOpacity:.3}),this.currPlot=null)},plotdialogChange:function(t){this.plotdialogVisible=t,t||(this.plotTabIndex=1,this.clearlight())},closeDialog:function(){this.plotdialogVisible=!1,window.layer.closeAll(),this.clearlight()}},components:{plotDetailDialog:function(){return i.e(141).then(i.bind(null,"SXR7"))}}},I=i("W5g0");var C=function(t){i("wKnu"),i("lINq")},S=Object(I.a)(_,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"title",rawName:"v-title"}],staticClass:"mapwrap",attrs:{"data-title":"自然资源监管"}},[i("div",{attrs:{id:"mapbox"}},[i("div",{staticClass:"backbtn",on:{click:function(e){return t.pageback()}}},[i("i",{staticClass:"el-icon-back"}),t._v("返回")]),t._v(" "),"0"===t.mapType?i("div",{staticClass:"plotlabel"},[i("p",[t._v("图示")]),t._v(" "),i("ul",{staticClass:"labellist"},t._l(t.labellist,function(e){return i("li",[i("span",{staticClass:"dot",style:{background:e.color}}),t._v(t._s(e.label))])}),0)]):t._e(),t._v(" "),"0"!==t.mapType&&t.teamLegend?i("div",{staticClass:"team-legend"},[i("img",{attrs:{src:t.teamLegend,alt:""}})]):t._e(),t._v(" "),t.showSwitch?i("div",{staticClass:"layer-ctrl"},[i("el-switch",{attrs:{"active-color":"#00F6FF","inactive-color":"#E5E5E5","active-text":"显示地名",width:"32"},on:{change:t.layerToggle},model:{value:t.layerSwitch,callback:function(e){t.layerSwitch=e},expression:"layerSwitch"}})],1):t._e(),t._v(" "),"0"!==t.mapType&&t.gisTabs.length>1?i("ul",{staticClass:"map-tabs"},t._l(t.gisTabs,function(e,a){return i("li",{key:a,staticClass:"tab",class:{selected:a===t.selectedGisTabs},on:{click:function(e){return t.handleSelectedGis(a)}}},[t._v(t._s(e.name))])}),0):t._e()]),t._v(" "),t.plotdialogVisible?i("plotDetailDialog",{attrs:{plotdialogVisible:t.plotdialogVisible,"land-id":t.landId,plotTabIndex:t.plotTabIndex},on:{plotdialogChangeEv:t.plotdialogChange,"update:plotTabIndex":function(e){t.plotTabIndex=e},"update:plot-tab-index":function(e){t.plotTabIndex=e}}}):t._e()],1)},[],!1,C,"data-v-1b99c0af",null);e.default=S.exports},LCol:function(t,e){t.exports="https://snkoudai.oss-cn-hangzhou.aliyuncs.com/goverment/static/img/weather.e6e1eb7.png"},OZzv:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAQAAAACach9AAACMUlEQVR4Ae3ShY7jQBAE0Aoz/f9/HTMzhg1zrdKUrJbdx+Kd2nD8VNudfsL/Th///dyQN2TH6f3y/BGpC379rV+S+qqetBOxImNQXL8JCAr2V4iMQXHGNJxeCfZXhSRBcQMfvkOWUdtfzlLgAENmZDcmo2TVmt8OSM2eXxBp3DjHSMFutqS7SbmemzBiR+xpKCNUIRkdkkYxhAkyGoBvyQFEJEefwSmmvBfJuJ6aKqKWnAkvGZOaZXTUgFqYULWNSHUckZuR1HIIimUExutRxwzOLROIG4vKmCKQt364mIlhSyzAf1m9lHZHJZrlAOMMztRRiKimp/rpdJDc9Awry5xTZCte7FHtuS8wJgeYGrex28xNTd086Dik7vUMscQOa8y4DoGtCCSkAKlNwpgNtphjrC6MIHUkR6YWxxs6Sc5xqn222mmCRFzIt8lEdKx+ikCtg91qS2WpwVfBelJCiQJwvzixfI9cxZQWgiSJelKnwBElKYtDOb2MFbhmUigbReQBV0Cg4+qMXSxXSyGUn4UbF8l+7qdSGnTC0XLCmahIgUHLhLOhpVCtw4CzYXvLQWQbJNmxoCsOKAxSgBJno75avolkRw8iIAFcsdc02e9iyCd8tHwmeSSoKTowIgvscSGZUOA7PuCN5b2BX9mQM7S0wYhMNU74zgsPBj3HU7wguAfnxxjFQGBE6pwN+GjME9zHY7zGp8wVxMShYX9NXvEWD3HbwJf4giO4CFIQxXScH1/TM+04kkBiAAAAAElFTkSuQmCC"},lINq:function(t,e){},mrfU:function(t,e){t.exports="https://snkoudai.oss-cn-hangzhou.aliyuncs.com/goverment/static/img/camera.f58f065.png"},n0y3:function(t,e){t.exports="https://snkoudai.oss-cn-hangzhou.aliyuncs.com/goverment/static/img/weather2_common.710f3fd.png"},o9yN:function(t,e){t.exports="https://snkoudai.oss-cn-hangzhou.aliyuncs.com/goverment/static/img/sensor_on.0c2a51e.png"},rBfV:function(t,e){t.exports="https://snkoudai.oss-cn-hangzhou.aliyuncs.com/goverment/static/img/camera_on.d47cce6.png"},rO80:function(t,e){t.exports="https://snkoudai.oss-cn-hangzhou.aliyuncs.com/goverment/static/img/weatherbg_2.9f140d6.gif"},wD5Q:function(t,e){t.exports="https://snkoudai.oss-cn-hangzhou.aliyuncs.com/goverment/static/img/marker-icon.2273e3d.png"},wKnu:function(t,e){},"x/VB":function(t,e){t.exports="https://snkoudai.oss-cn-hangzhou.aliyuncs.com/goverment/static/img/sensor.1ca064e.png"}});
//# sourceMappingURL=50.8a91d7a7a6d227fb969c.js.map