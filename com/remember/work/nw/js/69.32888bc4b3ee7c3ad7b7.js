webpackJsonp([69],{Hqim:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("mOB5"),o=a("mYEk"),s=a("44dg"),r=a("ItLx"),i=a("8BiH"),l=a("yivU"),c=a("ae5q"),u=a("VCTt"),d=a("VKKs");a("N/DY"),a("oAV5");function g(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,a){return function n(o,s){try{var r=e[o](s),i=r.value}catch(t){return void a(t)}if(!r.done)return Promise.resolve(i).then(function(t){n("next",t)},function(t){n("throw",t)});t(i)}("next")})}}var p={data:function(){return{currentPage:1,pageSize:15,total:1,downloadList:[],sortDirection:null,defaultSort:"descending",tableHeight:0,loading:!1,downloadStatusList:[{status:100,text:"全部导出"},{status:0,text:"等待导出"},{status:1,text:"导出中"},{status:2,text:"导出成功"},{status:3,text:"导出失败"}],exportFlag:100,categoryList:[{exportTasktName:"",name:"全部导出对象"},{exportTasktName:"TASKPATROLRECORD",name:"安全监管"},{exportTasktName:"TASKLVSELANDCERTIFICATE",name:"绿色认证"},{exportTasktName:"TASKFARMBUSINESS",name:"经营主体"},{exportTasktName:"TASKFARMOPERATIONREPORT",name:"生产作业上报"}],category:""}},created:function(){this.getDownloadList()},mounted:function(){var t=this;this.$nextTick(function(){t.tableHeight=t.$refs.listContent.offsetHeight}),window.addEventListener("resize",this.resizeHandle,!1)},methods:{back:function(){var t=this,e=this.$route.path;this.$router.go(-1),setTimeout(function(){e===t.$route.path&&t.back()},200)},change:function(t){this.currentPage=1,this.getDownloadList()},onChange:function(t){this.currentPage=t,this.getDownloadList()},changePageSize:function(t){this.pageSize=t,this.currentPage=1,this.getDownloadList()},handleEdit:function(t){var e=this;return g(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e.$ajax.post(e.$api.downloadExcel.downloadDel,{id:t.id});case 2:0===a.sent.data.respCode&&(e.$message({type:"success",message:"删除成功",center:!0}),e.total%e.pageSize==1&&1!==e.currentPage&&e.currentPage===Math.ceil(e.total/e.pageSize)&&(e.currentPage-=1),e.getDownloadList());case 4:case"end":return a.stop()}},a,e)}))()},getDownloadList:function(){var t=this;return g(regeneratorRuntime.mark(function e(){var a,n,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.downloadList=[],t.loading=!0,Object(u.b)(),a=Object(d.b)("govGovernmentUserVO"),n={createBy:a.id,exportTasktName:t.category,exportFlag:100===t.exportFlag?"":t.exportFlag,pageNo:t.currentPage,pageSize:t.pageSize},t.category||delete n.exportTasktName,e.next=8,t.$ajax.post(t.$api.downloadExcel.downloadExcelList,n);case 8:0===(o=e.sent).data.respCode?(t.downloadList=o.data.obj.list,t.total=o.data.obj.totalCount,t.loading=!1,t.$nextTick(function(){t.tableHeight=t.$refs.listContent.offsetHeight,t.backTop()})):t.loading=!1;case 10:case"end":return e.stop()}},e,t)}))()},getColor:function(t){switch(t){case 0:return"#0E5B69";case 1:return"#945B1D";case 2:return"#1D9425";case 3:return"#B73A31"}},getTaskName:function(t){if("TASKZZBASCOMPANY"===t)return"经营主体";var e=this.categoryList.filter(function(e){return e.exportTasktName===t});return e.length?e[0].name:"--"},formatDate:function(t,e){var a=new Date(t);return a.getFullYear()+e+((a.getMonth()+1<10?"0"+(a.getMonth()+1):a.getMonth()+1)+e)+(a.getDate()<10?"0"+a.getDate():a.getDate())+" "+(a.getHours()+":")+(a.getMinutes()<10?"0"+a.getMinutes():a.getMinutes())},resizeHandle:function(){this.tableHeight=this.$refs.listContent.offsetHeight},backTop:function(){document.querySelector(".el-table__body-wrapper").scrollTop=0}},destroyed:function(){window.removeEventListener("resize",this.resizeHandle,!1)},components:{Nav:n.default,Page:o.default,Loading:s.default,CustomInput:r.default,CustomSelect:i.default,CustomTable:l.default,CustomTableSort:c.default}},f=a("W5g0");var h=function(t){a("W/r0"),a("KxoS")},m=Object(f.a)(p,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"title",rawName:"v-title"}],staticClass:"download-excel-list",attrs:{"data-title":"导出记录"}},[n("Nav",{attrs:{title:"导出记录",hasShadow:!0,backColor:"#B6CFDE"},on:{back:t.back}},[n("div",{staticStyle:{width:"246px"},attrs:{slot:"right"},slot:"right"})]),t._v(" "),n("div",{staticClass:"main"},[n("div",{staticClass:"search-box"},[n("div",{staticClass:"search-box-left"},[n("CustomSelect",{attrs:{margin:"0 15px 0 0"}},[n("template",{slot:"select-container"},[n("el-select",{attrs:{placeholder:"全部类型"},on:{change:t.change},model:{value:t.category,callback:function(e){t.category=e},expression:"category"}},t._l(t.categoryList,function(t,e){return n("el-option",{key:e,attrs:{label:t.name,value:t.exportTasktName}})}),1)],1)],2),t._v(" "),n("CustomSelect",{attrs:{margin:"0 15px 0 0"}},[n("template",{slot:"select-container"},[n("el-select",{attrs:{placeholder:"全部导出状态"},on:{change:t.change},model:{value:t.exportFlag,callback:function(e){t.exportFlag=e},expression:"exportFlag"}},t._l(t.downloadStatusList,function(t,e){return n("el-option",{key:e,attrs:{label:t.text,value:t.status}})}),1)],1)],2)],1),t._v(" "),t._m(0)]),t._v(" "),n("div",{ref:"listContent",staticClass:"list-content"},[n("CustomTable",[n("template",{slot:"table-container"},[n("el-table",{staticStyle:{width:"100%"},attrs:{data:t.downloadList,fit:!0,height:t.tableHeight,lazy:!0}},[n("template",{slot:"empty"},[n("div",[n("Loading",{attrs:{show:t.loading,type:"element",theme:"loader-light"}}),t._v(" "),t.loading?t._e():n("div",{staticClass:"no-data"},[n("img",{attrs:{src:a("gtDs")}}),t._v(" "),n("span",[t._v("暂无数据")])])],1)]),t._v(" "),n("el-table-column",{attrs:{label:"文件名称",width:"600"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("span",{staticClass:"text-bold"},[t._v(t._s(e.row.exportName))])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"导出对象类型"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("span",{staticClass:"text"},[t._v(t._s(t.getTaskName(e.row.taskName)))])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"导出状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("span",{staticClass:"text",style:{color:t.getColor(e.row.exportFlag)}},[t._v(t._s(t.downloadStatusList[e.row.exportFlag+1].text))])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"导出数据量（条)"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("span",{staticClass:"text-bold"},[t._v(t._s(e.row.exportNum?e.row.exportNum:"--"))])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"导出时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("span",{staticClass:"text"},[t._v(t._s(t.formatDate(e.row.createTime,".")))])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"导出结果",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[1===e.row.exportFlag?n("div",{staticClass:"handle"},[t._v("--")]):t._e(),t._v(" "),2===e.row.exportFlag?n("div",{staticClass:"handle handle-success"},[n("a",{attrs:{href:e.row.filePath,download:e.row.exportName}},[t._v("下载查看")]),t._v(" "),n("span",{staticClass:"line"}),t._v(" "),n("span",{on:{click:function(a){return t.handleEdit(e.row)}}},[t._v("删除")])]):t._e(),t._v(" "),0===e.row.exportFlag||3===e.row.exportFlag?n("div",{staticClass:"handle"},[n("span",{on:{click:function(a){return t.handleEdit(e.row)}}},[t._v("删除")])]):t._e()]}}])})],2)],1)],2)],1)]),t._v(" "),t.total>t.pageSize?n("div",{staticClass:"page-box"},[n("Page",{attrs:{total:t.total,"page-size":t.pageSize,current:t.currentPage,isPageSizeShow:!0,isJumpShow:!0,isTotalShow:!0,perPage:15},on:{onChange:t.onChange,changePageSize:t.changePageSize}})],1):t._e()],1)},[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"excel-box"},[e("div",{staticClass:"down-notice"},[e("i",{staticClass:"el-icon-s-opportunity"}),this._v(" "),e("span",[this._v("文件导出，系统需要约5分钟处理，请耐心等待，已经生成的报表最多保留60天。")])])])}],!1,h,"data-v-c99ba80e",null);e.default=m.exports},KxoS:function(t,e){},"W/r0":function(t,e){}});
//# sourceMappingURL=69.32888bc4b3ee7c3ad7b7.js.map