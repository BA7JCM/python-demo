webpackJsonp([57,73,84,137],{"+SeG":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC4AAAAoCAYAAACB4MgqAAACjklEQVRYhe3YOWhUURTG8d9kosKgDm4pREE0hbjgVijpNAg2KtioCDYBjY1LKQqCiFhp4YYbCIpLELciaiMIRlIIFgErwVKEFO6goLG4IxnHefOW6LwE/ODB3HvOufN/9717zn234FxvCSewCdONbg3iNva1CtA78uVJrOkqrC3YnC9LJm1uRbmq4xWO4Es+PJEq4SDaK+1ya43DAfQ0FSm5vuHar0ZLjfFzc1lS6UN1o3bG81ABSzAHb/Ac3+OCame82erAAF7gDvrxWkjNDZUn+Co8xsKa/tm4ha5GwXmCn8eECFtBqC9To4LzAl9cuRppEtZFGfMCn5vQb16UIS/wdwn9BqMMeYH3i4cfwpMoY17gX3EoxucqXkYZ/wb4duGRvsXOFHEncRQ/6tiuo7tR8Egr5wZcFtIXnK2AXEgQOyTsjW5gi+HKeRdP44JHAr4IVwxDq/w+K8z+/YTjDFSuVMr6qkwTSvTkOrai8KhXZxw7kbKAF3HT8N64nkrCjcUVmcxrLEvgcXQm8Cvjofo3uEDYWH3ErgwMqcG7sDuF/0w8QFtVXyf6sFR4MqexLSVHqsXZgTNp/0CY8T4cw3zswbgqe0HITB8lX9CJwWcJ7+z4pAPXqB0XYziuYy2eJRkwyatSEnJrW5zjCFVCr/gFjXjwAi5hxQihkqoswMfuHuPA9wtVrZmahUeY0cipEfh6HP6bRCnULqTScpRDFPgCoZwX/wFUUi0XzgnrJoR64FNwT4O7baLWCAdUf0xgLXix4tionDdbG3HK75u5P/L4YeFwZrSpG8uqO2pnfDRC/9LK6kbeJ1mZ9R+82RrT4O/zhsig9y3CZ9hYU08r9gnJfSsm5ssTq0/CRO/9CQhOXSUqhTuQAAAAAElFTkSuQmCC"},"/b24":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("RRlK"),a=r("I0Vf"),i=r("Qt0Z"),o=r("Xb9r"),s=(r("PvbX"),r("wg9G"),r("SYE9"),r("Xtqa"));function c(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(a,i){try{var o=t[a](i),s=o.value}catch(e){return void r(e)}if(!o.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}var l={data:function(){return{layerGreenSwitch:!1,greenCertList:null,greenCertData:{area:"--",percentageLand:"--"},lawSupervisionId:null,regulatoryVisible:!1,lawSupervisionData:{num:"--",passRate:"--"}}},mounted:function(){},methods:{initFooter:function(){this.getLvseCertData(),this.getLawData()},layerGreenToggle:function(){var e=this;return c(regeneratorRuntime.mark(function t(){var r,n,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.layerGreenSwitch=!e.layerGreenSwitch,!e.layerGreenSwitch){t.next=14;break}return t.next=4,e.cropLandActive("",!1,[]);case 4:return e.closeAllDialogfn(),r=e.greenCertList.map(function(e){return e.landcode}),n=e.landList.map(function(e){if(e.gisPlotId)return e.gisPlotId}),a=e.getLvseGisIdsfn(r,n),t.next=10,e.refsArcgisMap.greenCertLandActive(a);case 10:t.sent?e.layerGreenSwitch=!0:(e.layerGreenSwitch=!1,e.$message("未匹配到对应地块")),t.next=17;break;case 14:return t.next=16,e.refsArcgisMap.greenCertLandActive([]);case 16:e.layerGreenSwitch=!1;case 17:case"end":return t.stop()}},t,e)}))()},layerLawSupervisionToggle:function(){var e=this;return c(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.regulatoryVisible=!e.regulatoryVisible,e.regulatoryVisible&&(e.closeAllDialogfn(1),e.cropLandActive());case 2:case"end":return t.stop()}},t,e)}))()},getNYDid:function(e){return/(\d{18})(\d{3})/g.test(e)?RegExp.$1+"000":e+""},getLvseGisIdsfn:function(e,t){var r=this;return t.map(function(t){var n=r.getNYDid(t);if(e.includes(n))return t}).filter(function(e){if(e)return e})},getLvseCertData:function(){var e=this;return c(regeneratorRuntime.mark(function t(){var r,n,a,i,o,s,c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return c=function(e){return new Promise(function(t){r.$ajax.post(r.$api.farmDetail.lvsecertLandList,{lvseCompanyId:e}).then(function(e){var r=e.status,n=e.data;200===r&&0==n.respCode&&n.obj?t(n.obj):t(!1)}).catch(function(e){t(!1)})})},s=function(e){return new Promise(function(t){r.$ajax.post(r.$api.nongwei.getByZzCompanyId,{zzCompanyId:e}).then(function(e){var r=e.status,n=e.data;200===r&&0==n.respCode&&n.obj?t(n.obj):t(!1)}).catch(function(e){t(!1)})})},r=e,t.next=5,s(e.companyCode);case 5:if((n=t.sent)&&n.id){t.next=8;break}return t.abrupt("return");case 8:if(a=n.id,e.greenCertList||!a){t.next=16;break}return t.next=12,c(a);case 12:i=t.sent,e.greenCertData.area=i.landCertArea,e.companyInfo.plotAreas&&!isNaN(e.companyInfo.plotAreas)&&((o=i.landCertArea/e.companyInfo.plotAreas)>1&&(o=1),o>0&&o<=1&&(e.greenCertData.percentageLand=e.numTofixed(100*o,1))),e.greenCertList=i.list||[];case 16:case"end":return t.stop()}},t,e)}))()},isLvseCertLand:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1],r=[!1,-1];if(!e||0===e.length)return r;var n=e.map(function(e){return e.landcode});if(/(\d{18})(\d{3})/g.test(t)){var a=RegExp.$1;n.map(function(e,t){-1!==e.indexOf(a)&&(r[0]=!0,r[1]=t)})}return r},getLawData:function(){var e=this;return c(regeneratorRuntime.mark(function t(){var r,n,a,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=function(e){return new Promise(function(t){r.$ajax.post(r.$api.nongwei.zfgetByZzCompanyId,{zzCompanyId:e}).then(function(e){var r=e.status,n=e.data;200===r&&0==n.respCode&&n.obj?t(n.obj):t(!1)}).catch(function(e){t(!1)})})},r=e,t.next=4,i(e.companyCode);case 4:if((n=t.sent)&&n.companyID){t.next=7;break}return t.abrupt("return");case 7:return e.lawSupervisionId=n.companyID,t.next=10,e.getStatisticsList(e.lawSupervisionId);case 10:a=t.sent,e.lawSupervisionData.num=a.totalCount||"--",e.lawSupervisionData.passRate=e.percentHander(a.totalCount,a.totalCountQualified);case 13:case"end":return t.stop()}},t,e)}))()},getStatisticsList:function(e){var t=this;return new Promise(function(r){t.$ajax.post(t.$api.govPatrol.statisticsByCompanyId,{zhiFaCompanyId:e}).then(function(e){var t=e.status,n=e.data;200===t&&0===n.respCode&&r(n.obj),r(!1)})})},percentHander:function(e,t){var r=0;return-1===e||0===e?"--":(e>0&&(e||0===e)&&(r=Number(String(t/e*100).split(".").map(function(e,t){return 0===t?e:e.substr(0,1)}).join("."))),r)}}},u=function(e,t){return new Promise(function(r){var n=JSON.parse(localStorage.govGovernmentSubjectVO);e.$ajax.post(e.$api.plotlist.getByGisDkid,{shGisDkid:t,dataTargetFlag:n.dataTargetFlag}).then(function(e){200===e.status&&0==e.data.respCode&&e.data.obj?r([!0,e.data]):r([!1,null])}).catch(function(e){r([!1,null])})})},p=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(a)throw i}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function d(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(a,i){try{var o=t[a](i),s=o.value}catch(e){return void r(e)}if(!o.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}var f={mixins:[l],data:function(){return{loading:!0,gisloading:!0,companyCode:"",companyInfo:{name:"",plotAreas:"",plotarea:""},landList:[],cropList:[],regulatoryVisible:!1,layerGreenSwitch:!1,plotDialog:{landId:"",plotId:"",gisType:1,plotdialogVisible:!1,plotTabIndex:1},errorFarm:!1}},provide:function(){return{farmDetailRefs:this}},computed:{refsArcgisMap:function(){return this.$refs.arcgisMap},refsCropLandListTabs:function(){return this.$refs.cropLandListTabs}},props:[],created:function(){this.$route.params&&this.$route.params.companyCode?this.companyCode=this.$route.params.companyCode:this.$router.push({path:"/"})},mounted:function(){var e=this;return d(regeneratorRuntime.mark(function t(){var r,n,a,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.postCompanyInfoData(e.companyCode);case 2:if(!(r=t.sent)||!r.name){t.next=9;break}e.companyInfo.name=r.name,e.companyInfo.plotAreas=r.plotAreas,e.companyInfo.plotarea=r.plotarea,t.next=12;break;case 9:return e.errorFarm=!0,e.gisloading=!1,t.abrupt("return");case 12:return t.next=14,e.postLandListData(e.companyCode);case 14:return(n=t.sent)&&(n.map(function(e){return e.select=!1}),n.map(function(e){return e.hasArea=!1}),e.landList=n),a=n.length&&n[0].countyId||"",t.next=19,e.postCropListData(e.companyCode);case 19:return(i=t.sent)&&(i.map(function(e){return e.select=!1}),e.cropList=i),t.next=23,e.initFooter();case 23:return e.loading=!1,t.next=26,e.refsArcgisMap.initFeature(a);case 26:e.gisloading=!1;case 27:case"end":return t.stop()}},t,e)}))()},methods:{gismapClickfn:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:obj).gisDkid,t=void 0===e?"":e;this.plotDialog.plotdialogVisible=!1,this.cropLandActive(t,!0)},landTabClickfn:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:obj,t=e.areaid,r=e.plotId,n=e.hasArea;if(r&&this.landList.forEach(function(e){r===e.plotId&&(t=e.gisPlotId)}),this.plotDialog.plotdialogVisible=!1,!n)return this.refsArcgisMap.cropLandActive([],!1),this.$message("该地块未绘制轮廓，无法在地图中查看"),!1;this.cropLandActive(t,!0)},cropTabClickfn:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:obj,t=e.productId,r=e.gisIds,n=void 0===r?[]:r;this.plotDialog.plotdialogVisible=!1,n&&n.length?this.cropLandActive(t,!1,n):(this.cropLandActive(t,!1,[]),this.$message("该品种的地块未绘制轮廓，无法在地图中查看"))},plotdialogChange:function(e){e||(this.plotDialog.plotId="",this.plotDialog.plotTabIndex=1,this.cropLandActive(),this.closeAllDialogfn())},pagebackfn:function(){var e=this,t=this.$route.path;this.$router.go(-1),setTimeout(function(){t===e.$route.path&&e.pagebackfn()},200)},closeAllDialogfn:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;1!==e&&(this.regulatoryVisible=!1),2!==e&&(this.plotDialog.plotdialogVisible=!1)},cropLandActive:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return d(regeneratorRuntime.mark(function a(){var i,o,s,c,l;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(t.refsCropLandListTabs.selectCropAreaList(e,r),i=r?[e]:n,!r){a.next=19;break}return a.next=5,u(t,e);case 5:if(o=a.sent,s=p(o,2),c=s[0],l=s[1],!c||!l.obj.plotId){a.next=15;break}t.plotDialog.plotdialogVisible=!0,t.plotDialog.plotId=l.obj.plotId,t.plotDialog.plotTabIndex=1,a.next=19;break;case 15:return t.$message("该地块未绘制轮廓，无法在地图中查看"),t.refsArcgisMap.cropLandActiveRender([],!0),t.refsCropLandListTabs.selectCropAreaList(null,!0),a.abrupt("return");case 19:t.refsArcgisMap.cropLandActiveRender(i,r);case 20:case"end":return a.stop()}},a,t)}))()},numTofixed:function(){return s.b.apply(void 0,arguments)},postLandListData:function(e){var t=this;return new Promise(function(r){t.$ajax.post(t.$api.nongwei.zzgetPlotList,{companyCode:e}).then(function(e){var t=e.status,n=e.data;200===t&&0==n.respCode&&n.obj?r(n.obj):r(!1)}).catch(function(e){r(!1)})})},postCompanyInfoData:function(e){var t=this;return new Promise(function(r){t.$ajax.post(t.$api.nongwei.zzgetNameAndAreas,{companyCode:e}).then(function(e){var t=e.status,n=e.data;200===t&&0==n.respCode&&n.obj?r(n.obj):r(!1)}).catch(function(e){r(!1)})})},postCropListData:function(e){var t=this;return new Promise(function(r){t.$ajax.post(t.$api.nongwei.zzgetCropList,{companyCode:e}).then(function(e){var t=e.status,n=e.data;200===t&&0==n.respCode&&n.obj?r(n.obj):r(!1)}).catch(function(e){r(!1)})})}},components:{farmdetailGismap:o.default,farmDetailsTabsOther:n.default,cropLandListTabsOther:a.default,farmdetailFooter:i.default,regulatoryDialog:function(){return r.e(142).then(r.bind(null,"gdKI"))},plotDetailDialog:function(){return r.e(141).then(r.bind(null,"SXR7"))}},destroyed:function(){window.layer.closeAll()}},m=r("W5g0");var g=function(e){r("UxqA")},v=Object(m.a)(f,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"title",rawName:"v-title"}],staticClass:"farmdetail",attrs:{"data-title":"经营主体详情"}},[n("div",{staticClass:"homemap_content"},[n("div",{staticClass:"homemap_head"},[n("span",{staticClass:"fl",on:{click:function(t){return e.pagebackfn()}}},[n("img",{attrs:{src:r("HgnC"),alt:""}}),e._v(" "),n("i",[e._v("返回")])]),e._v(" "),e.companyInfo.name?n("p",{staticClass:"tit"},[e._v(e._s(e.companyInfo.name))]):e._e(),e._v(" "),e.companyInfo.name?n("p",{staticClass:"tit subtit"},[e.companyInfo.plotarea?n("span",[e._v("土地流转面积: "),n("i",[e._v(e._s(e.companyInfo.plotarea)+"亩")])]):e._e(),e._v(" "),e.companyInfo.plotAreas?n("span",[e._v("可种植/养殖面积: "),n("i",[e._v(e._s(e.companyInfo.plotAreas)+"亩")])]):e._e()]):e._e(),e._v(" "),n("span",{staticClass:"data-source"},[e._v("数据来源：上海种植业管理系统")])]),e._v(" "),n("div",{staticClass:"homemap_main"},[n("farmdetail-gismap",{ref:"arcgisMap",attrs:{landList:e.landList,cropList:e.cropList},on:{gismapClickEv:e.gismapClickfn}})],1),e._v(" "),n("div",{staticClass:"homemap_maplayer"},[e.loading?e._e():n("farm-details-tabs-other",{attrs:{companyCode:e.companyCode}}),e._v(" "),e.loading?e._e():n("crop-land-list-tabs-other",{ref:"cropLandListTabs",attrs:{companyCode:e.companyCode,landList:e.landList,cropList:e.cropList},on:{landTabClickEv:e.landTabClickfn,cropTabClickEv:e.cropTabClickfn}})],1),e._v(" "),e.errorFarm?n("div",{staticClass:"errorfarm"},[e._v("\n\t\t\t未找到对应主体\n\t\t")]):e._e(),e._v(" "),e.loading?e._e():n("farmdetail-footer",{attrs:{greenIsShow:e.layerGreenSwitch,lawSupervisionData:e.lawSupervisionData,greenCertData:e.greenCertData},on:{highlightshowev:e.layerGreenToggle,viewlawdetailev:e.layerLawSupervisionToggle}})],1),e._v(" "),e.plotDialog.plotdialogVisible?n("plotDetailDialog",{attrs:{plotdialogVisible:e.plotDialog.plotdialogVisible,"plot-id":e.plotDialog.plotId,"land-id":e.plotDialog.landId,"gis-type":e.plotDialog.gisType,plotTabIndex:e.plotDialog.plotTabIndex,modal:!1,showThreeTab:!0},on:{"update:plotTabIndex":function(t){return e.$set(e.plotDialog,"plotTabIndex",t)},"update:plot-tab-index":function(t){return e.$set(e.plotDialog,"plotTabIndex",t)},plotdialogChangeEv:e.plotdialogChange}}):e._e(),e._v(" "),e.regulatoryVisible?n("regulatory-dialog",{attrs:{regulatoryVisible:e.regulatoryVisible,lawSupervisionId:e.lawSupervisionId},on:{"update:regulatoryVisible":function(t){e.regulatoryVisible=t},"update:regulatory-visible":function(t){e.regulatoryVisible=t}}}):e._e(),e._v(" "),n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.gisloading,expression:"gisloading"}],staticClass:"map-loader",attrs:{"element-loading-text":"加载中...","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(1, 27, 41, 0.2)"}})],1)},[],!1,g,"data-v-a808ab98",null);t.default=v.exports},HgnC:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAAAxUlEQVRIie3UsQkCMQBG4T/a2QiCiCA4gUu4hljYWFjY2DiJzuEMNhaChYVYOIggPpvAhejpJVys8iBFjoMvhCRSLpf7FvBptIADRauS/95GDNgEdhZ6AsuqWCy4cbBFCBYDrh1sHoqFghMLPYBZDBYCjoG7xaaxWBloPHAkaS+p/Xt5vzPGGP9bw5tv68IqBQyBmz0sSbbUBwUMgKuDJj80AvrA5Z/XQkAPODto8osvoAucHDT50yagAxwpqu/xzuVykvQCKwD3YxUJ+sAAAAAASUVORK5CYII="},I0Vf:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});r("PvbX");var n=r("Xtqa");function a(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(a,i){try{var o=t[a](i),s=o.value}catch(e){return void r(e)}if(!o.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}var i={name:"CropLandListTabs",data:function(){return{activeName:"种养品种",allimg:{imga:r("Pzue"),imgb:r("XJN0"),imgc:r("NUlc"),imgd:r("1WKC"),lvseimg:r("sqi+")},landStatusMap:["-","使用中","闲置中"],prevclicktime:0,isClickLandList:!1}},props:{companyCode:{default:"",type:String},landList:{default:function(){return[]},type:Array},cropList:{default:function(){return[]},type:Array}},computed:{},created:function(){},mounted:function(){var e=this;return a(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:setTimeout(function(){e.initListScrollfn(!0)},500);case 1:case"end":return t.stop()}},t,e)}))()},methods:{initListScrollfn:function(e){var t=this;e?this.$nextTick(function(){$(t.$refs.croplistref).niceScroll({cursorcolor:"rgba(0, 247, 255 ,0.4)",cursorwidth:"3px",cursorborder:"",autohidemode:!0,smoothscroll:!1,railpadding:{top:0,right:-10,left:0,bottom:0}})}):this.$nextTick(function(){$(t.$refs.arealistref).niceScroll({cursorcolor:"rgba(0, 247, 255 ,0.4)",cursorwidth:"3px",cursorborder:"",autohidemode:!0,smoothscroll:!1,railpadding:{top:0,right:-10,left:0,bottom:0}})})},clickCropItemfn:function(e){var t=this;return a(regeneratorRuntime.mark(function r(){var n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(t.preventFastClicks()){r.next=3;break}return r.abrupt("return");case 3:return r.next=5,t.postCropIdGetLandIds(t.companyCode,e);case 5:n=r.sent,t.$emit("cropTabClickEv",{productId:e,gisIds:n});case 7:case"end":return r.stop()}},r,t)}))()},clickAreaItemfn:function(e,t){this.preventFastClicks()&&this.$emit("landTabClickEv",{areaid:e,hasArea:t})},selectCropAreaList:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.cropList.map(function(e){return e.select=!1}),this.landList.map(function(e){return e.select=!1}),this.isClickLandList=!0,setTimeout(function(){t.isClickLandList=!1}),r&&(this.activeName="地块",this.initListScrollfn(!1)),e&&(r?this.landList.map(function(t){t.gisPlotId===e&&(t.select=!0)}):this.cropList.map(function(t){t.productId===e&&(t.select=!0)}))},postCropIdGetLandIds:function(e,t){var r=this;return new Promise(function(n){r.$ajax.post(r.$api.nongwei.zzCropGetPlotids,{companyCode:e,productId:t}).then(function(e){var t=e.status,r=e.data;200===t&&0==r.respCode&&r.obj?n(r.obj):n(!1)}).catch(function(e){n(!1)})})},preventFastClicks:function(){var e=!1,t=Date.parse(new Date);return this.prevclicktime&&t<this.prevclicktime+500?e=!1:(e=!0,this.prevclicktime=Date.parse(new Date)),e}},filters:{numTofixed:function(e){return Object(n.b)(e,3)}},watch:{landList:{handler:function(){var e=this,t=-1;if(this.landList.map(function(e,r){e.select&&(t=r)}),!this.isClickLandList&&-1!==t){var r=60*(t-3);r=r<0?0:r,setTimeout(function(){$(e.$refs.arealistref).getNiceScroll(0).doScrollTop(r,200)},200)}},deep:!0}}},o=r("W5g0");var s=function(e){r("SSLm")},c=Object(o.a)(i,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tabs-container fr landdrap"},[n("div",{staticClass:"tabs-wrap"},[n("el-tabs",{on:{"tab-click":function(t){e.initListScrollfn("0"===t.index)}},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[n("el-tab-pane",{attrs:{label:"种养品种",name:"种养品种"}},[n("div",{staticClass:"tabitem"},[n("div",{ref:"croplistref",staticClass:"plantlistcon"},[e.cropList.length?n("ul",e._l(e.cropList,function(t,a){return n("li",{key:t.productId,staticClass:"clearfix",class:{active:t.select},attrs:{cropid:t.productId},on:{click:function(){e.clickCropItemfn(t.productId)}}},[n("div",{staticClass:"plantimg plant-pic"},[t.imgUrl?n("img",{attrs:{src:e.aliimgresizefn(t.imgUrl,40,40),alt:"loading"}}):n("span",{staticClass:"no-img"},[n("img",{attrs:{src:r("+SeG"),alt:"loading"}})])]),e._v(" "),n("div",{staticClass:"plantname"},[e._v("\n\t\t\t\t\t\t\t\t\t"+e._s(t.productName)+"\n\t\t\t\t\t\t\t\t")]),e._v(" "),n("div",{staticClass:"plot-area"},[e._v(e._s(e._f("numTofixed")(t.area))+"亩")])])}),0):n("ul",[n("li",{staticClass:"clearfix noplant"},[n("p",[n("img",{attrs:{src:e.allimg.imgb,alt:""}})]),e._v(" "),n("p",[e._v("暂无种养品种")])])])])])]),e._v(" "),n("el-tab-pane",{attrs:{label:"地块",name:"地块"}},[n("div",{staticClass:"tabitem"},[n("div",{ref:"arealistref",staticClass:"arealistcon"},[e.landList.length?n("ul",e._l(e.landList,function(t,r){return n("li",{key:t.gisPlotId,staticClass:"clearfix",class:{active:t.select,item_noarea:!t.hasArea},attrs:{areaid:t.gisPlotId},on:{click:function(){e.clickAreaItemfn(t.gisPlotId,t.hasArea)}}},[n("div",{staticClass:"areapointer"}),e._v(" "),n("div",{staticClass:"areaname"},[n("span",[e._v(e._s(t.name))]),e._v(" "),t.hasArea?e._e():n("i",[e._v("无地块轮廓")])]),e._v(" "),n("div",{staticClass:"plot-area"},[e._v(e._s(e._f("numTofixed")(t.area))+"亩")])])}),0):n("ul",[n("li",{staticClass:"clearfix noarea"},[n("p",[n("img",{attrs:{src:e.allimg.imgc,alt:""}})]),e._v(" "),n("p",[e._v("尚未添加地块")])])])])])])],1)],1)])},[],!1,s,"data-v-46dc2774",null);t.default=c.exports},RRlK:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("VCTt"),a=r("xUeN"),i=r("c65A"),o=r("o2Qu");function s(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(a,i){try{var o=t[a](i),s=o.value}catch(e){return void r(e)}if(!o.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}var c={name:"farmDetailsTabs",data:function(){return{yield:null,estimateYield:null,generateFarmIntro:{},farmIntroContainer:null,farmRecordScroll:null,showCompanyIcon:!1,viewPics:[],showViews:!1,goodsSubjectUnit:null,estimateGoodsSubjectUnit:null,goodsSubjectList:[],estimateGoodsSubjectList:[],yieldSubject:"agri",estimateYieldSubject:"agri",estimateYieldSubjectModel:"agri",showEstimateYieldModel:!1,curDate:null,isCollapse:!1,hasCollapse:!1}},props:["companyCode"],created:function(){this.initData()},mounted:function(){var e=this;return s(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},t,e)}))()},methods:{initData:function(){this.getZzBasCompany()},loadDataReady:function(){var e=this;this.$nextTick(s(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.farmRecordScroll=Object(n.a)(e.$refs.farmRecordScroll,{scrollX:!1,freeScroll:!1,click:!1,scrollbar:{fade:!0}});case 1:case"end":return t.stop()}},t,e)})))},getCropSubject:function(){var e=this;return s(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.$ajax.post(e.$api.public.farmCropSubject,{farmId:e.farmId}).then(function(t){var r=t.data;if(e.curDate=r.curDate,0===r.respCode)return e.goodsSubjectUnit={},0!==r.obj.list.length&&(e.goodsSubjectList=r.obj.list.map(function(t){return e.goodsSubjectUnit[t.cropSubjectIdentifier]="forestry"===t.cropSubjectIdentifier||"animal"===t.cropSubjectIdentifier?t.cropCategoryUnitAll:"吨",{name:t.cropSubjectNickname,id:t.cropSubjectIdentifier}}),e.yieldSubject=r.obj.list[0].cropSubjectIdentifier,!0)}));case 1:case"end":return t.stop()}},t,e)}))()},getZzBasCompany:function(){var e=this;return s(regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.post(e.$api.govPatrol.getZzBasCompany,{companyCode:e.companyCode});case 2:0===(r=t.sent).data.respCode&&(e.generateFarmIntro=r.data.obj||{});case 4:case"end":return t.stop()}},t,e)}))()},handleTabs:function(e){var t=this;this.$nextTick(function(){"input"===e.name&&t.farmRecordScroll&&t.farmRecordScroll.refresh()})},collapse:function(){var e=this;this.isCollapse=!this.isCollapse,setTimeout(function(){e.farmIntroContainer?e.farmIntroContainer.refresh():e.farmIntroContainer=Object(n.a)(e.$refs.farmIntroContainer,{scrollX:!1,freeScroll:!1,click:!1,scrollbar:{fade:!0}})},300)},openViews:function(e){this.showViews=!0,this.viewPics=e}},watch:{generateFarmIntro:function(){var e=this;this.$nextTick(s(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.farmIntroContainer=Object(n.a)(e.$refs.farmIntroContainer,{scrollX:!1,freeScroll:!1,click:!1,scrollbar:{fade:!0}}),e.hasCollapse=e.$refs.collapse.offsetHeight>130;case 2:case"end":return t.stop()}},t,e)})))},hasCollapse:function(e){var t=this;e&&setTimeout(function(){t.farmIntroContainer&&t.farmIntroContainer.refresh()},400)}},components:{farmRecordOther:a.default,views:i.default,estimateYieldModel:o.default}},l=r("W5g0");var u=function(e){r("Rlf+")},p=Object(l.a)(c,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"tabs-container"},[r("div",{staticClass:"tabs-wrap"},[r("el-tabs",{attrs:{value:"farmIntro"},on:{"tab-click":e.handleTabs}},[r("el-tab-pane",{attrs:{label:"基地介绍",name:"farmIntro"}},[r("div",{staticClass:"farm-intro"},[e.generateFarmIntro?r("div",{ref:"farmIntroContainer",staticClass:"farm-intro-container"},[r("div",{staticClass:"farm-intro-wrap"},[r("div",{staticClass:"info-item"},[r("p",{ref:"collapse",staticClass:"info-collapse",class:{"info-collapse-active":e.isCollapse,"info-collapse-has":e.hasCollapse}},[r("b",[e._v("基地简介：")]),e._v(" "),r("span",[e._v(e._s(e.generateFarmIntro.remark))])]),e._v(" "),e.hasCollapse?[e.isCollapse?e._e():r("p",{staticStyle:{height:"15px"}})]:e._e(),e._v(" "),e.hasCollapse?[e.isCollapse?e._e():r("p",{staticClass:"info-more"},[r("span",{staticClass:"info-more-text",on:{click:e.collapse}},[r("span",[e._v("展开")]),e._v(" "),r("i",{staticClass:"el-icon-d-arrow-right"})])])]:e._e()],2),e._v(" "),r("p",{staticClass:"info-item"},[r("b",[e._v("经营主体：")]),e._v(e._s(e.generateFarmIntro.name))]),e._v(" "),r("p",{staticClass:"info-item"},[r("b",[e._v("主体类型：")]),e._v(e._s(e.generateFarmIntro.type))]),e._v(" "),r("p",{staticClass:"info-item"},[r("b",[e._v("法人代表（负责人）：")]),e._v(e._s(e.generateFarmIntro.man1))]),e._v(" "),r("p",{staticClass:"info-item"},[r("b",[e._v("联系方式：")]),e._v(e._s(e.generateFarmIntro.phone?e.generateFarmIntro.phone:""))]),e._v(" "),r("p",{staticClass:"info-item clearfix"},[r("span",[r("b",[e._v("主体唯一标识：")]),r("i",{staticStyle:{"font-style":"normal"}},[e._v(e._s(e.generateFarmIntro.creditCode))])])]),e._v(" "),r("p",{staticClass:"info-item"},[r("b",[e._v("基地位置：")]),e._v(e._s(e.generateFarmIntro.addr2?"基地位于"+e.generateFarmIntro.addr2:""))])])]):e._e()])]),e._v(" "),r("el-tab-pane",{attrs:{label:"农事操作",name:"input"}},[r("div",{staticClass:"farmword-container"},[r("div",{ref:"farmRecordScroll",staticClass:"farmword-wrap"},[r("farm-record-other",{attrs:{companyCode:e.companyCode},on:{loadDataReady:e.loadDataReady}})],1)])])],1)],1),e._v(" "),e.showCompanyIcon?r("views",{attrs:{pics:[e.generateFarmIntro.landRightImgUrl||""]},on:{viewerListen:function(t){e.showCompanyIcon=!1}}}):e._e(),e._v(" "),e.showViews?r("views",{attrs:{pics:e.viewPics},on:{viewerListen:function(t){e.showViews=!1}}}):e._e(),e._v(" "),e.showEstimateYieldModel?r("estimate-yield-model",{attrs:{"show-model":e.showEstimateYieldModel,"goods-subject-unit":e.estimateGoodsSubjectUnit,"estimate-yield-subject-model":e.estimateYieldSubjectModel,"goods-subject-list-model":e.estimateGoodsSubjectList},on:{"update:showModel":function(t){e.showEstimateYieldModel=t},"update:show-model":function(t){e.showEstimateYieldModel=t}}}):e._e()],1)},[],!1,u,"data-v-042194a2",null);t.default=p.exports},"Rlf+":function(e,t){},SSLm:function(e,t){},SYE9:function(e,t,r){"use strict";var n={indexfn:function(e,t){console.time("获取中心点时间");var r=this,n=+new Date,a=JSON.parse(JSON.stringify(e[0])),i=this.getBoundPinterfn(e),o=i[0][1],s=i[0][0],c=i[1][1]-i[0][1],l=i[0][0]-i[1][0],u=(t*l/c).toFixed(5),p=this.printMatrix(this.newMarixFn(t,u)),d=c/(t-1),f=l/(u-1);p=p.reverse();var m=function t(a){if(+new Date-n>200)return!1;if(0==a)return!1;for(var i=[],c=0;c<p.length;c++){var l=p[c].split("-"),u=o+parseInt(l[0])*d,m=s-parseInt(l[1])*f;if(r.morePoinersInMapfn([m,u],e,a)){i.push(m),i.push(u);break}}return i.length>0?i:t(a/2)}(c/(t-1)*4);return m&&(a.length=0,a=m),console.timeEnd("获取中心点时间"),a},morePoinersInMapfn:function(e,t,r){for(var n=[],a=[[0,0],[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1],[0,1],[1,1]],i=0;i<a.length;i++){var o=this.pointerIsInMapfn([e[0]+a[i][1]*r,e[1]+a[i][0]*r],t);n.push(o)}return n.every(function(e){return e})},printMatrix:function(e){if(null!=e&&0!=e[0].length){for(var t=e.length,r=e[0].length,n=0,a=[];r>2*n&&t>2*n;){for(var i=r-1-n,o=t-1-n,s=n;s<=i;s++)a.push(e[n][s]);if(n<o)for(s=n+1;s<=o;s++)a.push(e[s][i]);if(n<i&&n<o)for(s=i-1;s>=n;s--)a.push(e[o][s]);if(n<i&&n<o-1)for(s=o-1;s>=n+1;s--)a.push(e[s][n]);n++}return a}},newMarixFn:function(e,t){if(e<0||t<0)return[];for(var r=[],n=0;n<e;n++){for(var a=[],i=0;i<t;i++){var o;o=n+"-"+i,a.push(o)}r.push(a)}return r},getBoundPinterfn:function(e){var t=L.polygon(e,{}).getBounds();return[[t.getNorthWest().lat,t.getNorthWest().lng],[t.getSouthEast().lat,t.getSouthEast().lng]]},pointerIsInMapfn:function(e,t){if(e&&t)return!!gju.pointInPolygon({type:"Point",coordinates:e},{type:"Polygon",coordinates:[t]})}};t.a=n},SdNZ:function(e,t){},UxqA:function(e,t){},Xb9r:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("wggp"),a=r.n(n),i=r("PbuP"),o=r("yTDo"),s=r("R9IU"),c=r("jIOT"),l=r("YjV0"),u=r("VKKs"),p=(r("PvbX"),function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(a)throw i}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}());function d(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function f(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(a,i){try{var o=t[a](i),s=o.value}catch(e){return void r(e)}if(!o.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}var m={inject:["farmDetailRefs"],data:function(){return{gismap:null,gisloading:!0,temptoken:"",tileMap:{weixing:"/shanghaiArcGIS/rest/services/SHMAP_IMAGE/MapServer"},options:{url:"http://gov.snkoudai.com/mapdemo/arcgis3.28/init.js"},allPlotMarkerLayer:null,allPlotPolygonLayer:null,activePlotsLayer:null,greenCertPlotsLayer:null,greenCertPlotsIsActive:!1,serviceMap:{nongyongdi:"",dapeng:"",hezuosheNaturalBorder:""},homeLatLng:[121.12961431068945,30.979833911253177,121.69403691811132,31.266851733518802],wxLayerUpdateEnd:!1,plotidMapImg:{},tipsShow:!1}},props:{landList:{default:function(){return[]},type:Array},cropList:{default:function(){return[]},type:Array}},computed:{landGisIds:function(){return this.landList.map(function(e){return e.gisPlotId})}},mounted:function(){var e=this;return f(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.initMap();case 2:case"end":return t.stop()}},t,e)}))()},methods:{initFeature:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return f(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!e.landList.length){r.next=5;break}return r.next=3,e.renderPlotToMap(e.landList,t);case 3:r.sent.forEach(function(t,r){var n=t.attributes.DPDKID||t.attributes.DKID;e.landList.forEach(function(e){e.gisPlotId===n&&(e.hasArea=!0)})});case 5:case"end":return r.stop()}},r,e)}))()},initMap:function(){var e,t=this;return new Promise((e=f(regeneratorRuntime.mark(function e(r){var n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(u.b)("govGovernmentSubjectVO"),a="310100",n&&n.cityId&&2===n.subjectLevel&&(a=n.cityId),n&&n.countyId&&3===n.subjectLevel&&(a=n.countyId),a=i.a.hasOwnProperty(a)?a:"310100",t.serviceMap.nongyongdi=i.a[a].nongyongdi,t.serviceMap.dapeng=i.a[a].dapeng,t.serviceMap.hezuosheNaturalBorder=i.a[a].hezuosheNaturalBorder,t.homeLatLng=i.a[a].centerExtend,e.next=11,Object(o.a)(t);case 11:t.temptoken=e.sent,t.$nextTick(f(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.renderMap();case 2:return e.next=4,t.listenrMapInitStatus();case 4:if(e.sent){e.next=8;break}return window.location.reload(),e.abrupt("return");case 8:dojo.connect(t.gismap,"onClick",t.searchPointer),r();case 10:case"end":return e.stop()}},e,t)})));case 13:case"end":return e.stop()}},e,t)})),function(t){return e.apply(this,arguments)}))},renderMap:function(){var e=this;return new Promise(function(t){a.a.loadModules(["esri/map","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ImageParameters","esri/geometry/Point","esri/SpatialReference","esri/geometry/Extent","esri/layers/GraphicsLayer"],e.options).then(function(r){var n=p(r,8),a=n[0],i=n[1],o=(n[2],n[3],n[4],n[5],n[6]),s=n[7],c=e,l=new a("gismap",{extent:new(Function.prototype.bind.apply(o,[null].concat(d(e.homeLatLng),[new esri.SpatialReference({wkid:4326})]))),logo:!1,optimizePanAnimation:!0});dojo.connect(l,"onExtentChange",function(){}),dojo.connect(l,"onZoomEnd",function(e){var t=l.getZoom();c.updateMarker(c.allPlotMarkerLayer.graphics,t+10)});var u=new i(e.tileMap.weixing,{id:"weixing_ditu"});u.on("update-end",function(e){console.log(e.error),c.wxLayerUpdateEnd=!0});try{l.addLayer(u)}catch(e){console.log(e),console.log("报错")}e.allPlotPolygonLayer=new s({visible:!0}),l.addLayer(e.allPlotPolygonLayer),e.greenCertPlotsLayer=new s({visible:!0}),l.addLayer(e.greenCertPlotsLayer),e.activePlotsLayer=new s({visible:!0}),l.addLayer(e.activePlotsLayer),e.allPlotMarkerLayer=new s({visible:!0}),l.addLayer(e.allPlotMarkerLayer),e.gismap=l,t(!0)},function(e){t(!1)})})},listenrMapInitStatus:function(){var e,t=this,r=this,n=!1,a=r.$route.path;function i(){var e,t=this;return new Promise((e=f(regeneratorRuntime.mark(function e(i){var o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o=function(){if(r.$route.path===a&&!n){var e=document.getElementById("gismap_weixing_ditu");e&&""!==e.innerHTML&&(n=!0,i(!0))}},setTimeout(o,200),setTimeout(o,500),setTimeout(o,1e3),setTimeout(o,2e3),setTimeout(o,4e3),setTimeout(o,5e3),setTimeout(function(){if(r.$route.path===a&&!n){var e=document.getElementById("gismap_weixing_ditu");e&&""!==e.innerHTML?(n=!0,i(!0)):(document.getElementById("gismap").innerHTML="",console.log("天地图加载有问题 重新加载"),i(!1))}},7e3);case 8:case"end":return e.stop()}},e,t)})),function(t){return e.apply(this,arguments)}))}return new Promise((e=f(regeneratorRuntime.mark(function e(r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i();case 2:n=e.sent,r(n);case 4:case"end":return e.stop()}},e,t)})),function(t){return e.apply(this,arguments)}))},initServerLayer:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"nongyongdi";return new Promise(function(r){var n=e.serviceMap[t]+"?token="+e.temptoken;a.a.loadModules(["esri/layers/ArcGISDynamicMapServiceLayer"],e.options).then(function(e){p(e,1)[0];var a=new esri.layers.ArcGISDynamicMapServiceLayer(n,{id:t,outFields:["*"]});r(a)},function(e){r(!1)})})},renderAllPolygon:function(e,t){var r,n=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return new Promise((r=f(regeneratorRuntime.mark(function r(i){var o,s,c,l,u;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(e.length){r.next=3;break}return i(),r.abrupt("return");case 3:return r.next=5,n.mergePolygonRander(e,a);case 5:o=r.sent,s=p(o,2),c=s[0],l=s[1],c.map(function(e){t.add(e)}),u={},l.map(function(e){u[e.plotid]=e}),t.plotFeatures=Object.assign({},u),i();case 14:case"end":return r.stop()}},r,n)})),function(e){return r.apply(this,arguments)}))},mergePolygonRander:function(e,t){var r=this;return new Promise(function(n){a.a.loadModules(["esri/graphic","esri/geometry/Polygon","esri/SpatialReference","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol"],r.options).then(function(a){var i=p(a,5),o=i[0],s=i[1],c=i[2],l=i[3],u=i[4];if(0!==e.length){for(var f={},m=[],g=1===t?4:1,v=0;v<e.length;v++){var h=r.getNowAreaColor(e[v],t),y=p(h,2),w=y[0],b=y[1],C=JSON.parse(JSON.stringify(e[v].geometry.rings)),L=(w+b+g).split(",").join(""),x=e[v].attributes.DPDKID||e[v].attributes.DKID;if(m.push({plotid:x,plotplusid:r.getNYDid(x),areaColor:w,borderColor:b,borderwidth:g,rings:C}),f[L]){C=JSON.parse(JSON.stringify(e[v].geometry.rings));f[L].rings=f[L].rings.concat(C)}else f[L]={areaColor:w,borderColor:b,borderwidth:g,rings:C}}var I=[];for(var S in f){for(var A=f[S],P=(w=A.areaColor,b=A.borderColor,g=A.borderwidth,C=A.rings,new l(l.STYLE_SOLID,new u(u.STYLE_SOLID,new dojo.Color(b),g),new dojo.Color([].concat(d(w),[.3])))),k=new s(new c({wkid:4326})),D=0,_=C.length;D<_;D++)k.addRing(C[D]);I.push(new o(k,P))}n([I,m])}else n(!1)})})},updateFeature:function(e,t,r){var n=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return new Promise(function(o){a.a.loadModules(["esri/graphic","esri/geometry/Polygon","esri/SpatialReference","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol"],n.options).then(function(a){var s=p(a,5),c=s[0],l=s[1],u=s[2],f=s[3],m=s[4];if(!e.length)return r.clear(),void o(!0);var g=!1,v={},h=new l(new u({wkid:4326}));if(e.map(function(e){if(t.hasOwnProperty(e)){g=!0;var r=n.getNowAreaColor(t[e],2),a=p(r,2),o=a[0],s=a[1],c=i.stroke,l=void 0===c?s:c,u=i.fillOpacity,d=void 0===u?.3:u,f=i.fill,m=void 0===f?o:f,h=JSON.parse(JSON.stringify(t[e].rings)),y=(m+l+d).split(",").join("");if(v[y]){h=JSON.parse(JSON.stringify(t[e].rings));v[y].rings=v[y].rings.concat(h)}else v[y]={areaColor:m,borderColor:l,borderwidth:4,fillOpacity:d,rings:h}}}),g)for(var y in v){for(var w=v[y],b=w.areaColor,C=w.borderColor,L=w.borderwidth,x=w.fillOpacity,I=w.rings,S=new f(f.STYLE_SOLID,new m(m.STYLE_SOLID,new dojo.Color(C),L),new dojo.Color([].concat(d(b),[x]))),A=(h=new l(new u({wkid:4326})),0),P=I.length;A<P;A++)h.addRing(I[A]);r.add(new c(h,S))}o(g)})})},renderAllMarker:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:17,i=this;return new Promise(function(o){0!==e.length?a.a.loadModules(["esri/graphic","esri/geometry/Point","esri/symbols/PictureMarkerSymbol","esri/SpatialReference"],r.options).then(function(r){for(var a=p(r,4),c=a[0],l=a[1],u=a[2],d=a[3],f=0;f<e.length;f++){var m=JSON.parse(JSON.stringify(e[f].geometry.rings)),g=e[f].attributes.DPDKID||e[f].attributes.DKID;v(m,i.aliimgCircle(i.plotidMapImg[g],48),t)}function v(e,t,r){var a=[];e[0].map(function(e){2===e.length&&a.push(e)});var o=[];a.map(function(e){2===e.length&&o.push(s.point(e))});var f=s.featureCollection(o),m=s.center(f),g=i.computeMarkerPosAnchor(n),v=p(g,2),h=v[0],y=v[1],w=new l(m.geometry.coordinates,new d({wkid:4326})),b=new u({url:t,width:h[0],height:h[1],xoffset:y[0],yoffset:y[1]});r.add(new c(w,b))}o()}):o()})},updateMarker:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments[1];t.map(function(t){var n=t.symbol,a=e.computeMarkerPosAnchor(r),i=p(a,2),o=i[0],s=i[1];n.setWidth(o[0]),n.setHeight(o[1]),n.setOffset.apply(n,d(s))})},computeMarkerPosAnchor:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:2,9:4,10:4,11:4,12:6,13:6,14:6,15:6,16:8,17:8,18:12,19:18,20:36,21:42,22:48}[e]:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:2,9:4,10:4,11:4,12:6,13:8,14:8,15:8,16:12,17:16,18:24,19:32,20:40,21:48,22:56}[e],a=[[],[[0,0]],[[24,12],[0,12]],[[12,24],[0,0],[24,0]],[[24,24],[0,24],[0,0],[24,0]]].map(function(e){return e.map(function(e){return e[0]=parseInt(e[0]*n/24),e[1]=parseInt(e[1]*n/24),e}),e})[t][r];return[[n,n],a]},aliimgCircle:function(e,t){return t=t||100,e&&-1!==e.indexOf(".aliyuncs.com/")?e+"?x-oss-process=image/resize,w_"+t+",h_"+t+",m_fill/auto-orient,1/quality,q_100/sharpen,80/format,png":e},getCenterAZoom:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"company";return new Promise(function(n){for(var i=[],o=[],s=[],c=[],l=0;l<e.length;l++){var u=e[l].geometry.getExtent();i.push(u.xmin),o.push(u.ymin),s.push(u.xmax),c.push(u.ymax)}var f=function(e,t){if(4!==e.length)return[];var r=e[2]-e[0],n=e[3]-e[1];e[0],e[1];if("company"===t){var a=.25*r,i=.25*n;return[e[0]-5*a,e[1]-i,e[2]+5*a,e[3]+1.5*i]}if("plot"===t){var a=r,i=n;return[e[0]-a,e[1]-i,e[2]+a,e[3]+6*i]}}([Math.min.apply(null,i),Math.min.apply(null,o),Math.max.apply(null,s),Math.max.apply(null,c)],r);a.a.loadModules(["esri/geometry/Extent","esri/layers/GraphicsLayer"],t.options).then(function(e){var r=p(e,2),a=r[0],i=(r[1],new(Function.prototype.bind.apply(a,[null].concat(d(f),[new esri.SpatialReference({wkid:4326})]))));t.gismap.setExtent(i);var o=Boolean(f[2]-f[0]>.05||f[3]-f[1]>.05);n(o)})})},searchPointer:function(e){var t=this;return f(regeneratorRuntime.mark(function r(){var n,a,i,o,s,c,l,u,d,f;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return t.layersHander(),t.gismap.infoWindow.hide(),r.next=4,t.queryOnePointer(e,"dapeng");case 4:if(n=r.sent,a=p(n,2),i=a[0],o=a[1],!i){r.next=13;break}if(!(s=o.features[0].attributes.DPDKID||"")||!t.landGisIds.includes(s)){r.next=13;break}return t.$emit("gismapClickEv",{gisDkid:s}),r.abrupt("return");case 13:return r.next=15,t.queryOnePointer(e,"nongyongdi");case 15:c=r.sent,l=p(c,2),u=l[0],d=l[1],u?(f=d.features[0].attributes.DKID||"")&&t.landGisIds.includes(f)&&t.$emit("gismapClickEv",{gisDkid:f}):console.log("当前地点无地块数据");case 20:case"end":return r.stop()}},r,t)}))()},layersHander:function(e){switch(e){case 0:this.activePlotsLayer&&this.activePlotsLayer.clear();break;default:this.activePlotsLayer&&this.activePlotsLayer.clear(),this.gismap.infoWindow.hide()}},queryOnePointer:function(e,t){var r=this;return new Promise(function(n){a.a.loadModules(["esri/tasks/QueryTask","esri/tasks/query","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol"],r.options).then(function(a){var i=p(a,4),o=i[0],s=i[1],c=i[2],l=i[3],u=new s;u.returnGeometry=!0,u.outFields=["*"];new c(c.STYLE_SOLID,new l(l.STYLE_SOLID,new dojo.Color([255,255,255]),4),new dojo.Color([255,255,255,.5]));var d,m=new o(r.serviceMap[t]+"/0?token="+r.temptoken);u.geometry=e.mapPoint,m.execute(u,(d=f(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t&&t.features&&t.features.length>0&&t.features[0].attributes&&(t.features[0].attributes.hasOwnProperty("DPDKID")||t.features[0].attributes.hasOwnProperty("DKID"))?n([!0,t]):n([!1,null]);case 1:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)}))})})},showAreaInfo:function(e,t,r){var n=this;if(t.features&&0!=t.features.length){var a=t.features[0].attributes;a.hasOwnProperty("DPDKID")?e.infoWindow.setTitle("大棚: "+a.DPDKID):e.infoWindow.setTitle("农用地: "+a.DKID);var i='<div class="plot-table-content">';for(var o in a){var s=a[o];"Shape_Area"===o?s=p(a.Shape_Area):"SHAPE_Area"===o&&(s=p(a.SHAPE_Area));var l=new RegExp("[\\u4E00-\\u9FFF]+","g");if(c.a.hasOwnProperty(o)||l.test(o)){var u=c.a.hasOwnProperty(o)?c.a[o]:o;s="地块类型"===u&&c.b.hasOwnProperty(s)?c.b[s]:s,s="主体类型"===u&&c.d.hasOwnProperty(s)?c.d[s]:s,a[o]&&""!==a[o]&&" "!==a[o]&&"  "!==a[o]&&(i+='<div><span class="title pyc">'+u+"</span><p>"+s+"</p></div>")}}return i+="</div>",e.infoWindow.setContent(i),e.infoWindow.show(r,e.getInfoWindowAnchor(r)),e.infoWindow.domNode.querySelector(".titleButton.close").addEventListener("click",function(){n.layersHander()}),!0}return!1;function p(e){/\d+e[+-]\d/g.test(e=e)||e<1e-4?e*=16e6:e=parseFloat(e/666.66666666667);var t=e.toExponential().match(/\d(?:\.(\d*))?e([+-]\d+)/);return e.toFixed(Math.max(0,(t[1]||"").length-t[2]))}},getNowAreaColor:function(e,t){if(!e||!e.attributes||!(e.attributes["土地类型"]||e.attributes.TYPE||e.attributes.LANDTYPE))return[[51,98,2],[255,0,0]];var r=e.attributes["土地类型"]||e.attributes.TYPE||e.attributes.LANDTYPE;return c.c.hasOwnProperty(r)?e.attributes["土地类型"]?1===t?[c.c[r],[255,0,0]]:2===t?[c.c[r],[215,116,85]]:[c.c[r],c.c[r]]:1===t?[c.c[r],[255,0,0]]:2===t?[c.c[r],[215,116,85]]:[c.c[r],[165,165,165]]:[[201,242,208],[165,165,165]]},renderPlotToMap:function(e){var t,r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Promise((t=f(regeneratorRuntime.mark(function t(a){var i,o,s,c,l,u;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=e.map(function(e){return r.plotidMapImg[e.gisPlotId]=e.imgUrl,e.gisPlotId}),t.next=3,r.goMorePlotsWithId("nongyongdi",i,n);case 3:return o=t.sent,s=p(o,2),c=s[0],l=s[1],u=[],c&&l.length>0&&u.push.apply(u,d(l)),t.next=11,r.renderAllPolygon(u,r.allPlotPolygonLayer,2);case 11:return t.next=13,r.renderAllMarker(u,r.allPlotMarkerLayer,17);case 13:if(!c){t.next=18;break}return t.next=16,r.getCenterAZoom(u);case 16:t.next=19;break;case 18:r.tipsShow=!0;case 19:a(u);case 20:case"end":return t.stop()}},t,r)})),function(e){return t.apply(this,arguments)}))},goMorePlotsWithId:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return f(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",new Promise(function(){var a=f(regeneratorRuntime.mark(function a(o){var s,c,l,u;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(u=function e(t,r){return t.length>r?[t.splice(0,r)].concat(d(e(t,r))):[t]},t&&0!==t.length){a.next=4;break}return o(),a.abrupt("return");case 4:s=n&&i.a[n]&&i.a[n][e]||r.serviceMap[e],c=s+"/0?token="+r.temptoken,l=[],u(JSON.parse(JSON.stringify(t)),1e3).forEach(function(){var t=f(regeneratorRuntime.mark(function t(n,a){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:l.push(r.serverQuery(c,r.plotQueryfn(n,e)));case 1:case"end":return t.stop()}},t,r)}));return function(e,r){return t.apply(this,arguments)}}()),Promise.all(l).then(function(e){var t=!1,r=[];e.forEach(function(e,n){var a=p(e,2),i=a[0],o=a[1];i&&(t=!0),r.push.apply(r,d(o))}),o([t,r])});case 10:case"end":return a.stop()}},a,r)}));return function(e){return a.apply(this,arguments)}}()));case 1:case"end":return a.stop()}},a,r)}))()},serverQuery:function(e,t){var r=this;return new Promise(function(n){a.a.loadModules(["esri/map","esri/layers/ArcGISDynamicMapServiceLayer","esri/tasks/QueryTask","esri/toolbars/draw","esri/tasks/query","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol"],r.options).then(function(r){var a=p(r,7),i=(a[0],a[1],a[2]),o=(a[3],a[4]),s=(a[5],a[6],new i(e)),c=new o;if(c.outFields=["*"],t&&(c.where=t()),c.where){c.outSpatialReference=esri.spatialReference,c.spatialRelationship=o.SPATIAL_REL_INTERSECTS,c.returnGeometry=!0,c.returnDistinctValues=!1,c.relationParam=!1;try{s.execute(c,function(e){e.features&&0!==e.features.length?n([!0,e.features]):n([!1,[]])})}catch(e){n([!1,[]])}}else n([!1,[]])})})},plotQueryfn:function(e,t){var r="DPDKID",n=e||[];return n=n.filter(function(e){if(e)return e}),"nongyongdi"===t&&(r="DKID"),function(){for(var e="",t=0;t<n.length;t++)n[t]&&(t===n.length-1?e+=r+" = '"+n[t]+"'":e+=r+" = '"+n[t]+"' or ");return e}},greenCertLandActive:function(){var e,t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return new Promise((e=f(regeneratorRuntime.mark(function e(n){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.greenCertPlotsIsActive=Boolean(r.length),t.greenCertPlotsLayer.clear(),t.allPlotPolygonLayer.plotFeatures&&0!==t.allPlotPolygonLayer.plotFeatures.length){e.next=5;break}return n(!1),e.abrupt("return");case 5:if(!r.length){e.next=15;break}return e.next=8,t.updateFeature(r,t.allPlotPolygonLayer.plotFeatures,t.greenCertPlotsLayer,{stroke:[255,255,255],fillOpacity:.6,fill:[118,255,3]});case 8:if(!(a=e.sent)){e.next=12;break}return e.next=12,t.getCenterAZoom(t.greenCertPlotsLayer.graphics);case 12:n(a),e.next=16;break;case 15:n(!0);case 16:case"end":return e.stop()}},e,t)})),function(t){return e.apply(this,arguments)}))},greenCertLandCanvelActive:function(){var e=this;this.greenCertPlotsIsActive&&(this.greenCertPlotsLayer._div.rawNode.querySelectorAll("path")[0]&&(a.a.loadModules(["esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol","esri/Color"],this.options).then(function(t){var r=p(t,3),n=r[0],a=r[1],i=r[2],o=new n(n.STYLE_SOLID,new a(a.STYLE_SOLID,new i([118,255,3]),3),new i([118,255,3,.6]));e.greenCertPlotsLayer.graphics.map(function(e){e.setSymbol(o)})}),this.greenCertPlotsIsActive=!1))},cropLandActiveRender:function(){var e,t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments[1];return new Promise((e=f(regeneratorRuntime.mark(function e(a){var i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.activePlotsLayer.clear(),e.next=3,t.updateFeature(r,t.allPlotPolygonLayer.plotFeatures,t.activePlotsLayer,{stroke:[255,255,255],fillOpacity:.6});case 3:if(i=e.sent,!r.length||!i){e.next=9;break}return o=n?"plot":"company",t.activePlotsLayer.graphics[0]._extent,e.next=9,t.getCenterAZoom(t.activePlotsLayer.graphics,o);case 9:t.greenCertLandCanvelActive(),a(i);case 11:case"end":return e.stop()}},e,t)})),function(t){return e.apply(this,arguments)}))},setPlotPosition:function(e){var t=this;a.a.loadModules(["esri/map","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ImageParameters","esri/geometry/Point","esri/SpatialReference","esri/geometry/Extent","esri/layers/GraphicsLayer"],this.options).then(function(r){var n=p(r,8),a=(n[0],n[1],n[2],n[3],n[4],n[5],n[6]),i=(n[7],new(Function.prototype.bind.apply(a,[null].concat(d(e),[new esri.SpatialReference({wkid:4326})]))));t.gismap.setExtent(i,!0)})},getNYDid:function(e){return/(\d{18})(\d{3})/g.test(e)?RegExp.$1+"000":e+""}},components:{iknow:l.default}},g=r("W5g0");var v=function(e){r("SdNZ")},h=Object(g.a)(m,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"arcgis-map"},[r("div",{staticClass:"map-container",attrs:{id:"gismap"}}),e._v(" "),e.tipsShow?r("iknow",{attrs:{tipsShow:e.tipsShow,tipText:"无法显示地块轮廓，该基地的地块未上图"},on:{"update:tipsShow":function(t){e.tipsShow=t},"update:tips-show":function(t){e.tipsShow=t}}}):e._e()],1)},[],!1,v,"data-v-dc4ea0fc",null);t.default=h.exports}});
//# sourceMappingURL=57.5d30e75585f00a60c039.js.map