{"version":3,"file":"static/js/89.c4e0dc779c3f580b5408.js","sources":["webpack:///src/pages/recycle-bin/gmap.vue"],"sourcesContent":["<template>\r\n  <!-- 基于高德地图和leaflet的地图下钻 -->\r\n  <div>\r\n    <div class=\"gmap\" id=\"gmap\" ref=\"gmap\"></div>\r\n  </div>\r\n\r\n</template>\r\n\r\n<script>\r\nimport { getFeature } from '@/common/fn';\r\n\r\nexport default {\r\n  name: 'gmap',\r\n  data () {\r\n    return {\r\n      gmap: null,\r\n      allPolygon: [],\r\n      // 防止触发feature事件的时候触发了map上的事件，此变量用作开关\r\n      isFeatureClick: false,\r\n      // 记录当前下钻的adcode\r\n      adCodes: [100000],\r\n      sub: true\r\n    };\r\n  },\r\n  mounted () {\r\n    this.$nextTick(() => {\r\n      this._initMap();\r\n    });\r\n  },\r\n  methods: {\r\n    // 初始化地图\r\n    _initMap () {\r\n      this.gmap = L.map(this.gmapEl, {\r\n        center: [0, 0],\r\n        zoom: 9,\r\n        zoomSnap: 0.1,\r\n        layers: [],\r\n        zoomControl: false,\r\n        attributionControl: false,\r\n        dragging: true,\r\n        touchZoom: false,\r\n        scrollWheelZoom: true,\r\n        doubleClickZoom: false,\r\n        boxZoom: false,\r\n        tap: false,\r\n        keyboard: false,\r\n        maxZoom: 21,\r\n        minZoom: 5\r\n      })\r\n        .on('click', (e) => {\r\n          if (!this.isFeatureClick) {\r\n            // console.log(\"gmap\", e);\r\n            // console.log(this.removeCode());\r\n            this.drawPolygon(this.removeCode());\r\n          }\r\n          this.isFeatureClick = false;\r\n        });\r\n      this.drawPolygon(this.adCodes[0]);\r\n    },\r\n\r\n    // 绘制轮廓\r\n    async drawPolygon (areaId) {\r\n      // 获取高德json\r\n      const district = await getFeature({ areaId });\r\n      // console.log(areaId);\r\n      const features = district.features;\r\n      this.sub = district.sub;\r\n      this.allPolygon.forEach(item => {\r\n        item.remove();\r\n      });\r\n      this.allPolygon = [];\r\n      features.forEach((item, index) => {\r\n        this.allPolygon[index] = L.geoJSON(item, {\r\n          style () {\r\n            return {\r\n              color: '#ffc777',\r\n              fillColor: '#47473b',\r\n              fillOpacity: 0.6,\r\n              fillRule: 'evenodd',\r\n              className: 'polygonbox',\r\n              lineJoin: 'miter',\r\n              weight: 1\r\n            };\r\n          }\r\n        })\r\n          .on('click', ({ latlng: targetLatlng, layer }) => {\r\n            this.isFeatureClick = true;\r\n            // console.log(layer.feature.properties.adcode);\r\n            this.drawPolygon(layer.feature.properties.adcode);\r\n            this.addAdCode(layer.feature.properties.adcode);\r\n          })\r\n          .addTo(this.gmap);\r\n      });\r\n      this.drawProvinceFn();\r\n    },\r\n\r\n    // 计算所有图形的中心点和zoom大小\r\n    drawProvinceFn () {\r\n      // 所有多边形居中\r\n      const allPointer = [];\r\n      let zoom;\r\n      let center;\r\n      let bigPolygon;\r\n\r\n      this.allPolygon.forEach(item => {\r\n        const pb = item.getBounds();\r\n        allPointer.push([pb._southWest.lat, pb._southWest.lng]);\r\n        allPointer.push([pb._northEast.lat, pb._northEast.lng]);\r\n      });\r\n      // 获取所有板块集合的坐标\r\n      bigPolygon = L.polygon(allPointer, {}).getBounds();\r\n\r\n      zoom = this.gmap.getBoundsZoom(bigPolygon);\r\n\r\n      center = bigPolygon.getCenter();\r\n\r\n      this.gmap.setView(center, zoom);\r\n    },\r\n\r\n    // 增加adCode\r\n    addAdCode (adcode) {\r\n      if (!this.sub) return false;\r\n      this.adCodes = [...this.adCodes, adcode];\r\n    },\r\n    // 删除adCode\r\n    removeCode () {\r\n      if (this.adCodes.length > 1) {\r\n        this.adCodes.pop();\r\n        return this.adCodes.slice(-1)[0];\r\n      } else {\r\n        return this.adCodes[0];\r\n      }\r\n    }\r\n  },\r\n  computed: {\r\n    gmapEl () {\r\n      return this.$refs.gmap;\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n  .gmap {\r\n    position: fixed;\r\n    top: 0;\r\n    right: 0;\r\n    bottom: 0;\r\n    left: 0;\r\n    z-index: 9999;\r\n    background-color: #000;\r\n  }\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/pages/recycle-bin/gmap.vue"],"mappings":"AAWA","sourceRoot":""}