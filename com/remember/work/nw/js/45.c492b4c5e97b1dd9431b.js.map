{"version":3,"file":"static/js/45.c492b4c5e97b1dd9431b.js","sources":["webpack:///src/components/overview/modules/business-scale-statistics-21.vue"],"sourcesContent":["<template>\n\t<div class=\"business-scale-statistics-21\" v-loading=\"mainLoading\" element-loading-spinner=\"iconfont icon-loading1\" element-loading-background=\"rgba(0, 0, 0, 0.2)\">\n\t\t<area-panel area-title=\"经营规模统计\" @hand-sub-title=\"handlePage\">\n\t\t\t<div slot=\"panelMain\" class=\"module-body\">\n\t\t\t\t<div class=\"echart-container\" ref=\"EContainer\" v-show=\"hasData\"></div>\n\t\t\t\t<div class=\"no-data\" v-show=\"!hasData\"><span>暂无数据</span></div>\n\t\t\t</div>\n\t\t</area-panel>\n\t</div>\n</template>\n\n<script>\nimport areaPanel from '@/components/overview/area-panel';\nimport {areaLevelCorAreaId, maxDecimalPlaces} from '@/common/fn';\nimport {getStorage} from '@/utils/storage';\n\nconst subVo = getStorage('govGovernmentSubjectVO');\n// echarts 超级变量含义 {a} series.name, {b} data.name {c} data.value {d} data%\nconst barOption = {\n\tgrid: {\n\t\tshow: false,\n\t\t// height: '80%',\n\t\ttop: 20,\n\t\tleft: '7%',\n\t\tbottom: 32\n\t},\n\ttooltip: {\n\t\tshow: true,\n\t\ttrigger: 'item',\n\t\tconfine: true,\n\t\tformatter(a) {\n\t\t\tconst count = a.data.count;\n\t\t\treturn `${a.name}<br/>经营主体数量：${count}家<br/>经营主体总占地面积：${a.value}万亩`;\n\t\t},\n\t\tbackgroundColor: '#043250',\n\t\tpadding: [13, 14, 13, 11],\n\t\ttextStyle: {\n\t\t\tfontSize: 12,\n\t\t\tcolor: '#9ED2D8'\n\t\t}\n\t},\n\txAxis: {\n\t\tdata: [],\n\t\taxisLabel: {\n\t\t\tinterval: 0,\n\t\t\ttextStyle: {\n\t\t\t\tcolor: '#6EC2CB',\n\t\t\t\tfontSize: 12,\n\t\t\t\tlineHeight: 14\n\t\t\t},\n\t\t\talign: 'center'\n\t\t},\n\t\taxisTick: {\n\t\t\tshow: false\n\t\t},\n\t\taxisLine: {\n\t\t\tshow: false\n\t\t}\n\t},\n\tyAxis: {\n\t\tshow: false,\n\t\tname: '单位：',\n\t\tnameTextStyle: {\n\t\t\tfontSize: 14,\n\t\t\tcolor: '#6DC1CB',\n\t\t\tpadding: [0, 0, 10, 0]\n\t\t},\n\t\taxisLine: {\n\t\t\tshow: false,\n\t\t\tlineStyle: {\n\t\t\t\tcolor: '#0D394A'\n\t\t\t}\n\t\t},\n\t\taxisTick: {\n\t\t\tshow: false\n\t\t},\n\t\tsplitLine: {\n\t\t\tshow: true,\n\t\t\tlineStyle: {\n\t\t\t\tcolor: '#0D394A'\n\t\t\t}\n\t\t},\n\t\taxisLabel: {\n\t\t\ttextStyle: {\n\t\t\t\tcolor: '#6DC1CB',\n\t\t\t\tfontSize: 12\n\t\t\t}\n\t\t}\n\t},\n\tseries: [\n\t\t{\n\t\t\t// 背景bar\n\t\t\ttype: 'bar',\n\t\t\titemStyle: {\n\t\t\t\tnormal: {\n\t\t\t\t\tcolor: 'rgba(4, 190, 254, 0.2)'\n\t\t\t\t}\n\t\t\t},\n\t\t\tsilent: true,\n\t\t\tbarWidth: 50,\n\t\t\tbarGap: '-100%', // Make series be ove\n\t\t\tdata: [],\n\t\t\tlabel: {\n\t\t\t\tshow: true,\n\t\t\t\tposition: 'top',\n\t\t\t\tcolor: '#FEEB48',\n\t\t\t\tfontSize: 12,\n\t\t\t\tfontWeight: 'bold',\n\t\t\t\tformatter({data}) {\n\t\t\t\t\treturn `${data.labelValue}家`;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\ttype: 'bar',\n\t\t\tbarWidth: 50,\n\t\t\tdata: [],\n\t\t\tlabel: {\n\t\t\t\tshow: true,\n\t\t\t\tposition: 'top',\n\t\t\t\t// color: '#030E22',\n\t\t\t\tcolor: '#00F6FF',\n\t\t\t\tfontSize: 12,\n\t\t\t\tfontWeight: 'bold',\n\t\t\t\tformatter: '{c}\\n万亩'\n\t\t\t},\n\t\t\tz: 10,\n\t\t\titemStyle: {\n\t\t\t\tcolor: {\n\t\t\t\t\ttype: 'linear',\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: 0,\n\t\t\t\t\tx2: 0,\n\t\t\t\t\ty2: 1,\n\t\t\t\t\tcolorStops: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\toffset: 0,\n\t\t\t\t\t\t\tcolor: '#00F6FF' // 0% 处的颜色\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\toffset: 1,\n\t\t\t\t\t\t\tcolor: '#01C1FF' // 100% 处的颜色\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\tglobal: false // 缺省为 false\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t]\n};\nexport default {\n\tname: 'business-scale-statistics-21',\n\tprops: {\n\t\tfarmAreaInfo: {\n\t\t\ttype: Object,\n\t\t\tdefault() {\n\t\t\t\treturn areaLevelCorAreaId();\n\t\t\t}\n\t\t}\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tmainLoading: true,\n\t\t\tchartInstance: null,\n\t\t\thasData: true\n\t\t};\n\t},\n\tmounted() {\n\t\tthis.$nextTick(() => {\n\t\t\tthis.initMoudle();\n\t\t});\n\t\t// 适配图表label字体大小\n\t\twindow.addEventListener('resize', this.adaptationChart);\n\t\tthis.$once('hook:beforeDestroy', function() {\n\t\t\twindow.removeEventListener('resize', this.adaptationChart);\n\t\t});\n\t},\n\tmethods: {\n\t\tasync initMoudle() {\n\t\t\tthis.hasData = this.mainLoading = true;\n\t\t\tthis.chartInstance = this._initEcharts(this.eContainerRef, barOption);\n\t\t\tlet [result, [postfarmAreaId, postfarmAreaType]] = await this.getBusinessScale(this.farmAreaInfo.farmAreaId, this.farmAreaInfo.farmAreaType);\n\t\t\tif (!result) return;\n\t\t\tif (postfarmAreaId !== this.farmAreaInfo.farmAreaId || postfarmAreaType !== this.farmAreaInfo.farmAreaType) return;\n\t\t\t// const res = result.reverse();\n\t\t\tconst totalValue = result.reduce((total, item) => {\n\t\t\t\t// return total + item.businessCount;\n\t\t\t\treturn total + item.totalArea; //改为 按照面积数值来显示\n\t\t\t}, 0);\n\t\t\tif (totalValue === 0) {\n\t\t\t\tthis.hasData = false;\n\t\t\t\tthis.mainLoading = false;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.refreshChart(this.chartInstance, result, totalValue);\n\t\t\tthis.adaptationChart();\n\t\t\tthis.mainLoading = false;\n\t\t},\n\t\trefreshRender() {\n\t\t\tif (this.chartInstance) {\n\t\t\t\tthis.chartInstance.resize();\n\t\t\t}\n\t\t},\n\t\t// 获取经营主体规模分布\n\t\tgetBusinessScale(farmAreaId, farmAreaType) {\n\t\t\tvar args = arguments;\n\t\t\treturn this.$ajax\n\t\t\t\t.post(this.$api.overview.getAreaBusinessScaleStatistics, {\n\t\t\t\t\tfarmAreaId: [farmAreaId],\n\t\t\t\t\tfarmAreaType: farmAreaType\n\t\t\t\t})\n\t\t\t\t.then(({data}) => {\n\t\t\t\t\tif (data.respCode === 0) {\n\t\t\t\t\t\treturn [data.obj, [...args]];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log(new Error('获取经营主体规模统计error'), e);\n\t\t\t\t\t\treturn [null, [...args]];\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch(e => {\n\t\t\t\t\tconsole.log(new Error('获取经营主体规模统计error'), e);\n\t\t\t\t});\n\t\t},\n\t\t_initEcharts(el, option) {\n\t\t\tconst chart = this.$echarts.init(el);\n\t\t\tchart.setOption(option);\n\t\t\treturn chart;\n\t\t},\n\t\tasync refreshChart(chartInstance, res, totalValue) {\n\t\t\tif (res && res.length && res.length > 1) {\n\t\t\t\tconst chartOpts = {\n\t\t\t\t\txAxis: {\n\t\t\t\t\t\tdata: res.map(item => {\n\t\t\t\t\t\t\tif (item.businessStatisticsSelectName === '>=500') {\n\t\t\t\t\t\t\t\titem.businessStatisticsSelectName = '≥500';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn `${item.businessStatisticsSelectName}亩`;\n\t\t\t\t\t\t})\n\t\t\t\t\t},\n\t\t\t\t\tseries: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t// data: new Array(res.length).fill(totalValue)\n\t\t\t\t\t\t\tdata: res.map(item => ({value: totalValue, labelValue: item.businessCount}))\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdata: res.map(item => {\n\t\t\t\t\t\t\t\t// 当前值的占比\n\t\t\t\t\t\t\t\tconst curValuePercentage = maxDecimalPlaces({\n\t\t\t\t\t\t\t\t\tvalue: item.totalArea / totalValue\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tconst maxPercentage = 0.84;\n\t\t\t\t\t\t\t\t// 超出\n\t\t\t\t\t\t\t\tconst exceedMaxPercentage = curValuePercentage > maxPercentage;\n\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\t// value: item.businessCount,\n\t\t\t\t\t\t\t\t\t// area: item.totalArea,\n\t\t\t\t\t\t\t\t\tvalue: item.totalArea,\n\t\t\t\t\t\t\t\t\tcount: item.businessCount,\n\t\t\t\t\t\t\t\t\tlabel: {\n\t\t\t\t\t\t\t\t\t\tposition: exceedMaxPercentage ? 'insideTop' : 'top',\n\t\t\t\t\t\t\t\t\t\tcolor: exceedMaxPercentage ? '#033250' : '#00F6FF'\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t};\n\t\t\t\tchartInstance.setOption(chartOpts);\n\t\t\t}\n\t\t},\n\t\thandlePage() {\n\t\t\t// this.$router.push({\n\t\t\t// \tname: 'operateSubjectList'\n\t\t\t// });\n\t\t\tthis.$emit('handleClick', 'operateSubjectList', '经营规模统计');\n\t\t},\n\t\tadaptationChart() {\n\t\t\tconst htmlWidth = document.documentElement.clientWidth || document.body.clientWidth;\n\t\t\tconst opts = {\n\t\t\t\tseries: [\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: {\n\t\t\t\t\t\t\tfontSize: 14\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: {\n\t\t\t\t\t\t\tfontSize: 16\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t};\n\t\t\tif (htmlWidth > 3000) {\n\t\t\t\topts.series[0].label.fontSize = 14;\n\t\t\t\topts.series[1].label.fontSize = 16;\n\t\t\t\tif (this.chartInstance) {\n\t\t\t\t\tthis.chartInstance.setOption(opts);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\topts.series[0].label.fontSize = 12;\n\t\t\t\topts.series[1].label.fontSize = 12;\n\t\t\t\tif (this.chartInstance) {\n\t\t\t\t\tthis.chartInstance.setOption(opts);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\tcomputed: {\n\t\teContainerRef() {\n\t\t\treturn this.$refs.EContainer;\n\t\t}\n\t},\n\tcomponents: {\n\t\tareaPanel\n\t}\n};\n</script>\n\n<style scoped lang=\"less\">\n.business-scale-statistics-21 {\n\twidth: 100%;\n\theight: 100%;\n}\n.module-body {\n\twidth: 100%;\n\theight: 100%;\n\toverflow: hidden;\n\t.echart-container {\n\t\theight: 100%;\n\t}\n\t.no-data {\n\t\tposition: absolute;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\twidth: 100%;\n\t\theight: 100%;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tfont-size: 14px;\n\t\tcolor: #00f6ff;\n\t\tfont-weight: bold;\n\t}\n}\n/deep/ .el-loading-spinner {\n\toverflow: hidden;\n\t.iconfont {\n\t\tdisplay: block;\n\t\tfont-size: 40px;\n\t\tcolor: #00f6ff;\n\t\tanimation: loading 1.25s linear infinite;\n\t\tmargin-top: 24px;\n\t\tmargin-left: 8px;\n\t}\n}\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/components/overview/modules/business-scale-statistics-21.vue"],"mappings":"AAgBA","sourceRoot":""}