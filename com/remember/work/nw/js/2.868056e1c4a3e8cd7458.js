webpackJsonp([2],{"+uqX":function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a=t("VCTt");function n(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){return function a(n,o){try{var i=r[n](o),s=i.value}catch(e){return void t(e)}if(!i.done)return Promise.resolve(s).then(function(e){a("next",e)},function(e){a("throw",e)});e(s)}("next")})}}var o={name:"leaflet-map",props:{dataTargetFlag:{type:Number,default:function(){return 0}},farmAreaInfo:{type:Object,default:function(){return areaLevelCorAreaId()}}},data:function(){return{mapLayer:null,moduleLoading:!1,tileMapType:JSON.stringify({label:"卫星地图",value:"weixing"}),tileMapTypeList:[{label:"标准地图",value:"landi"},{label:"卫星地图",value:"weixing"}],openOperatorList:!1}},created:function(){},mounted:function(){var e=this;this.$nextTick(n(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.renderMap();case 2:return r.next=4,e.renderMarkersToMap();case 4:case"end":return r.stop()}},r,e)})))},methods:{getFarmListByArea:function(){return this.$ajax.post(this.$api.operators.listByArea,{farmAreaId:[this.farmAreaInfo.farmAreaId],farmAreaType:this.farmAreaInfo.farmAreaType,hasBusinessCategoryIdListFlag:0}).then(function(e){var r=e.data;if(0===r.respCode)return r.obj}).catch(function(e){console.log(new Error("leaflet"),e)})},getCenter:function(){var e=this;return n(regeneratorRuntime.mark(function r(){var t;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(a.g)({areaId:e.farmAreaInfo.farmAreaId});case 2:return t=r.sent,r.abrupt("return",t.areaNode._data.geoData.parent.properties.center);case 4:case"end":return r.stop()}},r,e)}))()},baseLayerGroup:function(){return L.layerGroup([L.tileLayer.chinaProvider("TianDiTu.Realm.Map",{id:"layer_line",detectRetina:!1,zIndex:5,maxZoom:21,minZoom:5}),L.tileLayer.chinaProvider("Google.Satellite.Annotion",{id:"layer_google",detectRetina:!1,zIndex:3,maxZoom:21,minZoom:5}),L.tileLayer.chinaProvider("TianDiTu.Satellite.Map",{id:"layer_tiandi",detectRetina:!1,zIndex:2,maxZoom:18,minZoom:5}),L.tileLayer.chinaProvider("GaoDe.Normal.Map",{id:"layer_gaodeLabel",detectRetina:!1,zIndex:1,maxZoom:18,minZoom:5})])},initLMap:function(){var e=this;return n(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",L.map(e.$refs.lMapRef,{center:[39.89491,116.322056],zoom:7,layers:e.baseLayerGroup(),zoomControl:!1,attributionControl:!1,dragging:!0,touchZoom:!1,scrollWheelZoom:!0,doubleClickZoom:!0,boxZoom:!1,tap:!1,keyboard:!0,maxZoom:21,minZoom:5,zoomSnap:.2}));case 1:case"end":return r.stop()}},r,e)}))()},renderMap:function(){var e=this;return n(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=e.baseLayerGroup(),r.next=3,e.initLMap();case 3:r.t1=e.mapLayer=r.sent,r.t0.addTo.call(r.t0,r.t1);case 5:case"end":return r.stop()}},r,e)}))()},renderMarkersToMap:function(){var e=this;return n(regeneratorRuntime.mark(function r(){var a,n,o,i,s,u,c,l;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.getFarmListByArea();case 2:a=r.sent,n=a.list.filter(function(e){return e.farmCenterLat&&e.farmCenterLng}).map(function(e){var r=e.companyId,t=e.farmId,a=e.farmName,n=e.farmCenterLat,o=e.farmCenterLng,i=e.provinceName,s=e.cityName,u=e.countyName,c=e.provinceId;return{companyId:r,farmId:t,farmName:a,latlng:L.latLng(n,o),addr:[["310000","110000","120000"].includes(String(c))?null:i,s,u].filter(function(e){return!!e}).join("-")}}),o=L.markerClusterGroup({showCoverageOnHover:!1,maxClusterRadius:20,zoomToBoundsOnClick:!1,spiderLegPolylineOptions:{stroke:!1},iconCreateFunction:function(e){var r=e.getChildCount();return new L.DivIcon({html:'<div class="marker-icon">'+r+"</div>",className:"marker-cluster-custom",iconSize:new L.Point(30,36)})}}),i=L.polygon(n.map(function(e){return e.latlng}),{}).getBounds(),s=e.mapLayer.getBoundsZoom(i),u=i.getCenter(),c=L.icon({iconUrl:t("2eqW"),iconSize:[12,18]}),l=L.icon({iconUrl:t("zku1"),iconSize:[12,18]}),e.mapLayer.setView(u,s-1.2),n.forEach(function(r){var t=r.latlng,a=r.farmName,n=r.addr,i=r.farmId,s=L.marker(t,{icon:c});s.bindTooltip('<p class="b-des">'+a+'</p><p class="s-des">'+n+"</p>",{className:"l-map-tooltip-custom",opacity:1,direction:"top",sticky:!0}),s.on("mouseover",function(e){s.setIcon(l)}),s.on("mouseout",function(){s.setIcon(c)}),s.on("click",function(){e.$router.push({name:"farmdetail",params:{farmid:i}}),s.setIcon(c),s.closeTooltip()}),o.addLayer(s)}),e.mapLayer.addLayer(o),o.on("clusterclick",function(r){var t=r.layer.getBounds(),a=e.mapLayer.getBoundsZoom(t),n=t.getCenter();e.mapLayer.setView(n,a-1.2)});case 14:case"end":return r.stop()}},r,e)}))()}},watch:{},components:{operatorsList:function(){return t.e(1).then(t.bind(null,"bkaB"))}}},i=t("W5g0");var s=function(e){t("CWKQ")},u=Object(i.a)(o,function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("div",{staticClass:"ov-module map-module"},[t("div",{staticClass:"map-area"},[t("div",{staticClass:"map-view"},[t("div",{ref:"lMapRef",attrs:{id:"gismap"}})]),e._v(" "),e._m(0),e._v(" "),e.moduleLoading?t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.moduleLoading,expression:"moduleLoading"}],staticClass:"gisloader",attrs:{"element-loading-text":"加载中...","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.2)"}}):e._e(),e._v(" "),t("operators-list",{attrs:{gisMapFlag:!1,farmAreaInfo:e.farmAreaInfo,dataTargetFlag:e.dataTargetFlag,openOperatorList:e.openOperatorList},on:{getFarmAllPlotEv:function(){},"update:openOperatorList":function(r){e.openOperatorList=r},"update:open-operator-list":function(r){e.openOperatorList=r}}})],1)])},[function(){var e=this.$createElement,r=this._self._c||e;return r("div",{staticClass:"map-control"},[r("div",{staticClass:"mapcontrol"})])}],!1,s,"data-v-16976d6d",null);r.default=u.exports},"2eqW":function(e,r){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAASCAYAAABvqT8MAAABGUlEQVQokX3STStEYRQH8N9ckw8gSVnbKMlCyDcgGxQSkiXfhq3ExkJ5K1tJs8CK7LBSUzKyIWXQWMyRp+maU6f+5/9yOt3nFmolv1XEMhbQG9wNtrGBLyhEoANHGJRfFxhHJYvNB03MQjtEsYglDCdiGVuBF9EVeBjzhVpJCSNB3mEILzG34RzdMZ9m6E+2ryVmgdeTeSBDa0K85dz/muCWDLcJMZUTmEzwfab+OX9rFDvoi97EWKIfFWolneoP1J6zPa0KejI8YhofTcxVzOA5C+Ikbq3+Y54IjywRjmPLZ8J9YjY0jQHYxxy+o+ewlxqKOSfs+nub3UYxL9CBhwQ/pWLjSavqP99ZdBkrzQJXuMR79CWuU8MPmHNCo1GijqgAAAAASUVORK5CYII="},CWKQ:function(e,r){},zku1:function(e,r){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAASCAYAAABvqT8MAAABI0lEQVQokX3SvWpVURAF4O8eD3mAEIPgG6QRC4s0PoCp/AlJI2JlEd9G+2BlkS4vIIjBSyrFLlgJgaCSIpGBeyOMzU4y93DMhgVrr7Vm9i+RGnqRr0QeiDxrOGhaf5VrZFXkVGT+B1ORt0WaiOzxEetuHp/xsMfLQfgY7xp/gbuNr+M5kZ/K0kcil8u5lpt26X/ocL90f4PTMj/F2zJ/0GGpCH9G9n5e+K0OR0V4NlLwtPDvHfaL8Ajvca9hFxvF35+IvINvWBnpXscvrHU4wRZmN4Tn2MZv5Qo3RM5GXnnWvIWvcYnHIuclPBf5ZCEzKCByU+Tfhs2h34/sd8/12+wNzbGCVfwo/Oeivbjka5EX5QwXIndqpht0/4JDRMMhvtbAP3RA7cVNSr5YAAAAAElFTkSuQmCC"}});
//# sourceMappingURL=2.868056e1c4a3e8cd7458.js.map