webpackJsonp([80],{ATtW:function(e,t){},MzE3:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("mOB5"),s=a("mYEk"),i=a("44dg"),n=a("ItLx"),o=a("8BiH"),l=a("yivU"),u=a("ae5q"),c=a("Yz8N"),d=a("LR0P"),m=a("3VJJ"),g=a("CgIA"),f=a("VCTt"),p=a("VKKs");a("oAV5");function h(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,a){return function r(s,i){try{var n=t[s](i),o=n.value}catch(e){return void a(e)}if(!n.done)return Promise.resolve(o).then(function(e){r("next",e)},function(e){r("throw",e)});e(o)}("next")})}}var v="",b={data:function(){var e=this;return{currentPage:1,pageSize:15,total:1,keyword:"",farmRecordList:[],businessCategoryList:[{bizCategoryName:"全部经营类目",id:""}],businessCategory:"",dateValue:"",currentSelectStartTime:"",pickerOptions:{disabledDate:function(t){if(e.currentSelectStartTime){var a=e.currentSelectStartTime.getTime(),r=a+31536e6,s=a-31536e6;return t.getTime()>(new Date).getTime()||(t.getTime()>r||t.getTime()<a)&&(t.getTime()<s||t.getTime()>a)}return t.getTime()>(new Date).getTime()},onPick:function(t){e.currentSelectStartTime=t.minDate}},areaValue:{ids:[],level:""},reportList:[{status:0,text:"全部经营主体"},{status:1,text:"已上报"},{status:2,text:"未上报"}],reportStatus:0,startAreaId:"",sortDirection:1,sortField:1,defaultSort:"descending",tableHeight:0,loading:!1,countsFlag:"1",excelLoading:!1,isModalShow:!1,isRunBall:!1,isAddNum:!1,farmStatistics:{}}},beforeRouteEnter:function(e,t,a){v="farmdetail"===t.name||"gisfarmdetail"===t.name?p.a.get("farmRecordSessionStorage"):"",a()},created:function(){v?(this.keyword=v.keyword,this.pageSize=v.pageSize,this.currentPage=v.currentPage,this.businessCategory=v.businessCategory,this.dateValue=v.dateValue,this.reportStatus=v.reportStatus,this.sortDirection=v.sortDirection):(this.keyword="",this.pageSize=15,this.currentPage=1,this.businessCategory="",this.dateValue="",this.reportStatus=0,this.sortDirection=1),this.getBusinessCategory(),this.getFarmRecordList(),this.getListGroupFarmMissionStatistics()},mounted:function(){var e=this;this.$nextTick(function(){e.tableHeight=e.$refs.listContent.offsetHeight}),window.addEventListener("resize",this.resizeHandle,!1)},beforeRouteLeave:function(e,t,a){"farmdetail"!==e.name&&"gisfarmdetail"!==e.name||p.a.set("farmRecordSessionStorage",{keyword:this.keyword,pageSize:this.pageSize,currentPage:this.currentPage,businessCategory:this.businessCategory,dateValue:this.dateValue,reportStatus:this.reportStatus,sortDirection:this.sortDirection}),a()},computed:{level:function(){return Object(p.b)("govGovernmentSubjectVO").subjectLevel},startId:function(){var e=Object(p.b)("govGovernmentSubjectVO"),t=Object(p.b)("govGovernmentSubjectVO").subjectLevel;return 1===t?e.provinceId:2===t?e.cityId:3===t?e.countyId:void 0}},methods:{back:function(){var e=this,t=this.$route.path;this.$router.go(-1),setTimeout(function(){t===e.$route.path&&e.back()},200)},goFarm:function(e){this.$router.push("/farmdetail/"+e.farmId)},download:function(){var e=this;return h(regeneratorRuntime.mark(function t(){var a,r,s,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.isModalShow=!1,e.farmRecordList.length){t.next=4;break}return e.$message({type:"info",message:"暂无数据，无法导出",center:!0}),t.abrupt("return");case 4:return a=Object(f.b)(),r=Object(p.b)("govGovernmentUserVO"),s={farmAreaId:e.areaValue.ids.length?[e.areaValue.ids[e.areaValue.ids.length-1]]:[a.farmAreaId],farmAreaType:e.areaValue.level?e.areaValue.level:a.farmAreaType,keyword:e.keyword?e.keyword:"",pageNo:e.currentPage,pageSize:e.pageSize,businessCategoryId:e.businessCategory?e.businessCategory:null,farmingEndTime:e.dateValue.endTime?e.dateValue.endTime:e.formatDate((new Date).getTime(),"-"),farmingStartTime:e.dateValue.startTime?e.dateValue.startTime:e.formatDate((new Date).getTime(),"-","startTime"),reportStatus:e.reportStatus,sortDirection:e.sortDirection,sortField:e.sortField,govUserId:r.id,townId:e.areaValue.townId?e.areaValue.townId:"",villageId:e.areaValue.villageId?e.areaValue.villageId:""},t.next=9,e.$ajax.post(e.$api.downloadExcel.listFarmOperationUploadToServer1,s);case 9:0===(i=t.sent).data.respCode&&(e.isAddNum&&(e.isAddNum=!1),e.isRunBall=!0,setTimeout(function(){e.isRunBall=!1,e.isAddNum=!0},800)),300===i.data.respCode&&(e.isModalShow=!0);case 12:case"end":return t.stop()}},t,e)}))()},areaCilck:function(e){var t=this;return h(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:t.areaValue=e,t.currentPage=1,t.getFarmRecordList(),t.getListGroupFarmMissionStatistics();case 4:case"end":return a.stop()}},a,t)}))()},businessChange:function(){this.currentPage=1,this.getFarmRecordList(),this.getListGroupFarmMissionStatistics()},dateChange:function(){this.currentPage=1,this.getFarmRecordList(),this.getListGroupFarmMissionStatistics()},focus:function(){this.currentSelectStartTime=""},onChange:function(e){this.currentPage=e,this.getFarmRecordList()},changePageSize:function(e){this.pageSize=e,this.currentPage=1,this.getFarmRecordList()},clickAndEnter:function(){this.currentPage=1,this.getFarmRecordList(),this.getListGroupFarmMissionStatistics()},sortChange:function(e){this.currentPage=1,this.defaultSort="descending"===e.order?"descending":"ascending",this.sortDirection="descending"===e.order?1:0,this.getFarmRecordList()},getFarmRecordList:function(){var e=this;return h(regeneratorRuntime.mark(function t(){var a,r,s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.farmRecordList=[],e.loading=!0,a=Object(f.b)(),e.dateValue||(e.dateValue={},e.dateValue.endTime=e.formatDate((new Date).getTime(),"-"),e.dateValue.startTime=e.formatDate((new Date).getTime(),"-","startTime")),r={farmAreaId:e.areaValue.ids.length?e.areaValue.ids:[a.farmAreaId],farmAreaType:e.areaValue.level?e.areaValue.level:a.farmAreaType,keyword:e.keyword?e.keyword:"",pageNo:e.currentPage,pageSize:e.pageSize,businessCategoryId:e.businessCategory?e.businessCategory:null,farmingEndTime:e.dateValue.endTime,farmingStartTime:e.dateValue.startTime,reportStatus:e.reportStatus,sortDirection:e.sortDirection,sortField:e.sortField,townId:e.areaValue.townId?e.areaValue.townId:null,villageId:e.areaValue.villageId?e.areaValue.villageId:null},t.next=7,e.$ajax.post(e.$api.produce.listFarmOperation1,r);case 7:0===(s=t.sent).data.respCode&&s.data.obj?(e.farmRecordList=s.data.obj.list,e.total=s.data.obj.totalCount,e.loading=!1,e.$nextTick(function(){e.tableHeight=e.$refs.listContent.offsetHeight,e.backTop()})):e.loading=!1;case 9:case"end":return t.stop()}},t,e)}))()},getListGroupFarmMissionStatistics:function(){var e=this;return h(regeneratorRuntime.mark(function t(){var a,r,s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=Object(f.b)(),e.dateValue||(e.dateValue={},e.dateValue.endTime=e.formatDate((new Date).getTime(),"-"),e.dateValue.startTime=e.formatDate((new Date).getTime(),"-","startTime")),r={farmAreaId:e.areaValue.ids.length?e.areaValue.ids:[a.farmAreaId],farmAreaType:e.areaValue.level?e.areaValue.level:a.farmAreaType,keyword:e.keyword?e.keyword:"",businessCategoryId:e.businessCategory?e.businessCategory:null,farmingEndTime:e.dateValue.endTime,farmingStartTime:e.dateValue.startTime,townId:e.areaValue.townId?e.areaValue.townId:null,villageId:e.areaValue.villageId?e.areaValue.villageId:null},t.next=5,e.$ajax.post(e.$api.produce.listGroupFarmMissionStatistics,r);case 5:0===(s=t.sent).data.respCode&&s.data.obj&&(console.log("res.data=====>",s.data),e.farmStatistics=s.data.obj);case 7:case"end":return t.stop()}},t,e)}))()},getBusinessCategory:function(){var e=this;return h(regeneratorRuntime.mark(function t(){var a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.post(e.$api.produce.businessCategory,{});case 2:0===(a=t.sent).data.respCode&&a.data.obj.list.forEach(function(t){e.businessCategoryList.push(t)});case 4:case"end":return t.stop()}},t,e)}))()},spliceAreaName:function(e){var t=Object(p.b)("govGovernmentSubjectVO"),a="";if(a=e.townName?a+"/"+e.townName:"",a=e.villageName?a?a+"/"+e.villageName:e.villageName:a||"",1===t.subjectLevel)return e.cityName+"/"+e.countyName+a;if(2===t.subjectLevel||3===t.subjectLevel){var r=e.cityName;return a=e.countyName?r+"/"+e.countyName+a:a}},formatDate:function(e,t,a){var r=new Date(e);return r.getFullYear()+t+((r.getMonth()+1<10?"0"+(r.getMonth()+1):r.getMonth()+1)+t)+(a?"01":r.getDate()<10?"0"+r.getDate():r.getDate())},formatNum:function(e){return e?Object(f.j)({value:e,places:2}):0},resizeHandle:function(){this.tableHeight=this.$refs.listContent.offsetHeight},backTop:function(){document.querySelector(".el-table__body-wrapper").scrollTop=0},buttonClick:function(e){e.target.blur()}},destroyed:function(){window.removeEventListener("resize",this.resizeHandle,!1)},components:{Nav:r.default,Page:s.default,Loading:i.default,CustomInput:n.default,CustomSelect:o.default,CustomTable:l.default,CustomTableSort:u.default,CustomDatePicker:c.default,CustomAreaSelect:d.default,downloadModal:m.default,RunBall:g.default}},S=a("W5g0");var C=function(e){a("ATtW"),a("iPST")},w=Object(S.a)(b,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"title",rawName:"v-title"},{name:"loading",rawName:"v-loading",value:e.excelLoading,expression:"excelLoading"}],staticClass:"farm-record-other",attrs:{"data-title":"信息直报","element-loading-text":"数据导出中...","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.5)"}},[r("Nav",{attrs:{title:"信息直报",hasShadow:!0,backColor:"#B6CFDE",paddingRight:"13px",isUserCenter:!0,isAddNum:e.isAddNum},on:{back:e.back}}),e._v(" "),r("div",{staticClass:"main"},[r("div",{staticClass:"search-box"},[r("div",{staticClass:"search-box-left"},[r("CustomDatePicker",{attrs:{margin:"0 15px 0 0",clearable:!1,pickerOptions:e.pickerOptions},on:{change:e.dateChange,focus:e.focus},model:{value:e.dateValue,callback:function(t){e.dateValue=t},expression:"dateValue"}}),e._v(" "),r("CustomSelect",{attrs:{margin:"0 15px 0 0"}},[r("template",{slot:"select-container"},[r("el-select",{attrs:{placeholder:"选择经营类目"},on:{change:e.businessChange},model:{value:e.businessCategory,callback:function(t){e.businessCategory=t},expression:"businessCategory"}},e._l(e.businessCategoryList,function(e){return r("el-option",{key:e.id,attrs:{label:e.bizCategoryName,value:e.id}})}),1)],1)],2),e._v(" "),r("CustomSelect",{attrs:{margin:"0 15px 0 0"}},[r("template",{slot:"select-container"},[r("el-select",{attrs:{placeholder:"全部"},on:{change:e.businessChange},model:{value:e.reportStatus,callback:function(t){e.reportStatus=t},expression:"reportStatus"}},e._l(e.reportList,function(e){return r("el-option",{key:e.status,attrs:{label:e.text,value:e.status}})}),1)],1)],2),e._v(" "),r("CustomAreaSelect",{attrs:{level:e.level,areaId:e.startId},on:{areaCilck:e.areaCilck}}),e._v(" "),r("CustomInput",{attrs:{iconfont:"el-icon-search",placeholder:"输入经营主体名称搜索"},on:{clickAndEnter:e.clickAndEnter},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}})],1),e._v(" "),r("div",{staticClass:"excel-box"},[r("div",{staticClass:"excel",on:{click:e.download}},[r("img",{attrs:{src:a("zqrc")}}),e._v(" "),r("span",{staticStyle:{"margin-left":"9px"}},[e._v("导出EXCEL")])])])]),e._v(" "),r("div",{ref:"listContent",staticClass:"list-content"},[r("CustomTable",[r("template",{slot:"table-container"},[r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.farmRecordList,fit:!0,height:e.tableHeight,lazy:!0}},[r("template",{slot:"empty"},[r("div",[r("Loading",{attrs:{show:e.loading,type:"element",theme:"loader-light"}}),e._v(" "),e.loading?e._e():r("div",{staticClass:"no-data"},[r("img",{attrs:{src:a("gtDs")}}),e._v(" "),r("span",[e._v("暂无数据")])])],1)]),e._v(" "),r("el-table-column",{attrs:{label:"经营主体名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",{staticClass:"text-bold"},[e._v(e._s(t.row.farmName?t.row.farmName:"--"))])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"所在地"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",{staticClass:"text"},[e._v(e._s(e.spliceAreaName(t.row)?e.spliceAreaName(t.row):"--"))])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"经营类目"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",{staticClass:"text"},[e._v(e._s(t.row.bizCategoryNameList.length?t.row.bizCategoryNameList.join("、"):"--"))])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"生产作业上报(条)"},scopedSlots:e._u([{key:"header",fn:function(t){return[r("CustomTableSort",{attrs:{title:"生产作业上报(条)",defaultSort:e.defaultSort},on:{sortChange:e.sortChange}})]}},{key:"default",fn:function(t){return[r("span",{staticClass:"text-bold text-green"},[e._v(e._s(t.row.farmingReportCount))])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"操作",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",{staticClass:"handle",on:{click:function(a){return e.goFarm(t.row)}}},[r("i",{staticClass:"iconfont icon-xiangqing"}),e._v(" "),r("span",[e._v("详情")])])]}}])})],2)],1)],2)],1)]),e._v(" "),r("div",{staticClass:"page-box"},[r("div",{staticClass:"farm-statistics"},[r("span",{staticClass:"text-bold"},[e._v("上报经营主体："+e._s(e.farmStatistics.reportFarms)+"家 (占比"+e._s(e.formatNum(e.farmStatistics.reportFarms/e.farmStatistics.totalFarms*100))+"%)")]),e._v(" "),r("span",{staticClass:"text-bold"},[e._v("未上报经营主体："+e._s(e.farmStatistics.unReportFarms)+"家 (占比"+e._s(e.formatNum(e.farmStatistics.unReportFarms/e.farmStatistics.totalFarms*100))+"%)")]),e._v(" "),r("span",{staticClass:"text-bold"},[e._v("生产作业上报："+e._s(e.farmStatistics.totalReports?e.farmStatistics.totalReports:0)+"条")])]),e._v(" "),e.total>e.pageSize?r("Page",{attrs:{total:e.total,"page-size":e.pageSize,current:e.currentPage,isPageSizeShow:!0,isJumpShow:!0,isTotalShow:!0,perPage:15},on:{onChange:e.onChange,changePageSize:e.changePageSize}}):e._e()],1),e._v(" "),r("RunBall",{attrs:{isRunBall:e.isRunBall}}),e._v(" "),r("downloadModal",{attrs:{isShow:e.isModalShow},on:{"update:isShow":function(t){e.isModalShow=t},"update:is-show":function(t){e.isModalShow=t}}})],1)},[],!1,C,"data-v-0cd1fffd",null);t.default=w.exports},iPST:function(e,t){}});
//# sourceMappingURL=80.6cfc3e955b4b807e64eb.js.map