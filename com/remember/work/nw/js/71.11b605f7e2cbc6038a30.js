webpackJsonp([71],{DXG9:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a("mOB5"),n=a("Ndy7"),i=a("AQ5S"),o=a("44dg"),s=a("oAV5"),c=a("VCTt"),l=(a("VKKs"),a("TXSd")),u=a.n(l);function d(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,a){return function r(n,i){try{var o=e[n](i),s=o.value}catch(t){return void a(t)}if(!o.done)return Promise.resolve(s).then(function(t){r("next",t)},function(t){r("throw",t)});t(s)}("next")})}}var f={data:function(){return{farmList:[],current:0,title:"",loading:!1,videoList:[],tempVideoList:[],bsScroll:null,globalLoding:!1,noData:!1,noSearch:!1,farmTotal:0,farmPageNo:1,farmPageSize:100,tempFarmSearchList:[],keyword:""}},computed:{getVideoList:function(){var t=[];if(this.videoList.length&&(t=Object(s.a)(4,this.videoList))[t.length-1].length<4)for(var e=4-t[t.length-1].length,a=0;a<e;a++)t[t.length-1].push({});return t}},mounted:function(){var t=this;return d(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.current=parseInt(t.$route.params.baseid),t.title=t.$route.query.farmName,t.getVideoListData(t.$route.params.baseid),t.getFarmList(),window.addEventListener("resize",function(){t.bsScroll&&t.bsScroll.refresh()});case 5:case"end":return e.stop()}},e,t)}))()},methods:{back:function(){this.$router.go(-1)},select:function(t){this.title=t.farmName,this.current=t.farmId,this.$router.replace({path:"/videoDetail/"+t.farmId+"?farmName="+t.farmName}),this.getVideoListData(t.farmId)},search:function(t){this.loading=!0,this.keyword=t,this.farmPageNo=1,this.getFarmList()},onchange:function(t){var e=this;return d(regeneratorRuntime.mark(function a(){var r;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return e.loading=!0,e.keyword=t,e.farmPageNo=1,e.loading=!0,a.next=6,e.getFarmListData();case 6:if(0!==(r=a.sent).respCode){a.next=13;break}if(e.keyword===t){a.next=10;break}return a.abrupt("return");case 10:e.farmList=r.obj.list.filter(function(t){return 0!==t.totalCount}),e.loading=!1,e.farmTotal=r.obj.totalCount;case 13:case"end":return a.stop()}},a,e)}))()},searchCamera:function(t){var e=this;if(this.globalLoding=!0,this.noSearch=!1,!t)return this.videoList=this.tempVideoList,void setTimeout(function(){e.globalLoding=!1},100);var a=this.fuzzyQuery(this.tempVideoList,t);a.forEach(function(t,e){t.autoplay=e<8}),this.videoList=a,setTimeout(function(){e.globalLoding=!1,!e.videoList.length&&e.tempVideoList.length&&(e.noSearch=!0)},100)},fuzzyQuery:function(t,e){for(var a=t.concat(),r=[],n=0;n<a.length;n++)a[n].displayName.indexOf(e)>=0&&r.push(a[n]);return r},scrollToEnd:function(){var t=this;return d(regeneratorRuntime.mark(function e(){var a,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=Math.ceil(t.farmTotal/t.farmPageSize),!(t.farmTotal>t.farmPageSize)){e.next=9;break}if(!(t.farmPageNo>=a)){e.next=4;break}return e.abrupt("return");case 4:return t.farmPageNo++,e.next=7,t.getFarmListData();case 7:0===(r=e.sent).respCode&&(r.obj.list.forEach(function(e){0!==e.totalCount&&t.farmList.push(e)}),t.$nextTick(function(){t.$refs.drop.refresh()}));case 9:case"end":return e.stop()}},e,t)}))()},getVideoListData:function(t){var e=this;return d(regeneratorRuntime.mark(function a(){var r;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return e.globalLoding=!0,e.noData=!1,a.next=4,e.$ajax.post(e.$api.farmDetail.getIotAll,{farmId:t});case 4:0===(r=a.sent).data.respCode&&(u()(),r.data.obj.cameraList.forEach(function(t,e){t.autoplay=e<8}),e.videoList=r.data.obj.cameraList,e.tempVideoList=r.data.obj.cameraList,e.globalLoding=!1,0===e.videoList.length&&(e.noData=!0));case 6:case"end":return a.stop()}},a,e)}))()},getFarmList:function(){var t=this;return d(regeneratorRuntime.mark(function e(){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.loading=!0,e.next=3,t.getFarmListData();case 3:0===(a=e.sent).respCode&&(t.farmList=a.obj.list.filter(function(t){return 0!==t.totalCount}),t.loading=!1,t.farmTotal=a.obj.totalCount);case 5:case"end":return e.stop()}},e,t)}))()},getFarmListData:function(){var t=this,e=Object(s.c)();return new Promise(function(a,r){t.$ajax.post(t.$api.operators.listByAreaAndZaiotKeyNotNull,{farmAreaId:[e.farmId],farmAreaType:e.level,keyword:t.keyword?t.keyword:null,pageNo:t.farmPageNo,pageSize:t.farmPageSize}).then(function(t){a(t.data)}).catch(function(t){r(t)})})},destroyVideos:function(){function t(){window.palyers.length&&window.palyers.map(function(t){t&&t.failure&&t.video&&t.video.hls&&t.video.hls.stopLoad()})}window.palyers&&(window.palyers.map(function(t){t.failure=!0}),setTimeout(t,2e3),setTimeout(t,5e3),setTimeout(t,8e3),setTimeout(function(){t(),window.palyers=window.palyers.filter(function(t){if(t&&t.failure&&(t=null),t&&!t.failure)return t})},15e3))}},destroyed:function(){window.removeEventListener("resize",function(){}),u()()},watch:{globalLoding:function(t){var e=this;t||this.$nextTick(function(){e.bsScroll&&e.$refs.scroll&&(e.bsScroll.destroy(),e.bsScroll=Object(c.a)(e.$refs.scroll))})},videoList:function(){var t=this;this.noData=!1,this.$nextTick(function(){setTimeout(function(){!t.bsScroll&&t.$refs.scroll&&(t.bsScroll=Object(c.a)(t.$refs.scroll)),0===t.videoList.length&&(t.noData=!0)},200)})}},components:{Nav:r.default,Dropdown:n.default,Video:i.default,Loading:o.default}},m=a("W5g0");var g=function(t){a("FM/z")},v=Object(m.a)(f,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{directives:[{name:"title",rawName:"v-title"}],staticClass:"video-detail",attrs:{"data-title":"环境监控"}},[r("div",{staticClass:"nav-box"},[r("Nav",{on:{search:t.searchCamera,back:t.back}},[r("template",{slot:"center"},[r("Dropdown",{ref:"drop",attrs:{title:t.title,data:t.farmList,current:t.current,loading:t.loading},on:{select:t.select,search:t.search,scrollToEnd:t.scrollToEnd,onchange:t.onchange}})],1)],2)],1),t._v(" "),t.noSearch?r("div",{staticClass:"no-data"},[r("img",{attrs:{src:a("FuWG")}}),t._v(" "),r("span",[t._v("无搜索结果")])]):[t.noData?r("div",{staticClass:"no-data"},[r("img",{attrs:{src:a("FuWG")}}),t._v(" "),r("span",[t._v("该农场尚未接入摄像头")])]):[t.globalLoding?r("div",{staticClass:"global-loading"},[r("Loading",{attrs:{show:t.globalLoding,type:"element"}})],1):[r("div",{ref:"scroll",staticClass:"video-main"},[r("div",{staticClass:"scroll"},[r("div",{staticStyle:{height:"40px"}}),t._v(" "),t._l(t.getVideoList,function(e,a){return r("div",{key:a,staticClass:"video-list"},t._l(e,function(e,a){return r("div",{key:a,staticClass:"video-item"},[e.displayName?r("div",{staticClass:"video-box"},[r("div",{staticClass:"video-title"},[r("span",[t._v(t._s(e.displayName))])]),t._v(" "),r("div",{staticClass:"box"},[r("div",{staticClass:"content"},[r("Video",{attrs:{"video-id":"video"+e.id,autoplay:!!e.autoplay&&e.autoplay,"video-quality":e}})],1)])]):t._e()])}),0)})],2)])]]]],2)},[],!1,g,"data-v-58f4fcfe",null);e.default=v.exports},"FM/z":function(t,e){},FuWG:function(t,e){t.exports="https://snkoudai.oss-cn-hangzhou.aliyuncs.com/goverment/static/img/bg-no-data.158621f.png"}});
//# sourceMappingURL=71.11b605f7e2cbc6038a30.js.map