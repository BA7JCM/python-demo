webpackJsonp([54,58],{"0DxH":function(e,n){e.exports="https://snkoudai.oss-cn-hangzhou.aliyuncs.com/goverment/static/img/area-brand-arrow.cb994fc.png"},"1FZi":function(e,n){e.exports="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QA6RXhpZgAATU0AKgAAAAgAA1EQAAEAAAABAQAAAFERAAQAAAABAAAAAFESAAQAAAABAAAAAAAAAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjL/wAARCAABAGgDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwBtFFFe4fABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFAH/9k="},Nb3h:function(e,n){e.exports="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QA6RXhpZgAATU0AKgAAAAgAA1EQAAEAAAABAQAAAFERAAQAAAABAAAAAFESAAQAAAABAAAAAAAAAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjL/wAARCAABAGgDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwCtRRRX6AcwUUUUAFFFFABRRRQAUUUUAFFFFABRRRQB/9k="},TOwy:function(e,n){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAABeklEQVQoka3Qz04TURTH8e+cc+6dmVIGHGiEVCOxicQXcNeFsjDqhh1PYPQZfBWegYSVhoXxAQxr4gKMMaQYAyqatMyfDotOSWkqbvwt7z2/T+65weuX/cfA7vnFWXLy45A861NkA4psQFlmlEVBVQ0BCAJBzVD1mI8wH+F8zMqtDkmYngObBnwAniRh+k6XrNX7eYSIQ0QpCodqznBYjkAR1DxmHvMNXBizunifOZd8B54B+8Yo+0B3ziV7d9L1e71fh+RqSD5gWGRXoIgi5nEuGmELHSKNvwBPgU8AY5D6oBtpvNdefPCw9/szmnvK/DqozmMuYnV+DS/hQY19HSOTIPVF14t/2046j771jymnXqjmuR23scA+1mueTgLTIPXAhgW2u9K4u3FWnl4DU11CkffAJvBnuiwzQOrB54rsLFuLRjOl0UxZthaK7AAvZmE3gQAZsBVUbDezkGYWElRsA1vAxd9Ks1aeTAm8Cqpq/E9vgOofnf+bS/cPcs+RqNt5AAAAAElFTkSuQmCC"},TsVw:function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("wggp"),a=t("VKKs"),o=t("VCTt"),i=t("PbuP"),s=t("yTDo"),c=t("jIOT"),u=t("Xtqa"),l=function(){return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,n){var t=[],r=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(t.push(i.value),!n||t.length!==n);r=!0);}catch(e){a=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}return t}(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function d(e){if(Array.isArray(e)){for(var n=0,t=Array(e.length);n<e.length;n++)t[n]=e[n];return t}return Array.from(e)}function p(e){return function(){var n=e.apply(this,arguments);return new Promise(function(e,t){return function r(a,o){try{var i=n[a](o),s=i.value}catch(e){return void t(e)}if(!i.done)return Promise.resolve(s).then(function(e){r("next",e)},function(e){r("throw",e)});e(s)}("next")})}}var g={"横沙镇":"横沙乡","旅投公司":"绿华镇","车墩":"车墩镇","石湖荡":"石湖荡镇","经开区镇":"松江工业区","香花桥":"香花桥街道","朱家角":"朱家角镇","农业园区":"练塘镇"},f={props:{isshowonnetland:{type:Boolean,default:!1}},data:function(){return{onNetLayers:{area:[],town:[],land:[]},onNetMenu:[],townlayer:null}},computed:{isShowOnNetLand:{get:function(){return this.isshowonnetland},set:function(e){this.initOnNetMode(e),this.$emit("update:isshowonnetland",e)}}},methods:{initOnNetMode:function(e){var n=this;return p(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n.gisloading=!0,n.onNetMenu.length=0,!e){t.next=10;break}return n.showAidaLand=!1,n.showGreenLand=!1,n.onNetMenu.push({level:"area",id:"310100",name:"上海市",center:[121.5479750860789,31.62421361249988]}),t.next=8,n.renderOnNet();case 8:t.next=12;break;case 10:return t.next=12,n.renderOnNet();case 12:n.gisloading=!1;case 13:case"end":return t.stop()}},t,n)}))()},onNetChangeHander:function(e){this.onNetMenu.splice(e,3),0===e&&(this.isShowOnNetLand=!1),this.renderOnNet()},renderOnNet:function(){var e=this;return p(regeneratorRuntime.mark(function n(){var t,r,a,o,s,c,u,l;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(t=e.onNetMenu,e.gisloading=!0,0===t.length?e.clearCompanySelectfn(!1):e.clearCompanySelectfn(!0),e.onNetLayers.area.forEach(function(e){return e.hide()}),e.clearLayers(e.gismap,e.onNetLayers.town),e.clearLayers(e.gismap,e.onNetLayers.land),e.townlayer&&(e.gismap.removeLayer(e.townlayer),e.townlayer=null),1!==t.length||"area"!==t[0].level){n.next=31;break}return n.next=10,e.setMapExtent(e.gismap,i.a[t[0].id].centerExtend);case 10:if(!e.onNetLayers.area.length){n.next=14;break}e.onNetLayers.area.forEach(function(e){return e.show()}),n.next=31;break;case 14:return a=[],n.next=17,e.getAreaList();case 17:if(!(o=n.sent)||!o.length){n.next=22;break}return n.next=21,e.renderAreaList(o);case 21:a=n.sent;case 22:if(a.length){n.next=27;break}return e.onNetMenu.splice(0,3),e.$message({type:"warning",offset:100,duration:2e3,message:"无法查看，该区街/镇无入网地块"}),e.renderOnNet(),n.abrupt("return");case 27:if(1===t.length){n.next=29;break}return n.abrupt("return");case 29:a.map(function(n){return e.gismap.addLayer(n)}),(r=e.onNetLayers.area).push.apply(r,d(a));case 31:if(2!==t.length||"town"!==t[1].level){n.next=51;break}return a=[],n.next=35,e.getTownList(t[1].id);case 35:if(!(c=n.sent)||!c.length){n.next=40;break}return n.next=39,e.renderTownList(c);case 39:a=n.sent;case 40:if(a.length){n.next=45;break}return e.onNetMenu.splice(1,3),e.$message({type:"warning",offset:100,duration:2e3,message:"无法查看，该区街/镇无入网地块"}),e.renderOnNet(),n.abrupt("return");case 45:if(2===t.length){n.next=47;break}return n.abrupt("return");case 47:return a.map(function(n){return e.gismap.addLayer(n)}),(s=e.onNetLayers.town).push.apply(s,d(a)),n.next=51,e.setSomePointerExtent(e.onNetLayers.town);case 51:if(3!==t.length){n.next=75;break}return console.time("镇的加载时间"),n.next=55,e.setMapZoomAndLevel(e.gismap,t[2].center,3);case 55:return n.next=57,e.renderTownLayer(e.gismap,t[1].id,t[2].name);case 57:return e.townlayer=n.sent,n.next=60,e.onUpdateEndLayer(e.townlayer);case 60:return n.next=62,e.renderLandList(t[1].id,t[2].id);case 62:if((l=n.sent).length){n.next=68;break}return e.onNetMenu.splice(2,3),e.$message({type:"warning",offset:100,duration:2e3,message:"无法查看，该区街/镇无入网地块"}),e.renderOnNet(),n.abrupt("return");case 68:if(3===t.length){n.next=70;break}return n.abrupt("return");case 70:return l.map(function(n){return e.gismap.addLayer(n)}),(u=e.onNetLayers.land).push.apply(u,d(l)),n.next=74,e.onUpdateEndLayer(l);case 74:console.timeEnd("镇的加载时间");case 75:e.gisloading=!1;case 76:case"end":return n.stop()}},n,e)}))()},renderAreaList:function(e){var n,t=this;return new Promise((n=p(regeneratorRuntime.mark(function n(r){var a;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:a=[],e.forEach(function(e){if(i.a[e.areaId]){var n=i.a[e.areaId].center||i.a[310100].center,r=e.allLandAcre/1e4>1?e.allLandAcre/1e4:e.allLandAcre;r=e.allLandAcre/1e4>1?Object(u.b)(r,2):Object(u.b)(r,0);var o=e.allLandAcre/1e4>1?"万亩":"亩",s=parseFloat(e.allLandAcre/e.productionLandArea);s=s>1?1:s;var c="占比"+Object(u.b)(s,2,!0);a.push(t.initSignCard(e.areaId,n,e.areaName,""+r+o,c,1,function(n,r){t.onNetMenu.push({level:"town",id:e.areaId,name:e.areaName,center:r}),t.renderOnNet()}))}}),Promise.all(a).then(function(e){r(e)});case 3:case"end":return n.stop()}},n,t)})),function(e){return n.apply(this,arguments)}))},renderTownList:function(e){var n,t=this;return new Promise((n=p(regeneratorRuntime.mark(function n(r){var a;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:a=[],e.forEach(function(e){if(i.a[e.areaId]){var n=e.shTownCenterLng&&e.shTownCenterLat&&[e.shTownCenterLat,e.shTownCenterLng],r=e.townLandAcre/1e4>1?e.townLandAcre/1e4:e.townLandAcre;r=e.townLandAcre/1e4>1?Object(u.b)(r,2):Object(u.b)(r,0);var o=e.townLandAcre/1e4>1?"万亩":"亩";a.push(t.initSignCard(e.townId,n,e.townName,""+r+o,"",2,function(n,r){t.onNetMenu.push({level:"land",id:e.townId,name:e.townName,center:r}),t.renderOnNet()}))}}),Promise.all(a).then(function(e){r(e)});case 3:case"end":return n.stop()}},n,t)})),function(e){return n.apply(this,arguments)}))},renderLandList:function(e,n){var t,r=this;return new Promise((t=p(regeneratorRuntime.mark(function t(a){var o,s,c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.getTownDetail(n);case 2:if((o=t.sent)&&o.length){t.next=5;break}return t.abrupt("return");case 5:s=[],c=i.a[e].nongyongdi,r.arrayHander(o,1e3).forEach(function(e,n){var t=r.renderLayerByGisId(c,"land-layer-"+n,e);s.push(t)}),Promise.all(s).then(function(e){a(e)});case 10:case"end":return t.stop()}},t,r)})),function(e){return t.apply(this,arguments)}))},renderLayerByGisId:function(e){var n=this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"nongyongdi",a=arguments[2];return new Promise(function(o){r.loadModules(["esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ImageParameters"],n.options).then(function(r){var i=l(r,2),s=i[0],c=new(0,i[1]),u=[],d="DKID IN ("+("'"+a.join("','")+"'")+")";u[0]=d,c.layerDefinitions=u,c.layerIds=[0],c.transparent=!0;var p=new s(e+"?token="+n.temptoken,{id:t,outFields:["*"],imageParameters:c});o(p)},function(e){o(!1)})})},initSignCard:function(e,n,a,o,i,s,c){var u=this;return new Promise(function(p){r.loadModules(["esri/layers/GraphicsLayer","esri/graphic","esri/geometry/Geometry","esri/geometry/Point","esri/symbols/PictureMarkerSymbol","esri/SpatialReference","esri/symbols/TextSymbol","esri/Color","esri/symbols/Font"],u.options).then(function(r){var u=l(r,9),g=u[0],f=u[1],h=(u[2],u[3]),y=u[4],m=(u[5],u[6]),A=u[7],v=u[8],w=t("UsSZ"),L=t("0DxH"),b=t("1FZi"),x=t("basq");2===s&&(w=t("ddyH"),L=t("TOwy"),b=t("Nb3h"));var S=new g({visible:!0,className:"sign-card-layer"}),I=new y({url:w,width:80,height:63,xoffset:0,yoffset:38}),M=new y({url:L,width:24,height:10,xoffset:0,yoffset:3}),E=new y({url:b,width:78,height:1,xoffset:0,yoffset:45}),P=new y({url:x,width:7,height:7,xoffset:30,yoffset:56}),N=new(Function.prototype.bind.apply(h,[null].concat(d(n),[new esri.SpatialReference({wkid:4326})])));if(S.add(new f(N,I)),S.add(new f(N,M)),S.add(new f(N,E)),S.add(new f(N,P)),E.flagId=P.flagId=M.flagId=I.flagId=e,a){var k=new m(a).setColor(new A([157,209,215])).setAlign(v.ALIGN_START).setFont(new v("15px").setWeight(v.WEIGHT_BOLD));k.xoffset=0,k.yoffset=69,S.add(new f(N,k))}if(o){var T=new m(o).setColor(new A([0,246,255])).setAlign(v.ALIGN_START).setFont(new v("20px").setWeight(v.WEIGHT_BOLD));T.xoffset=0,T.yoffset=38,i||(T.xoffset=0,T.yoffset=28),S.add(new f(N,T))}if(i){var D=new m(i).setColor(new A([254,235,72])).setAlign(v.ALIGN_START).setFont(new v("14px").setWeight(v.WEIGHT_BOLD));D.xoffset=0,D.yoffset=20,D.flagId=e,S.add(new f(N,D))}dojo.connect(S,"onClick",function(e){e.stopPropagation(),c&&c(e.graphic.symbol.flagId,n)}),p(S)})})},renderTownLayer:function(e,n,t){var a=this;return new Promise(function(o){r.loadModules(["esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ImageParameters"],a.options).then(function(r){var s=l(r,2),c=s[0],u=s[1];t=g[t]?g[t]:t;var d=new u,p=[],f="TOWN like '%"+t+"%'";p[0]=f,d.layerDefinitions=p,d.layerIds=[0],d.layerOption=u.LAYER_OPTION_SHOW,d.transparent=!0;var h=c(i.a[n].nongyongdi+"?token="+a.temptoken,{id:"townLayer",outFields:["*"],imageParameters:d});e.addLayer(h),o(h)},function(e){o(!1)})})},arrayHander:function(e,n){for(var t=JSON.parse(JSON.stringify(e)),r=[];t.length;)r.push(t.splice(0,n));return r},setMapZoomAndLevel:function(e,n,t){var a=this;return new Promise(function(o){r.loadModules(["esri/geometry/Point"],a.options).then(function(r){var a=l(r,1)[0];e.centerAndZoom(new a(parseFloat(n[0]),parseFloat(n[1]),new esri.SpatialReference({wkid:4326})),t),o()})})},setMapExtent:function(e,n){var t=this;return new Promise(function(a){r.loadModules(["esri/geometry/Extent"],t.options).then(function(t){var r=l(t,1)[0],o=new(Function.prototype.bind.apply(r,[null].concat(d(n),[new esri.SpatialReference({wkid:4326})])));e.setExtent(o),a()})})},setSomePointerExtent:function(e){var n=this;return new Promise(function(t){var a=[],o=[];e.forEach(function(e){var n=e.graphics[0].geometry;a.push(n.x),o.push(n.y)});var i=function(e){if(4!==e.length)return[];var n=e[2]-e[0],t=e[3]-e[1];return[e[0]-n,e[1]-t+.1*t,e[2]+n,e[3]+t+.1*t]}([Math.min.apply(null,a),Math.min.apply(null,o),Math.max.apply(null,a),Math.max.apply(null,o)]);r.loadModules(["esri/geometry/Extent","esri/layers/GraphicsLayer"],n.options).then(function(e){var r=l(e,2),a=r[0],o=(r[1],new(Function.prototype.bind.apply(a,[null].concat(d(i),[new esri.SpatialReference({wkid:4326})]))));n.gismap.setExtent(o),t()})})},clearLayers:function(e,n){n.length&&(n.forEach(function(n){e.removeLayer(n)}),n.length=0)},getAreaList:function(){var e=Object.keys(i.a).filter(function(e){return"310100"!==e});return this.$ajax.post(this.$api.overview.statisticsLandAcreByArea,{farmAreaId:e,farmAreaType:3,dataTargetFlag:this.dataTargetFlag}).then(function(e){var n=e.data;return 0===n.respCode?n.obj:null}).catch(function(e){console.log(e)})},getTownList:function(e){return this.$ajax.post(this.$api.overview.statisticsTownLandAcreByAreaId,{areaId:e}).then(function(e){var n=e.data;return 0===n.respCode?n.obj:null}).catch(function(e){console.log(e)})},getTownDetail:function(e){return this.$ajax.post(this.$api.overview.listOnShGisIdByTownId,{townId:e}).then(function(e){var n=e.data;return 0===n.respCode?n.obj:null}).catch(function(e){console.log(e)})}}},h=function(){return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,n){var t=[],r=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(t.push(i.value),!n||t.length!==n);r=!0);}catch(e){a=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}return t}(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function y(e){if(Array.isArray(e)){for(var n=0,t=Array(e.length);n<e.length;n++)t[n]=e[n];return t}return Array.from(e)}function m(e){return function(){var n=e.apply(this,arguments);return new Promise(function(e,t){return function r(a,o){try{var i=n[a](o),s=i.value}catch(e){return void t(e)}if(!i.done)return Promise.resolve(s).then(function(e){r("next",e)},function(e){r("throw",e)});e(s)}("next")})}}var A={zhongzhi:"LANDTYPE='N0103' or LANDTYPE='N0201' or LANDTYPE='N0101'",sucai:"LANDTYPE='N0102'",yuye:"LANDTYPE='N0902'",safe:"1=1"},v={name:"gis-map",mixins:[f],props:{categoryList:{type:Array,default:function(){return[]}},dataTargetFlag:{type:Number,default:function(){return 1}},farmAreaInfo:{type:Object,default:function(){return Object(o.b)()}},showList:{type:Boolean,default:!0},showLandType:{type:String,default:"all"},deleteGreenLand:{type:Boolean,default:!1},isShowGreenLand:{type:Boolean,default:!1},deleteAidaLand:{type:Boolean,default:!1},isShowAidaLand:{type:Boolean,default:!1}},computed:{showGreenLand:{get:function(){return this.isShowGreenLand},set:function(e){this.$emit("update:isShowGreenLand",e)}},showAidaLand:{get:function(){return this.isShowAidaLand},set:function(e){var n=this;e?(this.aidalandLayerLoading=!0,this.serverLayers.aidaland.show(),setTimeout(function(){document.querySelectorAll("#gismap #gismap_aidaland img").length&&(n.aidalandLayerLoading=!1)},1e3)):this.serverLayers.aidaland.hide(),this.$emit("update:isShowAidaLand",e)}},canShowAidaLand:function(){var e=!1,n=Object(a.b)("govGovernmentSubjectVO");return-1!==window.location.href.indexOf("govtest")&&[103,102].includes(n.id)&&(e=!0),-1!==window.location.href.indexOf("gov.snkoudai")&&[74].includes(n.id)&&(e=!0),-1===window.location.href.indexOf("192.168")&&-1===window.location.href.indexOf("127.0")||(e=!0),e},loading:function(){return this.gisloading||this.greenLayerLoading||this.nydLayerLoading||this.aidalandLayerLoading}},data:function(){return{gismap:null,legendList:[],gisloading:!1,greenLayerLoading:!1,nydLayerLoading:!1,aidalandLayerLoading:!1,temptoken:"",options:{url:"http://gov.snkoudai.com/mapdemo/arcgis3.28/init.js"},serverLayers:{},companyLayers:{},tileSourceMap:{weixing:"/shanghaiArcGIS/rest/services/SHMAP_IMAGE/MapServer",landi:"/shanghaiArcGIS/rest/services/SHMAP_AN/MapServer"},tileLayers:{weixing:null,landi:null},serviceMap:{nongyongdi:"",nongyongdiTile:"",hzssc_dapeng:"",hzssc_dapengTile:"",greenCert:"",greenCertTile:""},homeLatLng:[121.12961431068945,30.979833911253177,121.69403691811132,31.266851733518802],tileMapType:JSON.stringify({label:"标准地图",value:"landi"}),tileMapTypeList:[{label:"标准地图",value:"landi"},{label:"卫星地图",value:"weixing"}],baseMapIsWeixing:!1,layershow:{service:["农用地"],companyService:["农用地"]},companyname:"",companyId:"",inCompanySearch:!1,serverLayerShow:["农用地"],plotLayers:null,clearCompanySelect:!1,legendMap:{all:[{name:"粮田",color:"#d37600"},{name:"菜田",color:"#d5858a"},{name:"经作田",color:"#e8001f"},{name:"果园",color:"#969600"},{name:"水产",color:"#6697ff"},{name:"畜禽",color:"#fac907"}],zhongzhi:[{name:"粮田",color:"#d37600"},{name:"经作田",color:"#e8001f"},{name:"果园",color:"#969600"}],sucai:[{name:"菜田",color:"#d5858a"}],yuye:[{name:"水产",color:"#6697ff"}],safe:[{name:"绿色认证",color:"#24f930"}]},pageName:"",openOperatorList:!1,canShowOnNetBtn:!1}},inject:["plotDialog","landPop","greenLandPop"],watch:{tileMapType:function(e,n){var t=JSON.parse(e).value;for(var r in this.tileLayers){var a;if(r===t)(a=this.gismap.getLayer(r+"_ditu"))&&a.show();else(a=this.gismap.getLayer(r+"_ditu"))&&a.hide()}},layershow:{handler:function(e){var n=e.service,t=e.companyService;-1!==n.indexOf("农用地")?this.serverLayers.nongyongdi.forEach(function(e){return e.show()}):this.serverLayers.nongyongdi.forEach(function(e){return e.hide()}),-1!==t.indexOf("农用地")?this.companyLayers.nongyongdi.show():this.companyLayers.nongyongdi.hide()},deep:!0},isShowGreenLand:function(e){var n=this;return m(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n,e?(n.greenLayerLoading=!0,n.serverLayers.greenCert.show()):n.serverLayers&&n.serverLayers.greenCert&&n.serverLayers.greenCert.hide();case 2:case"end":return t.stop()}},t,n)}))()}},mounted:function(){this.pageName=this.$route.name,this.initMoudle()},methods:{initMoudle:function(){var e=this;return m(regeneratorRuntime.mark(function n(){var t,r,o,c,u,l,d,p;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t=e,e.gisloading=!0,r="310100",e.farmAreaInfo&&e.farmAreaInfo.farmAreaId&&i.a.hasOwnProperty(e.farmAreaInfo.farmAreaId)&&(r=e.farmAreaInfo.farmAreaId),e.serviceMap.nongyongdi=e.serviceMap.aidaland=i.a[r].nongyongdi,e.serviceMap.nongyongdiTile=i.a[r].nongyongdiTile,e.serviceMap.greenCert=i.a[r].greenCert,e.serviceMap.greenCertTile=i.a[r].greenCertTile,e.serviceMap.typeTitleMaps=i.a[r].typeTitleMaps||null,o=Boolean("overview"===e.$route.name),e.homeLatLng=o?i.a[r].centerExtendPlus:i.a[r].centerExtend,e.homeLatLng[0]+""=="120.4211898077586"&&$(window).width()>3e3&&(e.homeLatLng=[120.13760521303203,30.851050770703004,122.74617149721172,31.436759388867067]),n.next=14,Object(s.a)(e);case 14:if(e.temptoken=n.sent,e.gismap){n.next=22;break}return n.next=18,e.initMap();case 18:n.sent,dojo.connect(e.gismap,"onClick",e.searchPointer),n.next=30;break;case 22:e.layersHander(),e.serverLayers.greenCert&&e.gismap.removeLayer(e.serverLayers.greenCert),e.serverLayers.greenCert=null,e.serverLayers.nongyongdi&&e.serverLayers.nongyongdi.forEach(function(n){return e.gismap.removeLayer(n)}),e.layershow.service=e.layershow.companyService=["农用地"],!e.isShowOnNetLand&&e.goHomeExtent(),e.$refs.operatorsListChild&&e.$refs.operatorsListChild.initMoudle(),e.companyname&&e.clearCompanySelectfn();case 30:return n.next=32,e.verifyMapReadyHander("gismap_landi_ditu");case 32:if(e.gisloading=!1,"yuye"!==e.showLandType){n.next=40;break}return n.next=36,e.initServerLayer(e.gismap,"nongyongdi","yuye");case 36:c=n.sent,e.serverLayers.nongyongdi=[c],n.next=71;break;case 40:if("zhongzhi"!==e.showLandType){n.next=53;break}return n.next=43,e.initServerLayer(e.gismap,"nongyongdi","jingzuotian");case 43:return u=n.sent,n.next=46,e.initServerLayer(e.gismap,"nongyongdi","guoyuan");case 46:return l=n.sent,n.next=49,e.initServerLayer(e.gismap,"nongyongdi","liangtian");case 49:d=n.sent,e.serverLayers.nongyongdi=[u,l,d],n.next=71;break;case 53:if("sucai"!==e.showLandType){n.next=60;break}return n.next=56,e.initServerLayer(e.gismap,"nongyongdi","sucai");case 56:c=n.sent,e.serverLayers.nongyongdi=[c],n.next=71;break;case 60:if("safe"!==e.showLandType){n.next=67;break}return n.next=63,e.initServerLayer(e.gismap,"nongyongdi","all");case 63:c=n.sent,e.serverLayers.nongyongdi=[c],n.next=71;break;case 67:return n.next=69,e.initServerLayer(e.gismap,"nongyongdi",e.showLandType);case 69:c=n.sent,e.serverLayers.nongyongdi=[c];case 71:return n.next=73,e.onUpdateEndLayer(e.serverLayers.nongyongdi);case 73:if(n.sent){n.next=76;break}return n.abrupt("return");case 76:return e.nydLayerLoading=!1,n.next=79,e.initServerLayer(e.gismap,"greenCert");case 79:return e.serverLayers.greenCert=n.sent,e.serverLayers.greenCert.on("update-end",function(e){t.greenLayerLoading=!1}),e.showGreenLand?(e.greenLayerLoading=!0,e.serverLayers.greenCert.show()):e.serverLayers.greenCert.hide(),n.next=84,e.initServerLayer(e.gismap,"aidaland",e.showLandType);case 84:e.serverLayers.aidaland=n.sent,e.serverLayers.aidaland.on("update-end",function(e){t.aidalandLayerLoading=!1}),e.serverLayers.aidaland.hide(),p=Object(a.b)("govGovernmentSubjectVO"),e.canShowOnNetBtn=Boolean(2===p.subjectLevel&&"310100"===p.cityId);case 89:case"end":return n.stop()}},n,e)}))()},toggleLoading:function(e){this.gisloading=e},showSubjectDetailsfn:function(e){var n=this;return m(regeneratorRuntime.mark(function t(){var r,a,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n.clearCompanySelect=!1,r=e[0]||[],!(a=r.filter(function(e){if(e)return e}))||!a.length){t.next=17;break}return n.gisloading=!0,n.companyname="",n.layershow.service=[],o=e[2]&&e[2].countyId||"",t.next=10,n.renderPlotForPlogon(a,o);case 10:n.companyname=e[1],n.inCompanySearch=!0,n.layershow.companyService=["农用地"],n.gisloading=!1,n.clearCompanySelect=!1,t.next=20;break;case 17:n.clearCompanySelectfn(),n.gisloading=!1,n.$message({type:"warning",offset:100,duration:2e3,message:"未搜索到对应地块"});case 20:case"end":return t.stop()}},t,n)}))()},clearCompanySelectfn:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return m(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.inCompanySearch=!1,e.companyname="",e.layershow.service=["农用地"],e.layershow.companyService=[],setTimeout(function(){e.clearCompanySelect=!0},200),t.next=7,e.renderPlotForPlogon([]);case 7:!n&&e.goHomeExtent();case 8:case"end":return t.stop()}},t,e)}))()},goHomeExtent:function(){var e=this;r.loadModules(["esri/geometry/Extent"],this.options).then(function(n){var t=h(n,1)[0],r=new(Function.prototype.bind.apply(t,[null].concat(y(e.homeLatLng),[new esri.SpatialReference({wkid:4326})])));e.gismap.setExtent(r)})},initMap:function(){var e=this,n=this;return new Promise(function(t){r.loadModules(["esri/map","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ImageParameters","esri/geometry/Point","esri/SpatialReference","esri/geometry/Extent","esri/layers/GraphicsLayer","esri/dijit/Legend"],e.options).then(function(r){var a=h(r,9),o=a[0],i=a[1],s=(a[2],a[3],a[4],a[5],a[6]),c=a[7],u=(a[8],new(Function.prototype.bind.apply(s,[null].concat(y(e.homeLatLng),[new esri.SpatialReference({wkid:4326})]))));if(e.pageName===n.$route.name){var l=new o("gismap",{extent:u,logo:!1,optimizePanAnimation:!0,force3DTransforms:!1});dojo.connect(l,"onExtentChange",function(e){var t=Boolean(l.getScale()<9018)||n.inCompanySearch;n.baseMapToggle(t)}),e.tileLayers.weixing=new i(e.tileSourceMap.weixing,{id:"weixing_ditu",visible:!1}),l.addLayer(e.tileLayers.weixing),e.tileLayers.landi=new i(e.tileSourceMap.landi,{id:"landi_ditu",visible:!0}),l.addLayer(e.tileLayers.landi),e.companyLayers.nongyongdi=new c({visible:!0}),l.addLayer(e.companyLayers.nongyongdi),e.plotLayers=new c({visible:!0}),l.addLayer(e.plotLayers),n.gismap=l,t(!0)}},function(e){t(!1)})})},initServerLayer:function(e){var n=this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"nongyongdi",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"all";return new Promise(function(o){r.loadModules(["esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ImageParameters"],n.options).then(function(r){var i=h(r,3),s=i[0],c=(i[1],i[2]),u=Boolean(!!n.serviceMap[t+"Tile"]&&"all"===a),l=Boolean(!!n.serviceMap.typeTitleMaps&&n.serviceMap.typeTitleMaps[a]&&"nongyongdi"===t&&"all"!==a);if(u)var d=n.serviceMap[t+"Tile"]+"?token="+n.temptoken,p=new esri.layers.ArcGISTiledMapServiceLayer(d,{id:t,outFields:["*"]});else if(l)d=n.serviceMap.typeTitleMaps[a]+"?token="+n.temptoken,p=new esri.layers.ArcGISTiledMapServiceLayer(d,{id:a,outFields:["*"]});else{var g=new c,f=[],y=A[a]||"1=1";"aidaland"===t&&(y="("+y+") AND DKNEIRONG NOT IN ('无' , '否' , '' , ' ' , '  ') AND (LUNZUONEIR NOT IN ('无' , '否' , '' , ' ' , '  ') OR LUNZUONEIR NOT IN ('无' , '否' , '' , ' ' , '  '))"),f[0]=y,g.layerDefinitions=f,g.layerIds=[0],g.layerOption=c.LAYER_OPTION_SHOW,g.transparent=!0;p=s(d=n.serviceMap[t]+"?token="+n.temptoken,{id:t,outFields:["*"],imageParameters:g})}e.addLayer(p),o(p)},function(e){o(!1)})})},onUpdateEndLayer:function(e){var n,t=this;return new Promise((n=m(regeneratorRuntime.mark(function n(a){var o;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(e instanceof Array)){n.next=4;break}Promise.all(e.map(function(e){return r(e)})).then(function(e){var n=e.every(function(e){return e});a(n)}),n.next=8;break;case 4:return n.next=6,r(e);case 6:o=n.sent,a(o);case 8:case"end":return n.stop()}},n,t)})),function(e){return n.apply(this,arguments)}));function r(e){return new Promise(function(n){if(!e)return n(!1);e.on("update-end",function(e){n(!0)})})}},searchPointer:function(e){var n=this;return m(regeneratorRuntime.mark(function t(){var r,a,o,i,s,c,u,l,d,p,g,f,y;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n.gisloading=!0,n.layersHander(0),n.gismap.infoWindow.hide(),n.plotDialog.plotdialogVisible=!1,t.next=6,n.queryOnePointer(e,"nongyongdi");case 6:if(r=t.sent,a=h(r,2),o=a[0],i=a[1],!o){t.next=27;break}return s=i.features[0].attributes.DKID,t.next=14,n.getPlotId(s);case 14:if(c=t.sent,u=h(c,2),l=u[0],d=u[1],!l){t.next=27;break}return n.plotDialog.landId=d.id,n.plotDialog.plotId=d.plotId,n.plotDialog.gisType=d.type,n.plotDialog.plotdialogVisible=!0,t.next=25,n.renderAllPolygon(n.gismap,i.features,n.plotLayers);case 25:return n.gisloading=!1,t.abrupt("return");case 27:if(!n.showGreenLand){t.next=36;break}return t.next=30,n.queryOnePointer(e,"greenCert");case 30:p=t.sent,g=h(p,2),g[0],f=g[1],t.next=38;break;case 36:!1,f=!1;case 38:if((y=f||i)&&y.features&&0!=y.features.length){t.next=42;break}return n.gisloading=!1,t.abrupt("return");case 42:return t.next=44,n.renderAllPolygon(n.gismap,y.features,n.plotLayers);case 44:setTimeout(function(){n.gisloading=!1,n.showAreaInfo(n.gismap,y,e.mapPoint)},500);case 45:case"end":return t.stop()}},t,n)}))()},showAreaInfo:function(e,n,t){if(n.features&&0!=n.features.length){var r=n.features[0].attributes,a={};for(var o in r){var i=r[o];"Shape_Area"===o?(i=u(r.Shape_Area),a.shapeArea=i):"SHAPE_Area"===o&&(i=u(r.SHAPE_Area),a.shapeArea=i);var s=c.a.hasOwnProperty(o)?c.a[o]:o;i="地块类型"===s&&c.b.hasOwnProperty(i)?c.b[i]:i,"地块类型"===s&&c.b.hasOwnProperty(i)&&(a.landType=i),i="主体类型"===s&&c.d.hasOwnProperty(i)?c.d[i]:i,"主体类型"===s&&c.d.hasOwnProperty(i)&&(a.companyType=i),r[o]&&""!==r[o]&&" "!==r[o]&&"  "!==r[o]&&(a[o]=i)}return r.hasOwnProperty("DPDKID")?(e.infoWindow.setTitle("大棚: "+r.DPDKID),a.shapeLength=u(r.SHAPE_Length),this.landPop.landPopVisible=!0,this.landPop.landDetailData=a):r.hasOwnProperty("updateUser")&&r.hasOwnProperty("landtype")||r.hasOwnProperty("qiye")&&r.hasOwnProperty("area")?(e.infoWindow.setTitle("绿色认证用地: "+r.FID),this.greenLandPop.landPopVisible=!0,this.greenLandPop.landDetailData=a):(e.infoWindow.setTitle("农用地: "+r.DKID),this.landPop.landPopVisible=!0,this.landPop.landDetailData=a),!0}return!1;function u(e){/\d+e[+-]\d/g.test(e=e)||e<1e-4?e*=16e6:e=parseFloat(e/666.66666666667);var n=e.toExponential().match(/\d(?:\.(\d*))?e([+-]\d+)/);return e.toFixed(Math.max(0,(n[1]||"").length-n[2]))}},getPlotId:function(e){return this.$ajax.post(this.$api.plotlist.getByGisDkid,{shGisDkid:e,dataTargetFlag:this.dataTargetFlag}).then(function(e){var n=e.data;return 0===n.respCode?2===n.obj.type?[!1,null]:[!0,n.obj]:[!1,null]}).catch(function(e){console.log(e)})},renderAllPolygon:function(e,n,t){var a=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return new Promise(function(e){r.loadModules(["esri/graphic","esri/geometry/Polygon","esri/SpatialReference","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol"],a.options).then(function(r){var i=h(r,5),s=i[0],c=i[1],u=i[2],l=i[3],d=i[4];if(0!==n.length){for(var p={},g=0;g<n.length;g++){var f=a.getNowAreaColor(n[g],o),m=h(f,2),A=((b=m[0])+(x=m[1])+(S=1===o?4:1)).split(",").join("");if(p[A]){v=JSON.parse(JSON.stringify(n[g].geometry.rings));p[A].rings=p[A].rings.concat(v)}else{var v=JSON.parse(JSON.stringify(n[g].geometry.rings));p[A]={areaColor:b,borderColor:x,borderwidth:S,rings:v}}}for(var w in p){for(var L=p[w],b=L.areaColor,x=L.borderColor,S=L.borderwidth,I=(v=L.rings,new l(l.STYLE_SOLID,new d(d.STYLE_SOLID,new dojo.Color(x),S),new dojo.Color([].concat(y(b),[1])))),M=new c(new u({wkid:4326})),E=0,P=v.length;E<P;E++)M.addRing(v[E]);t.add(new s(M,I))}e()}})})},queryOnePointer:function(e,n){var t=this;return new Promise(function(a){t.serviceMap[n]?r.loadModules(["esri/tasks/QueryTask","esri/tasks/query","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol"],t.options).then(function(r){var o=h(r,4),i=o[0],s=o[1],c=o[2],u=o[3],l=new s;l.returnGeometry=!0,l.outFields=["*"];new c(c.STYLE_SOLID,new u(u.STYLE_SOLID,new dojo.Color([255,0,0]),2),new dojo.Color([255,255,0,.5]));var d,p=new i(t.serviceMap[n]+"/0?token="+t.temptoken);l.geometry=e.mapPoint,p.execute(l,(d=m(regeneratorRuntime.mark(function e(n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n&&n.features&&n.features.length>0&&n.features[0].attributes?a([!0,n]):a([!1,null]);case 1:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)}))}):a([!1,null])})},getNowAreaColor:function(e,n){if(!e||!e.attributes||!(e.attributes["土地类型"]||e.attributes.TYPE||e.attributes.LANDTYPE))return[[51,98,2],[255,0,0]];var t=e.attributes["土地类型"]||e.attributes.TYPE||e.attributes.LANDTYPE;return c.c.hasOwnProperty(t)?e.attributes["土地类型"]?1===n?[c.c[t],[255,0,0]]:2===n?[c.c[t],[215,116,85]]:[c.c[t],c.c[t]]:1===n?[c.c[t],[255,0,0]]:2===n?[c.c[t],[215,116,85]]:[c.c[t],[165,165,165]]:[[201,242,208],[165,165,165]]},layersHander:function(e){switch(e){case 0:this.plotLayers&&this.plotLayers.clear();break;case 1:for(var n in this.serverLayers)this.serverLayers[n]&&this.serverLayers[n].hide();this.serverLayerShow.service=[];case 2:this.companyProfile&&this.companyProfile.hide();default:this.plotLayers&&this.plotLayers.clear(),this.companyProfile&&this.companyProfile.hide(),this.gismap.infoWindow.hide()}},plotdialogChange:function(e){this.plotDialog.plotdialogVisible=e,e||(this.plotDialog.plotTabIndex=1,this.layersHander(0))},verifyMapReadyHander:function(e){var n,t=this,r=this,a=!1,o=r.$route.path;function i(){var n,t=this;return new Promise((n=m(regeneratorRuntime.mark(function n(i){var s;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:s=function(){if(r.$route.path===o&&!a){var n=document.getElementById(e);return!(!n||""===n.innerHTML)&&(a=!0,i(!0),!0)}},setTimeout(s,200),setTimeout(s,500),setTimeout(s,1e3),setTimeout(s,2e3),setTimeout(s,4e3),setTimeout(s,5e3),setTimeout(function(){if(r.$route.path===o&&!a){var n=document.getElementById(e);n&&""!==n.innerHTML?(a=!0,i(!0)):(document.getElementById("gismap").innerHTML="",console.log("overflow 卫星图加载有问题 重新加载"),i(!1))}},7e3);case 8:case"end":return n.stop()}},n,t)})),function(e){return n.apply(this,arguments)}))}return new Promise((n=m(regeneratorRuntime.mark(function e(n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.gisloading=!0,e.next=3,i();case 3:if(e.sent){e.next=10;break}return window.location.reload(),n(!1),e.abrupt("return");case 10:n(!0);case 11:case"end":return e.stop()}},e,t)})),function(e){return n.apply(this,arguments)}))},landPopChange:function(e){this.landPop.landPopVisible=e,e||this.layersHander(0)},greenLandPopChange:function(e){this.greenLandPop.landPopVisible=e,e||this.layersHander(0)},renderPlotForPlogon:function(e){var n,t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Promise((n=m(regeneratorRuntime.mark(function n(a){var o,i,s,c;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(t.companyLayers.nongyongdi.clear(),e.length){n.next=4;break}return a(),n.abrupt("return");case 4:return n.next=6,t.goMorePlotsWithId("nongyongdi",e,r);case 6:if(o=n.sent,i=h(o,2),s=i[0],c=i[1],!(s&&c.length>0)){n.next=15;break}return n.next=13,t.getCenterAZoom([].concat(y(c)),t.showLandType);case 13:n.next=17;break;case 15:t.$message({type:"warning",offset:100,duration:2e3,message:"未搜索到对应地块"}),setTimeout(t.clearCompanySelectfn,200);case 17:s&&c.length>0&&t.renderAllPolygon(t.gismap,c,t.companyLayers.nongyongdi,2),t.gisloading=!1,a();case 20:case"end":return n.stop()}},n,t)})),function(e){return n.apply(this,arguments)}))},goMorePlotsWithId:function(e,n){var t=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return m(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",new Promise(function(){var a=m(regeneratorRuntime.mark(function a(o){var s,c,u,l;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(l=function e(n,t){return n.length>t?[n.splice(0,t)].concat(y(e(n,t))):[n]},n&&0!==n.length){a.next=4;break}return o(),a.abrupt("return");case 4:s=r&&i.a[r]&&i.a[r][e]||t.serviceMap[e],c=s+"/0?token="+t.temptoken,u=[],l(JSON.parse(JSON.stringify(n)),1e3).forEach(function(){var n=m(regeneratorRuntime.mark(function n(r,a){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:u.push(t.serverQuery(c,t.plotQueryfn(r,e)));case 1:case"end":return n.stop()}},n,t)}));return function(e,t){return n.apply(this,arguments)}}()),Promise.all(u).then(function(e){var n=!1,t=[];e.forEach(function(e,r){var a=h(e,2),o=a[0],i=a[1];o&&(n=!0),t.push.apply(t,y(i))}),o([n,t])});case 10:case"end":return a.stop()}},a,t)}));return function(e){return a.apply(this,arguments)}}()));case 1:case"end":return a.stop()}},a,t)}))()},getCenterAZoom:function(e,n){var t=this;return new Promise(function(a){for(var o=[],i=[],s=[],c=[],u=0;u<e.length;u++){var l=e[u].geometry.getExtent();o.push(l.xmin),i.push(l.ymin),s.push(l.xmax),c.push(l.ymax)}var d=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(4!==e.length)return[];var n=e[2]-e[0],t=e[3]-e[1];e[0],e[1];return[e[0]-n,e[1]-t,e[2]+n,e[3]+t]}([Math.min.apply(null,o),Math.min.apply(null,i),Math.max.apply(null,s),Math.max.apply(null,c)],n);r.loadModules(["esri/geometry/Extent","esri/layers/GraphicsLayer"],t.options).then(function(e){var n=h(e,2),r=n[0],o=(n[1],new(Function.prototype.bind.apply(r,[null].concat(y(d),[new esri.SpatialReference({wkid:4326})]))));t.gismap.setExtent(o);var i=Boolean(d[2]-d[0]>.05||d[3]-d[1]>.05);a(i)})})},plotQueryfn:function(e,n){var t="DPDKID",r=e||[];return r=r.filter(function(e){if(e)return e}),"nongyongdi"===n&&(t="DKID"),function(){for(var e="",n=0;n<r.length;n++)r[n]&&(n===r.length-1?e+=t+" = '"+r[n]+"'":e+=t+" = '"+r[n]+"' or ");return e}},serverQuery:function(e,n){var t=this;return new Promise(function(a){r.loadModules(["esri/map","esri/layers/ArcGISDynamicMapServiceLayer","esri/tasks/QueryTask","esri/toolbars/draw","esri/tasks/query","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol"],t.options).then(function(t){var r=h(t,7),o=(r[0],r[1],r[2]),i=(r[3],r[4]),s=(r[5],r[6],new o(e)),c=new i;if(c.outFields=["*"],n&&(c.where=n()),c.where){c.outSpatialReference=esri.spatialReference,c.spatialRelationship=i.SPATIAL_REL_INTERSECTS,c.returnGeometry=!0,c.returnDistinctValues=!1,c.relationParam=!1;try{s.execute(c,function(e){e.features&&0!==e.features.length?a([!0,e.features]):a([!1,[]])})}catch(e){a([!1,[]])}}else a([!1,[]])})})},baseMapToggle:function(e){this.baseMapIsWeixing!==e&&(e?(this.baseMapIsWeixing=!0,this.gismap.getLayer("weixing_ditu").show(),this.gismap.getLayer("landi_ditu").hide()):(this.baseMapIsWeixing=!1,this.gismap.getLayer("landi_ditu").show(),this.gismap.getLayer("weixing_ditu").hide()))}},components:{operatorsList:function(){return t.e(1).then(t.bind(null,"bkaB"))}}},w=t("W5g0");var L=function(e){t("vzY3")},b=Object(w.a)(v,function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{staticClass:"map-area"},[t("div",{staticClass:"map-view",class:{"show-aida-land":e.showAidaLand,"show-company-land":e.inCompanySearch,"overview-map":"all"===e.showLandType,"show-onnet":e.isShowOnNetLand,"show-onnet-town":3===e.onNetMenu.length},attrs:{attr:e.showLandType}},[t("div",{attrs:{id:"gismap"}}),e._v(" "),e.legendMap[e.showLandType]?t("div",{attrs:{id:"legendBox"}},[t("ul",e._l(e.legendMap[e.showLandType],function(n,r){return t("li",{key:n.name},[t("span",{style:{"background-color":n.color}}),e._v(e._s(n.name))])}),0)]):e._e()]),e._v(" "),t("div",{staticClass:"map-control"},[t("div",{staticClass:"mapcontrol"},["all"===e.showLandType&&e.canShowOnNetBtn&&!e.isShowOnNetLand?t("div",{staticClass:"above-acre-btn",on:{click:function(n){e.isShowOnNetLand=!e.isShowOnNetLand}}},[t("i",{staticClass:"iconfont icon-wangluo"}),t("span",[e._v("入网统计")])]):e._e()])]),e._v(" "),e.isShowOnNetLand?t("div",{staticClass:"on-net-land"},[e.onNetMenu.length?t("div",{staticClass:"above-acre-bread"},[t("span",[e._v("入网统计")]),e._v(" "),e._l(e.onNetMenu,function(n,r){return t("span",{key:n.id,staticClass:"onnet-area-label"},[e._v(e._s(n.name)),t("i",{on:{click:function(n){return e.onNetChangeHander(r)}}},[e._v("×")])])})],2):e._e(),e._v(" "),e.isShowOnNetLand?t("div",{staticClass:"above-acre-back-btn",on:{click:function(n){e.isShowOnNetLand=!1}}},[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"退出入网统计",placement:"bottom"}},[t("span")])],1):e._e()]):e._e(),e._v(" "),e.inCompanySearch&&e.companyname?t("div",{staticClass:"now-company"},[e._v("\n\t\t"+e._s(e.companyname)+"\n\t\t"),t("span",{staticClass:"close",on:{click:function(){e.clearCompanySelectfn()}}},[e._v("×")])]):e._e(),e._v(" "),e.isShowOnNetLand?e._e():t("div",{staticClass:"show-green-certland"},[e.canShowAidaLand&&!e.deleteAidaLand?t("el-switch",{attrs:{"inactive-text":"高亮显示在田地块","active-color":"#00F6FF","inactive-color":"#1B6778"},model:{value:e.showAidaLand,callback:function(n){e.showAidaLand=n},expression:"showAidaLand"}}):e._e(),e._v(" "),e.deleteGreenLand?e._e():t("el-switch",{attrs:{"inactive-text":"显示绿色认证地块","active-color":"#00F6FF","inactive-color":"#1B6778"},model:{value:e.showGreenLand,callback:function(n){e.showGreenLand=n},expression:"showGreenLand"}})],1),e._v(" "),e.showList&&!e.isShowOnNetLand?t("operators-list",{ref:"operatorsListChild",attrs:{categoryList:e.categoryList,farmAreaInfo:e.farmAreaInfo,gisMapFlag:!0,"data-target-flag":e.dataTargetFlag,clearCompanySelect:e.clearCompanySelect,openOperatorList:e.openOperatorList},on:{"update:openOperatorList":function(n){e.openOperatorList=n},"update:open-operator-list":function(n){e.openOperatorList=n},getFarmAllPlotEv:e.showSubjectDetailsfn,toggleLoading:e.toggleLoading}}):e._e(),e._v(" "),e.loading?t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"gisloader",attrs:{"element-loading-text":"加载中...","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.1)"}}):e._e()],1)},[],!1,L,"data-v-52689010",null);n.default=b.exports},UsSZ:function(e,n){e.exports="https://snkoudai.oss-cn-hangzhou.aliyuncs.com/goverment/static/img/area-brand.c2db8a5.png"},Xtqa:function(e,n,t){"use strict";t.d(n,"b",function(){return a}),t.d(n,"a",function(){return o});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(e,n,t){return 0!=e?3==arguments.length&&t?(e*=100,parseInt(e*Math.pow(10,n)+.5,10)/Math.pow(10,n)+"%"):parseInt(e*Math.pow(10,n)+.5,10)/Math.pow(10,n):3==arguments.length&&t?"0%":0}function o(e,n,t){var a=["","一","二","三","四","五","六","日"];if(0==arguments.length)return!1;if("number"!=typeof e&&"object"!==(void 0===e?"undefined":r(e))&&"number"==typeof e&&10!=(e+"").length&&14!=(e+"").length)return!1;1!=arguments.length&&2!=arguments.length||(t=(new Date).getTime()),"number"==typeof e?10==(e+"").length&&(e=Number(e+"000")):e=e.getTime();var o=s(t),c=s(e),u=(o-c)/1e3,l=Math.floor(u/86400);if(0==(d=new Date(o).getDay()))var d=7;if(l>=-2&&l<=2){return["后天","明天","今天","昨天","前天"][l+2]}return Math.abs(l)>14-d&&l<0||l>=d+7?i(c,o,n):l>=d&&l<d+7?"上周"+a[Math.abs(l-d-7)]:l<0&&Math.abs(l)<=7-d||l>0&&l<d?"本周"+a[d-l]:l<0&&Math.abs(l)>7-d&&Math.abs(l)<=14-d?"下周"+a[Math.abs(l)+d-7]:i(c,o,n)}function i(e,n,t){if("年月日"==t)var r=t;else r=t||"/";var a=new Date(e),o=new Date(n),i=a.getFullYear(),s=o.getFullYear(),c="年月日"==t?a.getFullYear()+r[0]:a.getFullYear()+r,u=a.getMonth()+1<10?"0"+(a.getMonth()+1):a.getMonth()+1,l="年月日"==t?a.getMonth()+1+r[1]:u+r,d=a.getDate()<10?"0"+a.getDate():a.getDate(),p="年月日"==t?a.getDate()+r[2]:d;a.getHours(),a.getMinutes(),a.getSeconds();return i==s?l+p:c+l+p}function s(e){var n=new Date(e),t=n.getFullYear()+"/",r=(n.getMonth()+1<10?"0"+(n.getMonth()+1):n.getMonth()+1)+"/",a=n.getDate();return new Date(t+r+a+" 00:00:00").getTime()}Date.prototype.format=function(e){var n={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var t in/(y+)/i.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),n)new RegExp("("+t+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?n[t]:("00"+n[t]).substr((""+n[t]).length)));return e}},basq:function(e,n){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAKCAYAAABmBXS+AAAAi0lEQVQYlX3QzwoBcRTF8c/8SXlIigWlLBQ23oCaUooSaRYW3sbKuyjGYn5TM0zO7t6+995zT3S6PxKc0ccTPdzUFOOFAY7o4BrABgRvjLFDgkuoGxAUmGIT+nvMIPWrZfC2QoZu3AJ9K27btMYinJ8jq0MRtsFXgQkOdU+V0ZEykiHyajpVvvw3zA+WfRztqi/XGgAAAABJRU5ErkJggg=="},ddyH:function(e,n){e.exports="https://snkoudai.oss-cn-hangzhou.aliyuncs.com/goverment/static/img/town-brand.6adf536.png"},jIOT:function(e,n,t){"use strict";t.d(n,"c",function(){return r}),t.d(n,"b",function(){return a}),t.d(n,"d",function(){return o}),t.d(n,"a",function(){return i});t("PbuP");var r={"林地":[48,97,0],"果园":[150,150,0],"菜田":[213,133,138],"粮田":[211,181,0],"已征地":[0,142,139],"水产养殖":[102,151,255],"畜牧养殖":[250,201,7],"经作田":[232,0,31],"自留地/集体地":[0,142,139],"零星用地":[0,142,139],"大棚":[201,242,208],"露地":[201,242,208],N0102:[213,133,138],N0201:[150,150,0],N0101:[211,180,2],N0902:[102,151,255],N0103:[232,0,31],N03:[48,97,0],N0109:[0,142,139],N0110:[4,143,140],N0111:[4,143,140]},a={N0101:"粮田",N0102:"菜田",N0103:"经作田",N0109:"零星用地（其他）",N0110:"零星用地（已征地）",N0111:"零星用地（自留地/集体地）",N0201:"果园",N03:"林地",N0901:"养殖（畜牧）",N0902:"养殖（水产）"},o={HZ01:"合作社",HZ02:"家庭农场",HZ03:"农业企业",HZ04:"其他",HZ05:"农户（散户）",HZ06:"农户（大户）",HZ07:"村集体"},i={"区":"区/县","镇":"街镇","信用代":"主体唯一标识",updateUser:"经营主体名称",landtype:"认证作物",AREAMU:"地块亩数",CODE1:"区域",CODE2:"地块名称",COMPANY:"合作社名称",COMPANYID:"合作社ID",DAIBIAOADD:"代表地址",DAIBIAOID:"代表ID",DAIBIAOPHO:"代表手机号",DISTRICT:"行政区",DKID:"地块ID",DKNEIRONG:"地块内容",DPDKID:"地块ID",EDITOR:"编辑者",EDIT_TIME:"编辑时间",ISLINK:"连栋棚",JIANZUONEI:"间作内容",LANDTYPE:"地块类型",LUNZUONEIR:"轮作内容",REGION:"所属公司",REMARK:"备注",SHAPE_1_Area:"地块面积_1",SHAPE_1_Length:"地块周长_1",SHAPE_Area:"面积",SHAPE_Length:"地块周长",Shape_Area:"地块面积",Shape_Leng:"地块周长",TOWN:"所属镇",TYPE:"类型",VILLAGE:"村",ZHUTIDAIBI:"主体代表",ZHUTIID:"主体ID",ZHUTINAME:"主体名称",ZHUTITYPE:"主体类型"}},vzY3:function(e,n){},wggp:function(e,n,t){(function(e){"use strict";var n="4.17",t="next";function r(e){if(e.toLowerCase()===t)return t;var n=e&&e.match(/^(\d)\.(\d+)/);return n&&{major:parseInt(n[1],10),minor:parseInt(n[2],10)}}function a(e){return void 0===e&&(e=n),"https://js.arcgis.com/"+e+"/"}function o(e){return!e||r(e)?function(e){void 0===e&&(e=n);var o=a(e),i=r(e);return i!==t&&3===i.major?o+(i.minor<=10?"js/":"")+"esri/css/esri.css":o+"esri/themes/light/main.css"}(e):e}function i(e,n){var t=o(e),r=function(e){return document.querySelector('link[href*="'+e+'"]')}(t);return r||function(e,n){if(n){var t=document.querySelector(n);t.parentNode.insertBefore(e,t)}else document.head.appendChild(e)}(r=function(e){var n=document.createElement("link");return n.rel="stylesheet",n.href=e,n}(t),n),r}var s={Promise:"undefined"!=typeof window?window.Promise:void 0},c={};function u(e,n,t){var r;t&&(r=function(e,n){var t=function(r){n(r.error||new Error("There was an error attempting to load "+e.src)),e.removeEventListener("error",t,!1)};return e.addEventListener("error",t,!1),t}(e,t));var a=function(){n(e),e.removeEventListener("load",a,!1),r&&e.removeEventListener("error",r,!1)};e.addEventListener("load",a,!1)}function l(e){void 0===e&&(e={}),c=e}function d(){return document.querySelector("script[data-esri-loader]")}function p(){var e=window.require;return e&&e.on}function g(e){void 0===e&&(e={});var n={};[c,e].forEach(function(e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t])});var t=n.version,r=n.url||a(t);return new s.Promise(function(e,a){var o=d();if(o){var s=o.getAttribute("src");s!==r?a(new Error("The ArcGIS API for JavaScript is already loaded ("+s+").")):p()?e(o):u(o,e,a)}else if(p())a(new Error("The ArcGIS API for JavaScript is already loaded."));else{var c=n.css;if(c)i(!0===c?t:c,n.insertCssBefore);n.dojoConfig&&(window.dojoConfig=n.dojoConfig),u(o=function(e){var n=document.createElement("script");return n.type="text/javascript",n.src=e,n.setAttribute("data-esri-loader","loading"),n}(r),function(){o.setAttribute("data-esri-loader","loaded"),e(o)},a),document.body.appendChild(o)}})}function f(e){return new s.Promise(function(n,t){var r=window.require.on("error",t);window.require(e,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r.remove(),n(e)})})}function h(e,n){if(void 0===n&&(n={}),p())return f(e);var t=d(),r=t&&t.getAttribute("src");return!n.url&&r&&(n.url=r),g(n).then(function(){return f(e)})}var y={getScript:d,isLoaded:p,loadModules:h,loadScript:g,loadCss:i,setDefaultOptions:l,utils:s};e.getScript=d,e.isLoaded=p,e.loadModules=h,e.loadScript=g,e.loadCss=i,e.setDefaultOptions=l,e.utils=s,e.default=y,Object.defineProperty(e,"__esModule",{value:!0})})(n)},yTDo:function(e,n,t){"use strict";function r(e){return new Promise(function(n){var t="",r=window.location.origin;if(-1!==r.indexOf("192.168")||-1!==r.indexOf("127.0")){var a=Date.parse(new Date)/1e3,o=localStorage.getItem("devgistoken");if(o){var i=JSON.parse(o),s=i.origin,c=i.expiration,u=i.token;if(s===r&&a<c+43200)return void n(t=u)}e.$ajax.get("/getGisToken?request=getToken&username=zuoan&password=abc123&clientid=ref."+r+"/&expiration=1440").then(function(e){if(e.data){t=e.data.replace(/[\s]*/g,"");var o={origin:r,expiration:a,token:t};localStorage.setItem("devgistoken",JSON.stringify(o))}n(t)})}else n(t)})}n.a=function(e){var n,t,a=this;return new Promise((n=regeneratorRuntime.mark(function n(t){var o;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(-1!==window.location.origin.indexOf("192.168")||-1!==window.location.origin.indexOf("127.0.0.1")){n.next=4;break}e.$ajax.post(e.$api.public.gisGetToken,{}).then(function(e){if(200===e.status&&0===e.data.respCode&&e.data.obj){var n=e.data.obj.replace(/[\s↵]*/g,"");t(n)}else t(!1)}),n.next=8;break;case 4:return n.next=6,r(e);case 6:o=n.sent,t(o);case 8:case"end":return n.stop()}},n,a)}),t=function(){var e=n.apply(this,arguments);return new Promise(function(n,t){return function r(a,o){try{var i=e[a](o),s=i.value}catch(e){return void t(e)}if(!i.done)return Promise.resolve(s).then(function(e){r("next",e)},function(e){r("throw",e)});n(s)}("next")})},function(e){return t.apply(this,arguments)}))}}});
//# sourceMappingURL=54.e34c2e47b89708732e15.js.map