{"version":3,"file":"static/js/46.a0c1bb5a5e369b8c60ed.js","sources":["webpack:///src/components/overview/modules/price-trend-6.vue"],"sourcesContent":["<template>\n\t<div class=\"gov-area-panel\">\n\t\t<area-panel area-title=\"价格走势\">\n\t\t\t<div class=\"head-sub-title\" slot=\"subTitle\">\n\t\t\t\t<el-select v-model=\"vegetable\" placeholder=\"请选择\" class=\"vegetable-select\" filterable ref=\"cropSearch\" @change=\"selectCrop\">\n\t\t\t\t\t<el-option v-for=\"(item, index) in vegetableVariety\" :key=\"index\" :label=\"item.crop\" :value=\"item.cropId\"> </el-option>\n\t\t\t\t</el-select>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tslot=\"panelMain\"\n\t\t\t\tclass=\"echart-container\"\n\t\t\t\tref=\"EContainer\"\n\t\t\t\tv-loading=\"priceLoading\"\n\t\t\t\telement-loading-spinner=\"iconfont icon-loading1\"\n\t\t\t\telement-loading-background=\"rgba(0, 0, 0, 0.2)\"\n\t\t\t></div>\n\t\t</area-panel>\n\t</div>\n</template>\n\n<script>\nimport areaPanel from '@/components/overview/area-panel';\nimport {dateFormat, getIntervalTime, maxDecimalPlaces, areaLevelCorAreaId} from '@/common/fn';\nimport {setStorage, getStorage} from '@/utils/storage';\n\nconst xData = ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'];\n// echarts 超级变量含义 {a} series.name, {b} data.name {c} data.value {d} data%\nconst lineOption = {\n\ttitle: {\n\t\tshow: false,\n\t\ttext: '暂无数据',\n\t\ttextStyle: {\n\t\t\tfontSize: 12,\n\t\t\tcolor: '#6DC1CB'\n\t\t},\n\t\tleft: 'center',\n\t\ttop: 'center'\n\t},\n\tgrid: {\n\t\tshow: true,\n\t\tborderColor: '#0D394A',\n\t\tbottom: 40,\n\t\ttop: 40\n\t\t// height: '65%'\n\t},\n\ttooltip: {\n\t\tshow: true,\n\t\ttrigger: 'axis',\n\t\tformatter(value) {\n\t\t\tconst s = value.map(item => {\n\t\t\t\treturn item.value !== null ? `${item.seriesName}：${maxDecimalPlaces({value: item.value})}元/公斤` : '';\n\t\t\t});\n\t\t\treturn `${value[0].axisValue}<br/>${s.join('<br />')}`;\n\t\t},\n\t\tbackgroundColor: '#043250',\n\t\tpadding: [13, 14, 13, 11],\n\t\ttextStyle: {\n\t\t\tfontSize: 12,\n\t\t\tcolor: '#9ED2D8'\n\t\t}\n\t},\n\tlegend: {\n\t\tshow: true,\n\t\ttype: 'plain',\n\t\ttextStyle: {\n\t\t\tcolor: '#6DC1CB',\n\t\t\tfontSize: 12\n\t\t},\n\t\tbackgroundColor: 'rgba(255, 255, 255, 0)',\n\t\ttop: 3,\n\t\tright: '8.5%',\n\t\titemWidth: 30,\n\t\titemHeight: 10,\n\t\theight: 20,\n\t\tdata: [\n\t\t\t{\n\t\t\t\tname: `${new Date().getFullYear() - 1}年`,\n\t\t\t\ticon: `image://${require('images/prevYears.png')}`\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: `${new Date().getFullYear()}年`,\n\t\t\t\ticon: `image://${require('images/curYears.png')}`\n\t\t\t}\n\t\t]\n\t},\n\txAxis: {\n\t\tdata: xData,\n\t\tboundaryGap: false,\n\t\taxisLabel: {\n\t\t\ttextStyle: {\n\t\t\t\tcolor: '#6DC1CB',\n\t\t\t\tfontSize: 12\n\t\t\t},\n\t\t\talign: 'center'\n\t\t},\n\t\taxisTick: {\n\t\t\tshow: false\n\t\t},\n\t\taxisLine: {\n\t\t\tshow: true,\n\t\t\tlineStyle: {\n\t\t\t\t// color: '#0D394A'\n\t\t\t\tcolor: 'rgba(109,193,203,0.2)'\n\t\t\t}\n\t\t},\n\t\tz: 10\n\t},\n\tyAxis: {\n\t\tname: '(元/公斤)',\n\t\tnameTextStyle: {\n\t\t\tfontSize: 12,\n\t\t\tcolor: '#6DC1CB',\n\t\t\tpadding: [4, 8, 5, 35]\n\t\t},\n\t\taxisLine: {\n\t\t\tshow: false,\n\t\t\tlineStyle: {\n\t\t\t\tcolor: '#0D394A'\n\t\t\t}\n\t\t},\n\t\taxisTick: {\n\t\t\tshow: false\n\t\t},\n\t\tsplitLine: {\n\t\t\tshow: true,\n\t\t\tlineStyle: {\n\t\t\t\t// color: '#0D394A'\n\t\t\t\tcolor: 'rgba(109,193,203,0.2)'\n\t\t\t}\n\t\t},\n\t\taxisLabel: {\n\t\t\ttextStyle: {\n\t\t\t\tcolor: '#6DC1CB',\n\t\t\t\tfontSize: 12\n\t\t\t}\n\t\t}\n\t},\n\tseries: [\n\t\t{\n\t\t\tdata: [],\n\t\t\ttype: 'line',\n\t\t\tsmooth: true,\n\t\t\tsymbolSize: 0,\n\t\t\tareaStyle: {\n\t\t\t\tcolor: {\n\t\t\t\t\ttype: 'linear',\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: 0,\n\t\t\t\t\tx2: 0,\n\t\t\t\t\ty2: 1,\n\t\t\t\t\tcolorStops: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\toffset: 0,\n\t\t\t\t\t\t\tcolor: 'rgba(0, 162, 255, 0.5)' // 0% 处的颜色\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\toffset: 1,\n\t\t\t\t\t\t\tcolor: 'rgba(60, 105, 217, 0)' // 100% 处的颜色\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\tglobal: false // 缺省为 false\n\t\t\t\t}\n\t\t\t},\n\t\t\tlineStyle: {\n\t\t\t\tcolor: '#00FFFF'\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\tdata: [],\n\t\t\ttype: 'line',\n\t\t\tsmooth: true,\n\t\t\tsymbolSize: 0,\n\t\t\tareaStyle: {\n\t\t\t\tcolor: {\n\t\t\t\t\ttype: 'linear',\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: 0,\n\t\t\t\t\tx2: 0,\n\t\t\t\t\ty2: 1,\n\t\t\t\t\tcolorStops: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\toffset: 0,\n\t\t\t\t\t\t\tcolor: 'rgba(212, 167, 84, 0.5)' // 0% 处的颜色\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\toffset: 1,\n\t\t\t\t\t\t\tcolor: 'rgba(212, 167, 84, 0)' // 100% 处的颜色\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\tglobal: false // 缺省为 false\n\t\t\t\t}\n\t\t\t},\n\t\t\tlineStyle: {\n\t\t\t\tcolor: '#D4A452'\n\t\t\t}\n\t\t}\n\t]\n};\nconst govGovernmentSubjectVO = getStorage('govGovernmentSubjectVO');\nexport default {\n\tname: 'price-trend-6',\n\tdata() {\n\t\treturn {\n\t\t\t// 价格走势chart\n\t\t\tpriceTrendChart: null,\n\t\t\t// loading\n\t\t\tpriceLoading: false,\n\t\t\t// 蔬菜品种下拉框\n\t\t\tvegetableVariety: [],\n\t\t\t// 蔬菜品种下拉框默认值\n\t\t\tvegetable: null\n\t\t};\n\t},\n\tprops: {\n\t\tfarmAreaInfo: {\n\t\t\ttype: Object,\n\t\t\tdefault() {\n\t\t\t\treturn areaLevelCorAreaId();\n\t\t\t}\n\t\t}\n\t},\n\tmounted() {\n\t\tthis.$nextTick(() => {\n\t\t\tthis.initMoudle();\n\t\t});\n\t},\n\tmethods: {\n\t\tasync initMoudle() {\n\t\t\tthis.priceTrendChart = this._initEcharts(this.eContainerRef, lineOption);\n\t\t\tawait this.getCropList();\n\t\t\tthis.getCropPriceTable(this.vegetable);\n\t\t},\n\t\trefreshRender() {\n\t\t\tif (this.priceTrendChart) {\n\t\t\t\tthis.priceTrendChart.resize();\n\t\t\t}\n\t\t},\n\t\t_initEcharts(el, option) {\n\t\t\tconst chart = this.$echarts.init(el);\n\t\t\tchart.setOption(option);\n\t\t\treturn chart;\n\t\t},\n\t\t// 检测是否需要重新加载作物数据\n\t\tcheckCropReload() {\n\t\t\tlet cropTime = getStorage('cropTime');\n\t\t\tif (!cropTime) return true;\n\t\t\tcropTime = Number(cropTime);\n\t\t\tconst updateMonth = new Date(cropTime).getMonth();\n\t\t\tconst updateTime = new Date(cropTime).setMonth(updateMonth + 1, 1);\n\t\t\tconst curEarlyMonth = new Date().getTime();\n\t\t\treturn updateTime >= curEarlyMonth;\n\t\t},\n\t\t// 获取作物种类list\n\t\tgetCropList() {\n\t\t\tthis.priceLoading = true;\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tconst vegetableVariety = getStorage('vegetableVariety');\n\t\t\t\tif (this.checkCropReload() && vegetableVariety && vegetableVariety.length) {\n\t\t\t\t\tthis.vegetableVariety = vegetableVariety.map(item => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tcrop: item.ncCropName,\n\t\t\t\t\t\t\tcropId: item.id\n\t\t\t\t\t\t};\n\t\t\t\t\t});\n\t\t\t\t\tthis.vegetable = vegetableVariety[0].id;\n\t\t\t\t\treturn resolve();\n\t\t\t\t}\n\t\t\t\tthis.$ajax\n\t\t\t\t\t.post(this.$api.market.cropList, {\n\t\t\t\t\t\tareaId: govGovernmentSubjectVO.provinceId,\n\t\t\t\t\t\tkeyword: '',\n\t\t\t\t\t\tpageNo: 1,\n\t\t\t\t\t\tpageSize: 10000\n\t\t\t\t\t})\n\t\t\t\t\t.then(response => {\n\t\t\t\t\t\tconst res = response.data;\n\t\t\t\t\t\tconst obj = res.obj;\n\t\t\t\t\t\tif (res.respCode === 0) {\n\t\t\t\t\t\t\tsetStorage('cropTime', res.curDate);\n\t\t\t\t\t\t\tsetStorage('vegetableVariety', obj.list);\n\t\t\t\t\t\t\tthis.vegetableVariety = obj.list.map(item => {\n\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\tcrop: item.ncCropName,\n\t\t\t\t\t\t\t\t\tcropId: item.id\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tthis.vegetable = this.vegetableVariety[0] ? this.vegetableVariety[0].cropId : null;\n\t\t\t\t\t\t\tresolve(true);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresolve(false);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\t// 选择作物\n\t\tselectCrop(cropId) {\n\t\t\tthis.priceLoading = true;\n\t\t\tthis.priceTrendChart.setOption({\n\t\t\t\tseries: [\n\t\t\t\t\t{\n\t\t\t\t\t\tdata: []\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tdata: []\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t});\n\t\t\tthis.getCropPriceTable(cropId);\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.$refs.cropSearch.blur();\n\t\t\t});\n\t\t},\n\t\t// 获取作物价格走势 2020-01-02 10:22:11\n\t\tgetCropPriceTable(cropId) {\n\t\t\t// 今年的时间\n\t\t\tconst curYear = new Date().getFullYear();\n\t\t\tconst curMonth = new Date().getMonth();\n\t\t\tconst curYearList = getIntervalTime({\n\t\t\t\tstartTime: `${curYear}-01-01`,\n\t\t\t\thowMonth: curMonth\n\t\t\t});\n\t\t\t// 去年的时间\n\t\t\tconst prevYear = curYear - 1;\n\t\t\tconst prevYearList = getIntervalTime({\n\t\t\t\tstartTime: `${prevYear}-01-01`\n\t\t\t});\n\n\t\t\t// 两条并发\n\t\t\tthis.$ajax\n\t\t\t\t.all([\n\t\t\t\t\tthis.$ajax.post(this.$api.market.cropPrice, {\n\t\t\t\t\t\tdateListStr: curYearList,\n\t\t\t\t\t\tnccropId: cropId,\n\t\t\t\t\t\tproviceId: govGovernmentSubjectVO.provinceId\n\t\t\t\t\t}),\n\t\t\t\t\tthis.$ajax.post(this.$api.market.cropPrice, {\n\t\t\t\t\t\tdateListStr: prevYearList,\n\t\t\t\t\t\tnccropId: cropId,\n\t\t\t\t\t\tproviceId: govGovernmentSubjectVO.provinceId\n\t\t\t\t\t})\n\t\t\t\t])\n\t\t\t\t.then((acct, perms) => {\n\t\t\t\t\tif (acct) {\n\t\t\t\t\t\tconst curRes = acct[0].data;\n\t\t\t\t\t\tconst prevRes = acct[1].data;\n\t\t\t\t\t\tlet curTotal = 0;\n\t\t\t\t\t\tlet prevTotal = 0;\n\n\t\t\t\t\t\tcurRes.respCode === 0 &&\n\t\t\t\t\t\t\tcurRes.obj.forEach(item => {\n\t\t\t\t\t\t\t\tcurTotal += item.price;\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\tprevRes.respCode === 0 &&\n\t\t\t\t\t\t\tprevRes.obj.forEach(item => {\n\t\t\t\t\t\t\t\tprevTotal += item.price;\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// 是否有数据\n\t\t\t\t\t\tconst ownDataFlag = curTotal !== 0 || prevTotal !== 0;\n\n\t\t\t\t\t\tthis.priceTrendChart.setOption({\n\t\t\t\t\t\t\ttooltip: {\n\t\t\t\t\t\t\t\tshow: ownDataFlag\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttitle: {\n\t\t\t\t\t\t\t\tshow: !ownDataFlag\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tyAxis: {\n\t\t\t\t\t\t\t\tshow: true // !ownDataFlag\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\txAxis: {\n\t\t\t\t\t\t\t\tshow: ownDataFlag\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tseries: ownDataFlag\n\t\t\t\t\t\t\t\t? [\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tname: dateFormat(`${prevYear}-01-01`, 'yyyy年'),\n\t\t\t\t\t\t\t\t\t\t\tdata: (() => {\n\t\t\t\t\t\t\t\t\t\t\t\treturn prevRes.respCode === 0\n\t\t\t\t\t\t\t\t\t\t\t\t\t? prevRes.obj.map(item => ({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tname: item.ncCropName,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvalue: item.price\n\t\t\t\t\t\t\t\t\t\t\t\t\t  }))\n\t\t\t\t\t\t\t\t\t\t\t\t\t: [];\n\t\t\t\t\t\t\t\t\t\t\t})(),\n\t\t\t\t\t\t\t\t\t\t\tsymbol: 'circle',\n\t\t\t\t\t\t\t\t\t\t\tsymbolSize: 2,\n\t\t\t\t\t\t\t\t\t\t\tcolor: '#00F6FF'\n\t\t\t\t\t\t\t\t\t\t\t// showAllSymbol: true\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tname: dateFormat(`${curYear}-01-01`, 'yyyy年'),\n\t\t\t\t\t\t\t\t\t\t\tdata: (() => {\n\t\t\t\t\t\t\t\t\t\t\t\treturn curRes.respCode === 0\n\t\t\t\t\t\t\t\t\t\t\t\t\t? curRes.obj.map(item => ({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tname: item.ncCropName,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvalue: item.price\n\t\t\t\t\t\t\t\t\t\t\t\t\t  }))\n\t\t\t\t\t\t\t\t\t\t\t\t\t: [];\n\t\t\t\t\t\t\t\t\t\t\t})(),\n\t\t\t\t\t\t\t\t\t\t\tsymbol: 'circle',\n\t\t\t\t\t\t\t\t\t\t\tsymbolSize: 2,\n\t\t\t\t\t\t\t\t\t\t\tcolor: '#FBC02D'\n\t\t\t\t\t\t\t\t\t\t\t// showAllSymbol: true\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t  ]\n\t\t\t\t\t\t\t\t: [\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tdata: []\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tdata: []\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t  ]\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.priceLoading = false;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t}\n\t},\n\tcomputed: {\n\t\teContainerRef() {\n\t\t\treturn this.$refs.EContainer;\n\t\t}\n\t},\n\tcomponents: {\n\t\tareaPanel\n\t}\n};\n</script>\n\n<style scoped lang=\"scss\">\n@import '~styles/selectSkin_default';\n/deep/ .el-select {\n\t.el-input__inner {\n\t\twidth: 94px;\n\t\theight: 30px;\n\t\tpadding: 0 24px 0 12px;\n\t\ttext-align: center;\n\t\ttext-overflow: ellipsis;\n\t\t&::-webkit-input-placeholder {\n\t\t\tcolor: rgba(39, 145, 149, 0.5);\n\t\t}\n\t\t&:-moz-placeholder {\n\t\t\t/* Mozilla Firefox 4 to 18 */\n\t\t\tcolor: rgba(39, 145, 149, 0.5);\n\t\t}\n\t\t&::-moz-placeholder {\n\t\t\t/* Mozilla Firefox 19+ */\n\t\t\tcolor: rgba(39, 145, 149, 0.5);\n\t\t}\n\t\t&:-ms-input-placeholder {\n\t\t\t/* Internet Explorer 10+ */\n\t\t\tcolor: rgba(39, 145, 149, 0.5);\n\t\t}\n\t}\n}\n\n.gov-area-panel {\n\twidth: 100%;\n\theight: 100%;\n\t/*    min-width: 364px;\n    min-height: 295px;*/\n\tbackground-color: rgba(6, 31, 54, 0.34);\n\t.echart-container {\n\t\theight: 100%;\n\t\t/deep/ .el-loading-spinner {\n\t\t\toverflow: hidden;\n\t\t\t.iconfont {\n\t\t\t\tdisplay: block;\n\t\t\t\tline-height: 60px;\n\t\t\t\tfont-size: 40px;\n\t\t\t\tcolor: #00f6ff;\n\t\t\t\tanimation: loading 1.25s linear infinite;\n\t\t\t\tmargin-top: -5px;\n\t\t\t\tmargin-left: 8px;\n\t\t\t}\n\t\t}\n\t}\n}\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/components/overview/modules/price-trend-6.vue"],"mappings":"AAyBA","sourceRoot":""}