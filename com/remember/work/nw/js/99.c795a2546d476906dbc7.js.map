{"version":3,"file":"static/js/99.c795a2546d476906dbc7.js","sources":["webpack:///src/components/vegetables/MarketSupervision.vue"],"sourcesContent":["<template>\n\t<box-item title=\"价格监测\" position=\"left\" :loading=\"loading\">\n\t\t<div class=\"sub-title\" slot=\"subTitle\">\n\t\t\t<el-select v-model=\"cropId\" placeholder=\"请选择\" slot=\"subTitle\" class=\"vegetable-select\" filterable ref=\"cropSearch\" @change=\"selectCrop\">\n\t\t\t\t<el-option v-for=\"(item, index) in vegetableVariety\" :key=\"index\" :label=\"item.crop\" :value=\"item.cropId\"> </el-option>\n\t\t\t</el-select>\n\t\t</div>\n\n\t\t<!-- 主区域 -->\n\t\t<div class=\"echart-container\" ref=\"EContainer\"></div>\n\t</box-item>\n</template>\n\n<script>\nimport BoxItem from '@/components/common/BoxItem';\nimport {dateFormat, maxDecimalPlaces, areaLevelCorAreaId} from '@/common/fn';\nimport {getStorage} from '@/utils/storage';\n\nconst xData = ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'];\n// echarts 超级变量含义 {a} series.name, {b} data.name {c} data.value {d} data%\nconst lineChartOption = {\n\ttitle: {\n\t\tshow: false,\n\t\ttext: '暂无数据',\n\t\ttextStyle: {\n\t\t\tfontSize: 12,\n\t\t\tcolor: '#6DC1CB'\n\t\t},\n\t\tleft: 'center',\n\t\ttop: 'center'\n\t},\n\tgrid: {\n\t\tshow: true,\n\t\tborderColor: '#0D394A',\n\t\tbottom: 30,\n\t\ttop: 40,\n\t\tright: 20\n\t\t// height: '65%'\n\t},\n\ttooltip: {\n\t\tshow: true,\n\t\ttrigger: 'axis',\n\t\tformatter(series) {\n\t\t\tconst seriesList = series.map(seriesInfo => {\n\t\t\t\treturn `${seriesInfo.seriesName}：${seriesInfo.data !== null ? maxDecimalPlaces({value: seriesInfo.data}) + '元/公斤' : '无'}`;\n\t\t\t});\n\t\t\treturn `${series[0].axisValue}<br/>${seriesList.join('<br />')}`;\n\t\t},\n\t\tbackgroundColor: '#043250',\n\t\tpadding: [13, 14, 13, 11],\n\t\ttextStyle: {\n\t\t\tfontSize: 12,\n\t\t\tcolor: '#9ED2D8'\n\t\t},\n\t\tconfine: true\n\t},\n\tcolor: ['#DC6CFE', '#00E676', '#F6A82B', '#00D7E0'],\n\tlegend: {\n\t\tshow: true,\n\t\ttype: 'plain',\n\t\ttextStyle: {\n\t\t\tcolor: '#6DC1CB',\n\t\t\tfontSize: 12\n\t\t},\n\t\tbackgroundColor: 'rgba(255, 255, 255, 0)',\n\t\ttop: 3,\n\t\tright: 16,\n\t\titemWidth: 6,\n\t\titemHeight: 6,\n\t\titemGap: 14,\n\t\theight: 20,\n\t\ticon: 'circle',\n\t\tborderColor: 'yellow'\n\t\t// data: [\n\t\t//   {\n\t\t//     name: '田头价',\n\t\t//     icon: `image://${require('images/excel-icon-a.png')}`\n\t\t//   },\n\t\t//   {\n\t\t//     name: '批发价',\n\t\t//     icon: `image://${require('images/excel-icon-b.png')}`\n\t\t//   },\n\t\t//   {\n\t\t//     name: '电商价',\n\t\t//     icon: `image://${require('images/excel-icon-c.png')}`\n\t\t//   },\n\t\t//   {\n\t\t//     name: '零售价',\n\t\t//     icon: `image://${require('images/excel-icon-d.png')}`\n\t\t//   }\n\t\t// ]\n\t},\n\txAxis: {\n\t\tdata: xData,\n\t\tboundaryGap: false,\n\t\taxisLabel: {\n\t\t\tformatter(label) {\n\t\t\t\tconst dateFormatReg = /([\\d]*)[年]([\\d]*)[月]([\\d]*)[日]/g;\n\t\t\t\treturn label.replace(dateFormatReg, '$2月$3日');\n\t\t\t},\n\t\t\ttextStyle: {\n\t\t\t\tcolor: '#6DC1CB',\n\t\t\t\tfontSize: 12\n\t\t\t},\n\t\t\talign: 'center'\n\t\t},\n\t\taxisTick: {\n\t\t\tshow: false\n\t\t},\n\t\taxisLine: {\n\t\t\tshow: true,\n\t\t\tlineStyle: {\n\t\t\t\t// color: '#0D394A'\n\t\t\t\tcolor: 'rgba(109,193,203,0.2)'\n\t\t\t}\n\t\t},\n\t\tz: 10\n\t},\n\tyAxis: {\n\t\tname: '(元/公斤)',\n\t\tnameTextStyle: {\n\t\t\tfontSize: 12,\n\t\t\tcolor: '#6DC1CB',\n\t\t\tpadding: [4, 8, 5, 10]\n\t\t},\n\t\taxisLine: {\n\t\t\tshow: false,\n\t\t\tlineStyle: {\n\t\t\t\tcolor: '#0D394A'\n\t\t\t}\n\t\t},\n\t\taxisTick: {\n\t\t\tshow: false\n\t\t},\n\t\tsplitLine: {\n\t\t\tshow: true,\n\t\t\tlineStyle: {\n\t\t\t\t// color: '#0D394A'\n\t\t\t\tcolor: 'rgba(109,193,203,0.2)'\n\t\t\t}\n\t\t},\n\t\taxisLabel: {\n\t\t\ttextStyle: {\n\t\t\t\tcolor: '#6DC1CB',\n\t\t\t\tfontSize: 12\n\t\t\t}\n\t\t}\n\t},\n\tseries: [\n\t\t{\n\t\t\tname: '田头价',\n\t\t\tdata: [],\n\t\t\ttype: 'line',\n\t\t\tsmooth: true,\n\t\t\tsymbolSize: 0,\n\t\t\tconnectNulls: true,\n\t\t\tareaStyle: {\n\t\t\t\tcolor: {\n\t\t\t\t\ttype: 'linear',\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: 0,\n\t\t\t\t\tx2: 0,\n\t\t\t\t\ty2: 1,\n\t\t\t\t\tcolorStops: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\toffset: 0,\n\t\t\t\t\t\t\tcolor: 'rgba(233,128,251, 0.5)' // 0% 处的颜色\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\toffset: 1,\n\t\t\t\t\t\t\tcolor: 'rgba(233,128,251, 0)' // 100% 处的颜色\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\tglobal: false // 缺省为 false\n\t\t\t\t}\n\t\t\t},\n\t\t\tlineStyle: {\n\t\t\t\tcolor: '#DC6CFE'\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\tname: '批发价',\n\t\t\tdata: [],\n\t\t\ttype: 'line',\n\t\t\tsmooth: true,\n\t\t\tsymbolSize: 0,\n\t\t\tconnectNulls: true,\n\t\t\tareaStyle: {\n\t\t\t\tcolor: {\n\t\t\t\t\ttype: 'linear',\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: 0,\n\t\t\t\t\tx2: 0,\n\t\t\t\t\ty2: 1,\n\t\t\t\t\tcolorStops: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\toffset: 0,\n\t\t\t\t\t\t\tcolor: 'rgba(0,230,118, 0.5)' // 0% 处的颜色\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\toffset: 1,\n\t\t\t\t\t\t\tcolor: 'rgba(0,230,118, 0)' // 100% 处的颜色\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\tglobal: false // 缺省为 false\n\t\t\t\t}\n\t\t\t},\n\t\t\tlineStyle: {\n\t\t\t\tcolor: '#00E676'\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\tname: '零售价',\n\t\t\tdata: [],\n\t\t\ttype: 'line',\n\t\t\tsmooth: true,\n\t\t\tsymbolSize: 0,\n\t\t\tconnectNulls: true,\n\t\t\tareaStyle: {\n\t\t\t\tcolor: {\n\t\t\t\t\ttype: 'linear',\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: 0,\n\t\t\t\t\tx2: 0,\n\t\t\t\t\ty2: 1,\n\t\t\t\t\tcolorStops: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\toffset: 0,\n\t\t\t\t\t\t\tcolor: 'rgba(212, 167, 84, 0.5)' // 0% 处的颜色\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\toffset: 1,\n\t\t\t\t\t\t\tcolor: 'rgba(212, 167, 84, 0)' // 100% 处的颜色\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\tglobal: false // 缺省为 false\n\t\t\t\t}\n\t\t\t},\n\t\t\tlineStyle: {\n\t\t\t\tcolor: '#F6A82B'\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\tname: '电商价',\n\t\t\tdata: [],\n\t\t\ttype: 'line',\n\t\t\tsmooth: true,\n\t\t\tsymbolSize: 0,\n\t\t\tconnectNulls: true,\n\t\t\tareaStyle: {\n\t\t\t\tcolor: {\n\t\t\t\t\ttype: 'linear',\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: 0,\n\t\t\t\t\tx2: 0,\n\t\t\t\t\ty2: 1,\n\t\t\t\t\tcolorStops: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\toffset: 0,\n\t\t\t\t\t\t\tcolor: 'rgba(0,162,255, 0.5)' // 0% 处的颜色\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\toffset: 1,\n\t\t\t\t\t\t\tcolor: 'rgba(0,162,255, 0)' // 100% 处的颜色\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\tglobal: false // 缺省为 false\n\t\t\t\t}\n\t\t\t},\n\t\t\tlineStyle: {\n\t\t\t\tcolor: '#00D7E0'\n\t\t\t}\n\t\t}\n\t]\n};\nconst govGovernmentSubjectVO = getStorage('govGovernmentSubjectVO');\nconst vegetableVariety = getStorage('vegetableVariety');\n// 当前年的时间格式 时间戳\nconst yesterdayTimestamp = new Date().setDate(new Date().getDate() - 1);\nconst curDate = dateFormat(yesterdayTimestamp, 'yyyy-MM-dd');\nconst prevDate = dateFormat(\n\tcurDate\n\t\t.split('-')\n\t\t.map((date, i) => {\n\t\t\tlet nDate = Number(date);\n\t\t\tif (i === 0) {\n\t\t\t\tnDate -= 1;\n\t\t\t}\n\t\t\treturn nDate;\n\t\t})\n\t\t.join('/'),\n\t'yyyy-MM-dd'\n);\n\n/*\n * 逻辑\n * 进入（以田头价为例）\n * 获取田头价的作物列表 -- 通过第一个作物获取今年和去年的价格趋势 -- 处理趋势数据渲染到echart\n * 选择\n * 选择作物价格类型 -- 根据价格类型获取相应的作物列表 --- 进入逻辑第二步\n * 选择作物 --- 根据作物id获取去年和今年的价格趋势 -- 处理数据渲染到echart\n *\n * */\nexport default {\n\tname: 'PriceTrend',\n\tprops: {\n\t\tfarmAreaInfo: {\n\t\t\ttype: Object,\n\t\t\tdefault() {\n\t\t\t\treturn areaLevelCorAreaId();\n\t\t\t}\n\t\t}\n\t},\n\tdata() {\n\t\treturn {\n\t\t\t// 价格走势chart\n\t\t\tchart: null,\n\t\t\t// loading\n\t\t\tloading: false,\n\t\t\t// 市场价格类型列表\n\t\t\tpriceTypeList: [\n\t\t\t\t{\n\t\t\t\t\tname: '田头价',\n\t\t\t\t\tid: 0\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: '批发价',\n\t\t\t\t\tid: 1\n\t\t\t\t}\n\t\t\t],\n\t\t\t// 蔬菜品种下拉框\n\t\t\tvegetableVariety: [],\n\t\t\t// 蔬菜品种下拉框默认值\n\t\t\tcropId: null\n\t\t};\n\t},\n\tmounted() {\n\t\tthis.initPage();\n\t},\n\tmethods: {\n\t\t// 获取 田头价作物列表\n\t\tgetTtjCropList() {\n\t\t\treturn this.$ajax\n\t\t\t\t.post(this.$api.operate.ttjCropList, {\n\t\t\t\t\tpageNo: 1,\n\t\t\t\t\tpageSize: 10000\n\t\t\t\t})\n\t\t\t\t.then(({data: res}) => {\n\t\t\t\t\tif (res.respCode === 0) {\n\t\t\t\t\t\treturn res.obj;\n\t\t\t\t\t}\n\t\t\t\t\tthrow new Error(res);\n\t\t\t\t})\n\t\t\t\t.catch(e => {\n\t\t\t\t\tconsole.log(e);\n\t\t\t\t\tthrow e;\n\t\t\t\t});\n\t\t},\n\t\t// 获取 田头价|批发价|电商价|零售价的价格趋势\n\t\tgetCropPriceStatisticListWithAllPriceType() {\n\t\t\treturn this.$ajax\n\t\t\t\t.post(this.$api.operate.cropPriceStatisticListWithAllPriceType, {\n\t\t\t\t\tprovinceId: govGovernmentSubjectVO.provinceId,\n\t\t\t\t\tcropId: this.cropId,\n\t\t\t\t\tstartDateStr: prevDate, // 开始时间[包含这一天] 格式:yyyy-MM-dd\n\t\t\t\t\tendDateStr: curDate, // 结束时间[包含这一天],格式:yyyy-MM-dd\n\t\t\t\t\tstatisticType: 1 // 统计类型：1日、2周、3月、4年\n\t\t\t\t})\n\t\t\t\t.then(({data: res}) => {\n\t\t\t\t\tif (res.respCode === 0) {\n\t\t\t\t\t\treturn res.obj;\n\t\t\t\t\t}\n\t\t\t\t\tthrow new Error(res);\n\t\t\t\t})\n\t\t\t\t.catch(e => {\n\t\t\t\t\tthrow e;\n\t\t\t\t});\n\t\t},\n\n\t\t// 处理 田头价作物列表\n\t\tasync processTtjCropList() {\n\t\t\ttry {\n\t\t\t\tconst res = await this.getTtjCropList();\n\t\t\t\tthis.vegetableVariety = res.list.map(item => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tcrop: item.cropName,\n\t\t\t\t\t\tcropId: item.id\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t\tthis.cropId = this.vegetableVariety[0].cropId;\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log(e);\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t},\n\t\t// 处理 价格趋势数据\n\t\tasync processCropPriceStatisticListWithAllPriceType() {\n\t\t\ttry {\n\t\t\t\tconst cropPriceStatisticList = await this.getCropPriceStatisticListWithAllPriceType();\n\t\t\t\tfor (let i = cropPriceStatisticList.length - 1; i >= 0; i--) {\n\t\t\t\t\tconst priceInfo = cropPriceStatisticList[i];\n\t\t\t\t\tconst flag = priceInfo.ebusinessAveragePrice !== null || priceInfo.lotAveragePrice !== null || priceInfo.retailAveragePrice !== null || priceInfo.ttjAveragePrice !== null;\n\t\t\t\t\tif (flag) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcropPriceStatisticList.pop();\n\t\t\t\t}\n\t\t\t\treturn cropPriceStatisticList;\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log(e);\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t},\n\t\tasync updateChart() {\n\t\t\ttry {\n\t\t\t\tconst priceList = await this.processCropPriceStatisticListWithAllPriceType();\n\t\t\t\t// const xData = priceList.map(priceInfo => priceInfo.statisticDate);\n\t\t\t\tconst splitPriceList = priceList.reduce(\n\t\t\t\t\t(acc, priceInfo) => {\n\t\t\t\t\t\tacc[0].push(priceInfo.statisticDate);\n\t\t\t\t\t\tacc[1].push(priceInfo.ttjAveragePrice);\n\t\t\t\t\t\tacc[2].push(priceInfo.lotAveragePrice);\n\t\t\t\t\t\tacc[3].push(priceInfo.retailAveragePrice);\n\t\t\t\t\t\tacc[4].push(priceInfo.ebusinessAveragePrice);\n\t\t\t\t\t\treturn acc;\n\t\t\t\t\t},\n\t\t\t\t\t[\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\t/*xAxis*/\n\t\t\t\t\t\t],\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\t/*田头价*/\n\t\t\t\t\t\t],\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\t/*批发价*/\n\t\t\t\t\t\t],\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\t/*零售价*/\n\t\t\t\t\t\t],\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\t/*电商价*/\n\t\t\t\t\t\t]\n\t\t\t\t\t]\n\t\t\t\t);\n\t\t\t\t// console.log(splitPriceList);\n\t\t\t\tthis.chart.setOption({\n\t\t\t\t\txAxis: {\n\t\t\t\t\t\tdata: splitPriceList[0]\n\t\t\t\t\t},\n\t\t\t\t\tseries: [{data: splitPriceList[1]}, {data: splitPriceList[2]}, {data: splitPriceList[3]}, {data: splitPriceList[4]}]\n\t\t\t\t});\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log(e);\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t},\n\n\t\t// 页面初始化\n\t\tasync initPage() {\n\t\t\tthis.chart = this._initEcharts(this.eContainerRef, lineChartOption);\n\t\t\tawait this.updateCropList();\n\t\t\tthis.updateCropPrice();\n\t\t},\n\n\t\t// 更新作物价格趋势\n\t\tasync updateCropPrice() {\n\t\t\tthis.loading = true;\n\t\t\tawait this.updateChart();\n\t\t\tthis.loading = false;\n\t\t},\n\n\t\t// 更新作物列表\n\t\tasync updateCropList() {\n\t\t\tthis.vegetableVariety = [];\n\t\t\tawait this.processTtjCropList();\n\t\t},\n\n\t\t// 选择作物\n\t\tselectCrop() {\n\t\t\tthis.chart.setOption({\n\t\t\t\tseries: [\n\t\t\t\t\t{\n\t\t\t\t\t\tdata: []\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tdata: []\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tdata: []\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tdata: []\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t});\n\t\t\tthis.updateCropPrice();\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.$refs.cropSearch.blur();\n\t\t\t});\n\t\t},\n\n\t\t// 检测是否需要重新加载作物数据\n\t\tcheckCropReload() {\n\t\t\tlet cropTime = getStorage('cropTime');\n\t\t\tif (!cropTime) return true;\n\t\t\tcropTime = Number(cropTime);\n\t\t\tconst updateMonth = new Date(cropTime).getMonth();\n\t\t\tconst updateTime = new Date(cropTime).setMonth(updateMonth + 1, 1);\n\t\t\tconst curEarlyMonth = new Date().getTime();\n\t\t\treturn updateTime >= curEarlyMonth;\n\t\t},\n\n\t\t_initEcharts(el, option) {\n\t\t\tconst chart = this.$echarts.init(el);\n\t\t\tchart.setOption(option);\n\t\t\treturn chart;\n\t\t},\n\t\trefreshRender() {\n\t\t\tif (this.chart) {\n\t\t\t\tthis.chart.resize();\n\t\t\t}\n\t\t}\n\t},\n\tcomputed: {\n\t\teContainerRef() {\n\t\t\treturn this.$refs.EContainer;\n\t\t}\n\t},\n\tcomponents: {\n\t\tBoxItem\n\t}\n};\n</script>\n\n<style scoped lang=\"scss\">\n@import '~styles/selectSkin_default.scss';\n/deep/ .el-select {\n\t.el-input__inner {\n\t\twidth: 92px;\n\t\theight: 30px;\n\t\twhite-space: nowrap;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\tpadding: 0 25px 0 10px;\n\t\t.el-input__suffix {\n\t\t\tright: 0;\n\t\t}\n\t\t&::-webkit-input-placeholder {\n\t\t\tcolor: rgba(39, 145, 149, 0.5);\n\t\t}\n\t\t&:-moz-placeholder {\n\t\t\t/* Mozilla Firefox 4 to 18 */\n\t\t\tcolor: rgba(39, 145, 149, 0.5);\n\t\t}\n\t\t&::-moz-placeholder {\n\t\t\t/* Mozilla Firefox 19+ */\n\t\t\tcolor: rgba(39, 145, 149, 0.5);\n\t\t}\n\t\t&:-ms-input-placeholder {\n\t\t\t/* Internet Explorer 10+ */\n\t\t\tcolor: rgba(39, 145, 149, 0.5);\n\t\t}\n\t}\n\t+ .el-select {\n\t\tmargin-left: 2px;\n\t}\n}\n\n.sub-title {\n\tposition: absolute;\n\ttop: 50%;\n\ttransform: translateY(-75%);\n\tright: 8px;\n}\n.echart-container {\n\theight: 100%;\n\twidth: 100%;\n}\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/components/vegetables/MarketSupervision.vue"],"mappings":"AAkBA","sourceRoot":""}