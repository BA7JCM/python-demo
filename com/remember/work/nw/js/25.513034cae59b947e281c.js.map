{"version":3,"file":"static/js/25.513034cae59b947e281c.js","sources":["webpack:///src/components/overview/modules/market-supervision-20.vue"],"sourcesContent":["<template>\r\n\t<div class=\"market-supervision-20\" v-loading=\"loading\" element-loading-spinner=\"iconfont icon-loading1\" element-loading-background=\"rgba(0, 0, 0, 0.2)\">\r\n\t\t<area-panel area-title=\"田头价格监测\" titleLeft>\r\n\t\t\t<div class=\"sub-title\" slot=\"subTitle\">\r\n\t\t\t\t<el-select v-model=\"priceType\" placeholder=\"请选择\" slot=\"subTitle\" class=\"vegetable-select\" filterable ref=\"priceType\" @change=\"selectPriceType\">\r\n\t\t\t\t\t<el-option v-for=\"(item, index) in priceTypeList\" :key=\"index\" :label=\"item.name\" :value=\"item.id\"> </el-option>\r\n\t\t\t\t</el-select>\r\n\t\t\t\t<el-select v-model=\"cropId\" placeholder=\"请选择\" slot=\"subTitle\" class=\"vegetable-select two\" filterable ref=\"cropSearch\" @change=\"selectCrop\">\r\n\t\t\t\t\t<el-option v-for=\"(item, index) in vegetableVariety\" :key=\"index\" :label=\"item.crop\" :value=\"item.cropId\"> </el-option>\r\n\t\t\t\t</el-select>\r\n\t\t\t</div>\r\n\t\t\t<div v-show=\"!loading\" class=\"main-panel\" slot=\"panelMain\">\r\n\t\t\t\t<!-- 主区域 -->\r\n\t\t\t\t<div class=\"echart-container\" ref=\"EContainer\"></div>\r\n\t\t\t</div>\r\n\t\t</area-panel>\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\nimport areaPanel from '@/components/overview/area-panel';\r\nimport {dateFormat, getIntervalTime, maxDecimalPlaces, areaLevelCorAreaId} from '@/common/fn';\r\nimport {setStorage, getStorage} from '@/utils/storage';\r\n\r\nconst xData = ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'];\r\n// echarts 超级变量含义 {a} series.name, {b} data.name {c} data.value {d} data%\r\nconst lineChartOption = {\r\n\ttitle: {\r\n\t\tshow: false,\r\n\t\ttext: '暂无数据',\r\n\t\ttextStyle: {\r\n\t\t\tfontSize: 12,\r\n\t\t\tcolor: '#6DC1CB',\r\n\t\t},\r\n\t\tleft: 'center',\r\n\t\ttop: 'center',\r\n\t},\r\n\tgrid: {\r\n\t\tshow: true,\r\n\t\tborderColor: '#0D394A',\r\n\t\tbottom: 30,\r\n\t\ttop: 40,\r\n\t\tright: 20,\r\n\t\t// height: '65%'\r\n\t},\r\n\ttooltip: {\r\n\t\tshow: true,\r\n\t\ttrigger: 'axis',\r\n\t\tformatter(value) {\r\n\t\t\tconst s = value.map(item => {\r\n\t\t\t\treturn item.value !== null ? `${item.seriesName}：${maxDecimalPlaces({value: item.value})}元/公斤` : '';\r\n\t\t\t});\r\n\t\t\treturn `${value[0].axisValue}<br/>${s.join('<br />')}`;\r\n\t\t},\r\n\t\tbackgroundColor: '#043250',\r\n\t\tpadding: [13, 14, 13, 11],\r\n\t\ttextStyle: {\r\n\t\t\tfontSize: 12,\r\n\t\t\tcolor: '#9ED2D8',\r\n\t\t},\r\n\t},\r\n\tlegend: {\r\n\t\tshow: true,\r\n\t\ttype: 'plain',\r\n\t\ttextStyle: {\r\n\t\t\tcolor: '#6DC1CB',\r\n\t\t\tfontSize: 12,\r\n\t\t},\r\n\t\tbackgroundColor: 'rgba(255, 255, 255, 0)',\r\n\t\ttop: 3,\r\n\t\tright: 10,\r\n\t\titemWidth: 30,\r\n\t\titemHeight: 10,\r\n\t\theight: 20,\r\n\t\tdata: [\r\n\t\t\t{\r\n\t\t\t\tname: `${new Date().getFullYear() - 1}年`,\r\n\t\t\t\ticon: `image://${require('images/prevYears.png')}`,\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tname: `${new Date().getFullYear()}年`,\r\n\t\t\t\ticon: `image://${require('images/curYears.png')}`,\r\n\t\t\t},\r\n\t\t],\r\n\t},\r\n\txAxis: {\r\n\t\tdata: xData,\r\n\t\tboundaryGap: false,\r\n\t\taxisLabel: {\r\n\t\t\ttextStyle: {\r\n\t\t\t\tcolor: '#6DC1CB',\r\n\t\t\t\tfontSize: 12,\r\n\t\t\t},\r\n\t\t\talign: 'center',\r\n\t\t},\r\n\t\taxisTick: {\r\n\t\t\tshow: false,\r\n\t\t},\r\n\t\taxisLine: {\r\n\t\t\tshow: true,\r\n\t\t\tlineStyle: {\r\n\t\t\t\t// color: '#0D394A'\r\n\t\t\t\tcolor: 'rgba(109,193,203,0.2)',\r\n\t\t\t},\r\n\t\t},\r\n\t\tz: 10,\r\n\t},\r\n\tyAxis: {\r\n\t\tname: '(元/公斤)',\r\n\t\tnameTextStyle: {\r\n\t\t\tfontSize: 12,\r\n\t\t\tcolor: '#6DC1CB',\r\n\t\t\tpadding: [4, 8, 5, 10],\r\n\t\t},\r\n\t\taxisLine: {\r\n\t\t\tshow: false,\r\n\t\t\tlineStyle: {\r\n\t\t\t\tcolor: '#0D394A',\r\n\t\t\t},\r\n\t\t},\r\n\t\taxisTick: {\r\n\t\t\tshow: false,\r\n\t\t},\r\n\t\tsplitLine: {\r\n\t\t\tshow: true,\r\n\t\t\tlineStyle: {\r\n\t\t\t\t// color: '#0D394A'\r\n\t\t\t\tcolor: 'rgba(109,193,203,0.2)',\r\n\t\t\t},\r\n\t\t},\r\n\t\taxisLabel: {\r\n\t\t\ttextStyle: {\r\n\t\t\t\tcolor: '#6DC1CB',\r\n\t\t\t\tfontSize: 12,\r\n\t\t\t},\r\n\t\t},\r\n\t},\r\n\tseries: [\r\n\t\t{\r\n\t\t\tdata: [],\r\n\t\t\ttype: 'line',\r\n\t\t\tsmooth: true,\r\n\t\t\tsymbolSize: 0,\r\n\t\t\tareaStyle: {\r\n\t\t\t\tcolor: {\r\n\t\t\t\t\ttype: 'linear',\r\n\t\t\t\t\tx: 0,\r\n\t\t\t\t\ty: 0,\r\n\t\t\t\t\tx2: 0,\r\n\t\t\t\t\ty2: 1,\r\n\t\t\t\t\tcolorStops: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\toffset: 0,\r\n\t\t\t\t\t\t\tcolor: 'rgba(0, 162, 255, 0.5)', // 0% 处的颜色\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\toffset: 1,\r\n\t\t\t\t\t\t\tcolor: 'rgba(60, 105, 217, 0)', // 100% 处的颜色\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t],\r\n\t\t\t\t\tglobal: false, // 缺省为 false\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\tlineStyle: {\r\n\t\t\t\tcolor: '#00FFFF',\r\n\t\t\t},\r\n\t\t},\r\n\t\t{\r\n\t\t\tdata: [],\r\n\t\t\ttype: 'line',\r\n\t\t\tsmooth: true,\r\n\t\t\tsymbolSize: 0,\r\n\t\t\tareaStyle: {\r\n\t\t\t\tcolor: {\r\n\t\t\t\t\ttype: 'linear',\r\n\t\t\t\t\tx: 0,\r\n\t\t\t\t\ty: 0,\r\n\t\t\t\t\tx2: 0,\r\n\t\t\t\t\ty2: 1,\r\n\t\t\t\t\tcolorStops: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\toffset: 0,\r\n\t\t\t\t\t\t\tcolor: 'rgba(212, 167, 84, 0.5)', // 0% 处的颜色\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\toffset: 1,\r\n\t\t\t\t\t\t\tcolor: 'rgba(212, 167, 84, 0)', // 100% 处的颜色\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t],\r\n\t\t\t\t\tglobal: false, // 缺省为 false\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\tlineStyle: {\r\n\t\t\t\tcolor: '#D4A452',\r\n\t\t\t},\r\n\t\t},\r\n\t],\r\n};\r\nconst govGovernmentSubjectVO = getStorage('govGovernmentSubjectVO');\r\nconst vegetableVariety = getStorage('vegetableVariety');\r\n\r\nexport default {\r\n\tname: 'market-supervision-20',\r\n\tprops: {\r\n\t\tfarmAreaInfo: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn areaLevelCorAreaId();\r\n\t\t\t},\r\n\t\t},\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\t// 价格走势chart\r\n\t\t\tchart: null,\r\n\t\t\t// loading\r\n\t\t\tloading: false,\r\n\t\t\t// 市场类型\r\n\t\t\tpriceType: 0,\r\n\t\t\t// 市场价格类型列表\r\n\t\t\tpriceTypeList: [\r\n\t\t\t\t{\r\n\t\t\t\t\tname: '田头价',\r\n\t\t\t\t\tid: 0,\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tname: '批发价',\r\n\t\t\t\t\tid: 1,\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\t// 蔬菜品种下拉框\r\n\t\t\tvegetableVariety: [],\r\n\t\t\t// 蔬菜品种下拉框默认值\r\n\t\t\tcropId: null,\r\n\t\t};\r\n\t},\r\n\tmounted() {\r\n\t\tthis.initPage();\r\n\t},\r\n\tmethods: {\r\n\t\t// 页面初始化\r\n\t\tasync initPage() {\r\n\t\t\tthis.chart = this._initEcharts(this.eContainerRef, lineChartOption);\r\n\t\t\tawait this.updateCropList();\r\n\t\t\tthis.updateCropPrice();\r\n\t\t},\r\n\r\n\t\t// 更新作物列表\r\n\t\tasync updateCropList() {\r\n\t\t\tthis.vegetableVariety = [];\r\n\t\t\tif (this.priceType) {\r\n\t\t\t\tawait this.processDefaultCropList();\r\n\t\t\t} else {\r\n\t\t\t\tawait this.processTtjCropList();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t// 更新作物价格趋势\r\n\t\tasync updateCropPrice() {\r\n\t\t\tthis.loading = true;\r\n\t\t\tif (this.priceType) {\r\n\t\t\t\tawait this.getCropPriceTable();\r\n\t\t\t} else {\r\n\t\t\t\tawait this.processTtPrice();\r\n\t\t\t}\r\n\t\t\tthis.loading = false;\r\n\t\t},\r\n\r\n\t\t// 获取 田头价作物列表\r\n\t\tgetTtjCropList() {\r\n\t\t\treturn this.$ajax\r\n\t\t\t\t.post(this.$api.operate.ttjCropList, {\r\n\t\t\t\t\tpageNo: 1,\r\n\t\t\t\t\tpageSize: 10000,\r\n\t\t\t\t})\r\n\t\t\t\t.then(({data: res}) => {\r\n\t\t\t\t\tif (res.respCode === 0) {\r\n\t\t\t\t\t\treturn res.obj;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthrow new Error(res);\r\n\t\t\t\t})\r\n\t\t\t\t.catch(e => {\r\n\t\t\t\t\tconsole.log(e);\r\n\t\t\t\t\tthrow e;\r\n\t\t\t\t});\r\n\t\t},\r\n\t\t// 获取 批发价作物列表\r\n\t\tgetDefaultCropList() {\r\n\t\t\treturn this.$ajax\r\n\t\t\t\t.post(this.$api.market.cropList, {\r\n\t\t\t\t\tareaId: govGovernmentSubjectVO.provinceId,\r\n\t\t\t\t\tkeyword: '',\r\n\t\t\t\t\tpageNo: 1,\r\n\t\t\t\t\tpageSize: 10000,\r\n\t\t\t\t})\r\n\t\t\t\t.then(({data: res}) => {\r\n\t\t\t\t\tif (res.respCode === 0) {\r\n\t\t\t\t\t\tsetStorage('cropTime', res.curDate);\r\n\t\t\t\t\t\treturn res.obj;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthrow new Error(res);\r\n\t\t\t\t})\r\n\t\t\t\t.catch(e => {\r\n\t\t\t\t\tconsole.log(e);\r\n\t\t\t\t\tthrow e;\r\n\t\t\t\t});\r\n\t\t},\r\n\t\t// 获取 田头价格走势\r\n\t\tgetCropPriceStatisticList() {\r\n\t\t\treturn this.$ajax\r\n\t\t\t\t.post(this.$api.operate.cropPriceStatisticList, {\r\n\t\t\t\t\tyearsList: [`${new Date().getFullYear()}`, `${new Date().getFullYear() - 1}`],\r\n\t\t\t\t\tcropId: this.cropId,\r\n\t\t\t\t\t// 省id\r\n\t\t\t\t\tprovinceId: govGovernmentSubjectVO.provinceId,\r\n\t\t\t\t})\r\n\t\t\t\t.then(({data: res}) => {\r\n\t\t\t\t\tif (res.respCode === 0) {\r\n\t\t\t\t\t\treturn res.obj;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthrow new Error(res);\r\n\t\t\t\t})\r\n\t\t\t\t.catch(e => {\r\n\t\t\t\t\tconsole.log(e);\r\n\t\t\t\t\tthrow e;\r\n\t\t\t\t});\r\n\t\t},\r\n\r\n\t\t// 获取作物价格走势 2020-01-02 10:22:11\r\n\t\tasync getCropPriceTable() {\r\n\t\t\t// 今年的时间\r\n\t\t\tconst curYear = new Date().getFullYear();\r\n\t\t\tconst curMonth = new Date().getMonth();\r\n\t\t\tconst curYearList = getIntervalTime({\r\n\t\t\t\tstartTime: `${curYear}-01-01`,\r\n\t\t\t\thowMonth: curMonth,\r\n\t\t\t});\r\n\t\t\t// 去年的时间\r\n\t\t\tconst prevYear = curYear - 1;\r\n\t\t\tconst prevYearList = getIntervalTime({\r\n\t\t\t\tstartTime: `${prevYear}-01-01`,\r\n\t\t\t});\r\n\r\n\t\t\t// 两条并发\r\n\t\t\treturn this.$ajax\r\n\t\t\t\t.all([\r\n\t\t\t\t\tthis.$ajax.post(this.$api.market.cropPrice, {\r\n\t\t\t\t\t\tdateListStr: curYearList,\r\n\t\t\t\t\t\tnccropId: this.cropId,\r\n\t\t\t\t\t\tproviceId: govGovernmentSubjectVO.provinceId,\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tthis.$ajax.post(this.$api.market.cropPrice, {\r\n\t\t\t\t\t\tdateListStr: prevYearList,\r\n\t\t\t\t\t\tnccropId: this.cropId,\r\n\t\t\t\t\t\tproviceId: govGovernmentSubjectVO.provinceId,\r\n\t\t\t\t\t}),\r\n\t\t\t\t])\r\n\t\t\t\t.then(acct => {\r\n\t\t\t\t\tif (acct) {\r\n\t\t\t\t\t\tconst curRes = acct[0].data;\r\n\t\t\t\t\t\tconst prevRes = acct[1].data;\r\n\t\t\t\t\t\tlet curTotal = 0;\r\n\t\t\t\t\t\tlet prevTotal = 0;\r\n\r\n\t\t\t\t\t\tcurRes.respCode === 0 &&\r\n\t\t\t\t\t\t\tcurRes.obj.forEach(item => {\r\n\t\t\t\t\t\t\t\tcurTotal += item.price;\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tprevRes.respCode === 0 &&\r\n\t\t\t\t\t\t\tprevRes.obj.forEach(item => {\r\n\t\t\t\t\t\t\t\tprevTotal += item.price;\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t// 是否有数据\r\n\t\t\t\t\t\tconst ownDataFlag = curTotal !== 0 || prevTotal !== 0;\r\n\r\n\t\t\t\t\t\tthis.chart.setOption({\r\n\t\t\t\t\t\t\ttooltip: {\r\n\t\t\t\t\t\t\t\tshow: ownDataFlag,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\ttitle: {\r\n\t\t\t\t\t\t\t\tshow: !ownDataFlag,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tyAxis: {\r\n\t\t\t\t\t\t\t\tshow: true, // !ownDataFlag\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\txAxis: {\r\n\t\t\t\t\t\t\t\tshow: ownDataFlag,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tseries: ownDataFlag\r\n\t\t\t\t\t\t\t\t? [\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tname: dateFormat(`${prevYear}-01-01`, 'yyyy年'),\r\n\t\t\t\t\t\t\t\t\t\t\tdata: (() => {\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn prevRes.respCode === 0\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t? prevRes.obj.map(item => ({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tname: item.ncCropName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvalue: item.price,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t  }))\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t: [];\r\n\t\t\t\t\t\t\t\t\t\t\t})(),\r\n\t\t\t\t\t\t\t\t\t\t\tsymbol: 'circle',\r\n\t\t\t\t\t\t\t\t\t\t\tsymbolSize: 2,\r\n\t\t\t\t\t\t\t\t\t\t\tcolor: '#00F6FF',\r\n\t\t\t\t\t\t\t\t\t\t\t// showAllSymbol: true\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tname: dateFormat(`${curYear}-01-01`, 'yyyy年'),\r\n\t\t\t\t\t\t\t\t\t\t\tdata: (() => {\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn curRes.respCode === 0\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t? curRes.obj.map(item => ({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tname: item.ncCropName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvalue: item.price,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t  }))\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t: [];\r\n\t\t\t\t\t\t\t\t\t\t\t})(),\r\n\t\t\t\t\t\t\t\t\t\t\tsymbol: 'circle',\r\n\t\t\t\t\t\t\t\t\t\t\tsymbolSize: 2,\r\n\t\t\t\t\t\t\t\t\t\t\tcolor: '#FBC02D',\r\n\t\t\t\t\t\t\t\t\t\t\t// showAllSymbol: true\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t  ]\r\n\t\t\t\t\t\t\t\t: [\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tdata: [],\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tdata: [],\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t  ],\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t},\r\n\r\n\t\t// 处理 批发价作物列表\r\n\t\tasync processDefaultCropList() {\r\n\t\t\tawait new Promise((resolve, reject) => {\r\n\t\t\t\tif (this.checkCropReload() && vegetableVariety && vegetableVariety.length) {\r\n\t\t\t\t\tthis.vegetableVariety = vegetableVariety.map(item => {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tcrop: item.ncCropName,\r\n\t\t\t\t\t\t\tcropId: item.id,\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t});\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tthis.cropId = vegetableVariety[0].id;\r\n\t\t\t\t\t\treturn resolve();\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\tconsole.log(e);\r\n\t\t\t\t\t\treject(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.getDefaultCropList()\r\n\t\t\t\t\t\t.then(res => {\r\n\t\t\t\t\t\t\tsetStorage('vegetableVariety', res.list);\r\n\t\t\t\t\t\t\tthis.vegetableVariety = res.list.map(item => {\r\n\t\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t\tcrop: item.ncCropName,\r\n\t\t\t\t\t\t\t\t\tcropId: item.id,\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\tthis.cropId = this.vegetableVariety[0].cropId;\r\n\t\t\t\t\t\t\t\treturn resolve();\r\n\t\t\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t\t\tthrow new Error(e);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.catch(e => {\r\n\t\t\t\t\t\t\tconsole.log(e);\r\n\t\t\t\t\t\t\treject(e);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 处理 田头价作物列表\r\n\t\tasync processTtjCropList() {\r\n\t\t\ttry {\r\n\t\t\t\tconst res = await this.getTtjCropList();\r\n\t\t\t\tthis.vegetableVariety = res.list.map(item => {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tcrop: item.cropName,\r\n\t\t\t\t\t\tcropId: item.id,\r\n\t\t\t\t\t};\r\n\t\t\t\t});\r\n\t\t\t\tthis.cropId = this.vegetableVariety[0].cropId;\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.log(e);\r\n\t\t\t\tthrow e;\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 处理 田头价格趋势\r\n\t\tasync processTtPrice() {\r\n\t\t\tconst res = await this.getCropPriceStatisticList();\r\n\t\t\tlet curRes = res[0].data.slice(0, 12);\r\n\t\t\tlet prevRes = res[1].data.slice(0, 12);\r\n\t\t\tconst curTotal = curRes.reduce((total, value) => {\r\n\t\t\t\treturn total + value;\r\n\t\t\t}, 0);\r\n\t\t\tconst prevTotal = prevRes.reduce((total, value) => {\r\n\t\t\t\treturn total + value;\r\n\t\t\t}, 0);\r\n\r\n\t\t\tconst curYear = new Date().getFullYear();\r\n\t\t\t// 去年的时间\r\n\t\t\tconst prevYear = curYear - 1;\r\n\r\n\t\t\t// 是否有数据\r\n\t\t\tconst ownDataFlag = curTotal !== 0 || prevTotal !== 0;\r\n\r\n\t\t\tthis.chart.setOption({\r\n\t\t\t\ttooltip: {\r\n\t\t\t\t\tshow: ownDataFlag,\r\n\t\t\t\t},\r\n\t\t\t\ttitle: {\r\n\t\t\t\t\tshow: !ownDataFlag,\r\n\t\t\t\t},\r\n\t\t\t\tyAxis: {\r\n\t\t\t\t\tshow: true, // !ownDataFlag\r\n\t\t\t\t},\r\n\t\t\t\txAxis: {\r\n\t\t\t\t\tshow: ownDataFlag,\r\n\t\t\t\t},\r\n\t\t\t\tseries: ownDataFlag\r\n\t\t\t\t\t? [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tname: dateFormat(`${prevYear}-01-01`, 'yyyy年'),\r\n\t\t\t\t\t\t\t\tdata: (() => {\r\n\t\t\t\t\t\t\t\t\treturn prevRes.map((value, index) => ({\r\n\t\t\t\t\t\t\t\t\t\tname: `${index + 1}月`,\r\n\t\t\t\t\t\t\t\t\t\tvalue,\r\n\t\t\t\t\t\t\t\t\t}));\r\n\t\t\t\t\t\t\t\t})(),\r\n\t\t\t\t\t\t\t\tsymbol: 'circle',\r\n\t\t\t\t\t\t\t\tsymbolSize: 2,\r\n\t\t\t\t\t\t\t\tcolor: '#00F6FF',\r\n\t\t\t\t\t\t\t\t// showAllSymbol: true\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcurRes.length\r\n\t\t\t\t\t\t\t\t? {\r\n\t\t\t\t\t\t\t\t\t\tname: dateFormat(`${curYear}-01-01`, 'yyyy年'),\r\n\t\t\t\t\t\t\t\t\t\tdata: (() => {\r\n\t\t\t\t\t\t\t\t\t\t\treturn curRes.map((value, index) => ({\r\n\t\t\t\t\t\t\t\t\t\t\t\tname: `${index + 1}月`,\r\n\t\t\t\t\t\t\t\t\t\t\t\tvalue,\r\n\t\t\t\t\t\t\t\t\t\t\t}));\r\n\t\t\t\t\t\t\t\t\t\t})(),\r\n\t\t\t\t\t\t\t\t\t\tsymbol: 'circle',\r\n\t\t\t\t\t\t\t\t\t\tsymbolSize: 2,\r\n\t\t\t\t\t\t\t\t\t\tcolor: '#FBC02D',\r\n\t\t\t\t\t\t\t\t\t\t// showAllSymbol: true\r\n\t\t\t\t\t\t\t\t  }\r\n\t\t\t\t\t\t\t\t: {\r\n\t\t\t\t\t\t\t\t\t\tdata: [],\r\n\t\t\t\t\t\t\t\t  },,\r\n\t\t\t\t\t  ]\r\n\t\t\t\t\t: [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tdata: [],\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tdata: [],\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t  ],\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t// 选择作物\r\n\t\tselectCrop() {\r\n\t\t\tthis.chart.setOption({\r\n\t\t\t\tseries: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tdata: [],\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tdata: [],\r\n\t\t\t\t\t},\r\n\t\t\t\t],\r\n\t\t\t});\r\n\t\t\tthis.updateCropPrice();\r\n\t\t\tthis.$nextTick(() => {\r\n\t\t\t\tthis.$refs.cropSearch.blur();\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t// 选择价格类型\r\n\t\tasync selectPriceType() {\r\n\t\t\tawait this.updateCropList();\r\n\t\t\tthis.chart.setOption({\r\n\t\t\t\tseries: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tdata: [],\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tdata: [],\r\n\t\t\t\t\t},\r\n\t\t\t\t],\r\n\t\t\t});\r\n\t\t\tthis.updateCropPrice();\r\n\t\t\tthis.$nextTick(() => {\r\n\t\t\t\tthis.$refs.priceType.blur();\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t// 检测是否需要重新加载作物数据\r\n\t\tcheckCropReload() {\r\n\t\t\tlet cropTime = getStorage('cropTime');\r\n\t\t\tif (!cropTime) return true;\r\n\t\t\tcropTime = Number(cropTime);\r\n\t\t\tconst updateMonth = new Date(cropTime).getMonth();\r\n\t\t\tconst updateTime = new Date(cropTime).setMonth(updateMonth + 1, 1);\r\n\t\t\tconst curEarlyMonth = new Date().getTime();\r\n\t\t\treturn updateTime >= curEarlyMonth;\r\n\t\t},\r\n\r\n\t\t_initEcharts(el, option) {\r\n\t\t\tconst chart = this.$echarts.init(el);\r\n\t\t\tchart.setOption(option);\r\n\t\t\treturn chart;\r\n\t\t},\r\n\r\n\t\trefreshRender() {\r\n\t\t\tif (this.chart) {\r\n\t\t\t\tthis.chart.resize();\r\n\t\t\t}\r\n\t\t},\r\n\t},\r\n\tcomputed: {\r\n\t\teContainerRef() {\r\n\t\t\treturn this.$refs.EContainer;\r\n\t\t},\r\n\t},\r\n\tcomponents: {\r\n\t\tareaPanel,\r\n\t},\r\n};\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n@import '~styles/selectSkin_default.scss';\r\n.market-supervision-20 {\r\n\twidth: 100%;\r\n\theight: 100%;\r\n\t/deep/ .el-select {\r\n\t\t.el-input__inner {\r\n\t\t\twidth: 93px;\r\n\t\t\theight: 30px;\r\n\t\t\twhite-space: nowrap;\r\n\t\t\toverflow: hidden;\r\n\t\t\ttext-overflow: ellipsis;\r\n\t\t\tpadding: 0 25px 0 10px;\r\n\t\t\t.el-input__suffix {\r\n\t\t\t\tright: 0;\r\n\t\t\t}\r\n\t\t\t&::-webkit-input-placeholder {\r\n\t\t\t\tcolor: rgba(39, 145, 149, 0.5);\r\n\t\t\t}\r\n\t\t\t&:-moz-placeholder {\r\n\t\t\t\t/* Mozilla Firefox 4 to 18 */\r\n\t\t\t\tcolor: rgba(39, 145, 149, 0.5);\r\n\t\t\t}\r\n\t\t\t&::-moz-placeholder {\r\n\t\t\t\t/* Mozilla Firefox 19+ */\r\n\t\t\t\tcolor: rgba(39, 145, 149, 0.5);\r\n\t\t\t}\r\n\t\t\t&:-ms-input-placeholder {\r\n\t\t\t\t/* Internet Explorer 10+ */\r\n\t\t\t\tcolor: rgba(39, 145, 149, 0.5);\r\n\t\t\t}\r\n\t\t}\r\n\t\t+ .el-select {\r\n\t\t\tmargin-left: 2px;\r\n\t\t}\r\n\t}\r\n\t.main-panel {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t}\r\n\r\n\t.sub-title {\r\n\t\tposition: absolute;\r\n\t\tright: 15px;\r\n\t}\r\n\t.echart-container {\r\n\t\theight: 100%;\r\n\t\twidth: 100%;\r\n\t}\r\n}\r\n\r\n/deep/ .el-loading-spinner {\r\n\toverflow: hidden;\r\n\t.iconfont {\r\n\t\tdisplay: block;\r\n\t\tfont-size: 40px;\r\n\t\tcolor: #00f6ff;\r\n\t\tanimation: loading 1.25s linear infinite;\r\n\t\tmargin-top: 24px;\r\n\t\tmargin-left: 8px;\r\n\t}\r\n}\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/components/overview/modules/market-supervision-20.vue"],"mappings":"AAwBA","sourceRoot":""}