{"version":3,"file":"static/js/144.06582e94eb8670e3f8cc.js","sources":["webpack:///src/components/common/video.vue"],"sourcesContent":["<template>\n\t<div class=\"custom-video-player\" v-loading=\"loading\" element-loading-background=\"rgba(0, 0, 0, 0)\">\n\t\t<div class=\"video\" :id=\"videoId\"></div>\n\t\t<div class=\"noInitPlayer\" :class=\"{active: showInitplayer}\" v-if=\"!autoplay\" @mouseover=\"showInitplayer = true\" @mouseleave=\"showInitplayer = false\" @click=\"(autoplay = true), initPlayer()\">\n\t\t\t<div class=\"playbtn\">\n\t\t\t\t<div class=\"vcp-playtoggle\"></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</template>\n\n<script>\nimport videoPic from '@/assets/images/video/video-poster.png';\nexport default {\n\tprops: {\n\t\t// 视频播放器的标识符，确定渲染的位置\n\t\tvideoId: {\n\t\t\ttype: String,\n\t\t\tdefault: 'video'\n\t\t},\n\t\tvideoQuality: {\n\t\t\ttype: Object,\n\t\t\tdefault: () => {\n\t\t\t\treturn {};\n\t\t\t}\n\t\t},\n\t\tautoplay: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true\n\t\t}\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tplayer: null,\n\t\t\tloading: false,\n\t\t\tshowInitplayer: false\n\t\t};\n\t},\n\tmounted() {\n\t\tif (this.autoplay) {\n\t\t\tthis.initPlayer();\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.player.paused() && this.player.play();\n\t\t\t}, 2000);\n\t\t}\n\t},\n\tmethods: {\n\t\tinitPlayer() {\n\t\t\tconst hlsUrl = this.videoQuality.hlsUrl ? this.videoQuality.hlsUrl : null;\n\t\t\tconst hlsUrlHd = this.videoQuality.hlsUrlHd ? this.videoQuality.hlsUrlHd : null;\n\t\t\tlet url = hlsUrl || hlsUrlHd;\n\n\t\t\tconst that = this;\n\t\t\t// eslint-disable-next-line no-undef\n\t\t\tthis.player = new TcPlayer(this.videoId, {\n\t\t\t\tm3u8: url,\n\t\t\t\twidth: '100%', // 视频的显示宽度，请尽量使用视频分辨率宽度\n\t\t\t\theight: '100%',\n\t\t\t\tlive: true,\n\t\t\t\tautoplay: that.autoplay,\n\t\t\t\tflash: false,\n\t\t\t\tpreload: 'none',\n\t\t\t\tposter: {\n\t\t\t\t\tstyle: 'stretch',\n\t\t\t\t\tsrc: videoPic\n\t\t\t\t},\n\t\t\t\twording: {\n\t\t\t\t\t2032: '请求视频失败，请检查网络',\n\t\t\t\t\t2048: '请求m3u8文件失败，可能是网络错误或者跨域问题'\n\t\t\t\t},\n\t\t\t\tlistener(msg) {\n\t\t\t\t\tif (msg.type === 'load') {\n\t\t\t\t\t\tthat.loading = true;\n\t\t\t\t\t}\n\t\t\t\t\tif (msg.type === 'playing' || msg.type === 'error' || msg.type === 'progress') {\n\t\t\t\t\t\tthat.loading = false;\n\t\t\t\t\t}\n\t\t\t\t\tif (msg.type === 'pause') {\n\t\t\t\t\t\tthat.player && that.player.hls && that.player.hls.stopLoad(); // 这里的this是TcPlayer里的实例，不是vue的实例\n\t\t\t\t\t}\n\t\t\t\t\tif (msg.type === 'play') {\n\t\t\t\t\t\tthat.player && that.player.hls && that.player.hls.startLoad();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (that.player && !that.player.initreflashbtn) {\n\t\t\t\t\t\t// 初始化\n\t\t\t\t\t\tthat.player.initreflashbtn = true;\n\t\t\t\t\t\t// 新增刷新按钮\n\t\t\t\t\t\tconst resflashobj = document.createElement('div');\n\t\t\t\t\t\tresflashobj.className = 'vcp-reflashbtn';\n\t\t\t\t\t\tresflashobj.addEventListener('click', function() {\n\t\t\t\t\t\t\t// console.log('手动重新loading');\n\t\t\t\t\t\t\tthat.player && that.player.video && that.player.video.hls && that.player.video.hls.stopLoad();\n\n\t\t\t\t\t\t\tclearTimeout(that.player.timer_errordoing);\n\t\t\t\t\t\t\tthat.player.load(url);\n\t\t\t\t\t\t\tthat.player && that.player.video && that.player.video.play();\n\t\t\t\t\t\t});\n\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\tmsg.src.player.el.querySelector('.vcp-controls-panel').appendChild(resflashobj);\n\t\t\t\t\t\t}, 600);\n\n\t\t\t\t\t\t// 新增切换流畅度按钮\n\t\t\t\t\t\tconst switchLoadBtn = document.createElement('div');\n\t\t\t\t\t\tlet textContent = hlsUrl ? '流畅' : '高清';\n\t\t\t\t\t\tswitchLoadBtn.setAttribute('class', 'switch-load-btn');\n\t\t\t\t\t\tswitchLoadBtn.innerText = textContent;\n\t\t\t\t\t\tswitchLoadBtn.addEventListener('click', () => {\n\t\t\t\t\t\t\tswitch (textContent) {\n\t\t\t\t\t\t\t\tcase '流畅':\n\t\t\t\t\t\t\t\t\tif (!hlsUrlHd) {\n\t\t\t\t\t\t\t\t\t\tthat.$message({\n\t\t\t\t\t\t\t\t\t\t\ttype: 'warning',\n\t\t\t\t\t\t\t\t\t\t\tmessage: '当前视频仅支持流畅播放',\n\t\t\t\t\t\t\t\t\t\t\tcenter: true\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tthat.player.load(hlsUrlHd);\n\t\t\t\t\t\t\t\t\turl = hlsUrlHd;\n\t\t\t\t\t\t\t\t\ttextContent = '高清';\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase '高清':\n\t\t\t\t\t\t\t\t\tif (!hlsUrl) {\n\t\t\t\t\t\t\t\t\t\tthat.$message({\n\t\t\t\t\t\t\t\t\t\t\ttype: 'warning',\n\t\t\t\t\t\t\t\t\t\t\tmessage: '当前视频仅支持高清播放',\n\t\t\t\t\t\t\t\t\t\t\tcenter: true\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tthat.player.load(hlsUrl);\n\t\t\t\t\t\t\t\t\turl = hlsUrl;\n\t\t\t\t\t\t\t\t\ttextContent = '流畅';\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthat.$message({\n\t\t\t\t\t\t\t\ttype: 'success',\n\t\t\t\t\t\t\t\tmessage: `已切换至${textContent}播放`,\n\t\t\t\t\t\t\t\tcenter: true\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tswitchLoadBtn.innerText = textContent;\n\t\t\t\t\t\t\tthat.player && that.player.video && that.player.video.play();\n\t\t\t\t\t\t});\n\t\t\t\t\t\thlsUrl !== hlsUrlHd && msg.src.player.el.querySelector('.vcp-controls-panel').appendChild(switchLoadBtn);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (!window.palyers) {\n\t\t\t\twindow.palyers = [];\n\t\t\t}\n\t\t\twindow.palyers.push(this.player);\n\t\t}\n\t}\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.custom-video-player {\n\twidth: 100%;\n\theight: 100%;\n\tbackground: url('~@/assets/images/video/video-poster.png') center no-repeat;\n\tbackground-size: 100%;\n\t.video {\n\t\twidth: 100%;\n\t\theight: 100%;\n\t}\n\t.noInitPlayer {\n\t\twidth: 100%;\n\t\theight: 100%;\n\t\tposition: absolute;\n\t\ttop: 0;\n\t\toverflow: hidden;\n\t\t-webkit-transition: opacity 0.3s;\n\t\ttransition: opacity 0.3s;\n\t\tcursor: pointer;\n\t\t.playbtn {\n\t\t\twidth: 100%;\n\t\t\theight: 32px;\n\t\t\tposition: absolute;\n\t\t\tleft: 0;\n\t\t\tbottom: -33px;\n\t\t\tbackground-color: #242424;\n\t\t\topacity: 0.8;\n\t\t\tfilter: alpha(opacity=80);\n\t\t\tz-index: 1000;\n\t\t\t.vcp-playtoggle {\n\t\t\t\twidth: 32px;\n\t\t\t\tbackground-image: url(/static/img/video-play-icon.9d7098b.png);\n\t\t\t\tbackground-size: 40% !important;\n\t\t\t\tbackground-repeat: no-repeat;\n\t\t\t\tbackground-position: center;\n\t\t\t}\n\t\t}\n\t\t&.active {\n\t\t\t.playbtn {\n\t\t\t\tbottom: -1px;\n\t\t\t}\n\t\t}\n\t}\n}\n</style>\n\n<style lang=\"scss\">\n.custom-video-player .video .el-loading-mask {\n\tbackground-color: transparent;\n}\n.custom-video-player .video .vcp-player {\n\tvideo {\n\t\tobject-fit: fill;\n\t}\n\t.vcp-poster {\n\t\twidth: calc(100% + 1px);\n\t\theight: calc(100% + 1px);\n\t\tz-index: 1000;\n\t}\n\n\t.vcp-controls-panel {\n\t\topacity: 0;\n\t\ttransition: opacity 0.3s;\n\t\theight: 2em;\n\t\tbottom: -1px;\n\t\t&.show {\n\t\t\tanimation: unset;\n\t\t}\n\t\t.vcp-volume {\n\t\t\tdisplay: none;\n\t\t}\n\t\t.vcp-playtoggle {\n\t\t\twidth: 2.5em;\n\t\t\tbackground-image: url('~@/assets/images/video/video-play-icon.png');\n\t\t\tbackground-size: 40% !important;\n\t\t\tbackground-repeat: no-repeat;\n\t\t\tbackground-position: center;\n\t\t}\n\t\t.vcp-fullscreen-toggle {\n\t\t\twidth: 2em;\n\t\t\theight: 2em;\n\t\t\tbackground: url('~@/assets/images/video/video-full-icon.png') no-repeat center center;\n\t\t\tbackground-size: 50%;\n\t\t}\n\n\t\t.vcp-reflashbtn {\n\t\t\tcursor: pointer;\n\t\t\tposition: relative;\n\t\t\tz-index: 1001;\n\t\t\twidth: 2.5em;\n\t\t\theight: 2em;\n\t\t\tfloat: left;\n\t\t\tbackground-repeat: no-repeat;\n\t\t\tbackground-position: center;\n\t\t\tbackground-size: 45%;\n\t\t\tbackground-image: url('~@/assets/images/video/video-refresh.png');\n\t\t}\n\n\t\t/* 视频按钮切换样式 */\n\t\t.switch-load-btn {\n\t\t\twidth: 50px;\n\t\t\theight: 24px;\n\t\t\tbackground-color: rgba(0, 0, 0, 0.6);\n\t\t\t-webkit-border-radius: 12px;\n\t\t\t-moz-border-radius: 12px;\n\t\t\tborder-radius: 12px;\n\t\t\tcolor: #fff;\n\t\t\tfont-size: 12px;\n\t\t\ttext-align: center;\n\t\t\tline-height: 24px;\n\t\t\tposition: absolute;\n\t\t\ttop: 50%;\n\t\t\ttransform: translateY(-50%);\n\t\t\tz-index: 1001;\n\t\t\tright: 40px;\n\t\t\tuser-select: none;\n\t\t\tcursor: pointer;\n\t\t}\n\t}\n\n\t.vcp-timelabel {\n\t\tdisplay: none;\n\t}\n\t&.vcp-playing {\n\t\t.vcp-controls-panel {\n\t\t\t.vcp-playtoggle {\n\t\t\t\tbackground-image: url('~@/assets/images/video/video-pause-icon.png');\n\t\t\t}\n\t\t}\n\t}\n\t&.vcp-fullscreen {\n\t\t.vcp-fullscreen-toggle {\n\t\t\tbackground-image: url('~@/assets/images/video/video-scale-icon.png');\n\t\t\tbackground-size: 50%;\n\t\t}\n\t}\n\t&:hover {\n\t\t.vcp-controls-panel {\n\t\t\topacity: 1;\n\t\t}\n\t}\n}\n\n.custom-video-player .video .vcp-playtoggle:hover,\n.custom-video-player .video .vcp-reflashbtn:hover {\n\tbackground-color: rgba(0, 0, 0, 0.6);\n}\n.custom-video-player .video .vcp-video {\n\tposition: relative;\n\tz-index: 1001;\n}\n\n.custom-video-player .video .vcp-loading {\n\tdisplay: none !important;\n}\n\n.custom-video-player .el-loading-spinner .path {\n\tstroke: #ccfcfe;\n}\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/components/common/video.vue"],"mappings":"AAaA","sourceRoot":""}