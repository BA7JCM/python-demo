webpackJsonp([95],{XvyD:function(e,t){},ay2i:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("+Yef"),i=a("VCTt");function n(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,a){return function r(i,n){try{var s=t[i](n),o=s.value}catch(e){return void a(e)}if(!s.done)return Promise.resolve(o).then(function(e){r("next",e)},function(e){r("throw",e)});e(o)}("next")})}}var s=Object(i.b)(),o={name:"scene",data:function(){return{map:null,tabs:void 0,selectedGis:0,oldLayers:null,oldImageLayers:null,serverTime:null}},created:function(){},mounted:function(){var e=this;this.$nextTick(n(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getCenter();case 2:return t.next=4,e.setTabs();case 4:case"end":return t.stop()}},t,e)})))},methods:{getCenter:function(){var e=this;return n(regeneratorRuntime.mark(function t(){var a,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(i.g)({areaId:r.a[s.farmAreaId]||s.farmAreaId});case 2:a=t.sent,n=a.areaNode._data.geoData.parent.properties.center,e.map=e._initMap({el:e.$refs.sceneMap,center:[n[1],n[0]]}),e.drawPolygon({districtExplorer:a.districtExplorer,areaNode:a.areaNode,map:e.map});case 6:case"end":return t.stop()}},t,e)}))()},_initMap:function(e){var t=e.el,a=e.center,r=L.tileLayer.chinaProvider("TianDiTu.Realm.Map",{id:"layer_line",detectRetina:!1,zIndex:5,maxZoom:21,minZoom:5}),i=L.tileLayer.chinaProvider("Google.Satellite.Map",{id:"layer_google",detectRetina:!1,zIndex:3,maxZoom:21,minZoom:5}),n=(L.tileLayer.chinaProvider("Google.Satellite.Annotion",{id:"layer_google",detectRetina:!1,zIndex:3,maxZoom:21,minZoom:5}),L.tileLayer.chinaProvider("TianDiTu.Satellite.Map",{id:"layer_tiandi",detectRetina:!1,zIndex:2,maxZoom:18,minZoom:5})),s=L.tileLayer.chinaProvider("GaoDe.Normal.Map",{id:"layer_gaodeLabel",detectRetina:!1,zIndex:1,maxZoom:18,minZoom:5});return L.map(t,{center:a,zoom:7,layers:[r,i,n,s],zoomControl:!1,attributionControl:!1,dragging:!0,touchZoom:!1,scrollWheelZoom:!0,doubleClickZoom:!0,boxZoom:!1,tap:!1,keyboard:!0,maxZoom:21,minZoom:5})},drawPolygon:function(e){e.districtExplorer;var t=e.areaNode,a=e.map;L.geoJSON(t.getParentFeature(),{style:function(){return{color:"#FFFF33",fillColor:"#009cba",fillOpacity:0,fillRule:"evenodd",className:"polygonbox",lineJoin:"miter",weight:3}}}).addTo(a)},getGisList:function(){var e=this;return n(regeneratorRuntime.mark(function t(){var a,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.post(e.$api.scene.govGisTypeList,{});case 2:if(a=t.sent,0!==(r=a.data).respCode){t.next=7;break}return e.serverTime=r.curDate,t.abrupt("return",r.obj);case 7:return t.abrupt("return",!1);case 8:case"end":return t.stop()}},t,e)}))()},setTabs:function(){var e=this;return n(regeneratorRuntime.mark(function t(){var a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getGisList();case 2:a=t.sent,e.tabs=a.map(function(e){return{id:e.id,legendPic:e.imgUrl,typeIcon:e.typeIcon,typeName:e.typeName,gisPics:e.typeImgVOS}}),e.handleSwitchGis(0);case 5:case"end":return t.stop()}},t,e)}))()},handleSwitchGis:function(e){try{var t=this.tabs[e].gisPics[0].gisImgUrl,a=this.tabs[e].gisPics[0].pngImgUrl,r=void 0,i=void 0,n=void 0;t?(r=L.tileLayer.wms(t.match(/(http[s]?:\/\/)[a-zA-Z0-9./_:-]*(?=\?)/)[0],{layers:decodeURIComponent(t.match(/(layers=)([a-zA-Z0-9%_-]*)(&)/)[2]),format:"image/png",transparent:!0,crs:L.CRS.EPSG4326,maxZoom:20,minZoom:5,zIndex:10}),i=L.layerGroup(),this.oldImageLayers&&(this.oldImageLayers.remove(),this.oldImageLayers=null),this.oldLayers&&this.oldLayers.remove(),i.addLayer(r),this.oldLayers=r):(n=this.tabs[e].gisPics[0].imgPath.split(",").map(Number),i=L.imageOverlay(a,[[n[3],n[2]],[n[1],n[0]]],{opacity:1,maxZoom:20,minZoom:5,zIndex:10,pane:"tilePane"}),this.oldImageLayers&&this.oldImageLayers.remove(),this.oldLayers&&(this.oldLayers.remove(),this.oldLayers=null),this.oldImageLayers=i),i.addTo(this.map),this.selectedGis=e}catch(e){console.warn("数据配置不正确",e)}}},computed:{getUpdateGisTime:function(){var e=new Date(this.serverTime).getMinutes(),t=this.tabs[this.selectedGis],a=new Date(this.serverTime).setMinutes(10*parseInt(e/10));return t.gisPics[0]&&(a=t.gisPics[0].gisDataUpdateTime||a),a},showUpdateTime:function(){return this.tabs&&this.tabs[this.selectedGis].gisPics.length>0},showLegendPic:function(){return this.tabs&&this.tabs[this.selectedGis].legendPic}}},c=a("W5g0");var l=function(e){a("XvyD")},m=Object(c.a)(o,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"title",rawName:"v-title"}],staticClass:"map-container",attrs:{"data-title":"气象监测"}},[a("div",{ref:"sceneMap",staticClass:"scene-map"}),e._v(" "),e.tabs?a("ul",{staticClass:"map-tabs"},e._l(e.tabs,function(t,r){return a("li",{key:t.id,staticClass:"tab",class:{select:r===e.selectedGis},on:{click:function(t){return e.handleSwitchGis(r)}}},[a("img",{staticClass:"type-icon",attrs:{src:t.typeIcon,alt:t.typeName+"图标"}}),e._v(" "),a("span",[e._v(e._s(t.typeName))])])}),0):e._e(),e._v(" "),e.showUpdateTime?a("p",{staticClass:"update-time"},[e._v(e._s(e._f("znDateFormat")(e.getUpdateGisTime,"yyyy.MM.dd hh:mm"))+"更新")]):e._e(),e._v(" "),e.showLegendPic?a("img",{staticClass:"legend",attrs:{src:e.tabs[e.selectedGis].legendPic,alt:e.tabs[e.selectedGis].typeName+"图例"}}):e._e()])},[],!1,l,"data-v-a2e5d9c8",null);t.default=m.exports}});
//# sourceMappingURL=95.87e9f93128b897dca2cb.js.map