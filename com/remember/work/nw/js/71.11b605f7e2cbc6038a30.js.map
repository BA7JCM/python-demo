{"version":3,"file":"static/js/71.11b605f7e2cbc6038a30.js","sources":["webpack:///src/pages/envMonitoring/videoDetail.vue"],"sourcesContent":["<template>\n\t<div class=\"video-detail\" v-title data-title=\"环境监控\">\n\t\t<!-- <RemoteJs src=\"//imgcache.qq.com/open/qcloud/video/vcplayer/TcPlayer-2.3.2.js\"></RemoteJs> -->\n\t\t<div class=\"nav-box\">\n\t\t\t<Nav @search=\"searchCamera\" @back=\"back\">\n\t\t\t\t<template slot=\"center\">\n\t\t\t\t\t<Dropdown\n\t\t\t\t\t\tref=\"drop\"\n\t\t\t\t\t\t:title=\"title\"\n\t\t\t\t\t\t:data=\"farmList\"\n\t\t\t\t\t\t:current=\"current\"\n\t\t\t\t\t\t@select=\"select\"\n\t\t\t\t\t\t@search=\"search\"\n\t\t\t\t\t\t@scrollToEnd=\"scrollToEnd\"\n\t\t\t\t\t\t@onchange=\"onchange\"\n\t\t\t\t\t\t:loading=\"loading\"\n\t\t\t\t\t></Dropdown>\n\t\t\t\t</template>\n\t\t\t</Nav>\n\t\t</div>\n\n\t\t<template v-if=\"!noSearch\">\n\t\t\t<template v-if=\"!noData\">\n\t\t\t\t<template v-if=\"!globalLoding\">\n\t\t\t\t\t<div class=\"video-main\" ref=\"scroll\">\n\t\t\t\t\t\t<div class=\"scroll\">\n\t\t\t\t\t\t\t<div style=\"height: 40px\">\n\t\t\t\t\t\t\t\t<!-- 解决顶部设置padding-top值被滚动抵消问题 -->\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div v-for=\"(item, index) in getVideoList\" :key=\"index\" class=\"video-list\">\n\t\t\t\t\t\t\t\t<div v-for=\"(ele, i) in item\" :key=\"i\" class=\"video-item\">\n\t\t\t\t\t\t\t\t\t<div v-if=\"ele.displayName\" class=\"video-box\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"video-title\">\n\t\t\t\t\t\t\t\t\t\t\t<span>{{ ele.displayName }}</span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"box\">\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"content\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Video :video-id=\"'video' + ele.id\" :autoplay=\"ele.autoplay ? ele.autoplay : false\" :video-quality=\"ele\"></Video>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<div class=\"global-loading\" v-else>\n\t\t\t\t\t<Loading :show=\"globalLoding\" type=\"element\"></Loading>\n\t\t\t\t</div>\n\t\t\t</template>\n\n\t\t\t<div class=\"no-data\" v-else>\n\t\t\t\t<img src=\"@/assets/images/env-monitoring/bg-no-data.png\" />\n\t\t\t\t<span>该农场尚未接入摄像头</span>\n\t\t\t</div>\n\t\t</template>\n\t\t<div class=\"no-data\" v-else>\n\t\t\t<img src=\"@/assets/images/env-monitoring/bg-no-data.png\" />\n\t\t\t<span>无搜索结果</span>\n\t\t</div>\n\t</div>\n</template>\n\n<script>\nimport Nav from '@/components/common/nav.vue';\nimport Dropdown from '@/components/common/dropdown.vue';\n// import RemoteJs from '@/components/common/remote-js.vue'\nimport Video from '@/components/common/video.vue';\nimport Loading from '@/components/common/loading.vue';\n\nimport {arrTrans, getAreaId} from '@/utils/utils.js';\nimport {_initBScroll} from '@/common/fn';\nimport {getStorage} from '@/utils/storage';\nimport destroyVideos from '@/common/fn/destroyVideos';\n\nexport default {\n\tdata() {\n\t\treturn {\n\t\t\tfarmList: [],\n\t\t\tcurrent: 0,\n\t\t\ttitle: '',\n\t\t\tloading: false,\n\t\t\tvideoList: [],\n\t\t\ttempVideoList: [],\n\t\t\tbsScroll: null,\n\t\t\tglobalLoding: false,\n\t\t\tnoData: false,\n\t\t\tnoSearch: false,\n\t\t\tfarmTotal: 0,\n\t\t\tfarmPageNo: 1,\n\t\t\tfarmPageSize: 100,\n\t\t\ttempFarmSearchList: [],\n\t\t\tkeyword: ''\n\t\t};\n\t},\n\tcomputed: {\n\t\tgetVideoList() {\n\t\t\tlet temp = [];\n\t\t\tconst colNum = 4;\n\t\t\tif (this.videoList.length) {\n\t\t\t\ttemp = arrTrans(colNum, this.videoList);\n\t\t\t\t// 用于布局，当二维数组最后一个元素长度不够布局，向里面添加空元素，达到布局时占位\n\t\t\t\tif (temp[temp.length - 1].length < colNum) {\n\t\t\t\t\tconst length = colNum - temp[temp.length - 1].length;\n\t\t\t\t\tfor (let i = 0; i < length; i++) {\n\t\t\t\t\t\ttemp[temp.length - 1].push({});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn temp;\n\t\t}\n\t},\n\tasync mounted() {\n\t\tthis.current = parseInt(this.$route.params.baseid);\n\t\tthis.title = this.$route.query.farmName;\n\t\tthis.getVideoListData(this.$route.params.baseid);\n\t\tthis.getFarmList();\n\n\t\t// 解决缩放滚动条长存的问题\n\t\twindow.addEventListener('resize', () => {\n\t\t\tif (this.bsScroll) {\n\t\t\t\tthis.bsScroll.refresh();\n\t\t\t}\n\t\t});\n\t},\n\tmethods: {\n\t\tback() {\n\t\t\tthis.$router.go(-1);\n\t\t},\n\t\tselect(item) {\n\t\t\tthis.title = item.farmName;\n\t\t\tthis.current = item.farmId;\n\t\t\tthis.$router.replace({path: `/videoDetail/${item.farmId}?farmName=${item.farmName}`});\n\t\t\tthis.getVideoListData(item.farmId);\n\t\t},\n\t\tsearch(keyword) {\n\t\t\tthis.loading = true;\n\t\t\tthis.keyword = keyword;\n\t\t\tthis.farmPageNo = 1;\n\t\t\tthis.getFarmList();\n\t\t},\n\t\tasync onchange(keyword) {\n\t\t\tthis.loading = true;\n\t\t\tthis.keyword = keyword;\n\t\t\tthis.farmPageNo = 1;\n\n\t\t\tthis.loading = true;\n\t\t\tconst res = await this.getFarmListData();\n\n\t\t\tif (res.respCode === 0) {\n\t\t\t\tif (this.keyword !== keyword) return;\n\n\t\t\t\tthis.farmList = res.obj.list.filter(ele => ele.totalCount !== 0);\n\t\t\t\tthis.loading = false;\n\t\t\t\tthis.farmTotal = res.obj.totalCount;\n\t\t\t}\n\t\t},\n\t\tsearchCamera(value) {\n\t\t\tthis.globalLoding = true;\n\t\t\tthis.noSearch = false;\n\t\t\t// 没有搜索词，默认搜索全部\n\t\t\tif (!value) {\n\t\t\t\tthis.videoList = this.tempVideoList;\n\n\t\t\t\t// 解决搜索摄像头时，dom未删除导致video已经初始化而一直存在于页面的问题\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.globalLoding = false;\n\t\t\t\t}, 100);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst data = this.fuzzyQuery(this.tempVideoList, value);\n\t\t\tdata.forEach((ele, index) => {\n\t\t\t\tif (index < 8) {\n\t\t\t\t\tele.autoplay = true;\n\t\t\t\t} else {\n\t\t\t\t\tele.autoplay = false;\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.videoList = data;\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.globalLoding = false;\n\n\t\t\t\tif (!this.videoList.length && this.tempVideoList.length) {\n\t\t\t\t\tthis.noSearch = true;\n\t\t\t\t}\n\t\t\t}, 100);\n\t\t},\n\t\t// 模糊查询\n\t\tfuzzyQuery(list, keyWord) {\n\t\t\tconst temp = list.concat();\n\t\t\tvar arr = [];\n\t\t\tfor (var i = 0; i < temp.length; i++) {\n\t\t\t\tif (temp[i].displayName.indexOf(keyWord) >= 0) {\n\t\t\t\t\tarr.push(temp[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn arr;\n\t\t},\n\t\t// 实现无限滚动\n\t\tasync scrollToEnd() {\n\t\t\tconst pages = Math.ceil(this.farmTotal / this.farmPageSize);\n\t\t\tif (this.farmTotal > this.farmPageSize) {\n\t\t\t\tif (this.farmPageNo >= pages) return;\n\n\t\t\t\tthis.farmPageNo++;\n\n\t\t\t\tconst res = await this.getFarmListData();\n\n\t\t\t\tif (res.respCode === 0) {\n\t\t\t\t\tres.obj.list.forEach(ele => {\n\t\t\t\t\t\tif (ele.totalCount === 0) return;\n\t\t\t\t\t\tthis.farmList.push(ele);\n\t\t\t\t\t});\n\t\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\t\tthis.$refs.drop.refresh();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tasync getVideoListData(farmId) {\n\t\t\tthis.globalLoding = true;\n\t\t\tthis.noData = false;\n\t\t\tconst res = await this.$ajax.post(this.$api.farmDetail.getIotAll, {\n\t\t\t\tfarmId: farmId\n\t\t\t});\n\t\t\tif (res.data.respCode === 0) {\n\t\t\t\t// this.destroyVideos();\n\t\t\t\tdestroyVideos();\n\t\t\t\t// 只自动播放前八个摄像头\n\t\t\t\tres.data.obj.cameraList.forEach((ele, index) => {\n\t\t\t\t\tif (index < 8) {\n\t\t\t\t\t\tele.autoplay = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tele.autoplay = false;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.videoList = res.data.obj.cameraList;\n\t\t\t\t// 缓存video列表，用于搜索\n\t\t\t\tthis.tempVideoList = res.data.obj.cameraList;\n\t\t\t\tthis.globalLoding = false;\n\t\t\t\tif (this.videoList.length === 0) {\n\t\t\t\t\tthis.noData = true;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tasync getFarmList() {\n\t\t\tthis.loading = true;\n\t\t\tconst res = await this.getFarmListData();\n\t\t\tif (res.respCode === 0) {\n\t\t\t\tthis.farmList = res.obj.list.filter(ele => ele.totalCount !== 0);\n\t\t\t\tthis.loading = false;\n\t\t\t\tthis.farmTotal = res.obj.totalCount;\n\t\t\t}\n\t\t},\n\t\tgetFarmListData() {\n\t\t\tconst areaId = getAreaId();\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tthis.$ajax\n\t\t\t\t\t.post(this.$api.operators.listByAreaAndZaiotKeyNotNull, {\n\t\t\t\t\t\tfarmAreaId: [areaId.farmId],\n\t\t\t\t\t\tfarmAreaType: areaId.level,\n\t\t\t\t\t\tkeyword: this.keyword ? this.keyword : null,\n\t\t\t\t\t\tpageNo: this.farmPageNo,\n\t\t\t\t\t\tpageSize: this.farmPageSize\n\t\t\t\t\t})\n\t\t\t\t\t.then(res => {\n\t\t\t\t\t\tresolve(res.data);\n\t\t\t\t\t})\n\t\t\t\t\t.catch(err => {\n\t\t\t\t\t\treject(err);\n\t\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tdestroyVideos() {\n\t\t\tif (!window.palyers) return;\n\t\t\twindow.palyers.map(player => {\n\t\t\t\tplayer.failure = true;\n\t\t\t}); // 标记前面的视频对象 为销毁对象\n\t\t\tsetTimeout(destroyVideo, 2000);\n\t\t\tsetTimeout(destroyVideo, 5000);\n\t\t\tsetTimeout(destroyVideo, 8000);\n\t\t\tsetTimeout(() => {\n\t\t\t\tdestroyVideo(), clearVideo();\n\t\t\t}, 15000);\n\t\t\tfunction destroyVideo() {\n\t\t\t\tif (!window.palyers.length) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\twindow.palyers.map(player => {\n\t\t\t\t\tplayer && player.failure && player.video && player.video.hls && player.video.hls.stopLoad();\n\t\t\t\t});\n\t\t\t}\n\t\t\tfunction clearVideo() {\n\t\t\t\twindow.palyers = window.palyers.filter(player => {\n\t\t\t\t\tif (player && player.failure) {\n\t\t\t\t\t\tplayer = null;\n\t\t\t\t\t}\n\t\t\t\t\tif (player && !player.failure) {\n\t\t\t\t\t\treturn player;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n\tdestroyed() {\n\t\twindow.removeEventListener('resize', () => {});\n\t\t// this.destroyVideos();\n\t\tdestroyVideos();\n\t},\n\twatch: {\n\t\tglobalLoding(newVal) {\n\t\t\tif (!newVal) {\n\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\t// 滚动dom被删除，重新初始化滚动\n\t\t\t\t\tif (this.bsScroll && this.$refs.scroll) {\n\t\t\t\t\t\tthis.bsScroll.destroy();\n\t\t\t\t\t\tthis.bsScroll = _initBScroll(this.$refs.scroll);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tvideoList() {\n\t\t\tthis.noData = false;\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tif (!this.bsScroll && this.$refs.scroll) {\n\t\t\t\t\t\tthis.bsScroll = _initBScroll(this.$refs.scroll);\n\t\t\t\t\t}\n\t\t\t\t\tif (this.videoList.length === 0) {\n\t\t\t\t\t\tthis.noData = true;\n\t\t\t\t\t}\n\t\t\t\t}, 200);\n\t\t\t});\n\t\t}\n\t},\n\tcomponents: {\n\t\tNav,\n\t\tDropdown,\n\t\t// RemoteJs,\n\t\tVideo,\n\t\tLoading\n\t}\n};\n</script>\n\n<style scoped lang=\"scss\">\n@import '~styles/scrollbarSkin_default';\n\n.video-detail {\n\tdisplay: flex;\n\tflex-direction: column;\n\theight: 100vh;\n\tmin-width: 1366px;\n\tbox-sizing: border-box;\n\tbackground-color: #021220;\n\n\t.global-loading {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\theight: 100%;\n\t}\n\n\t.video-main {\n\t\toverflow: hidden;\n\t\theight: 100%;\n\t\t// padding-top: 40px;\n\t}\n\n\t.video-list {\n\t\tdisplay: flex;\n\t\tpadding: 0 45px 30px;\n\n\t\t.video-item {\n\t\t\tflex: 1;\n\t\t\tpadding-right: 20px;\n\n\t\t\t&:last-child {\n\t\t\t\tpadding-right: 0;\n\t\t\t}\n\n\t\t\t.video-title {\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tjustify-content: center;\n\t\t\t\theight: 40px;\n\t\t\t\tborder-left: 1px solid #134662;\n\t\t\t\tborder-top: 1px solid #134662;\n\t\t\t\tborder-right: 1px solid #134662;\n\n\t\t\t\tspan {\n\t\t\t\t\tcolor: #00e5ff;\n\t\t\t\t\tfont-size: 14px;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/* box 用来控制宽度 */\n\t\t\t.box {\n\t\t\t\twidth: 100%;\n\t\t\t\tpadding-bottom: 56.25%;\n\t\t\t\theight: 0;\n\t\t\t\tposition: relative;\n\t\t\t}\n\t\t\t/* item 用来放置全部的子元素 */\n\t\t\t.content {\n\t\t\t\tposition: absolute;\n\t\t\t\twidth: 100%;\n\t\t\t\theight: 100%;\n\t\t\t}\n\t\t}\n\t}\n\n\t.no-data {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\theight: 100%;\n\n\t\tspan {\n\t\t\tmargin-top: 30px;\n\t\t\tfont-size: 16px;\n\t\t\tcolor: #00e5ff;\n\t\t}\n\t}\n}\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/pages/envMonitoring/videoDetail.vue"],"mappings":"AA2EA","sourceRoot":""}