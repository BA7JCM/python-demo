webpackJsonp([49,113,131],{"+sNG":function(t,e){t.exports="https://snkoudai.oss-cn-hangzhou.aliyuncs.com/goverment/static/img/sensor2_on.39d0fe9.png"},"0e/S":function(t,e){t.exports="https://snkoudai.oss-cn-hangzhou.aliyuncs.com/goverment/static/img/weather_top.8afb8ae.gif"},"1do9":function(t,e){},"24oI":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n("VCTt"),i=n("cmJz"),r=n("c65A"),o=n("o2Qu"),s=n("FVyf"),l=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],a=!0,i=!1,r=void 0;try{for(var o,s=t[Symbol.iterator]();!(a=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);a=!0);}catch(t){i=!0,r=t}finally{try{!a&&s.return&&s.return()}finally{if(i)throw r}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function c(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,n){return function a(i,r){try{var o=e[i](r),s=o.value}catch(t){return void n(t)}if(!o.done)return Promise.resolve(s).then(function(t){a("next",t)},function(t){a("throw",t)});t(s)}("next")})}}var d=["#F0C87B","#A6D889","#DD90CB","#9173FE","#4DCBFF","#1DE9B6","#ca8622","#bda29a","#6e7074","#546570","#c4ccd3"],u=["一月","二月","三月","四月","五月","六月"],p=[220,182,191,234,290,330],m=u.map(function(t,e){return{name:t,value:p[e],itemStyle:{color:d[e]}}}),f={tooltip:{show:!0,trigger:"item",textStyle:{fontSize:12,color:"#ffffff"}},title:{text:"近半年销售额",textStyle:{color:"#02E4EE",fontSize:16,fontWeight:"bold"},subtextStyle:{color:"#6DC1CB",fontSize:12,fontWeight:400},left:"center",padding:[17,0,0,0],itemGap:10,textVerticalAlign:"top"},grid:{show:!0,top:66,right:24,height:130,width:270,borderColor:"#0D394A"},color:d,xAxis:{data:u,scale:!0,axisLabel:{textStyle:{color:"#6DC1CB",fontSize:12},align:"center"},axisTick:{show:!1},axisLine:{show:!0,lineStyle:{color:"#0D394A"}},z:10},yAxis:{nameTextStyle:{fontSize:12,color:"#6DC1CB",padding:[0,0,0,0]},axisLine:{show:!1,lineStyle:{color:"#0D394A"}},axisTick:{show:!1},splitLine:{show:!0,lineStyle:{color:"#0D394A"}},axisLabel:{textStyle:{color:"#6DC1CB",fontSize:12}}},series:[{type:"bar",barWidth:24,data:m}]},h=function(){var t={},e=function(e,n){var a={};n.forEach(function(t){a[t.incomeDateStr]=t}),t[e]=a},n=!0,a=!1,i=void 0;try{for(var r,o=Object.entries(s.a)[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var c=r.value,d=l(c,2);e(d[0],d[1])}}catch(t){a=!0,i=t}finally{try{!n&&o.return&&o.return()}finally{if(a)throw i}}return t}(),v={name:"farmDetailsTabs",data:function(){return{sales:null,salesBar:Object(a.d)(f),yield:null,yieldBar:Object(a.d)(f),farmRecordList:[],estimateYield:null,estimateYieldBar:Object(a.d)(f),generateFarmIntro:{farmIntro:{},companyInfo:{},farmIncomeVOS:[],govPickVOList:[],businessCategoryList:[]},farmIntroContainer:null,farmRecordScroll:null,showCompanyIcon:!1,viewPics:[],showViews:!1,goodsSubjectUnit:null,estimateGoodsSubjectUnit:null,goodsSubjectList:[],estimateGoodsSubjectList:[],yieldSubject:"agri",estimateYieldSubject:"agri",estimateYieldSubjectModel:"agri",showEstimateYieldModel:!1,curDate:null}},props:["farminfo","farmId"],computed:{businessCategoryStr:function(){if(this.generateFarmIntro.businessCategoryList.length&&this.generateFarmIntro.farmIntro.businessCategoryIdList&&this.generateFarmIntro.farmIntro.businessCategoryIdList.length){var t=this.generateFarmIntro.farmIntro.businessCategoryIdList,e=[];return this.generateFarmIntro.businessCategoryList.map(function(n){t.includes(n.id)&&e.push(n.bizCategoryName)}),e.join("，")}return""}},created:function(){this.initData()},mounted:function(){var t=this;return c(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getCropSubject();case 2:t.$nextTick(c(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.farmIntroContainer=Object(a.a)(t.$refs.farmIntroContainer,{scrollX:!1,freeScroll:!1,click:!1}),t.farmRecordScroll=Object(a.a)(t.$refs.farmRecordScroll,{scrollX:!1,freeScroll:!1,click:!1});case 2:case"end":return e.stop()}},e,t)})));case 3:case"end":return e.stop()}},e,t)}))()},methods:{initData:function(){this.generateFarmIntro={farmIntro:this.farminfo.farmDetailVO,companyInfo:this.farminfo.companyVO||{},farmIncomeVOS:this.farminfo.farmIncomeVOS,govPickVOList:this.farminfo.govPickVOList,businessCategoryList:this.farminfo.businessCategoryList},this.checkAuthCount=this.farminfo.inspectVOS.length},checkSubjectChangeUnit:function(t){return{agri:!0,forestry:!1,animal:!1,fishery:!0}[t]},yieldXAxis:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yyyy.MM",n=new Date(this.curDate).setDate(1),i=new Date(n).getMonth(),r=[],o=0;o<6;o++)r.push("add"===t?Object(a.c)(new Date(n).setMonth(i++),e):Object(a.c)(new Date(n).setMonth(--i),e));return r},getCropSubject:function(){var t=this;return c(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.$ajax.post(t.$api.public.farmCropSubject,{farmId:t.farmId}).then(function(e){var n=e.data;if(t.curDate=n.curDate,0===n.respCode)return t.goodsSubjectUnit={},0!==n.obj.list.length&&(t.goodsSubjectList=n.obj.list.map(function(e){return t.goodsSubjectUnit[e.cropSubjectIdentifier]="forestry"===e.cropSubjectIdentifier||"animal"===e.cropSubjectIdentifier?e.cropCategoryUnitAll:"吨",{name:e.cropSubjectNickname,id:e.cropSubjectIdentifier}}),t.yieldSubject=n.obj.list[0].cropSubjectIdentifier,!0)}));case 1:case"end":return e.stop()}},e,t)}))()},getEstimateCropSubject:function(){var t=this;return new Promise(function(e,n){t.$ajax.post(t.$api.public.getEstimateFarmCropSubject,{farmId:t.farmId}).then(function(t){var n=t.data;0===n.respCode&&e(n.obj)}).catch(function(t){console.log(t),n(t)})})},processEstimateCropSubject:function(){var t=this;return c(regeneratorRuntime.mark(function e(){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getEstimateCropSubject();case 2:if(n=e.sent,t.estimateGoodsSubjectUnit={},0!==n.list.length){e.next=6;break}return e.abrupt("return",!1);case 6:t.estimateGoodsSubjectList=n.list.map(function(e){return t.estimateGoodsSubjectUnit[e.cropSubjectIdentifier]="forestry"===e.cropSubjectIdentifier||"animal"===e.cropSubjectIdentifier?e.cropCategoryUnitAll:"吨",{name:e.cropSubjectNickname,id:e.cropSubjectIdentifier}}),t.estimateYieldSubject=n.list[0].cropSubjectIdentifier;case 8:case"end":return e.stop()}},e,t)}))()},getOutput:function(t){return this.$ajax.post(this.$api.farmDetail.getOutputListByFarmId,{dateList:this.yieldXAxis("minus","yyyy-MM-dd").reverse(),farmId:this.farmId,subjectIdentifier:t}).then(function(t){var e=t.data;if(0===e.respCode)return e.obj})},getEstimateYieldEchartsData:function(){var t=this;return new Promise(function(e,n){t.$ajax.post(t.$api.farmDetail.getPickForecastMonthByFarmId,{farmId:t.$route.params.farmid,subjectIdentifier:t.estimateYieldSubject}).then(function(t){var n=t.data;0===n.respCode&&e(n.obj)}).catch(function(t){console.log(t),n(new Error(t))})})},loadSalesBar:function(){var t=h[this.generateFarmIntro.farmIntro.farmId];this.salesBar.title.text="近半年销售额",this.salesBar.title.subtext="单位：万元",this.salesBar.xAxis.data=this.generateFarmIntro.farmIncomeVOS.map(function(t){return Object(a.c)(t.incomeDate,"yyyy.MM")}),this.salesBar.xAxis.axisLabel.formatter=function(t){return t},this.salesBar.series[0].data=this.generateFarmIntro.farmIncomeVOS.map(function(e,n){return{name:Object(a.c)(e.incomeDate,"yyyy.MM"),value:t?t[e.incomeDateStr]?Object(a.j)({value:t[e.incomeDateStr].totalAmount/Math.pow(10,4)}):0:Object(a.j)({value:e.totalAmount/Math.pow(10,4)}),itemStyle:{color:d[n]}}}),this.salesBar.tooltip.formatter=function(t){return t.name+"<br/>"+Object(a.l)({value:t.value,unit:"元",base:1e4}).formatter},this.salesBar.yAxis.axisLabel.formatter=function(t){return Object(a.l)({value:t}).formatter},this.sales=this.$echarts.init(this.$refs.sales),this.sales.setOption(this.salesBar)},loadYieldBar:function(t){var e=this;return c(regeneratorRuntime.mark(function n(){var i,r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i=e.goodsSubjectUnit[t]||"吨",n.next=3,e.getOutput(t);case 3:r=n.sent,e.yieldBar.title.text="近半年实际产量",e.yieldBar.xAxis.data=r.map(function(t){return Object(a.c)(t.pickTime,"yyyy.MM")}),e.yieldBar.yAxis.name="单位："+i,e.yieldBar.xAxis.axisLabel.formatter=function(t){return t},e.yieldBar.series[0].data=r.map(function(n,i){return{name:Object(a.c)(n.pickTime,"yyyy.MM"),value:Object(a.j)({value:e.checkSubjectChangeUnit(t)?n.sumPickOutput/Math.pow(10,3):n.sumPickOutput}),itemStyle:{color:d[i]}}}),e.yieldBar.yAxis.axisLabel.formatter=function(t){return Object(a.l)({value:t}).formatter},e.yieldBar.tooltip.formatter=function(t){return t.name+"<br/>"+Object(a.l)({value:t.value,unit:i}).formatter},e.yield=e.$echarts.init(e.$refs.yield),e.yield.setOption(e.yieldBar);case 13:case"end":return n.stop()}},n,e)}))()},loadEstimateYieldEchart:function(t){var e=this;return c(regeneratorRuntime.mark(function n(){var i,r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.getEstimateYieldEchartsData();case 2:i=n.sent,r=e.estimateGoodsSubjectUnit[t]||"吨",e.estimateYieldBar.title.text="未来预计产量",e.estimateYieldBar.xAxis.data=i.total.map(function(t){return Object(a.c)(new Date(t.pickMonthStr+"-01"),"yyyy.MM")}),e.estimateYieldBar.series[0].data=i.total.map(function(n,i){return{name:Object(a.c)(new Date(n.pickMonthStr+"-01"),"yyyy.MM"),value:Object(a.j)({value:e.checkSubjectChangeUnit(t)?n.sumTotal/Math.pow(10,3):n.sumTotal}),itemStyle:{color:d[i]}}}),e.estimateYieldBar.yAxis.name="单位："+r,e.estimateYieldBar.xAxis.axisLabel.formatter=function(t){return t},e.estimateYieldBar.yAxis.axisLabel.formatter=function(t){return Object(a.l)({value:t}).formatter},e.estimateYieldBar.tooltip.formatter=function(t){return t.name+"<br/>"+Object(a.l)({value:t.value,unit:r}).formatter},e.estimateYield=e.$echarts.init(e.$refs.estimateYield),e.estimateYield.setOption(e.estimateYieldBar),e.estimateYield.on("click",function(t){e.$emit("closeAllDialogEv"),setTimeout(function(){e.estimateYieldSubjectModel=e.estimateYieldSubject,e.showEstimateYieldModel=!0},200)});case 14:case"end":return n.stop()}},n,e)}))()},handleTabs:function(t){var e=this;this.$nextTick(function(){"input"===t.name&&e.farmRecordScroll.refresh()})},openViews:function(t){this.showViews=!0,this.viewPics=t}},components:{farmRecord:i.default,views:r.default,estimateYieldModel:o.default}},g=n("W5g0");var y=function(t){n("1do9")},b=Object(g.a)(v,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"tabs-container"},[n("div",{staticClass:"tabs-wrap"},[n("el-tabs",{attrs:{value:"farmIntro"},on:{"tab-click":t.handleTabs}},[n("el-tab-pane",{attrs:{label:"基地介绍",name:"farmIntro"}},[t.generateFarmIntro?n("div",{staticClass:"farm-intro"},[n("div",{ref:"farmIntroContainer",staticClass:"farm-intro-container"},[n("div",{staticClass:"farm-intro-wrap"},[n("p",{staticClass:"info-item"},[n("b",[t._v("基地简介：")]),t._v(t._s(t.generateFarmIntro.farmIntro.farmDesc))]),t._v(" "),t.businessCategoryStr?n("p",{staticClass:"info-item"},[n("b",[t._v("经营类目：")]),t._v(t._s(t.businessCategoryStr||""))]):t._e(),t._v(" "),n("p",{staticClass:"info-item"},[n("b",[t._v("经营主体：")]),t._v(t._s(t.generateFarmIntro.companyInfo.companyName))]),t._v(" "),n("p",{staticClass:"info-item"},[n("b",[t._v("主体类型：")]),t._v(t._s(t.generateFarmIntro.companyInfo&&t.generateFarmIntro.companyInfo.companyCategoryVO&&t.generateFarmIntro.companyInfo.companyCategoryVO.companyCategoryName)+"\n\t\t\t\t\t\t\t")]),t._v(" "),n("p",{staticClass:"info-item"},[n("b",[t._v("法人代表（负责人）：")]),t._v(t._s(t.generateFarmIntro.companyInfo.legalPerson))]),t._v(" "),n("p",{staticClass:"info-item"},[n("b",[t._v("联系方式：")]),t._v(t._s(t.generateFarmIntro.companyInfo.legalPersonPhone))]),t._v(" "),n("p",{staticClass:"info-item clearfix"},[n("span",[n("b",[t._v("主体唯一标识：")]),n("i",{staticStyle:{"font-style":"normal"}},[t._v(t._s(t.generateFarmIntro.companyInfo.enterpriseCreditCode))])])]),t._v(" "),t.generateFarmIntro.farmIntro.landRightStartDate||t.generateFarmIntro.farmIntro.landRightEndDate?n("p",{staticClass:"info-item clearfix"},[n("span",[n("b",[t._v("土地承包期限：")]),t._v(" "),t.generateFarmIntro.farmIntro.landRightStartDate?n("i",{staticStyle:{"font-style":"normal"}},[t._v("\n\t\t\t\t\t\t\t\t\t\t"+t._s(t._f("dateFormat")(t.generateFarmIntro.farmIntro.landRightStartDate,"yyyy.MM.dd"))+"~"+t._s(t._f("dateFormat")(t.generateFarmIntro.farmIntro.landRightEndDate,"yyyy.MM.dd"))+"\n\t\t\t\t\t\t\t\t\t")]):t._e()]),t._v(" "),t.generateFarmIntro.farmIntro.landRightImgUrl?n("span",{staticClass:"icon-pic-wrap f-right",on:{click:function(e){t.showCompanyIcon=!0}}},[n("i",{staticClass:"iconfont icon-pic"})]):t._e()]):t._e(),t._v(" "),n("p",{staticClass:"info-item"},[n("b",[t._v("基地位置与规模：")]),t._v("基地位于"+t._s(t.generateFarmIntro.farmIntro.cityName)+t._s(t.generateFarmIntro.farmIntro.countyName)+t._s(t.generateFarmIntro.farmIntro.farmAddress)+"\n\t\t\t\t\t\t\t\t"),t.generateFarmIntro.farmIntro.farmAcre?n("span",[t._v("，占地"+t._s(t._f("toFloat")(t.generateFarmIntro.farmIntro.farmAcre))+t._s(t._f("areaUnit")(t.generateFarmIntro.farmIntro.farmAcreUnit))+"。")]):t._e()]),t._v(" "),n("div",{staticClass:"info-item"},[n("div",{staticClass:"head-item"},[n("b",[t._v("检测与认证")]),t._v(" "),t.checkAuthCount?n("i",[t._v("共"+t._s(t.checkAuthCount)+"份")]):n("i",[t._v("无")])]),t._v(" "),t.farminfo.inspectVOS.length?n("div",{staticClass:"content-item"},[n("ul",{staticClass:"content-lists"},t._l(t.farminfo.inspectVOS,function(e,a){return t.farminfo.inspectVOS.length?n("li",{key:a,staticClass:"list"},[n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.reportName,placement:"top-start"}},[n("p",{staticClass:"list-name"},[t._v(t._s(e.reportName))])]),t._v(" "),n("span",{staticClass:"list-line"}),t._v(" "),n("p",{staticClass:"list-des",on:{click:function(n){return t.openViews(e.inspectReportImages)}}},[n("i",{staticClass:"iconfont icon-pic"}),t._v("\n\t\t\t\t\t\t\t\t\t\t\t\t"+t._s(e.inspectReportImages.length)+"张\n\t\t\t\t\t\t\t\t\t\t\t")])],1):t._e()}),0)]):t._e()])])])]):t._e()]),t._v(" "),n("el-tab-pane",{attrs:{label:"农事操作",name:"input"}},[t.generateFarmIntro?n("div",{staticClass:"farmword-container"},[n("div",{ref:"farmRecordScroll",staticClass:"farmword-wrap"},[n("farm-record",{attrs:{companyId:t.farminfo.companyVO.id,farmId:t.farmId}})],1)]):t._e()])],1)],1),t._v(" "),t.showCompanyIcon?n("views",{attrs:{pics:[t.generateFarmIntro.farmIntro.landRightImgUrl||""]},on:{viewerListen:function(e){t.showCompanyIcon=!1}}}):t._e(),t._v(" "),t.showViews?n("views",{attrs:{pics:t.viewPics},on:{viewerListen:function(e){t.showViews=!1}}}):t._e(),t._v(" "),t.showEstimateYieldModel?n("estimate-yield-model",{attrs:{"show-model":t.showEstimateYieldModel,"goods-subject-unit":t.estimateGoodsSubjectUnit,"estimate-yield-subject-model":t.estimateYieldSubjectModel,"goods-subject-list-model":t.estimateGoodsSubjectList},on:{"update:showModel":function(e){t.showEstimateYieldModel=e},"update:show-model":function(e){t.showEstimateYieldModel=e}}}):t._e()],1)},[],!1,y,"data-v-58bda36a",null);e.default=b.exports},"46SJ":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n("24oI"),i=n("VD73"),r=n("Qt0Z"),o=(n("PvbX"),n("wg9G"),n("SYE9")),s=n("Xtqa"),l={data:function(){return{iotMarkData:[]}},methods:{initIotMark:function(){var t=this,e=n("x/VB"),a=n("mrfU"),i=n("LCol");this.iotMarkData.forEach(function(n,r){var o=[n.lat,n.lng];switch(n.iotType){case 1:t.addmark({src:e,latlng:o,type:"sensor",index:r,configid:n.id,layertit:n.pointName}),!t.controlList.includes("传感器")&&t.controlList.push("传感器");break;case 2:t.addmark({src:a,latlng:o,type:"video",index:r}),!t.controlList.includes("摄像头")&&t.controlList.push("摄像头");break;case 3:t.addmark({src:i,latlng:o,type:"weather",index:r,configid:n.id,layertit:n.pointName}),!t.controlList.includes("气象站")&&t.controlList.push("气象站")}})},addmark:function(t){var e=this,n=!!t.hasOwnProperty("configid")&&t.configid,a=t.hasOwnProperty("layertit")?t.layertit:"",i=L.icon({iconUrl:t.src,iconSize:[30,45],type:t.type,className:t.type+"_marker markitem",index:t.index,configid:n,layertit:a});L.marker({lat:t.latlng[0],lng:t.latlng[1]},{icon:i}).addTo(this.map).on("click",function(t){var n=t.sourceTarget,a=t.target,i=t.latlng;e.syncAreaSelectfn([],!0);var r=n.options.icon.options.configid,o=n.options.icon.options.layertit,s=n.options.icon.options.type,l=n.options.icon.options.index,c=2*$(a._icon).offset().left-$(window).width()+16,d=2*$(a._icon).offset().top-$(window).height()+16;$(".homeMap .homemap_content .anilayertemp").removeClass("hidden").find("span").css("margin",d+"px 0 0 "+c+"px").removeClass("weatheranimate"),"weather"===s&&$(".homeMap .homemap_content .anilayertemp span").addClass("weatheranimate"),e.layertit=o,e.initmarklayer(s,l,a._icon,i,r),setTimeout(function(){e.backmarkericon(s,a._icon)},400)})},weather:function(t){var e=this;layer.open({type:1,id:"weatherPop",anim:-1,skin:"anilayer slidecontrol weatherlayer",resize:!1,content:'<div class="equiplayer sensormonitor"><div class="loader historyload" style="padding: 29% 0 0 50%;"><div class="loader-inner ball-spin-fade-loader"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div></div>',title:!1,area:["779px","519px"],shade:0,success:function(n,a){e.getWeatherInfo(t)},end:function(t,n){e.backmarkericon()}})},getWeatherInfo:function(t){var e=this;e.$ajax.post(this.$api.landSource.sensorlist,{configId:t,farmId:e.farmid}).then(function(t){t.data&&0==t.data.respCode?e.weatherLayout(t.data.obj.weatherStation):500==t.data.respCode&&e.$message({type:"warning",message:t.data.respDesc,center:!0})})},weatherLayout:function(t){var e="";if(t.isOnline&&t.slotList.length>0)t.slotList.forEach(function(t,n){if(2305==t.sensorTypeID){for(var a=[{label:"北",arr:[15,16,0]},{label:"东北",arr:[1,2]},{label:"东",arr:[3,4]},{label:"东南",arr:[5,6]},{label:"南",arr:[7,8]},{label:"西南",arr:[9,10]},{label:"西",arr:[11,12]},{label:"西北",arr:[13,14]}],i=Math.floor(t.data/22.5),r=0,o=0;o<8;o++)if(-1!=$.inArray(i,a[o].arr)){r=o;break}e+='<div class="weatheritem w1">\n\t\t\t\t\t\t\t\t\t\t\t<p>风向</p>\n\t\t\t\t\t\t\t\t\t\t\t<p class="value">'+a[r].label+"</p>\n\t\t\t\t\t\t\t\t\t\t</div>"}else 2049==t.sensorTypeID?e+='<div class="weatheritem w2">\n\t\t\t\t\t\t\t\t\t\t\t<p>风速</p>\n\t\t\t\t\t\t\t\t\t\t\t<p class="value">'+l(t.data,1)+t.unit+"</p>\n\t\t\t\t\t\t\t\t\t\t</div>":5377==t.sensorTypeID?e+='<div class="weatheritem w3">\n\t\t\t\t\t\t\t\t\t\t<p>光照度</p>\n\t\t\t\t\t\t\t\t\t\t<p class="value">'+parseInt(t.data)+t.unit+"</p>\n\t\t\t\t\t\t\t\t\t</div>":769==t.sensorTypeID?e+='<div class="weatheritem w4">\n\t\t\t\t\t\t\t\t\t\t<p>空气湿度</p>\n\t\t\t\t\t\t\t\t\t\t<p class="value">'+l(t.data,1)+t.unit+"</p>\n\t\t\t\t\t\t\t\t\t</div>":770==t.sensorTypeID?e+='<div class="weatheritem w5">\n\t\t\t\t\t\t\t\t\t\t<p>空气温度</p>\n\t\t\t\t\t\t\t\t\t\t<p class="value">'+l(t.data,1)+t.unit+"</p>\n\t\t\t\t\t\t\t\t\t</div>":12802==t.sensorTypeID?e+='<div class="weatheritem w6">\n\t\t\t\t\t\t\t\t\t<p>PM2.5</p>\n\t\t\t\t\t\t\t\t\t<p class="value">'+l(t.data,1)+t.unit+"</p>\n\t\t\t\t\t\t\t\t</div>":41217==t.sensorTypeID?e+='<div class="weatheritem w7">\n\t\t\t\t\t\t\t\t\t\t<p>大气压强</p>\n\t\t\t\t\t\t\t\t\t\t<p class="value">'+l(t.data,1)+t.unit+"</p>\n\t\t\t\t\t\t\t\t\t</div>":41473==t.sensorTypeID&&(e+='<div class="weatheritem w8">\n\t\t\t\t\t\t\t\t\t\t<p>降水量</p>\n\t\t\t\t\t\t\t\t\t\t<p class="value">'+l(t.data,1)+t.unit+"</p>\n\t\t\t\t\t\t\t\t\t</div>")});else{var a=t.hasOwnProperty("isOnline")&&!t.isOnline?"离线":"--",i=t.hasOwnProperty("isOnline")&&!t.isOnline?"":"ftcolor";[{label:"风向",classname:"w1"},{label:"风速",classname:"w2"},{label:"光照度",classname:"w3"},{label:"空气湿度",classname:"w4"},{label:"空气温度",classname:"w5"},{label:"PM2.5",classname:"w6"},{label:"大气压强",classname:"w7"},{label:"降水量",classname:"w8"}].forEach(function(t,n){e+='<div class="weatheritem '+t.classname+' gray">\n\t\t\t\t\t\t\t\t\t\t<p>'+t.label+'</p>\n\t\t\t\t\t\t\t\t\t\t<p class="value  '+i+'">'+a+"</p>\n\t\t\t\t\t\t\t\t\t</div>"})}var r=n("rO80"),o=n("AJ8d"),s='<div class="title"><p class="txt">'+this.layertit+'</p><span class="closebtn ivu-modal-close" onClick="window.layer.closeAll()"></span></div>\n\t\t\t\t\t\t\t\t<div class="weathercon">\n\t\t\t\t\t\t\t\t\t<div class="weather_bgimgs">\n\t\t\t\t\t\t\t\t\t\t<p><img src="'+r+'" alt="" /></p><p><img src="'+o+'" alt="" /></p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="weather_items">'+e+"</div>\n\t\t\t\t\t\t\t\t</div>";function l(t,e,n){return 0!=t?3==arguments.length&&n?(t*=100,parseInt(t*Math.pow(10,e)+.5,10)/Math.pow(10,e)+"%"):parseInt(t*Math.pow(10,e)+.5,10)/Math.pow(10,e):3==arguments.length&&n?"0%":0}$("#weatherPop .sensormonitor").html(s)},videomonitor:function(t){var e=this,n='<div class="equiplayer videomonitor"> <p class="title"><span class="pyc videotitle">'+e.iotMarkData[t].pointName+'</span><span class="closebtn" onClick="window.layer.closeAll()"></span></p> <div id="videomonitor"> <div class="loader videoload"> <div class="loader-inner ball-spin-fade-loader"> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> </div> </div> </div> </div>';layer.open({type:1,anim:-1,skin:"anilayer slidecontrol cameralayer",resize:!1,content:n,title:!1,area:["659px","399px"],shade:0,success:function(n,a){setTimeout(function(){e.initvideo($("#videomonitor"),e.iotMarkData[t].hlsUrl)},800)},end:function(t,n){e.playerobj&&e.playerobj.stopload(),e.playerobj=null,e.backmarkericon()}})},sensormonitor:function(t){var e=this;layer.open({type:1,anim:-1,skin:"anilayer slidecontrol sensormonitorlayer",resize:!1,content:'<div class="equiplayer sensormonitor"><div class="loader historyload" style="padding: 29% 0 0 50%;"><div class="loader-inner ball-spin-fade-loader"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div></div>',title:!1,area:["659px","399px"],shade:0,success:function(n,a){e.getsensorlist(t,function(n,a){$(".sensormonitorlayer .sensormonitor").html(n),$(".sensormonitor .sensorlist").niceScroll({cursorcolor:"rgba(0, 247, 255 ,0.4)",cursorwidth:"4px",cursorborder:"none",autohidemode:!0,railoffset:!0,railpadding:{top:0,right:5,left:0,bottom:0}}),$(".sensormonitor .sensorlist ul li").each(function(t,n){e.zanumber($(this).find(".sensoritem .sensornum"))}),a.length>1?$(".sensormonitor .sensorlist ul").on("click",".senhistory_btn",function(){var n=$(this).closest("li");if(n.hasClass("active")){$(this).closest("li").removeClass("active").siblings("li").removeClass("active").show(),n.find(".sensor_history").html('<div class="historycon"></div>');var i=$(this).closest(".sensorlist").data("scrollT");$(".sensormonitor .sensorlist").scrollTop(Math.abs(i))}else{i=$(this).closest(".sensormonitor .sensorlist").scrollTop();$(this).closest(".sensorlist").data("scrollT",i),$(".sensormonitor .sensorlist").getNiceScroll().hide(),n.addClass("active").siblings("li").removeClass("active").hide(),e.inithistory(n.find(".historycon"),a[n.index()],t)}}):1==a.length&&($(".sensormonitor .sensorlist").getNiceScroll().hide(),$(".sensormonitor .sensorlist ul li").addClass("active").siblings("li").removeClass("active").hide(),e.inithistory($(".sensormonitor .sensorlist ul li").find(".historycon"),a[0],t),$(".sensormonitor .sensorlist ul li span.splitline,.sensormonitor .sensorlist ul li .senhistory_btn").remove(),$(".sensormonitor .sensorlist ul li .sensoritem").css("width","499px"))})},end:function(t,n){e.backmarkericon()}})},getsensorlist:function(t,e){var n=this;this.$ajax.post(n.$api.landSource.sensorlist,{farmId:this.farmid,configId:t}).then(function(t){if(t.data&&0==t.data.respCode){var a=t.data.obj.sensorDeviceList,i='<div class="equiplayercon"> <div class="title"><p class="txt">'+n.layertit+'</p><span class="closebtn" onClick="window.layer.closeAll()"></span></div><div class="sensorlist"><ul class="clearfix">';a.forEach(function(t,e){i+='<li>\n\t\t\t\t\t\t\t\t<div class="sensorlicon clearfix">\n\t\t\t\t\t\t\t\t\t<div class="sensoricon"><img src="../../static/sensor_icon/'+t.sensorTypeID+'.png" alt="" /></div>\n\t\t\t\t\t\t\t\t\t<div class="sensoritem">\n\t\t\t\t\t\t\t\t\t\t<p>'+t.deviceName+"</p>\n\t\t\t\t\t\t\t\t\t\t<p>单位：<span>"+(t.unit||"无")+"</span></p>",t.data||0==t.data?i+='<div class="sensornum za_number" num="'+t.data+'"></div>':i+='<div class="sensornum za_number" style="font-size: 24px; color: #2f896d; line-height: 32px;">离线</div>',i+='</div> <span class="splitline"></span> <div class="senhistory_btn"></div> </div> <div class="sensor_history"> <div class="historycon"></div> </div> </li>'}),e(i+="</ul></div></div>",a)}else 500==t.data.respCode&&n.$message({type:"warning",message:t.data.respDesc,center:!0})})},backmarkericon:function(t,e){$(".layui-layer-setwin").remove(),$("#homemap .leaflet-map-pane .leaflet-marker-pane img.sensor_marker").attr("src",n("x/VB")).removeClass("active"),$("#homemap .leaflet-map-pane .leaflet-marker-pane img.video_marker").attr("src",n("mrfU")).removeClass("active"),$("#homemap .leaflet-map-pane .leaflet-marker-pane img.weather_marker").attr("src",n("LCol")).removeClass("active"),2===arguments.length&&("sensor"===t?e.src=n("o9yN"):"video"===t?e.src=n("rBfV"):"weather"===t&&(e.src=n("Ivz0")),$(e).addClass("active"))},initmarklayer:function(t,e,n,a,i){5==arguments.length&&("sensor"==t?this.sensormonitor(i):"video"==t?this.videomonitor(e):"weather"==t&&this.weather(i),a&&this.markcenter(a)),a&&this.markcenter(a),setTimeout(function(){$(".homeMap .homemap_content .anilayertemp").addClass("hidden")},400)},inithistory:function(t,e,n){var a=this,i=t;i.html('<div class="loader historyload"><div class="loader-inner ball-spin-fade-loader"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>'),function(t){a.$ajax.post(a.$api.landSource.sensorhistory,{farmId:a.farmid,deviceId:e.deviceID,slotId:e.slotID,configId:t}).then(function(t){if(t.data&&0==t.data.respCode){for(var e=t.data.obj.dataList,n=[],r=[],o=0;o<e.length;o++)n.push(new Date(e[o].time).format("MM.dd hh:mm")),r.push(e[o].close);!function(t,e,n,i){if(!i)return!1;if(!e.length&&!n.length)return void(i.innerHTML='<div style="padding-top:100px;text-align:center;font-size:16px;">暂无数据<div>');var r=a.$echarts.init(i),o={title:{show:!1,text:"",subtext:""},tooltip:{show:!0,trigger:"axis",borderColor:"#308A6E",backgroundColor:"#64C3A4",padding:[5,10,2],textStyle:{color:"#fff"},formatter:function(t){return"<p style='text-align:center;line-height:16px;'>"+t[0].name+"<br/>数值："+t[0].value+"</p>"},axisPointer:{lineStyle:{color:"#6ffb70",width:1},crossStyle:{color:"#308A6E",width:3}}},legend:{data:[]},toolbox:{show:!1},calculable:!1,xAxis:[{type:"category",boundaryGap:!1,data:e,splitLine:{show:!1},axisLabel:{show:!0,textStyle:{color:"#73867A"},formatter:function(t){return t.split(" ")[0]+"\n"+t.split(" ")[1]}},axisLine:{lineStyle:{color:"#308A6E",width:1}}}],yAxis:[{type:"value",splitLine:{show:!0,lineStyle:{color:"rgba(48,138,110,0.2)"}},axisLabel:{show:!0,textStyle:{color:"#73867A"}},axisLine:{lineStyle:{color:"#308A6E",width:1}}}],grid:{x:50,y:20,x2:23,y2:40,borderWidth:0},series:[{name:"传感器历史数据",type:"line",smooth:!0,clickable:!1,itemStyle:{normal:{color:"#64C3A4",lineStyle:{color:"#64C3A4"},areaStyle:{color:"rgba(109, 250, 115, 0.1)"}},emphasis:{lineStyle:{color:"#fff"}}},data:n,symbol:"circle",symbolSize:0}]};r.setOption(o)}(t.data.obj.unit,n,r,i.get(0))}})}(n)},initvideo:function(t,e){var a=this;function i(e){var i=0,r=null,o=null;function s(t){o=setInterval(function(){window.TcPlayer&&(a.playerobj=function(t){if(!(t.idname&&t.src&&t.width&&t.height))return!1;var e={m3u8:t.src,width:t.width,height:t.height,autoplay:!0,coverpic:{style:"stretch",src:t.poster||""},live:!0,flash:!1,x5_player:!0,x5_type:!0,x5_fullscreen:!0,listener:function(t){if(!n)return!1;var e=t.src.player.el.querySelector(".vcp-loading");if("error"==t.type?n.options.src&&(e.setAttribute("style","display:none;"),n.timer_errordoing=setTimeout(function(){n&&!n.playing()&&n.errorreload_i<3?(console.log("重新loading"),n.load(n.options.src),n.errorreload_i++,e.setAttribute("style","display:block;")):e.setAttribute("style","display:none;"),clearTimeout(n.timer_errordoing)},3e3)):n.playing()&&(clearTimeout(n.timer_errordoing),e.setAttribute("style","display:none;")),!n.initreflashbtn){n.initreflashbtn=!0;var a=document.createElement("div");a.className="vcp-reflashbtn",a.addEventListener("click",function(){console.log("手动重新loading"),n&&n.video&&n.video.hls&&n.video.hls.stopLoad(),e.setAttribute("style","display:block;"),clearTimeout(n.timer_errordoing),n.load(n.options.src)}),setTimeout(function(){t.src.player.el.querySelector(".vcp-controls-panel").appendChild(a)},600)}}};t.setoptionfn&&(e=t.setoptionfn(e));var n=new TcPlayer(t.idname,e);return n.timer_errordoing=null,n.errorreload_i=0,n.initreflashbtn=!1,n.stopload=function(){n&&n.video&&n.video.hls&&n.video.hls.stopLoad(),n=null},n}({idname:"videoitem",src:t,width:"560",height:"315",poster:n("B4o8")}),clearInterval(o))},300)}t.html('<div id="videoitem" class="videobaseStyle"></div>'),s(e),r=setInterval(function(){if(""==$("#videoitem").html()){if(console.log("出错："+i),i>=3)return clearInterval(r),clearInterval(o),t.html('<p style="font-size: 20px; color: #71e8cf; text-align: center; line-height: 303px;">视频连接失败，请刷新浏览器重试</p>'),!1;s(e),i++}else clearInterval(r),clearInterval(o)},1e3)}a.playerobj&&a.playerobj.stopload(),window.TcPlayer?i(e):$.getScript("https://snkoudai.oss-cn-hangzhou.aliyuncs.com/common/common-js/snkoudai-web/js/TcPlayer-2.2.2.js",function(){$.getScript("https://snkoudai.oss-cn-hangzhou.aliyuncs.com/common/common-js/snkoudai-web/js/hls.min.0.8.9.js",function(){i(e)})})},markcenter:function(t){this.mapMovePos("area",120,t)},zanumber:function(t){var e=t.attr("num");if(!isNaN(e)&&(e=Number(e)+"").split("").length>0){for(var n=e.split(""),a="",i=0;i<n.length;i++)"."==n[i]?a+='<span class="number_pointer"></span>':isNaN(n[i])?a+='<span class="number_other">'+n[i]+"</span>":a+='<span class="number_'+n[i]+'"></span>';t.html(a),setTimeout(function(){t.find("span").not(".number_pointer").addClass("aninum")},0)}}}},c=n("VCTt");function d(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function u(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,n){return function a(i,r){try{var o=e[i](r),s=o.value}catch(t){return void n(t)}if(!o.done)return Promise.resolve(s).then(function(t){a("next",t)},function(t){a("throw",t)});t(s)}("next")})}}var p=n("FChz"),m=n("mrfU"),f=n("LCol"),h=n("+sNG"),v=n("rBfV"),g=n("Ivz0"),y=n("B4o8"),b=["a1LbLHpaiF0","a1gtsBcBv8B","a1VcM7zpCpr"],w={data:function(){return{newVersionFlag:null,totalSensor:0,totalController:0,markProductPosition:[],hisBsFlag:!1,sensorHsBs:null}},mounted:function(){},methods:{getDeviceDetail:function(t){return this.$ajax.post(this.$api.farmDetail.getDeviceDetailState,{deviceId:t,farmId:this.farmid}).then(function(t){var e=t.data;if(0===e.respCode)return e.obj})},getDeviceHistory:function(t,e){return this.$ajax.post(this.$api.farmDetail.getDeviceHistory,{farmId:this.farmid,deviceId:t,identifier:e}).then(function(t){var e=t.data;if(0===e.respCode)return e.obj})},_initIot:function(){var t=this;return u(regeneratorRuntime.mark(function e(){var n,a,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getDevicesPosition();case 2:n=e.sent,a=n.cameraList?n.cameraList.map(function(t){return{lat:t.lat,lng:t.lng,id:t.id,pointName:t.displayName,iotType:2,hlsUrl:t.hlsUrl,hlsUrlHd:t.hlsUrlHd,updateTime:t.updateTime}}):[],i=n.gateDeviceList?n.gateDeviceList.map(function(t){return{lat:t.lat,lng:t.lng,id:t.id,pointName:t.clientDisplayName,iotType:"INTEGRATED"===t.productVO.productType?3:1,hlsUrl:null,updateTime:null,productKey:t.productVO.productKey}}):[],t.markProductPosition=[].concat(d(a),d(i)),t._initIotMark();case 7:case"end":return e.stop()}},e,t)}))()},getDevicesPosition:function(){return this.$ajax.post(this.$api.farmDetail.getIotLocationAll,{farmId:this.farmid}).then(function(t){var e=t.data;if(0===e.respCode)return e.obj})},_initIotMark:function(){var t=this;this.markProductPosition.forEach(function(e,n){var a=[e.lat,e.lng];switch(e.iotType){case 1:t._addMark({src:p,latlng:a,type:"sensor",index:n,configid:e.id,layertit:e.pointName}),!t.controlList.includes("传感器")&&t.controlList.push("传感器");break;case 2:t._addMark({src:m,latlng:a,type:"video",index:n}),!t.controlList.includes("摄像头")&&t.controlList.push("摄像头");break;case 3:t._addMark({src:f,latlng:a,type:"weather",index:n,configid:e.id,layertit:e.pointName}),!t.controlList.includes("气象站")&&t.controlList.push("气象站")}})},_addMark:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.src,a=e.latlng,i=e.type,r=e.index,o=e.configid,s=void 0!==o&&o,l=e.layertit,c=void 0===l?"":l,d=L.icon({iconUrl:n,iconSize:[30,45],type:i,className:i+"_marker markitem",index:r,configid:s,layertit:c});L.marker({lat:a[0],lng:a[1]},{icon:d}).addTo(this.map).on("click",function(e){var n=e.sourceTarget,a=e.target,i=e.latlng;t.syncAreaSelectfn([],!0);var r=n.options.icon.options,o=r.configid,s=r.layertit,l=r.type,c=r.index;t.layertit=s,t._initMarkLayer({type:l,markIndex:c,icon:a._icon,latlng:i,configId:o}),setTimeout(function(){t.recoveryMarkerIcon(l,a._icon)},400)})},_initMarkLayer:function(t){var e=t.type,n=t.markIndex,a=(t.icon,t.latlng),i=t.configId;switch(e){case"video":this._initVideoLayer(n);break;case"sensor":case"weather":this._initGatewayLayer(n,i)}a&&this._mark2Center(a)},_initVideoLayer:function(t){var e=this,n='<div class="equiplayer videomonitor">\n        <p class="title">\n          <span class="pyc videotitle">'+this.markProductPosition[t].pointName+'</span>\n          <span class="closebtn" onClick="window.layer.closeAll()"></span>\n        </p>\n        <div id="videomonitor">\n          <div class="loader videoload">\n            <div class="loader-inner ball-spin-fade-loader"> \n              <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> \n            </div> \n          </div> \n        </div> \n      </div>';layer.open({type:1,anim:-1,skin:"anilayer slidecontrol cameralayer",resize:!1,content:n,title:!1,area:["659px","399px"],shade:0,success:function(){e.$nextTick(function(){}),setTimeout(function(){e._initVideoPlayer($("#videomonitor"),e.markProductPosition[t])},300)},end:function(){e.playerobj&&e.playerobj.stopload(),e.playerobj=null,e.recoveryMarkerIcon()}})},_initGatewayLayer:function(t,e){var n=this,a=null,i=null;window.layer.open({type:1,skin:"anilayer slidecontrol sensormonitorlayer "+(this.isInterHasImage(t)?"hasImage":""),resize:!1,content:'\n\t\t\t\t<div id="newVersion" class="equiplayer sensormonitor">\n\t\t\t\t\t<div class="equiplayercon">\n\t\t\t\t\t\t<p class="title"><span class="closebtn" onclick="window.layer.closeAll()"></span></p>\n\t\t\t\t\t\t<div class="monitorlistcon">\n\t\t\t\t\t\t\t<div class="monitorlist sensorlist">\n\t\t\t\t\t\t\t\t<div class="loader historyload" style="padding:23% 0 0 50%;">\n\t\t\t\t\t\t\t\t\t<div class="loader-inner ball-spin-fade-loader"><div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div></div><div></div><div></div><div></div><div></div><div></div><div></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>',title:!1,area:["659px",this.isInterHasImage(t)?"514px":"399px"],shade:0,anim:-1,success:function(){var r=this;return u(regeneratorRuntime.mark(function o(){var s,l,d,u,p,m,f,h;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return s=".sensormonitor .monitorlist ul li",r.next=3,n.generateSubDeviceList(t,e);case 3:l=r.sent,d=l.generateDetail,u=l.listTpl,p=d.sensorList,m=d.controllerList,f=null,$(".sensormonitorlayer .sensormonitor").html(u),p.length>3&&(a=Object(c.a)($(".sensormonitor .sensorlist").get(0)),$(".sensormonitor .monitorlist>ul>li").css("overflow","hidden"),a.scrollTo(0,-1),a.scrollTo(0,0)),m.length>3&&(i=Object(c.a)($(".sensormonitor .controlerlist").get(0)),$(".sensormonitor .monitorlist>ul>li").css("overflow","hidden"),i.scrollTo(0,-1),i.scrollTo(0,0)),$(s).each(function(){n._zaNumber($(this).find(".sensoritem .sensornum"))}),(h=$(s).length)>1?(n.hisBsFlag=!1,n.sensorHsBs=null,$(".sensormonitor .sensorlist ul").on("click",".senhistory_btn",function(){var t=$(this).closest("li");t.hasClass("active")?(t.find(".sensor_history").html('<div class="historycon"></div>'),$(this).closest("li").removeClass("active").siblings("li").removeClass("active").show(),a&&(a.refresh(),a.scrollTo(0,f),setTimeout(function(){a.refresh()},300))):(a&&(f=a.y),t.addClass("active").siblings("li").removeClass("active").hide(),n._initHistory(t.find(".historycon"),t.data("index"),p),n.$nextTick(function(){a&&a.refresh()}))})):1===h&&(n.hisBsFlag=!0,$(".sensormonitor .sensorlist>ul>li").addClass("active").siblings("li").removeClass("active").hide(),n._initHistory($(".sensormonitor .sensorlist>ul>li").find(".historycon"),$(".sensormonitor .sensorlist>ul>li").data("index"),p),$(".sensormonitor .sensorlist>ul>li span.splitline,.sensormonitor .sensorlist>ul>li .senhistory_btn").remove(),$(".sensormonitor .sensorlist>ul>li .sensoritem").css("width","499px"),a&&a.destroy()),$(".equiplayer p.title span.layertname").on("click",function(){$(".equiplayer p.title span.layertname").length>1?$(this).addClass("active").siblings("span.layertname").removeClass("active"):$(this).addClass("blue"),$(".sensormonitor .equiplayercon .monitorlist").eq($(this).index()).show().siblings(".monitorlist").hide(),n.hisBsFlag&&setTimeout(function(){n.sensorHsBs&&n.sensorHsBs.refresh()},300)}),$(".equiplayer p.title span.layertname").first().trigger("click");case 17:case"end":return r.stop()}},o,r)}))()},end:function(){n.recoveryMarkerIcon()}})},generateSubDeviceList:function(t,e){var n=this;return u(regeneratorRuntime.mark(function a(){var i,r,o,s,l,c,d,u,p;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return i=n,a.next=3,n.getDeviceDetail(e);case 3:return r=a.sent,o=r.sensorList,s=r.controllerList,l=r.deviceVO,c=r.totalController,d=r.totalSensor,u=r.totalProperty,p='<div class="equiplayercon"><p class="title">',!!u+!!d+!!c===1||!!u+!!d+!!c===0?p+='<span class="layertname">'+i.markProductPosition[t].pointName+"</span>":(u>0&&(p+='<span class="layertname">气象监测</span>'),d>0&&(p+='<span class="layertname">环境监测</span>'),c>0&&(p+='<span class="layertname">远程控制</span>')),p+='<span class="closebtn" onClick="window.layer.closeAll()"></span></p><div class="monitorlistcon '+(n.isInterHasImage(t)?"weatherlayer":"")+'">',u>0&&(p+=n.generateWeatherTpl(l)),p=n.generateSensingTpl("controler",n.generateSensingTpl("sensor",p,o),s),0===d&&0===c&&0===u&&(p+='<div class="monitorlist nodata"><ul class="clearfix"><li class="nodata">暂未连接子设备</li></ul></div>'),p+="</div></div>",a.abrupt("return",{listTpl:p,generateDetail:r});case 18:case"end":return a.stop()}},a,n)}))()},generateWeatherTpl:function(t){var e="",a="",i="",r=t.devicePropertyDTOList,o=n("0e/S"),s=2===t.gateType?n("5y8e"):n("n0y3"),l={Direction:{name:"",value:"--"},Temp:{name:"",value:"--"},Speed:{name:"",value:"--"},Rain:{name:"",value:"--"},Humi:{name:"",value:"--"},Pressure:{name:"",value:"--"},Light:{name:"",value:"--"},PM25:{name:"",value:"--"}};return r.forEach(function(t){a=t.specsNumber?t.specsNumber.unit:"",l[t.identifier].name=t.name,i=t.propertyValue,"bool"!==t.dataType&&"enum"!==t.dataType||(i=JSON.parse(t.specs)[i]),i=(i||"--")+a,l[t.identifier].value=i}),e+='\n\t\t\t\t\t<div class="monitorlist weathercon '+(2===t.gateType?"lower":"")+'">\n\t\t\t\t\t\t<div class="weather_bgimgs">\n\t\t\t\t\t\t\t<p><img style="width:286px" src="'+o+'" alt="" /></p>\n\t\t\t\t\t\t\t<p><img style="width:286px" src="'+s+'" alt="" /></p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="weather_items"> <div class="weatheritem">\n\t\t\t\t\t\t\t<p>'+l.Direction.name+'</p>\n\t\t\t\t\t\t\t<p class="value '+("--"===l.Direction.value.substr(0,2)?"gray":"")+'">'+l.Direction.value+'</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="weatheritem">\n\t\t\t\t\t\t\t<p>'+l.Speed.name+'</p>\n\t\t\t\t\t\t\t<p class="value '+("--"===l.Speed.value.substr(0,2)?"gray":"")+'">'+l.Speed.value+'</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="weatheritem">\n\t\t\t\t\t\t\t<p>'+l.Light.name+'</p>\n\t\t\t\t\t\t\t<p class="value '+("--"===l.Light.value.substr(0,2)?"gray":"")+'">'+l.Light.value+'</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="weatheritem">\n\t\t\t\t\t\t\t<p>'+l.Humi.name+'</p>\n\t\t\t\t\t\t\t<p class="value '+("--"===l.Humi.value.substr(0,2)?"gray":"")+'">'+l.Humi.value+'</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="weatheritem">\n\t\t\t\t\t\t\t<p>'+l.Temp.name+'</p>\n\t\t\t\t\t\t\t<p class="value '+("--"===l.Temp.value.substr(0,2)?"gray":"")+'">'+l.Temp.value+'</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="weatheritem">\n\t\t\t\t\t\t\t<p>'+l.PM25.name+'</p>\n\t\t\t\t\t\t\t<p class="value '+("--"===l.PM25.value.substr(0,2)?"gray":"")+'">'+l.PM25.value+'</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="weatheritem">\n\t\t\t\t\t\t\t<p>'+l.Pressure.name+'</p>\n\t\t\t\t\t\t\t<p class="value '+("--"===l.Pressure.value.substr(0,2)?"gray":"")+'">'+l.Pressure.value+'</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="weatheritem">\n\t\t\t\t\t\t\t<p>'+l.Rain.name+'</p>\n\t\t\t\t\t\t\t<p class="value '+("--"===l.Rain.value.substr(0,2)?"gray":"")+'">'+l.Rain.value+"</p>\n\t\t\t\t\t</div></div></div>"},generateSensingTpl:function(t,e,n){return n.length>0&&(e+='<div class="monitorlist '+("sensor"===t?"sensorlist":"controlerlist")+'"><ul class="clearfix">',n.forEach(function(n,a){var i=n.devicePropertyDTOList;if("sensor"===t&&i.length>1&&i.forEach(function(t,i){var r=t.propertyValue,o="",s="无";"bool"!==t.dataType&&"enum"!==t.dataType||(o="discrete",r=JSON.parse(t.specs)[r]),e+='<li data-index="'+a+"-"+i+'" class="'+o+'">\n\t\t\t\t\t\t\t<div class="sensorlicon clearfix">\n\t\t\t\t\t\t\t<div class="sensoricon"><img src="'+(n.productVO.productLogo?n.productVO.productLogo:"https://zaiot.oss-cn-hangzhou.aliyuncs.com/wechat/img/icon_eq_default.png")+'" alt="" /></div>\n\t\t\t\t\t\t\t<div class="sensoritem">\n\t\t\t\t\t\t\t<p>'+n.clientDisplayName+"-"+t.name+"</p>",t.specsNumber&&t.specsNumber.unit&&(s=t.specsNumber.unit),e+="<p>单位：<span>"+s+"</span></p>",b.includes(n.productKey)&&(r=parseInt(r,10)>=100?"0.1":r),e+='<div class="sensornum za_number '+(r?"":"no-value")+'" num="'+(r||"--")+'"></div>',e+='</div> <span class="splitline"></span> <div class="senhistory_btn"></div> </div> <div class="sensor_history"> <div class="historycon"></div> </div> </li>'}),1===i.length){var r=i[0],o=r.propertyValue,s="",l="";if(l="controler"===t?" controler":l,"bool"!==r.dataType&&"enum"!==r.dataType||(s="discrete",o=JSON.parse(r.specs)[o]),e+="sensor"===t?'<li data-index="'+a+'-0" class="'+(s+l)+'">\n\t\t\t\t\t\t\t<div class="sensorlicon clearfix">\n\t\t\t\t\t\t\t<div class="sensoricon"><img src="'+(n.productVO.productLogo?n.productVO.productLogo:"https://zaiot.oss-cn-hangzhou.aliyuncs.com/wechat/img/icon_eq_default.png")+'" alt="" /></div>\n\t\t\t\t\t\t\t<div class="sensoritem">\n\t\t\t\t\t\t\t<p>'+n.clientDisplayName+"</p>":'<li data-index="'+a+'-0" class="'+(s+l)+'">\n\t\t\t\t\t\t\t<div class="sensorlicon clearfix">\n\t\t\t\t\t\t\t<div class="sensoricon"><img src="'+(n.controllerCategoryVO.categoryLogo?n.controllerCategoryVO.categoryLogo:"https://zaiot.oss-cn-hangzhou.aliyuncs.com/wechat/img/icon_eq_default.png")+'" alt="" /></div>\n\t\t\t\t\t\t\t<div class="sensoritem">\n\t\t\t\t\t\t\t<p>'+n.clientDisplayName+"</p>","sensor"===t){var c="无";r.specsNumber&&r.specsNumber.unit&&(c=r.specsNumber.unit),e+="<p>单位：<span>"+c+"</span></p>",b.includes(n.productKey)&&(o=parseInt(o,10)>=100?"0.1":o),e+='<div class="sensornum za_number '+(o?"":"no-value")+'" num="'+(o||"--")+'"></div>'}else"ONLINE"===n.deviceState?(b.includes(n.productKey)&&(o=parseInt(o,10)>=100?"0.1":o),e+='<div class="sensornum za_number '+(o?"":"no-value")+'" num="'+(o||"--")+'"></div>'):e+='<div class="sensornum za_number" style="font-size: 24px; color: #2F896D; line-height: 32px;">离线</div>';e+="sensor"===t?'</div> <span class="splitline"></span> <div class="senhistory_btn"></div> </div> <div class="sensor_history"> <div class="historycon"></div> </div> </li>':'</div></div> <div class="sensor_history"> <div class="historycon"></div> </div> </li>'}}),e+="</ul></div>"),e},_mark2Center:function(t){this.moveMapPosition("area","120",t)},moveMapPosition:function(t,e,n){var a=this;this.$nextTick(function(){var i=a.map.getPixelBounds(),r=i.max.y-i.min.y,o=a.map.getBounds(),s=o._northEast.lat-o._southWest.lat,l="area"===t?s/4:0;a.map.panTo({lat:n.lat+l+s*(e/r),lng:n.lng})})},_initVideoPlayer:function(t,e){var n=this;return u(regeneratorRuntime.mark(function a(){var i,r,o;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return i=n,r=function(){var a=0,i=null;t.html('<div id="videoitem" class="videobaseStyle"></div>'),n.playerobj=o({idName:"videoitem",src:e.hlsUrl||e.hlsUrlHd,width:"560",height:"315",poster:y}),i=setInterval(function(){if(""===$("#videoitem").html()){if(a>=3)return clearInterval(i),t.html('<p style="font-size: 20px; color: #71e8cf; text-align: center; line-height: 303px;">视频连接失败，请刷新浏览器重试</p>'),!1;a++}else clearInterval(i)},1e3)},o=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.idName,a=t.src,r=t.width,o=t.height,s=t.poster,l=t.autoplay,c=void 0===l||l,d=t.live,u=void 0===d||d,p=t.flash,m=void 0!==p&&p,f=t.x5_player,h=void 0===f||f,v=t.x5_type,g=void 0===v||v,y=t.x5_fullscreen,b=new TcPlayer(n,{m3u8:a,width:r,height:o,autoplay:c,coverpic:{style:"stretch",src:s||""},live:u,flash:m,x5_player:h,x5_type:g,x5_fullscreen:void 0===y||y,listener:function(t){if(!b)return!1;var n=t.src.player.el.querySelector(".vcp-loading");if("error"===t.type?b.options.src&&(n.setAttribute("style","display:none;"),b.timer_errordoing=setTimeout(function(){if(!b.playing()&&b.errorreload_i<3){var t=e.hlsUrl?"流畅":"高清";document.querySelector(".switch-load-btn")&&(document.querySelector(".switch-load-btn").innerHTML=t),b.load(b.options.src),b.errorreload_i++,n.setAttribute("style","display:block;")}else n.setAttribute("style","display:none;");clearTimeout(b.timer_errordoing)},3e3)):"playing"===t.type&&(clearTimeout(b.timer_errordoing),n.setAttribute("style","display:none;")),!b.initreflashbtn){var a=document.createElement("div"),r=e.hlsUrl?"流畅":"高清";a.setAttribute("class","switch-load-btn"),a.innerText=r,a.addEventListener("click",function(){switch(r){case"流畅":if(!e.hlsUrlHd)return i.$message({type:"warning",message:"当前视频仅支持流畅播放",center:!0}),!1;b.load(e.hlsUrlHd),r="高清";break;case"高清":if(!e.hlsUrl)return i.$message({type:"warning",message:"当前视频仅支持高清播放",center:!0}),!1;b.load(e.hlsUrl),r="流畅"}i.$message({type:"success",message:"已切换至"+r+"播放",center:!0}),a.innerText=r}),e.hlsUrl!==e.hlsUrlHd&&t.src.player.el.querySelector(".vcp-controls-panel").appendChild(a),b.initreflashbtn=!0;var o=document.createElement("div");o.className="vcp-reflashbtn",o.addEventListener("click",function(){b&&b.video&&b.video.hls&&b.video.hls.stopLoad(),n.setAttribute("style","display:block;"),clearTimeout(b.timer_errordoing),b.load("高清"===r?e.hlsUrlHd:e.hlsUrl)}),setTimeout(function(){t.src.player.el.querySelector(".vcp-controls-panel").appendChild(o)},600)}}});return b.timer_errordoing=null,b.errorreload_i=0,b.initreflashbtn=!1,b.stopload=function(){b&&b.video&&b.video.hls&&b.video.hls.stopLoad(),b=null},b},n.playerobj&&n.playerobj.stopload(),a.next=6,n._initTcPlayer();case 6:r();case 7:case"end":return a.stop()}},a,n)}))()},_initTcPlayer:function(){return new Promise(function(t,e){window.TcPlayer?t():$.getScript("https://imgcache.qq.com/open/qcloud/video/vcplayer/TcPlayer-2.3.2.js",function(){t()})})},recoveryMarkerIcon:function(t,e){this.$nextTick(function(){var n=$("#homemap .leaflet-map-pane .leaflet-marker-pane");switch($(".layui-layer-setwin").remove(),n.find("img.sensor_marker").attr("src",p).removeClass("active"),n.find("img.video_marker").attr("src",m).removeClass("active"),n.find("img.weather_marker").attr("src",f).removeClass("active"),t){case"sensor":e.src=h;break;case"video":e.src=v;break;case"weather":e.src=g}$(e).addClass("active")})},isInterHasImage:function(t){return 3===this.markProductPosition[t].iotType},_initHistory:function(t,e,n){var a=this;return u(regeneratorRuntime.mark(function i(){var r,o,l,d,u,p,m,f,h,v;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return r=function(t,e,n,a){if(!a)return!1;if(e.length||n.length){var i=echarts.init(a),r={title:{show:!1,text:"",subtext:""},tooltip:{show:!0,trigger:"axis",borderColor:"#64C3A4",backgroundColor:"rgba(100,195,164,1)",padding:[5,10,2],textStyle:{color:"#fff"},formatter:function(e){return"<p class='echartBox' style='text-align:left;line-height:24px;padding:3px;'>"+e[0].name+"<br/>数值："+(void 0===e[0].value?"--":e[0].value)+t.replace(/无/,"")+"</p>"},axisPointer:{lineStyle:{color:"#64C3A4",width:1},crossStyle:{color:"#00E5FF",width:3}}},legend:{data:[]},toolbox:{show:!1},calculable:!1,xAxis:[{type:"category",boundaryGap:!1,data:e,splitLine:{show:!1},axisLabel:{show:!0,textStyle:{color:"#73867A"},formatter:function(t){return t.split(" ")[0]+"\n"+t.split(" ")[1]}},axisLine:{lineStyle:{color:"rgba(255,255,255,0.1)",width:1}}}],yAxis:[{type:"value",splitLine:{show:!0,lineStyle:{color:"rgba(48,138,110,0.2)"}},axisLabel:{show:!0,textStyle:{color:"#73867A"}},axisLine:{lineStyle:{color:"rgba(255,255,255,0.1)",width:1}}}],grid:{left:48,right:23,top:20,bottom:43,borderWidth:0},series:[{name:"传感器历史数据",type:"line",smooth:!0,clickable:!1,itemStyle:{normal:{color:"#73867A",lineStyle:{color:"#308A6E"},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(109,250,115,0.4)"},{offset:1,color:"rgba(100,195,164,0)"}],global:!1}}},emphasis:{lineStyle:{color:"#fff"}}},data:n,symbol:"circle",symbolSize:1,showAllSymbol:!0}]},o=Math.max.apply(null,n);if(o.toString().length>4){var s=7*(o.toString().length-4)+50;r.grid.x=s}i.setOption(r)}else a.innerHTML='<div style="padding-top: 100px; text-align: center; font-size: 18px; color: #2CD2A9;">暂无历史数据<div>'},o=function(t,e,n,i){var r="";r+='<div class="control_timeline" ref="controltimeline"><ul class="clearfix">';for(var o=0;o<e.length;o++)r+='<li><span class="pointer"></span><p><span class="fl">'+e[o]+'</span><span class="fr">'+(JSON.parse(d.specs)[n[o]]||"")+"</span></p> </li>";if(r+="</ul></div>",0===e.length)return i.innerHTML='<div style="padding-top: 100px; text-align: center; font-size: 18px; color: #2CD2A9;">暂无历史数据<div>',!1;i.innerHTML=r,a.sensorHsBs=Object(c.a)(i.querySelectorAll(".control_timeline")[0])},l=e.split("-").map(function(t){return Number(t)}),d=n[l[0]].devicePropertyDTOList[l[1]],u="bool"===d.dataType||"enum"===d.dataType,t.html('<div class="loader historyload"><div class="loader-inner ball-spin-fade-loader"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>'),i.next=8,a.getDeviceHistory(n[l[0]].id,d.identifier);case 8:p=i.sent,m=p.historyList,f=[],h=[],v="无",m.forEach(function(t){var e=t.value;u?f.push(Object(s.a)(t.timestamp,"年月日")):f.push(new Date(t.timestamp).format("MM.dd hh:mm")),b.includes(p.deviceVO.productKey)&&(e=parseInt(e,10)>=100?"0.1":e),h.push(null===e?null:Object(s.b)(e,2))}),d.specsNumber&&(v=d.specsNumber.unit||v),u?o(v,f,h,t.get(0)):r(v,f,h,t.get(0));case 16:case"end":return i.stop()}},i,a)}))()},_zaNumber:function(t){var e=t.attr("num");if(isNaN(e)){var n=e;"停"===e?n="<i style='color:#FEBD4D;font-style:normal;'>停</i>":"开"===e?n="<i style='color:#30E034;font-style:normal;'>开</i>":"关"===e&&(n="<i style='color:#FD4F4F;font-style:normal;'>关</i>"),t.html(n)}else if((e=Number(e)+"").split("").length>0){for(var a=e.split(""),i="",r=0;r<a.length;r++)"."==a[r]?i+='<span class="number_pointer"></span>':isNaN(a[r])?i+='<span class="number_other">'+a[r]+"</span>":i+='<span class="number_'+a[r]+'"></span>';t.html(i),setTimeout(function(){t.find("span").not(".number_pointer").addClass("aninum")},0)}}}},_=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],a=!0,i=!1,r=void 0;try{for(var o,s=t[Symbol.iterator]();!(a=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);a=!0);}catch(t){i=!0,r=t}finally{try{!a&&s.return&&s.return()}finally{if(i)throw r}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function x(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,n){return function a(i,r){try{var o=e[i](r),s=o.value}catch(t){return void n(t)}if(!o.done)return Promise.resolve(s).then(function(t){a("next",t)},function(t){a("throw",t)});t(s)}("next")})}}var C={data:function(){return{layerGreenSwitch:!1,greenCertList:null,greenCertData:{area:"--",percentageLand:"--"},lawSupervisionId:null,regulatoryVisible:!1,lawSupervisionData:{num:"--",passRate:"--"}}},mounted:function(){},methods:{initFooter:function(){this.getLvseCertData(),this.getLawData()},layerGreenToggle:function(){var t=this;this.layerGreenSwitch=!this.layerGreenSwitch;var e=this.allData.landAndPlantPlanListVOS,n=[];this.syncAreaSelectfn([],!0),e.map(function(e,a){var i=t.isLvseCertLand(t.greenCertList,e.shGisDkid),r=_(i,2),o=r[0];r[1];if(o){var s=t.allpolygon.filter(function(t){return t.areaid===e.id})[0];t.layerGreenSwitch?(n.push(e.id),$(s._path).attr({stroke:"#76ff03","fill-opacity":"0.8",fill:"#76ff03"}).closest("g").append($(s._path))):$(s._path).attr({stroke:e.fillColor,fill:e.fillColor,"fill-opacity":"0.3","stroke-width":"2"})}}),n.length>0&&this.syncAreaSelectfn(n,!1),0===n.length&&this.layerGreenSwitch&&(this.$message("未匹配到对应地块"),this.layerGreenSwitch=!1)},LawDetailToggle:function(){this.plotdialogChange(!1),this.regulatoryVisible=!this.regulatoryVisible,this.regulatoryVisible&&window.layer.closeAll("page")},getLvseCertData:function(){var t=this;return x(regeneratorRuntime.mark(function e(){var n,a,i,r,o,s,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l=function(t){return new Promise(function(e){n.$ajax.post(n.$api.farmDetail.lvsecertLandList,{lvseCompanyId:t}).then(function(t){var n=t.status,a=t.data;200===n&&0==a.respCode&&a.obj?e(a.obj):e(!1)}).catch(function(t){e(!1)})})},s=function(t){return new Promise(function(e){n.$ajax.post(n.$api.nongwei.getBySnkoudaiCompanyId,{snkoudaiCompanyId:t}).then(function(t){var n=t.status,a=t.data;200===n&&0==a.respCode&&a.obj?e(a.obj):e(!1)}).catch(function(t){e(!1)})})},n=t,e.next=5,s(t.companyid);case 5:if((a=e.sent)&&a.id){e.next=8;break}return e.abrupt("return");case 8:if(i=a.id,t.greenCertList||!i){e.next=16;break}return e.next=12,l(i);case 12:r=e.sent,t.greenCertData.area=r.landCertArea,t.allData.allLandArce&&!isNaN(t.allData.allLandArce)&&((o=r.landCertArea/t.allData.allLandArce)>1&&(o=1),o>0&&o<=1&&(t.greenCertData.percentageLand=t.numTofixed(100*o,1))),t.greenCertList=r.list||[];case 16:case"end":return e.stop()}},e,t)}))()},isLvseCertLand:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments[1],n=[!1,-1];if(!t||0===t.length)return n;var a=t.map(function(t){return t.landcode});if(/(\d{18})(\d{3})/g.test(e)){var i=RegExp.$1;a.map(function(t,e){-1!==t.indexOf(i)&&(n[0]=!0,n[1]=e)})}return n},getLawData:function(){var t=this;return x(regeneratorRuntime.mark(function e(){var n,a,i,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=function(t){return new Promise(function(e){n.$ajax.post(n.$api.nongwei.zfgetBySnkoudaiCompanyId,{snkoudaiCompanyId:t}).then(function(t){var n=t.status,a=t.data;200===n&&0==a.respCode&&a.obj?e(a.obj):e(!1)}).catch(function(t){e(!1)})})},n=t,e.next=4,r(t.companyid);case 4:if((a=e.sent)&&a.companyID){e.next=7;break}return e.abrupt("return");case 7:return t.lawSupervisionId=a.companyID,e.next=10,t.getStatisticsList(t.lawSupervisionId);case 10:i=e.sent,t.lawSupervisionData.num=i.totalCount||"--",t.lawSupervisionData.passRate=t.percentHander(i.totalCount,i.totalCountQualified);case 13:case"end":return e.stop()}},e,t)}))()},getStatisticsList:function(t){var e=this;return new Promise(function(n){e.$ajax.post(e.$api.govPatrol.statisticsByCompanyId,{zhiFaCompanyId:t}).then(function(t){var e=t.status,a=t.data;200===e&&0===a.respCode&&n(a.obj),n(!1)})})},percentHander:function(t,e){var n=0;return-1===t||0===t?"--":(t>0&&(t||0===t)&&(n=Number(String(e/t*100).split(".").map(function(t,e){return 0===e?t:t.substr(0,1)}).join("."))),n)}}},S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function k(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function I(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,n){return function a(i,r){try{var o=e[i](r),s=o.value}catch(t){return void n(t)}if(!o.done)return Promise.resolve(s).then(function(t){a("next",t)},function(t){a("throw",t)});t(s)}("next")})}}var D={mixins:[l,w,C],data:function(){return{map:null,loading:!0,allData:{farmDetailVO:{farmName:""},cropVOList:null,landAndPlantPlanListVOS:null},superVisionFlag:!1,certificateVisible:!1,farmid:"",companyname:"",companyid:"",layerSwitch:!1,wxMapLabelLayer:null,showSwitch:!1,allpolygon:[],allMakerLayer:[],controlList:[],nowispoly:!1,isclickarea:!0,layertit:"",playerobj:null,controlIconShow:["农作物","传感器","气象站","摄像头"],zoommapclass:["0","1","2","3","4","zoom110","zoom110","zoom110","zoom110","zoom110","zoom110","zoom1112","zoom1112","zoom13","zoom14","zoom1516 zoom15","zoom1516 zoom16","zoom17","zoom18","zoom192021 zoom19","zoom192021 zoom20","zoom192021 zoom21"],plotdialogVisible:!1,plotId:0,plotTabIndex:1,errorFarm:!1}},provide:function(){return{farmDetailRefs:this}},props:[],created:function(){this.$route.params&&this.$route.params.farmid?this.farmid=this.$route.params.farmid:this.$router.push({path:"/"})},mounted:function(){var t=this;return I(regeneratorRuntime.mark(function e(){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getAllDatefn();case 2:if(n=e.sent){e.next=6;break}return t.errorFarm=!0,e.abrupt("return");case 6:return n.cropVOList&&n.cropVOList.length&&n.cropVOList.map(function(t){return t.select=!1}),n.landAndPlantPlanListVOS&&n.landAndPlantPlanListVOS.length&&n.landAndPlantPlanListVOS.map(function(t){return t.select=!1}),t.allData=n,t.companyid=n.companyVO.id,t.superVisionFlag=1===n.companyVO.supervisionFlag,t.iotMarkData=t.allData.iotFarmConfigVOS,t.newVersionFlag=t.allData.farmDetailVO.zaiotCompanyAccessKey,t.companyname=t.allData.companyVO.companyName,e.next=16,t.initmap();case 16:null===t.newVersionFlag?t.initIotMark():t._initIot(),t.initFooter();case 18:case"end":return e.stop()}},e,t)}))()},methods:{getAllDatefn:function(){var t=this;return new Promise(function(e){t.$ajax.post(t.$api.farmDetail.farmdetail,{farmId:t.farmid}).then(function(t){t.data&&0===t.data.respCode?e(t.data.obj):e(!1)})})},rendermapfn:function(t,e){var n=this;return new Promise(function(a){var i=n,r=L.tileLayer.chinaProvider("TianDiTu.Realm.Map",{id:"layer_line",detectRetina:!1,zIndex:5,maxZoom:21,minZoom:5}),o=L.tileLayer.chinaProvider("Google.Satellite.Map",{id:"layer_google",detectRetina:!1,zIndex:3,maxZoom:21,minZoom:5}),s=(L.tileLayer.chinaProvider("Google.Satellite.Annotion",{id:"layer_google",detectRetina:!1,zIndex:3,maxZoom:21,minZoom:5}),L.tileLayer.chinaProvider("TianDiTu.Satellite.Map",{id:"layer_tiandi",detectRetina:!1,zIndex:2,maxZoom:18,minZoom:5})),l=L.tileLayer.chinaProvider("GaoDe.Normal.Map",{id:"layer_gaodeLabel",detectRetina:!1,zIndex:1,maxZoom:18,minZoom:5}),c=L.map(t,{center:e,zoom:16,zoomControl:!0,attributionControl:!1,dragging:!0,touchZoom:!1,scrollWheelZoom:!0,doubleClickZoom:!0,boxZoom:!1,tap:!1,keyboard:!1,maxZoom:21,minZoom:5}),d=L.layerGroup([r,o,s,l]);n.wxMapLabelLayer=L.tileLayer.chinaProvider("GaoDe.Normal.Annotion",{maxZoom:20,minZoom:5,zIndex:10}),d.addTo(c),n.map=c,c.on("click",function(t){t.latlng;i.eventClickfn(!1)}),c.on("zoomend",function(t){i.markerEditWithZoom(t.target._zoom)}),c.whenReady(function(){a()})})},layerToggle:function(t){t?this.wxMapLabelLayer.addTo(this.map):this.map.removeLayer(this.wxMapLabelLayer),this.layerSwitch=t},initPolygon:function(t,e,n,a,i){var r=this,s=L.polygon(n,{color:a||"#64C3A4",fillColor:a||"#64C3A4",fillOpacity:.3,oldstroke:"#64C3A4",className:"polygonbox",weight:2});s.areaid=e,s.index=this.allpolygon.length,s.on("click",function(t){r.nowispoly=!0,r.eventClickfn(!0,t.target.index)}),this.allpolygon.push(s);if(i.iconsrc.length>0&&i.center[0]&&i.center[1]){var l=[[],[[12,12]],[[24,12],[-1,12]],[[24,0],[0,0],[12,22]],[[24,0],[0,0],[24,24],[0,24]]],c=[[],["m_1"],["m_2_1","m_2_2"],["m_3_1","m_3_2","m_3_3"],["m_4_1","m_4_2","m_4_3","m_4_4"]];i.area<1333.5&&(c.length=0,c=[[],["m_1_noc mnoc"],["m_2_1_noc mnoc","m_2_2_noc mnoc"],["m_3_1_noc mnoc","m_3_2_noc mnoc","m_3_3_noc mnoc"],["m_4_1_noc mnoc","m_4_2_noc mnoc","m_4_3_noc mnoc","m_4_4_noc mnoc"]]);var d=i.iconsrc.length;if(d>4&&(d=4),i.center&&n)if(!o.a.pointerIsInMapfn(i.center,n)&&i.center){i.center.length=0;var u=o.a.indexfn(n,11);i.center=u}for(var p=0;p<d;p++){var m=L.icon({iconUrl:r.aliimgresizefn(i.iconsrc[p],48,48),iconSize:[24,24],iconAnchor:l[d][p],className:c[d][p]+" li_"+t+"_index"}),f=L.marker({lat:i.center[0],lng:i.center[1]},{icon:m}).on("click",function(t){var e=parseInt(t.target._icon.className.split("li_")[1].split("_index")[0]);this.$refs.cropLandListTabs.clickAreaItemfn(this.allData.landAndPlantPlanListVOS[e].id)});r.allMakerLayer.push(f),-1==r.controlList.indexOf("农作物")&&r.controlList.push("农作物")}}return s},editPolygonSelect:function(t){t&&t._path&&($(t._path).attr("stroke","#fff"),$(t._path).attr("stroke-width","4"),this.isclickarea?$(t._path).attr("fill-opacity",.5):this.isclickarea=!0,$(t._path).closest("g").append($(t._path)))},clearPolygonSelect:function(t){$("#homemap .leaflet-pane svg g").find("path").each(function(){var t=.3,e=2;"#76ff03"===$(this).attr("fill")&&(t=.6,e=3),$(this).attr({stroke:$(this).attr("fill"),"stroke-width":e,"fill-opacity":t})})},initCenterZoom:function(t){var e=this,n=[],a=this.allpolygon;if((t=t||!1)||!1,a.length>0){if(!t){t=[];for(var i=0;i<a.length;i++)t.push(i)}for(var r in t){var o=a[t[r]].getBounds();n.push([o._southWest.lat,o._southWest.lng]),n.push([o._northEast.lat,o._northEast.lng])}var s=this.map.getZoom(),l=L.polygon(n,{}).getBounds(),c=this.map.getBoundsZoom(l),d=l.getCenter();s!=c-1?(e.map.once("zoomend",function(){e.mapMovePos("all",80,d)}),e.map.setZoom(c-1)):e.mapMovePos("all",80,d)}},hideLoadingfn:function(t){t||(this.loading=!1,this.showSwitch=!0)},changeAreaPos:function(t){if(!t)return!1;var e=t.getBounds(),n=this.map.getBoundsZoom(e);this.map.setZoom(n-1),this.mapMovePos("area",20,e.getCenter())},selectedArea:function(t,e){if(e)this.clearPolygonSelect(t),this.editPolygonSelect(t),this.changeAreaPos(t);else{this.clearPolygonSelect(this.allpolygon[t[0]]);for(var n=0;n<t.length;n++)this.editPolygonSelect(this.allpolygon[t[n]]);this.initCenterZoom(t)}},mapMovePos:function(t,e,n){var a=this;setTimeout(function(){var i=a.map.getPixelBounds(),r=i.max.y-i.min.y,o=a.map.getBounds(),s=o._northEast.lat-o._southWest.lat;if("area"==t)var l=s/4,c=n;else l=0,c=n;var d=c.lat+l+s*(e/r),u=c.lng;a.map.panTo({lat:d,lng:u})},600)},eventClickfn:function(t,e){var n=this;(!t&&!this.nowispoly||t&&this.nowispoly)&&(setTimeout(function(){n.nowispoly=!1},100),t?n.syncAreaSelectfn([n.allpolygon[e].areaid],!0):n.syncAreaSelectfn([],!0))},markerEditWithZoom:function(t){$(".leaflet-marker-pane").get(0).setAttribute("class","leaflet-pane leaflet-marker-pane "+this.zoommapclass[t])},initmap:function(t){var e,n=this;return new Promise((e=I(regeneratorRuntime.mark(function t(e){var a,i,r,o,s,l,c,d,u,p,m;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=0,r=[],o=[39.942188,116.372267],(s=(a=n).allData.landAndPlantPlanListVOS).map(function(t,e){t.path&&(i++,r=r.concat(JSON.parse(t.path)))}),i>0&&(l=L.polygon(r,{}).getBounds(),o=[(o=l.getCenter()).lat,o.lng]),t.next=9,a.rendermapfn(document.getElementById("homemap"),o);case 9:if(0!==i){t.next=17;break}return t.next=12,a.goaddressCenterfn(n.allData.farmDetailVO);case 12:(c=t.sent)&&a.map.setView({lat:c.lat,lng:c.lng},13),a.hideLoadingfn(),t.next=21;break;case 17:if(s.length>0)for(d=0;d<s.length;d++){if(u={iconsrc:[],center:null,area:0},s[d].cropList)for(u.center=[s[d].landCenterLat,s[d].landCenterLng],p=[0,666.7,66.67,1],u.area=p[s[d].landAcreUnit]*parseFloat(s[d].landAcre),m=0;m<s[d].cropList.length;m++)u.iconsrc.push(s[d].cropList[m].imgUrl);s[d].path&&JSON.parse(s[d].path)instanceof Array&&a.initPolygon(d,s[d].id,JSON.parse(s[d].path),s[d].fillColor,u)}a.initCenterZoom(),$(".leaflet-marker-pane").get(0).setAttribute("class","leaflet-pane leaflet-marker-pane "+a.zoommapclass[a.map.getZoom()]),setTimeout(function(){a.map.addLayer(L.layerGroup([].concat(k(a.allpolygon),k(a.allMakerLayer)))),setTimeout(function(){a.hideLoadingfn()},300)},s.length);case 21:e();case 22:case"end":return t.stop()}},t,n)})),function(t){return e.apply(this,arguments)}))},initAreaPlantLayer:function(t){var e=this;this.plotdialogVisible=!1,window.layer.closeAll("page"),this.plotId=t,this.plotTabIndex=1,this.$nextTick(function(){setTimeout(function(){e.plotdialogVisible=!0},200)})},plotdialogChange:function(t){this.plotdialogVisible=t,t||(this.plotTabIndex=1,this.syncAreaSelectfn([],!0))},syncAreaSelectfn:function(t,e){if(!t||0===t.length)return window.layer.closeAll("page"),this.plotdialogVisible=!1,this.$refs.cropLandListTabs.selectCropAreaList(),this.clearPolygonSelect(),!1;for(var n=e?null:[],a=0;a<t.length;a++)for(var i=0;i<this.allpolygon.length;i++)this.allpolygon[i].areaid==t[a]&&(e?(n=this.allpolygon[this.allpolygon[i].index],this.initAreaPlantLayer(t[a])):n.push(this.allpolygon[i].index));e&&1===t.length&&this.$refs.cropLandListTabs.selectCropAreaList(t[0],!0),this.selectedArea(n,e)},goaddressCenterfn:function(t){var e,n="";return t.provinceName&&(n+=t.provinceName),t.cityName&&(n+=t.cityName),t.countyName&&(n+=t.countyName),t.farmAddress&&(n+=t.farmAddress),e=n,new Promise(function(t){var n=new AMap.Geocoder;n.getLocation(e,function(e,n){if("complete"===e&&n.geocodes.length){var a=n.geocodes[0].location;t(a)}else console.log("根据地址查询位置失败"),t(!1)})})},ifDate:function(t,e,n){var a=["","一","二","三","四","五","六","日"];if(0==arguments.length)return!1;if("number"!=typeof t&&"object"!==(void 0===t?"undefined":S(t))&&"number"==typeof t&&10!=(t+"").length&&14!=(t+"").length)return!1;1!=arguments.length&&2!=arguments.length||(n=(new Date).getTime()),"number"==typeof t?10==(t+"").length&&(t=Number(t+"000")):t=t.getTime();var i=c(n),r=c(t),o=(i-r)/1e3,s=Math.floor(o/86400);if(0==(l=new Date(i).getDay()))var l=7;if(s>=-2&&s<=2){return["后天","明天","今天","昨天","前天"][s+2]}return Math.abs(s)>14-l&&s<0||s>=l+7?d(r,i,e):s>=l&&s<l+7?"上周"+a[Math.abs(s-l-7)]:s<0&&Math.abs(s)<=7-l||s>0&&s<l?"本周"+a[l-s]:s<0&&Math.abs(s)>7-l&&Math.abs(s)<=14-l?"下周"+a[Math.abs(s)+l-7]:d(r,i,e);function c(t){var e=new Date(t),n=e.getFullYear()+"/",a=(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"/",i=e.getDate();return new Date(n+a+i+" 00:00:00").getTime()}function d(t,e,n){if("年月日"==n)var a=n;else a=n||"/";var i=new Date(t),r=new Date(e),o=(i.getFullYear(),r.getFullYear(),"年月日"==n?i.getFullYear()+a[0]:i.getFullYear()+a),s=i.getMonth()+1<10?"0"+(i.getMonth()+1):i.getMonth()+1,l="年月日"==n?i.getMonth()+1+a[1]:s+a,c=i.getDate()<10?"0"+i.getDate():i.getDate(),d="年月日"==n?i.getDate()+a[2]:c;i.getHours(),i.getMinutes(),i.getSeconds();return o+l+d}},pagebackfn:function(){var t=this,e=this.$route.path;this.$router.go(-1),setTimeout(function(){e===t.$route.path&&t.pagebackfn()},200)},closeAllDialogfn:function(){this.eventClickfn(!1),window.layer.closeAll(),this.plotdialogVisible=!1},onIotDetailfn:function(){-1===window.location.origin.indexOf("test")?window.open(this.$api.iotHref.prod):window.open(this.$api.iotHref.dev)},openDialog:function(t){var e=this;this.closeAllDialogfn(),setTimeout(function(){t?e.regulatoryVisible=!0:e.certificateVisible=!0},300)},numTofixed:function(){return s.b.apply(void 0,arguments)}},watch:{controlIconShow:function(t){var e=$("#homemap .leaflet-marker-pane");/农作物/.test(t)?e.find(".leaflet-marker-icon").not(".markitem").show():e.find(".leaflet-marker-icon").not(".markitem").hide(),/摄像头/.test(t)?e.find(".video_marker").show():e.find(".video_marker").hide(),/传感器/.test(t)?e.find(".sensor_marker").show():e.find(".sensor_marker").hide(),/气象站/.test(t)?e.find(".weather_marker").show():e.find(".weather_marker").hide()}},components:{farmDetailsTabs:a.default,cropLandListTabs:i.default,farmdetailFooter:r.default,certificationTabs:function(){return n.e(143).then(n.bind(null,"gdjO"))},regulatoryDialog:function(){return n.e(142).then(n.bind(null,"gdKI"))},plotDetailDialog:function(){return n.e(141).then(n.bind(null,"SXR7"))}},destroyed:function(){window.layer.closeAll(),this.plotdialogVisible=!1,this.playerobj&&this.playerobj.stopload()}},A=n("W5g0");var T=function(t){n("ja/R")},j=Object(A.a)(D,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"title",rawName:"v-title"}],staticClass:"farmdetail",attrs:{"data-title":"经营主体详情"}},[a("div",{staticClass:"homemap_content"},[a("div",{staticClass:"homemap_head"},[a("span",{staticClass:"fl",on:{click:function(e){return t.pagebackfn()}}},[a("img",{attrs:{src:n("HgnC"),alt:""}}),t._v(" "),a("i",[t._v("返回")])]),t._v(" "),t.allData.farmDetailVO.farmName?a("p",{staticClass:"tit"},[t._v(t._s(t.allData.farmDetailVO.farmName))]):t._e(),t._v(" "),t.allData.farmDetailVO.farmName?a("p",{staticClass:"tit subtit"},[t.allData.farmDetailVO.farmAcre?a("span",[t._v("土地流转面积: "),a("i",[t._v(t._s(t.allData.farmDetailVO.farmAcre)+"亩")])]):t._e(),a("span",[t._v("可种植/养殖面积: "),a("i",[t._v(t._s(t.allData.allLandArce)+"亩")])]),a("span",[t._v("在田面积: "),a("i",[t._v(t._s(t.allData.allLandArceOnPlanting)+"亩")])])]):t._e(),t._v(" "),a("ul",{staticClass:"headbtns"},[t.allData.farmDetailVO.zaiotCompanyAccessKey?a("li",{staticClass:"item iotview",on:{click:t.onIotDetailfn}},[t._v("物联网设备总览")]):t._e(),t._v(" "),t.superVisionFlag?a("li",{staticClass:"item certificate",on:{click:function(e){return t.openDialog(!1)}}},[t._v("合格证使用记录")]):t._e()])]),t._v(" "),a("div",{staticClass:"homemap_main"},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"map-loader",attrs:{"element-loading-text":"加载中...","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(1, 27, 41, 0.8)"}}),t._v(" "),a("div",{class:{hidemap:t.loading},attrs:{id:"homemap"}}),t._v(" "),t.errorFarm?a("div",{staticClass:"errorfarm"},[t._v("\n\t\t\t\t未找到对应主体\n\t\t\t")]):t._e()]),t._v(" "),a("div",{staticClass:"homemap_maplayer"},[t.allData.farmGeoCountVO&&0!==t.allData.farmGeoCountVO.landGeoCount&&0!==t.allData.farmGeoCountVO.landNotGenCount?a("p",{staticClass:"status"},[a("span",{staticClass:"draw_areas"},[t._v("绘制轮廓的地块："),a("i",[t._v(t._s(t.allData.farmGeoCountVO.landGeoCount))])]),t._v(" "),a("span",{staticClass:"nodraw_areas"},[t._v("未绘制轮廓的地块："),a("i",[t._v(t._s(t.allData.farmGeoCountVO.landNotGenCount))])])]):t.allData.farmGeoCountVO&&0===t.allData.farmGeoCountVO.landGeoCount?a("p",{staticClass:"status noareastatus"},[t._v("未绘制地块轮廓，无法可视化查看地块信息")]):t._e(),t._v(" "),t.allData.inputVos&&!t.loading?a("farm-details-tabs",{attrs:{farminfo:t.allData,farmId:this.$route.params.farmid},on:{closeAllDialogEv:t.closeAllDialogfn}}):t._e(),t._v(" "),t.allData.cropVOList&&t.allData.landAndPlantPlanListVOS&&!t.loading?a("crop-land-list-tabs",{ref:"cropLandListTabs",attrs:{cropList:t.allData.cropVOList,landList:t.allData.landAndPlantPlanListVOS}}):t._e(),t._v(" "),t.controlList.length>1?a("div",{staticClass:"controlshow"},[a("el-checkbox-group",{model:{value:t.controlIconShow,callback:function(e){t.controlIconShow=e},expression:"controlIconShow"}},[a("span",{staticClass:"title"},[t._v("显示内容:")]),t._v(" "),a("div",{staticClass:"all-checkbox"},t._l(t.controlList,function(t,e){return a("el-checkbox",{key:e,attrs:{label:t}})}),1)])],1):t._e()],1),t._v(" "),t.showSwitch?a("div",{staticClass:"layer-ctrl"},[a("el-switch",{attrs:{"active-color":"#00F6FF","inactive-color":"#E5E5E5","active-text":"显示地名",width:"32"},on:{change:t.layerToggle},model:{value:t.layerSwitch,callback:function(e){t.layerSwitch=e},expression:"layerSwitch"}})],1):t._e(),t._v(" "),t.superVisionFlag&&!t.loading?a("farmdetail-footer",{attrs:{greenIsShow:t.layerGreenSwitch,lawSupervisionData:t.lawSupervisionData,greenCertData:t.greenCertData},on:{highlightshowev:t.layerGreenToggle,viewlawdetailev:t.LawDetailToggle}}):t._e()],1),t._v(" "),t.plotdialogVisible?a("plotDetailDialog",{attrs:{plotdialogVisible:t.plotdialogVisible,"plot-id":"","land-id":t.plotId,"gis-type":0,plotTabIndex:t.plotTabIndex,showThreeTab:!0},on:{plotdialogChangeEv:t.plotdialogChange,"update:plotTabIndex":function(e){t.plotTabIndex=e},"update:plot-tab-index":function(e){t.plotTabIndex=e}}}):t._e(),t._v(" "),t.regulatoryVisible?a("regulatory-dialog",{attrs:{regulatoryVisible:t.regulatoryVisible,lawSupervisionId:t.lawSupervisionId},on:{"update:regulatoryVisible":function(e){t.regulatoryVisible=e},"update:regulatory-visible":function(e){t.regulatoryVisible=e}}}):t._e(),t._v(" "),t.certificateVisible?a("certificationTabs",{attrs:{certificateVisible:t.certificateVisible,companyid:t.companyid,farmid:t.farmid},on:{"update:certificateVisible":function(e){t.certificateVisible=e},"update:certificate-visible":function(e){t.certificateVisible=e}}}):t._e()],1)},[],!1,T,"data-v-1438800f",null);e.default=j.exports},"5y8e":function(t,e){t.exports="https://snkoudai.oss-cn-hangzhou.aliyuncs.com/goverment/static/img/weather2_lower.87e225d.png"},"8b9Y":function(t,e){},AJ8d:function(t,e){t.exports="https://snkoudai.oss-cn-hangzhou.aliyuncs.com/goverment/static/img/weatherbg_1.22fdf1b.png"},B4o8:function(t,e){t.exports="https://snkoudai.oss-cn-hangzhou.aliyuncs.com/goverment/static/img/poster.e8c2c6c.jpg"},FChz:function(t,e){t.exports="https://snkoudai.oss-cn-hangzhou.aliyuncs.com/goverment/static/img/sensor2.4975d50.png"},HgnC:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAAAxUlEQVRIie3UsQkCMQBG4T/a2QiCiCA4gUu4hljYWFjY2DiJzuEMNhaChYVYOIggPpvAhejpJVys8iBFjoMvhCRSLpf7FvBptIADRauS/95GDNgEdhZ6AsuqWCy4cbBFCBYDrh1sHoqFghMLPYBZDBYCjoG7xaaxWBloPHAkaS+p/Xt5vzPGGP9bw5tv68IqBQyBmz0sSbbUBwUMgKuDJj80AvrA5Z/XQkAPODto8osvoAucHDT50yagAxwpqu/xzuVykvQCKwD3YxUJ+sAAAAAASUVORK5CYII="},Ivz0:function(t,e){t.exports="https://snkoudai.oss-cn-hangzhou.aliyuncs.com/goverment/static/img/weather_on.9596a4d.png"},LCol:function(t,e){t.exports="https://snkoudai.oss-cn-hangzhou.aliyuncs.com/goverment/static/img/weather.e6e1eb7.png"},SYE9:function(t,e,n){"use strict";var a={indexfn:function(t,e){console.time("获取中心点时间");var n=this,a=+new Date,i=JSON.parse(JSON.stringify(t[0])),r=this.getBoundPinterfn(t),o=r[0][1],s=r[0][0],l=r[1][1]-r[0][1],c=r[0][0]-r[1][0],d=(e*c/l).toFixed(5),u=this.printMatrix(this.newMarixFn(e,d)),p=l/(e-1),m=c/(d-1);u=u.reverse();var f=function e(i){if(+new Date-a>200)return!1;if(0==i)return!1;for(var r=[],l=0;l<u.length;l++){var c=u[l].split("-"),d=o+parseInt(c[0])*p,f=s-parseInt(c[1])*m;if(n.morePoinersInMapfn([f,d],t,i)){r.push(f),r.push(d);break}}return r.length>0?r:e(i/2)}(l/(e-1)*4);return f&&(i.length=0,i=f),console.timeEnd("获取中心点时间"),i},morePoinersInMapfn:function(t,e,n){for(var a=[],i=[[0,0],[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1],[0,1],[1,1]],r=0;r<i.length;r++){var o=this.pointerIsInMapfn([t[0]+i[r][1]*n,t[1]+i[r][0]*n],e);a.push(o)}return a.every(function(t){return t})},printMatrix:function(t){if(null!=t&&0!=t[0].length){for(var e=t.length,n=t[0].length,a=0,i=[];n>2*a&&e>2*a;){for(var r=n-1-a,o=e-1-a,s=a;s<=r;s++)i.push(t[a][s]);if(a<o)for(s=a+1;s<=o;s++)i.push(t[s][r]);if(a<r&&a<o)for(s=r-1;s>=a;s--)i.push(t[o][s]);if(a<r&&a<o-1)for(s=o-1;s>=a+1;s--)i.push(t[s][a]);a++}return i}},newMarixFn:function(t,e){if(t<0||e<0)return[];for(var n=[],a=0;a<t;a++){for(var i=[],r=0;r<e;r++){var o;o=a+"-"+r,i.push(o)}n.push(i)}return n},getBoundPinterfn:function(t){var e=L.polygon(t,{}).getBounds();return[[e.getNorthWest().lat,e.getNorthWest().lng],[e.getSouthEast().lat,e.getSouthEast().lng]]},pointerIsInMapfn:function(t,e){if(t&&e)return!!gju.pointInPolygon({type:"Point",coordinates:t},{type:"Polygon",coordinates:[e]})}};e.a=a},VD73:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});n("PvbX");var a={name:"cropLandListTabs",data:function(){return{activeName:"种养品种",allimg:{imga:n("Pzue"),imgb:n("XJN0"),imgc:n("NUlc"),imgd:n("1WKC"),lvseimg:n("sqi+")},landStatusMap:["-","使用中","闲置中"],prevclicktime:0,isClickLandList:!1}},props:{cropList:{default:function(){return[]},type:Array},landList:{default:function(){return[]},type:Array}},computed:{},created:function(){},mounted:function(){var t,e=this;return(t=regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.initListScrollfn(!0);case 1:case"end":return t.stop()}},t,e)}),function(){var e=t.apply(this,arguments);return new Promise(function(t,n){return function a(i,r){try{var o=e[i](r),s=o.value}catch(t){return void n(t)}if(!o.done)return Promise.resolve(s).then(function(t){a("next",t)},function(t){a("throw",t)});t(s)}("next")})})()},methods:{initListScrollfn:function(t){var e=this;t?this.$nextTick(function(){$(e.$refs.croplistref).niceScroll({cursorcolor:"rgba(0, 247, 255 ,0.4)",cursorwidth:"3px",cursorborder:"",autohidemode:!0,smoothscroll:!1,railpadding:{top:0,right:-10,left:0,bottom:0}})}):this.$nextTick(function(){$(e.$refs.arealistref).niceScroll({cursorcolor:"rgba(0, 247, 255 ,0.4)",cursorwidth:"3px",cursorborder:"",autohidemode:!0,smoothscroll:!1,railpadding:{top:0,right:-10,left:0,bottom:0}})})},clickCropItemfn:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments[1];if(this.preventFastClicks()){for(var n=!1,a=0;a<t.length;a++)for(var i=0;i<this.$parent.allpolygon.length;i++)this.$parent.allpolygon[i].areaid==t[a]&&(n=!0);window.layer.closeAll("page"),this.$parent.plotdialogVisible=!1,t&&t.length>=1&&n?(this.$parent.isclickarea=!1,this.$parent.syncAreaSelectfn(t,!1),this.selectCropAreaList(e,!1)):(this.$parent.syncAreaSelectfn([],!1),this.$message("该品种的地块未绘制轮廓，无法在地图中查看"))}},clickAreaItemfn:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.preventFastClicks()){if(n)return this.$parent.isclickarea=!0,this.$parent.syncAreaSelectfn([],!1),this.$message("该地块未绘制轮廓，无法在地图中查看"),!1;this.isClickLandList=!0,setTimeout(function(){e.isClickLandList=!1}),this.selectCropAreaList(t,!0),this.$parent.syncAreaSelectfn([t],!0)}},selectCropAreaList:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.cropList.map(function(t){return t.select=!1}),this.landList.map(function(t){return t.select=!1}),n&&(this.activeName="地块",this.initListScrollfn(!1)),-1!==e&&(n?this.landList.map(function(n){n.id===e&&(n.path?n.select=!0:t.$message("该地块未绘制轮廓，无法在地图中查看"))}):this.cropList[e].select=!0)},preventFastClicks:function(){var t=!1,e=Date.parse(new Date);return this.prevclicktime&&e<this.prevclicktime+500?t=!1:(t=!0,this.prevclicktime=Date.parse(new Date)),t}},watch:{landList:{handler:function(){var t=this,e=-1;if(this.landList.map(function(t,n){t.select&&(e=n)}),!this.isClickLandList&&-1!==e){var n=60*(e-3);n=n<0?0:n,this.initListScrollfn(!1),setTimeout(function(){$(t.$refs.arealistref).getNiceScroll(0).doScrollTop(n,100)},200)}},deep:!0}}},i=n("W5g0");var r=function(t){n("8b9Y")},o=Object(i.a)(a,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"tabs-container fr landdrap"},[n("div",{staticClass:"tabs-wrap"},[n("el-tabs",{on:{"tab-click":function(e){t.initListScrollfn("0"===e.index)}},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[n("el-tab-pane",{attrs:{label:"种养品种",name:"种养品种"}},[n("div",{staticClass:"tabitem"},[n("div",{ref:"croplistref",staticClass:"plantlistcon"},[t.cropList.length?n("ul",t._l(t.cropList,function(e,a){return n("li",{key:e.cropId,staticClass:"clearfix",class:{active:e.select},attrs:{cropid:e.cropId},on:{click:function(){t.clickCropItemfn(e.landIdList,a)}}},[n("div",{staticClass:"plantimg plant-pic"},[n("img",{attrs:{src:t.aliimgresizefn(e.imgUrl,40,40),alt:"loading"}})]),t._v(" "),n("div",{staticClass:"plantname"},[t._v(t._s(e.cropName))]),t._v(" "),n("div",{staticClass:"plot-area"},[t._v(t._s(e.allLandAcre)+"亩")])])}),0):n("ul",[n("li",{staticClass:"clearfix noplant"},[n("p",[n("img",{attrs:{src:t.allimg.imgb,alt:""}})]),t._v(" "),n("p",[t._v("暂无种养品种")])])])])])]),t._v(" "),n("el-tab-pane",{attrs:{label:"地块",name:"地块"}},[n("div",{staticClass:"tabitem"},[n("div",{ref:"arealistref",staticClass:"arealistcon"},[t.landList.length?n("ul",t._l(t.landList,function(e,a){return n("li",{key:e.id,staticClass:"clearfix",class:{active:e.select,item_noarea:!e.path},attrs:{areaid:e.id},on:{click:function(){t.clickAreaItemfn(e.id,!e.path)}}},[n("div",{staticClass:"areaimg"},[n("img",{attrs:{src:e.landTypeImgUrl,alt:"loading"}})]),t._v(" "),n("div",{staticClass:"areaname"},[t._v("\n\t\t\t\t\t\t\t\t\t"+t._s(e.landName)+"\n\t\t\t\t\t\t\t\t\t"),e.path?t._e():n("span",{staticClass:"editarea",attrs:{title:"未绘制轮廓"}},[n("i")])]),t._v(" "),n("div",{staticClass:"status plant",class:["plant_"+e.landStatus]},[t._v(t._s(t.landStatusMap[e.landStatus]))])])}),0):n("ul",[n("li",{staticClass:"clearfix noarea"},[n("p",[n("img",{attrs:{src:t.allimg.imgc,alt:""}})]),t._v(" "),n("p",[t._v("尚未添加地块")])])])])])])],1)],1)])},[],!1,r,"data-v-12329682",null);e.default=o.exports},"ja/R":function(t,e){},mrfU:function(t,e){t.exports="https://snkoudai.oss-cn-hangzhou.aliyuncs.com/goverment/static/img/camera.f58f065.png"},n0y3:function(t,e){t.exports="https://snkoudai.oss-cn-hangzhou.aliyuncs.com/goverment/static/img/weather2_common.710f3fd.png"},o9yN:function(t,e){t.exports="https://snkoudai.oss-cn-hangzhou.aliyuncs.com/goverment/static/img/sensor_on.0c2a51e.png"},rBfV:function(t,e){t.exports="https://snkoudai.oss-cn-hangzhou.aliyuncs.com/goverment/static/img/camera_on.d47cce6.png"},rO80:function(t,e){t.exports="https://snkoudai.oss-cn-hangzhou.aliyuncs.com/goverment/static/img/weatherbg_2.9f140d6.gif"},"x/VB":function(t,e){t.exports="https://snkoudai.oss-cn-hangzhou.aliyuncs.com/goverment/static/img/sensor.1ca064e.png"}});
//# sourceMappingURL=49.0169dc9279a8268e04e2.js.map