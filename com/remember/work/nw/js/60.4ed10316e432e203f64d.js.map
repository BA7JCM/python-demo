{"version":3,"file":"static/js/60.4ed10316e432e203f64d.js","sources":["webpack:///src/pages/landSource.vue"],"sourcesContent":["<template>\r\n  <!-- 自然资源监管 -->\r\n  <div class=\"layout-container\" v-title data-title=\"自然资源监管\">\r\n    <div class=\"item-container\">\r\n      <div class=\"s-item-wrap\">\r\n        <div class=\"_s-item-wrap\">\r\n          <freetek-box title=\"用地类型分布\">\r\n            <div ref=\"lTypeDis\" class=\"pie-charts-container\"></div>\r\n          </freetek-box>\r\n        </div>\r\n      </div>\r\n      <div class=\"s-item-wrap\">\r\n        <div class=\"_s-item-wrap\">\r\n          <freetek-box title=\"用地类型明细\">\r\n            <div class=\"table-container\">\r\n              <el-table\r\n                :data=\"landTypeDetails\"\r\n                stripe\r\n                height=\"100%\"\r\n                width=\"100%\"\r\n                ref=\"landTypeDetails\"\r\n              >\r\n                <el-table-column\r\n                  prop=\"landType\"\r\n                  label=\"用地类型\"\r\n                >\r\n                </el-table-column>\r\n                <el-table-column\r\n                  prop=\"area\"\r\n                  min-width=\"116px\"\r\n                  label=\"面积（万亩）\"\r\n                >\r\n                </el-table-column>\r\n                <el-table-column\r\n                  prop=\"numberOfPlots\"\r\n                  label=\"地块数\"\r\n                >\r\n                </el-table-column>\r\n              </el-table>\r\n            </div>\r\n          </freetek-box>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"b-item-wrap\">\r\n      <div class=\"_b-item-wrap\">\r\n        <freetek-box title=\"\" size=\"big\">\r\n          <!-- <transition name=\"fade\" slot=\"title\">\r\n             <div class=\"titles-wrap\" v-if=\"showTitles\">\r\n               <ul class=\"titles\">\r\n                 <li class=\"title\" v-for=\"(title, index) in soilPHTitles\" @click=\"soilPHTitle = index\"\r\n                     :class=\"{active: soilPHTitle === index}\">\r\n                   {{title}}\r\n                 </li>\r\n               </ul>\r\n             </div>\r\n           </transition>-->\r\n\r\n          <mappart :gisdata=\"gisdata\" :gisget=\"gisget\" v-if=\"gisdata\"></mappart>\r\n        </freetek-box>\r\n      </div>\r\n    </div>\r\n    <div class=\"item-container\">\r\n      <div class=\"s-item-wrap\">\r\n        <div class=\"_s-item-wrap\">\r\n          <freetek-box title=\"种养面积分布\">\r\n            <div ref=\"pStandardDis\" class=\"pie-charts-container\"></div>\r\n          </freetek-box>\r\n        </div>\r\n      </div>\r\n      <div class=\"s-item-wrap\">\r\n        <div class=\"_s-item-wrap\">\r\n          <freetek-box title=\"种养面积明细\">\r\n            <div class=\"table-container\">\r\n              <el-table\r\n                :data=\"plantingStandardDetails\"\r\n                stripe\r\n                height=\"100%\"\r\n                width=\"100%\"\r\n                ref=\"plantingStandardDetails\"\r\n              >\r\n                <el-table-column\r\n                  prop=\"plantStandard\"\r\n                  label=\"种养品种\"\r\n                >\r\n                </el-table-column>\r\n                <el-table-column\r\n                  prop=\"area\"\r\n                  min-width=\"116px\"\r\n                  label=\"面积（万亩）\"\r\n                >\r\n                </el-table-column>\r\n                <el-table-column\r\n                  prop=\"numberOfPlots\"\r\n                  label=\"地块数\"\r\n                >\r\n                </el-table-column>\r\n              </el-table>\r\n            </div>\r\n          </freetek-box>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\nimport freetekBox from '../components/freetekBox';\r\nimport mappart from '../components/landsource/mappart';\r\nimport {\r\n  deepCopy,\r\n  _initBScroll,\r\n  maxDecimalPlaces,\r\n  areaLevelCorAreaId\r\n} from '@/common/fn';\r\nimport { getStorage } from '@/utils/storage';\r\n\r\n// echarts 超级变量含义 {a} series.name, {b} data.name {c} data.value {d} data%\r\nconst piePublicOpts = {\r\n  tooltip: {\r\n    show: true,\r\n    trigger: 'item',\r\n    formatter: '{b} <br/>面积: {c}万亩({d}%)'\r\n  },\r\n  color: [\r\n    '#E6AA4A',\r\n    '#BD4280',\r\n    '#A778F9',\r\n    '#AFBE3D',\r\n    '#0FEF34',\r\n    '#01B649',\r\n    '#32CEBB',\r\n    '#02B8FF',\r\n    '#7EE2E1',\r\n    '#85B5D5',\r\n    '#c4ccd3'\r\n  ],\r\n  textStyle: {\r\n    color: '#9DD1D7',\r\n    fontSize: 14,\r\n    fontWeight: '400',\r\n    lineHeight: 14\r\n  },\r\n  series: [\r\n    {\r\n      name: '用地类型分布',\r\n      type: 'pie',\r\n      radius: ['44%', '60%'],\r\n      avoidLabelOverlap: true,\r\n      minAngle: 15,\r\n      startAngle: 30,\r\n      label: {\r\n        normal: {\r\n          show: true,\r\n          position: 'outside',\r\n          formatter: '{b}: {d}%'\r\n        }\r\n      },\r\n      labelLine: {\r\n        normal: {\r\n          show: true,\r\n          length: 10,\r\n          length2: 20\r\n        }\r\n      },\r\n      hoverAnimation: false,\r\n      data: []\r\n    },\r\n    {\r\n      type: 'pie',\r\n      radius: ['47.9%', '54.4%'],\r\n      minAngle: 15,\r\n      startAngle: 90,\r\n      itemStyle: {\r\n        normal: {\r\n          show: true,\r\n          color: 'rgba(255,255,255,0.42)'\r\n        },\r\n        emphasis: {\r\n          show: true,\r\n          color: 'rgba(255,255,255,0.42)'\r\n        }\r\n      },\r\n      animation: true,\r\n      labelLine: {\r\n        show: false\r\n      },\r\n      hoverAnimation: false,\r\n      z: 3,\r\n      tooltip: {\r\n        show: false\r\n      },\r\n      data: [0]\r\n    }\r\n  ]\r\n};\r\nconst farmAreaInfo = areaLevelCorAreaId();\r\nconst groupFlag = getStorage('govGovernmentSubjectVO').groupFlag;\r\n\r\nexport default {\r\n  name: 'landSource',\r\n  data () {\r\n    return {\r\n      // 用地类型分布\r\n      lTypeDis: null,\r\n      // 用地类型分布数据\r\n      lTypeDisData: deepCopy(piePublicOpts),\r\n      // 种养面积分布\r\n      pStandardDis: null,\r\n      // 种养面积分布数据\r\n      pStandardDisData: deepCopy(piePublicOpts),\r\n      // 用地类型明细\r\n      landTypeDetails: null,\r\n      // 种养面积明细\r\n      plantingStandardDetails: null,\r\n      // gis 数据\r\n      gisdata: null,\r\n      lTypeDScroll: null,\r\n      pSDScroll: null,\r\n      gisget: false// 是否已经调用gis数据接口\r\n    };\r\n  },\r\n  mounted () {\r\n    this.$nextTick(() => {\r\n      this.lTypeDis = this._initEcharts(this.$refs.lTypeDis, this.lTypeDisData);\r\n\r\n      this.pStandardDis = this._initEcharts(this.$refs.pStandardDis, this.pStandardDisData);\r\n\r\n      this.lTypeDScroll = _initBScroll(this.$refs.landTypeDetails.$el.querySelector('.el-table__body-wrapper'));\r\n      this.pSDScroll = _initBScroll(this.$refs.plantingStandardDetails.$el.querySelector('.el-table__body-wrapper'));\r\n\r\n      this.lTypeDis.resize();\r\n      this.pStandardDis.resize();\r\n      this.getAllData();\r\n      this.renderLandType();\r\n      this.getStatisticsAcre();\r\n    });\r\n    window.onresize = () => {\r\n      this.lTypeDis.resize();\r\n      this.pStandardDis.resize();\r\n    };\r\n  },\r\n  /* keep-alive 生命周期 */\r\n  activated () {\r\n  },\r\n  deactivated () {\r\n    // console.log(\"deactivated\");\r\n  },\r\n  /* end keep-alive */\r\n  methods: {\r\n    // 获取用地类型\r\n    getPlotTypeStatistical () {\r\n      return this.$ajax.post(this.$api.plotlist.landTypeDistributionlist, {})\r\n        .then(({ data }) => {\r\n          if (data.respCode === 0) {\r\n            return data.obj;\r\n          }\r\n        })\r\n        .catch((e) => {\r\n          console.log(new Error('获取用地类型'), e);\r\n        });\r\n    },\r\n    // 获取用地类型---非集团版本\r\n    getAreaLandTypeDistribution () {\r\n      return this.$ajax.post(this.$api.public.areaLandTypeDistribution, {\r\n        farmAreaId: [farmAreaInfo.farmAreaId],\r\n        farmAreaType: farmAreaInfo.farmAreaType\r\n      })\r\n        .then(({ data }) => {\r\n          if (data.respCode === 0) {\r\n            return data.obj;\r\n          }\r\n        })\r\n        .catch((e) => {\r\n          console.log(new Error('获取用地类型---非集团版本'), e);\r\n        });\r\n    },\r\n    // 渲染用地类型分布\r\n    async renderLandType () {\r\n      const res = await (groupFlag === 0 ? this.getAreaLandTypeDistribution : this.getPlotTypeStatistical)();\r\n      this.landTypeDetails = res.list.map((item) => {\r\n        // console.log(item);\r\n        return {\r\n          landType: item.landType,\r\n          area: item.landAcre / 10000, // maxDecimalPlaces({ value: item.landAcre })\r\n          numberOfPlots: item.landNum\r\n        };\r\n      });\r\n      this.lTypeDis.setOption({\r\n        series: [\r\n          {\r\n            name: '用地类型分布',\r\n            data: this.landTypeDetails.map((item) => {\r\n              return {\r\n                name: item.landType,\r\n                value: item.area\r\n              };\r\n            })\r\n          }\r\n        ]\r\n      });\r\n\r\n      this.$nextTick(() => {\r\n        this.lTypeDScroll.refresh();\r\n      });\r\n    },\r\n\r\n    /**\r\n       * 初始化echarts\r\n       * _initEcharts\r\n       * @param el\r\n       * @param option\r\n       * @returns chart 实例\r\n       * @private\r\n       */\r\n    _initEcharts (el, option) {\r\n      const chart = this.$echarts.init(el);\r\n      chart.setOption(option);\r\n      return chart;\r\n    },\r\n\r\n    getAllData () {\r\n      this.$ajax.post(this.$api.landSource.index, {})\r\n        .then((response) => {\r\n          const res = response.data;\r\n          let data;\r\n          if (res.respCode === 0) {\r\n            data = res.obj;\r\n            this.gisget = true;\r\n            this.gisdata = data.gisDistributionVOList;\r\n            // console.log('select选项：',this.gisdata);\r\n            // 用地类型\r\n            return true;\r\n          }\r\n        });\r\n    },\r\n\r\n    // 2019-12-27 10:47:08 修改\r\n    getStatisticsAcre () {\r\n      this.$ajax.post(this.$api.landSource.statisticsAcre, {\r\n        farmAreaId: [farmAreaInfo.farmAreaId],\r\n        farmAreaType: farmAreaInfo.farmAreaType\r\n      })\r\n        .then(({ data: res }) => {\r\n          const data = res.obj;\r\n          let plantChartData;\r\n          if (res.respCode === 0) {\r\n            try {\r\n              // 标准\r\n              this.plantingStandardDetails = data.plantAcreAndLandNumVOS.map((item) => {\r\n                return {\r\n                  plantStandard: item.cropName,\r\n                  area: maxDecimalPlaces({ value: item.sumPlantAcre / 10000, places: 4 }),\r\n                  numberOfPlots: item.landNum\r\n                };\r\n              });\r\n              plantChartData = data.plantAcreAndCropVOS.map((item) => {\r\n                return {\r\n                  name: item.cropName,\r\n                  value: maxDecimalPlaces({ value: item.sumPlantAcre / 10000, places: 4 })\r\n                };\r\n              });\r\n              this.pStandardDis.setOption({\r\n                tooltip: {\r\n                  position (p, params, dom) {\r\n                    p[0] = p[0] - dom.clientWidth - 40;\r\n                    return [p[0], p[1]];\r\n                  }\r\n                },\r\n                series: [\r\n                  {\r\n                    name: '种养面积分布',\r\n                    data: plantChartData\r\n                  }\r\n                ]\r\n              });\r\n            } catch (e) {\r\n              console.log('后台没有数据，错误被抛出！', e);\r\n            }\r\n            this.$nextTick(() => {\r\n              this.pSDScroll.refresh();\r\n            });\r\n            return true;\r\n          }\r\n        });\r\n    }\r\n  },\r\n\r\n  components: {\r\n    freetekBox,\r\n    mappart\r\n  }\r\n};\r\n</script>\r\n<style scoped lang=\"scss\">\r\n  // 表格皮肤样式\r\n  @import \"~styles/tableSkin_default\";\r\n  @import \"~styles/scrollbarSkin_default\";\r\n\r\n  .layout-container {\r\n    padding: 5px 0 10px 0;\r\n    width: 100%;\r\n    box-sizing: border-box;\r\n    display: flex;\r\n    justify-content: space-between;\r\n    /*min-height: 600px;*/\r\n    flex: 1;\r\n\r\n    .item-container {\r\n      width: 26.80%;\r\n      flex: 1;\r\n      display: flex;\r\n      justify-content: space-between;\r\n      flex-direction: column;\r\n\r\n      .s-item-wrap {\r\n        height: calc(100% / 2 - 10px);\r\n        position: relative;\r\n\r\n        ._s-item-wrap {\r\n          position: absolute;\r\n          top: 0;\r\n          left: 0;\r\n          height: 100%;\r\n          width: 100%;\r\n\r\n          .pie-charts-container {\r\n            width: 100%;\r\n            height: 100%;\r\n          }\r\n\r\n          .table-container {\r\n            width: 100%;\r\n            height: 100%;\r\n            -webkit-box-sizing: border-box;\r\n            -moz-box-sizing: border-box;\r\n            box-sizing: border-box;\r\n            padding: 0 25px;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    .b-item-wrap {\r\n      width: 45.42%;\r\n      margin: 0 auto;\r\n      position: relative;\r\n\r\n      ._b-item-wrap {\r\n        position: absolute;\r\n        top: 0;\r\n        left: 0;\r\n        width: 100%;\r\n        height: 100%;\r\n\r\n        .titles-wrap {\r\n          position: absolute;\r\n          top: 46px;\r\n          left: 50%;\r\n          transform: translateX(-50%);\r\n          width: 196px;\r\n          z-index: 99999;\r\n\r\n          &:before {\r\n            content: '';\r\n            position: absolute;\r\n            top: -9px;\r\n            left: 50%;\r\n            transform: translateX(-50%);\r\n            width: 0;\r\n            height: 0;\r\n            border: 5px solid transparent;\r\n            border-bottom-color: rgba(0, 0, 0, .9);\r\n          }\r\n\r\n          .titles {\r\n            border-radius: 10px;\r\n            box-shadow: 0px 0px 38px 0px rgba(0, 246, 255, 0.41);\r\n            overflow: hidden;\r\n            background-color: rgba(0, 0, 0, .9);\r\n\r\n            .title {\r\n              height: 42px;\r\n              line-height: 42px;\r\n              text-align: center;\r\n              font-size: 16px;\r\n              color: #9DD1D7;\r\n              font-weight: 400;\r\n              cursor: pointer;\r\n\r\n              &.active,\r\n              &:hover {\r\n                color: #00F6FF;\r\n                background: rgba(0, 246, 255, 0.2);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /deep/ .mapcontain {\r\n    box-sizing: border-box;\r\n    padding: 0 100px;\r\n  }\r\n\r\n  /deep/ .el-table--scrollable-y .el-table__body-wrapper {\r\n    overflow: hidden;\r\n  }\r\n\r\n  /deep/ .el-table--scrollable-x .el-table__body-wrapper {\r\n    overflow: hidden;\r\n  }\r\n\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/pages/landSource.vue"],"mappings":"AAqHA","sourceRoot":""}